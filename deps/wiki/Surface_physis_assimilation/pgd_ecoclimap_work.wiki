[[PageOutline]]
[[Center(begin)]]
= '''PGD and ECOCLIMAP work''' =

Last modified [[LastModified]]
[[Center(end)]]


'''This page was first created as 'memory notes' from the snow discussion held at the [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Surface201604 Surface meeting in Oslo, April 2016].''' People involved in the discussion: Mariken Homleid (Met Norway), Yurii Batrak (Met Norway), Jeanette Onvlee (KNMI), Laura Rontu (FMI), Ekaterina Kurzeneva (FMI), Patrick Samuelsson (SMHI), Magnus Lindskog (SMHI), Bolli Palmason (IMO)

== Replace a default ECOCLIMAP physiography field with external data (in this case tree height) ==

Any physiography in ECOCLIMAP/SURFEX that is specified in [http://www.umr-cnrm.fr/surfex/spip.php?article37 SURFEX namelist NAM_DATA_ISBA] can be read from an external data source which means that the default field is replaced. In this case we replace the tree height data:
{{{
 NAM_DATA_ISBA=>{
    'CFNAM_H_TREE(1)'  => '"tree_height_metcoop.dat",',
    'CFTYP_H_TREE(1)'  => '"ASCLLV",',
},
}}}
where tree_height_metcoop.dat has the format
{{{
     52.0497246      28.2909050 2.05343e+01
     52.0451813      28.3260918 1.97938e+01
     52.0406265      28.3612728 2.28008e+01
     52.0622673       1.6313438 1.00000e+20
     52.0668259       1.6665424 1.00000e+20
}}}
tree_height_metcoop.dat must be made available in the {{{$HM_CLDATA/PGD}}} directory.

The motivation for replacing tree height data for the !MetCoOp domain and the resulting impact on the forecasted U10m is [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/pgd_ecoclimap_work/Patrick_Samuelsson_et_al_Newsletter_10.pdf described in this report].

The three tree data sets used for the processing are available here:
 * At ECMWF, cca:/project/hirlam/harmonie/climate/TREE_HEIGHT_INPUT
 * At the HIRLAM server, [https://hirlam.org/portal/download/tree_height_raw_data_MetCoOp.tgz]

The preparation of the mixed tree height data set (tree_height_metcoop.dat) has been done in [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/pgd_ecoclimap_work/tree_height_calc_for_MetCoOp.m MATLAB with this script].

The modifications needed in the HARMONIE-AROME configuration to allow reading and processing of the external tree height data are divided into three changesets:
 * [https://hirlam.org/trac/changeset/16548 Introduction of external physiography field for tree height, H_TREE, and...]
 * [https://hirlam.org/trac/changeset/16552 Modification for correct processing of XUNDEF in input physiography ASCII...]
 * [https://hirlam.org/trac/changeset/16553 Limiting of momentum roughness length over land to maximum 1.6 m.]

== ECOCLIMAP binary cover file ==

The ECOCLIMAP cover files are in general not connected to SURFEX versions. But, if new covers are added SURFEX needs to be modified.

 * Katya showed a table on how she has modified ECOCLIMAP 2.1(?) with respect to covers and inland water (Katya please attach table to this page). These changes need to be moved to later ECOCLIMAP version corresponding to what is operational.
 * Bolli referred to [https://hirlam.org/trac/raw-attachment/wiki/HarmonieWorkingWeek/Surface201604/harmonie_imo-201604.pdf his presentation] on changes made in the ECOCLIMAP file over Iceland. Modifications of the Greenland ice edge are part of these changes. So far changes are only made using existing cover numbers (integers) but Bolli would like to add new cover numbers since the existing ones do not cover Icelandic needs. Note, with new covers three SURFEX files need to be modified and one needs to be added:  
    * ini_data_cover.F90 (modified)
    * modd_data_cover_par.F90 (modified)
    * read_covers_param.F90 (modified)
    * coverxxx_xxx.F90 (added for the new range of covers xxx-xxx)

It was concluded that we should merge our changes before they are communicated to the SURFEX team as an updated version of ECOCLIMAP. Katya and Bolli coordinate this merging.

== The ASCII files for characteristics per cover ==

The characteristic files are connected to specific SURFEX versions. Thus, now modifications are needed to fulfil cy40h (SURFEXv7.3) but when we move to cy43h (SURFEXv8) later such changes need to be forwarded to the corresponding SURFEXv8 files.

 * Katya has modified the tables for some specific cover numbers since the fraction of inland water was not realistic. See her table. 
 * Bolli is modifying LAI values for some of the cover types based on MODIS data.

Katya and Bolli coordinate how the merging of characteristic files should be done.

== clay/sand binary files ==

 * Bolli has changed the HSWD clay and sand files over Iceland following Icelandic expertise on soil conditions. He plans to submit these modified files to the SURFEX team. But he will coordinate such submission with Patrick and Katya to see if Scandinavia modifications should enter as well.
 * Matti Horttanainen from FMI has provided SOILGRIDS almost global data for HARMONIE/SURFEX. Here is a basic document [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/pgd_ecoclimap_work/soilgrids_docu.pdf (pdf)]. The data are available at cca: /project/hirlam/harmonie/climate/ where the rest of HARMONIE physiography building blocks also reside. This is a figure [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/pgd_ecoclimap_work/Sandandclay.pdf (pdf)] about the chain from SOILGRIDS to Const.Clim.sfx, controlled by a script [https://hirlam.org/trac/browser/branches/harmonie-43rb/scr/Prepare_soil?rev=16518&order=name Prepare_soil]

== Additional matters ==
  
 * Bolli will document the method on how MODIS LAI information should be processed to make validation possible for LAI fields over specific domains. Also, he will document how such MODIS LAI information can be written to new ASCII files for characteristics per cover.
 * Bolli has implemented new Icelandic lakes!!! To be continued...
 * In his presentation Bolli referred to changes of how surface roughness is calculated based on LAI. The LAI/6 factor is changed to LAI/4.

