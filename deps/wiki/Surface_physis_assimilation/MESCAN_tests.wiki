[[PageOutline]]
[[Center(begin)]]
= '''Test and development of MESCAN and CANARI''' =

Last modified [[LastModified]]

[[Center(end)]]

== Activate MESCAN in CANARI ==

We should test the potential of anisotropic structure functions in MESCAN.
MESCAN can be activated within CANARI in the HARMONIE-AROME configuration by simple namelist switches. 

[http://www.cnrm-game-meteo.fr/aladin/IMG/pdf/expose_ebazile_asm2016_wg_surfex.pdf Eric Bazile presented] some MESCAN material at the All Staff Meeting in Lisbon April 2016. See his slides 12-17.

[https://hirlam.org/trac/raw-attachment/wiki/HirlamMeetings/HMG_visit_SMHI_September_2016/magnustomas_surface_mgvisit.pdf Magnus Lindskog had a MESCAN slide (see number 7)] in his assimilation presentation for the HIRLAM MG in Norrköping, September 2016. Here the need for different radius of influences is shown.

[https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/MESCAN_tests/MESCAN_summary_170908.pdf Overview and summary of MESCAN experiments on a domain covering Sweden and Norway by Mariken Homleid.] Summary statistics for [https://hirlam.org/portal/validation/40h1/cy40h11mescanJuly2016_export/  July 2016], [https://hirlam.org/portal/validation/40h1/cy40h11mescanOct2016_export/ October 2016] and [https://hirlam.org/portal/validation/40h1//cy40h11mescanDec2016_export/ December 2016].

=== Namelist settings ===

To activate MESCAN within CANARI edit namelist {{{NALORI}}} in {{{nam/harmonie_namelists.pm}}}.
Thus, replace this setting for CANARI:

{{{
 NALORI=>{
'LCORRF' => '.TRUE.,',
'RCALPH' => '0.0,',
},
}}}

with this setting for MESCAN: 

{{{
 NALORI=>{
'LMESCAN' => '.TRUE.,',
},
}}}

Also, it is recommended to change some radius of influences. Thus, change the CANARI settings:

{{{
 NAM_CANAPE=>{
'REF_A_H2' => '85000.,',
'REF_A_T2' => '80000.,',
}
}}}

to the MESCAN settings:

{{{
 NAM_CANAPE=>{
'REF_A_H2' => '190000.,',
'REF_A_T2' => '190000.,',
}
}}}

Set observation error standard deviation as a function of temperature:

{{{
 NALORI=>{
'VARSIGO' => '.TRUE.,',
},
}}}

=== Ideas ===

Reduce REF_A_H2 and REF_A_T2 in CANARI to half their original values for a sensitivity test to see how big impact the radius of influences has.
A more sophisticated analysis of the radius of influences can be done using the NMC-based method as shown in the figure below (from Tomas Landelius).
This would give an indication of {{{a}}} in the current CANARI formula {{{ro12 = exp( -r/2a )}}}. A smaller radius of influence may give a more patchy
analysis of surface temperature and humidity which may trigger convection better. But, this is still speculation and needs tests...


[[Image(t2m_correlations.png, 400px)]]


== Modification of CANARI ==

At the [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Surface201705 HIRLAM surface meeting in Norrköping] in May 2017 [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Surface201705/canari_sfx.pdf Trygve presented ideas and tests of CANARI modifications] which would open the door to utilize SURFEX variables (from sfx-files) in CANARI instead of the limited (grid-averaged) surface fields that are now provided via the atmospheric files.

The change set referred to by Trygve in his presentation is [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/MESCAN_tests/cansfx.tar.gz available here].

The call tree for MASTERODB, CANARI/SODA-part, with Trygve's modifications [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/MESCAN_tests/Trygve_soda_call_tree.pdf looks like this].

At the Norrköping meeting we discussed how we may read SURFEX diagnostic results (e.g. T2M_ISBA) from sfx files at the beginning of the Canari process to replace T2m (grid averaged) as now read from atmospheric files.
An idea came up where a new call to a new subroutine (at the end of [https://hirlam.org/trac/browser/trunk/harmonie/src/arpifs/phys_dmn/suphmse.F90 arpifs/phys_dmn/suphmse.F90], after the call to SUPHMSE_SURFACE) is implemented. The new subroutine should belong to the mse/externals routines. This new routine (using GOTO SURFEX calls), again calls a new subroutine under surfex/SURFEX which makes e.g. T2M_ISBA available.

Hmhm, but according to me (Patrick) it is still highly unclear how exactly Canari needs to be modified so that the sfx-files are opened/accessed for reading, how/where new SURFEX variables should enter 




