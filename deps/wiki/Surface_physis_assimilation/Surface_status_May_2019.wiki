[[PageOutline]]
[[Center(begin)]]
= '''Reports on surface activities May 2019''' =

Last modified [[LastModified]]

[[Center(end)]]

== Status with respect to Rolling Work Plan 2019 for Surface analysis and modelling ==

[wiki:Surface_physis_assimilation/First_cy43h_setup Many surface aspects related to the short term development for cy43h2.1 release are presented on this wiki.]

> '''Status notes are indicated like this.'''

=== SU1: Algorithms for surface assimilation ===

 * '''SU1.1 Develop/assess SEKF for soil, snow and vegetation using SYNOP data in combination with the diffusion soil and the Explicit Snow (ES) schemes in SURFEXv8.1'''
   * '''SU1.1.1 Activate, develop and evaluate SEKF for diffusion soil scheme as implemented in SURFEX/SODA. (Åsmund, Ekaterina, Magnus, Jelena, Patrick, Mariken, Trygve, Sigurdur)'''
     > Åsmund now successfully has a cy43h branch running with DIF+ExplSnow in combination with SEKF and TITAN/ gridPP. We recently discussed how the innovation from the analysis should be used for open land and forest respectively. An idea is to increase the observation error for the forest patch to reflect the fact that observations in principle represemt open land. HOwever, Åsmund will start to study the effect of using the same innovation. Very importantly we decided that first guess should be based on the relevant patch, i.e. open land and not on grid-averaged values as is currently done in our operational setup. 
   * '''SU1.1.2 Activate, develop and evaluate SEKF for explicit snow scheme as implemented in SURFEX/SODA. (Ekaterina, Magnus, Jelena, Patrick, Mariken, Trygve, Sigurdur, Åsmund)'''
     > Trygve and Mariken have modified the assimilation of SWE to work properly for 2 patches. These modifications are valid for both D95 (operational) and Explicit (under testing) snow schemes and also for the glacier area. No activities yet on assimilation of other prognostic snow variables (e.g. temperature, density, ). Trygve has just shown that the use of SWE (snow-water equivalent) first guess from open land leads to much better results for the SWE assimilation (increments become smaller).
   * '''SU1.1.3 Combine the development in SU1.1.1-1.1.2 and set up a pre-operational system based on (S)EKF for soil, snow and vegetation. (Ekaterina, Magnus, Jelena, Patrick, Mariken, Trygve, Sigurdur, Åsmund)'''
   > This combined setup is now one used by Åsmund.
 * '''SU1.2 For CANARI in HARMONIE-AROME, (i) solve inconsistencies in land/sea mask between SURFEX and climate files (ii) implement new weigted T2m, Rh2m, and snow for first guess (based e.g. on patch info) (iii) exclude need of climatological snow density. Activate the MESCAN part of CANARI, and investigate sensitivity of anisotropic horizontal/vertical structure functions. (Ekaterina, Mariken)'''
     > For (i): it was found, that not only inconsistencies in land/sea mask are important, but also how it is used in the observation operator. SYNOP reports over the sea and SHIP reports over land should be rejected. This was not the case in CANARI and needed developments. With the binary land-sea mask, too many stations would be rejected. Now, instead of the binary land-sea mask, the land fraction (still, from old climate files) is used. This allows to reject only those stations, for which it is really impossible to obtain the model counterpart. Also, it is needed for the proper the use of MESCAN options. Also, surface diagnostics routines are modified, to allow missing values, which makes it possible for CANARI to reject the problematic stations.
 * '''SU1.3 Further develop snow analysis and assimilation of snow extent in CANARI/MESCAN/SODA. Developments on snow analysis in CANARI for AROME-France. (Ekaterina, Mariken, Laura)'''
   > Laura: no progress. 
   > 
   > Magnus has been looking into the Cryoland product for the IMPREX project. He concluded that the T2m threshold of 0 degC currently used as a limit to allow the assimilation to add snow does not work properly in mountainous terrain. Thus, we may need to make this threshold altitude dependent for example...
   >
   > Bolli says: We now have snow accumulations over a winter season until February for 2 years in our CARRA spin-up and we can start to see the effect of snow obs. DA and soon - when the spin-up reaches Mars we'll see the effect of using satellite snow cover products in DA. I've compared to our own reanalysis where no snow DA was used and I just presented a quick comparisons at the CARRA at the end of May.
 * '''SU1.4 Develop/assess EKF for sea ice, using satellite products in combination with the SICE scheme. (Yurii, Ekaterina)'''
 * '''SU1.7 Test and further develop the surface analysis tool based on gripp and TITAN in combination with SODA. This is an alternative to CANARI. (Trygve, Åsmund)'''
   > Use of open-land patch for first guess for T2m, Rh2m and snow has now been implemented in TITAN/ gridPP. Also the connection to Obsmon has been added.
 * '''SU1.8 Continue earlier externally financed work on EnKF and assimilation of raw radiances (e.g. soil moisture, temperature and snow (smos)). Also investigate/develop needed forward models like CMEM/HUT work with SSMIS, AMSR2 and MWRI and Sentinel 1 SAR data. Investigate/design methodology for a consistent generation of upper air and surface perturbations. Address problem of sampling of a long term memory error. Enhance EnKF methodology to be suitable for a multy-patches approach. In the long term this will lead towards consistent surface and upper-air surface perturbations. (Tomas, Jelena, Ekaterina)'''
  > Tomas says: I'm working on three surface DA issues related to EnKF at the moment (funded by SNSA and IMPREX):
  > 
  > Localization of B matrix using PCA. Since we only have ca 10 members and I'd like to to 3D EnKF something need to be done to avoid spurious correlations. My idea is to do sequential (and easily parallelized) DA and restrict the region of interest to a fixed sized region surrounding each observation (size given by correlation length). Based on a time series of ensemble data a covariance matrix (with decent rank) can be obtained for a number of regions (divide the area into suitable number of regions dependent on correlation length). Now do a PCA on those covariance matrices in order to find a basis that spans all possible local B matrices. For a given situation with a B estimate based on 10 members this estimate can then be projected onto the PCA basis in order to obtain a regularized/localized B. Work is under way but there are issues with low spread in areas including water bodies (much less spread in MEPS there). Maybe an NMC approach can give better spread for the PCA or maybe one has to mask out the water bodies.
  > Use of my one year run (winter focus) with recommended SURFEX setup for studies on howt o do DA with multiple patches when observations only relate to one of them. One example was the question of how to distribute SWE information from p1 to p2 in MEPS.
  > 
  > Collapse of ensemble in regions with saturated state variables. In EnKF (and probably also EKF?) you run into problems with bounded state variables (like moisture related ones). When all ensemble members are in the saturated state the spread will be zero causing numerical problems. Moreover the DA methods are based on Gaussian statistics... There are several possible remedies. In my opinion transforming the variable into an unbounded and more Gaussian is a nice way (like what is done for RH in the upper air DA). I'm looking at this together with David G who has the same problem for DA with hydrological models. It would be good if we could agree on a common strategy and learn from one another.
> 
> IMPREX is ending in June but SNSA will continue this year out. The plan is to do more remote sensing DA (3D EnKF) ones I have a method for obtaining decent B matrices in place. If I run into too much trouble I'll resort to 1D EnKF in order to have some result for the final report :)
 

=== SU2: Use of observations in surface assimilation ===

 * '''SU2.1 Examine/compare available satellite snow-extent (and possibly Snow-Water Equivalent products) to identify their pros and cons. Some might become available through ODB. (Ekaterina, Mariken, Magnus, Susanna, Bolli)'''
  > As part of the IMPREX project Susanna will visit ECMWF and compare their way of modelling and assimilation of snow with our offline experimental setups where we test the 3-L snow scheme.
  > 
  > Bolli says: I have identified possible candidates for snow extent DA. I presented a quick comparison between CryoClim vs. NSICD MODIS MOD10A1 and our own MODIS product for one particular day in a CARRA meeting last year. Since then I've looked more closely at this MOD10A1 product and identified the replacement product in development at NSICD called VNP10 and based on VIIRS instrument. Reason for my search for better product is that I found CryoClim lacking, but I still need to check H-SAF products.
 * '''SU2.2 Examine available satellite soil moisture products for use in surface data assimilation. The description of the sub-tasks contains the following information: [soil moisture product] - [assimilation method] - [SURFEX version].'''
   * '''SU2.2.1 [ASCAT, AMSR-2, ...] - [EnKF] - [8.1] (Tomas, John)'''
   * '''SU2.2.2 [ASCAT, AMSR-2, SAR-C (Sentinel-1), ...] - [ EKF ] - [ 8.1 ] (Magnus, Tomas)'''
 * '''SU2.3 Examine available satellite sea-ice extent products and make them available in ODB. E.g. OSI SAF. (Yurii, Bin)'''
 * '''SU2.4 Explore the possibility to use SIMBA buoys for assimilation of sea-ice conditions. (Bin, Yurii)'''
 * '''SU2.6 Examine the use of amateur weather observations (like Netatmo) in surface assimlation, using gridpp (instead of CANARI). (Trygve, Joris)'''
  > See comments under SU1.7.
 * '''SU2.7 Examine available snow products for use in surface data assimilation. The description of the sub-tasks contains the following information: [soil moisture product] - [assimilation method] - [SURFEX version].'''
   * '''SU2.7.1 [Cryoland] - [sEKF] - [first 7.2, later on 8.1] (Magnus)'''
    > Magnus is currently working on assimilation of Cryoland satellite snow extent in HARMONIE for an external project. Same principles as developed by Mariken is used. [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/Surface_status_May_2019/magnus_tallinn_su.pdf Magnus present his progress here.]
   * '''SU2.7.2 [H-SAF] - [sEKF] - [8.1] (Ekaterina, Mariken)'''
    > [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/Surface_status_May_2019/satsnowana_tallin_190528_mariken.pdf Presentation by Mariken: Use of Satellite Snow Extent in MetCoOp?]

=== SU3: SURFEX: validation of existing options for NWP ===

 * '''SU3.1 Test and validate the behaviour of individual components, as well as the full combination, of DIF, ES, MEB in cy43/SURFEXv8.1. Utilize a combination of offline SURFEX, MUSC, and the full 3D model depending on the type of study. Also, utilize climate-mode simulations (without data assimilation) to identify and reduce biases.
   * '''SU3.1.1 In climate mode, over different domains, examine biases in cy43 when the full combination of DIF, ES, MEB are activated in combination with recommended namelist settings. (Samuel, Patrick, Mariken, Ekakterina, NiNa?, Emily, John, Trygve)'''
   > [https://hangouts.google.com/call/_X1gmcTBejjrYlunM2N1AEEI?authuser=0 Samuel presents status and plans here.]
   >
   > Emily says: I've run tests using cy43 in climate and nwp mode testing that the changes committed worked over Ireland - both our small and large domains. Found bug in boundaries which Ulf fixed, liaised with Eoin on the Canari fails and his suggestion worked. 
   > Patrick has solved the issues with MEB which can now be used in cy43h runs. Thus, [wiki:Surface_physis_assimilation/New_SURFEX_options_cy43h the full wish list is now available for testing!]
   * '''SU3.1.2 By namelist modifications, parameter tuning and/or code modifications try to reduce any biases identified in SU3.1.1. (Samuel, Patrick, Mariken, Ekaterina, NiNa, Emily, John, Trygve, Patrick LM, Aaron)'''
   * '''SU3.1.3 Based on the outcome of SU3.1.2, repeat the simulations for different domains as done in SU3.1.1 and evaluate the performance. This version of HARMONIE-AROME will be used for coupling to surface data assimilation in SU1. (Samuel, Patrick, Mariken, Ekaterina, NiNa, Bolli, Emily, John, Trygve)'''
 * '''SU3.2 Develop methods for parameter optimization in SURFEX (ISBA) and apply the method on an operational cycle to reach better performance. (John)'''
 * '''SU3.3 Examine the potential use of, until now, non-utilized options in TEB. (Carl?)'''
 * '''SU3.7 Test new ECUME formulations for the sea tile in cy43h. (Samuel, Karl-Ivar, Bolli)'''
    > Samuel: A test was done for feb'18 over Spain : [https://hirlam.org/portal/aemet/verif43h2a1/ecume6/]. Results show a positive impact of ECUME6 in T2m, RH2m & Q2m. Interestingly, the improvements are spread beyond coastal regions. I plan to do more tests for other periods & case studies to check the impact in cloud formation & visibility over sea.
=== SU4: SURFEX: development of model components ===

 * '''SU4.1 Develop a physically based glacier model for SURFEX based on the Explicit Snow Scheme. Includes glacier albedo aspects. (Bolli, Kristian)'''
  > Some good ideas for ISBA-ES where discussed in e-mail between us and Aaron Boone last year, but since it was decided to use the D95 for the CARRA project all new work was halted. We've develop a new method of reading in satellite albedo into the system to use over glacier areas. 
 * '''SU4.2 Further development of SICE (effect of melt pond, snow-ice formation, improvement of albedo scheme) (Yurii, Bin, Ekaterina)'''
   > Yurii says: As you remember in cy40 in climate mode we updated SIC outside SURFEX to represent evolution of the ice cover. This approach doesn't really work in SURFEX 8.1 because now SIC is assumed to be 'owned' by the sea ice scheme and can't be changed from outside. To overcome this problem I extended the already existing in SURFEX 8.1 mechanism which provides monthly SIC to the ice scheme. As a consequence it was quite straightforward to adopt SIC relaxation option from GELATO in SICE. So, now it is possible to have not only instant SIC updates in climate mode but also relax current SIC towards the updated field to have a smooth transition. Fuxing, David and myself utilized this new mechanism to add SIC updates in cy43 climate mode. In principle it should work for both SICE and GELATO, but only SICE was tested.
 * '''SU4.3 Evaluate the orographic radiation (ORORAD) implementation in cy43 and apply further modifications and developments. (Laura)''' Laura: no way within cy43h2 using SURFEX 8.1, no changes in harmonie-43rb where it works as it used
 * '''SU4.4 Implement, evaluate and further modify/develop a new orographic roughness parametrization (OROTUR). (Laura)''' Laura: available for testing in cy43 develop 
 * '''SU4.5 Further development of MEB which can include separate soil column under snow/non-snow, snow albedo in forest, effect of intercepted snow on albedo. (Patrick, Aaron)'''
  > Aaron: MEB is now available for testing also for the open land patch.
 
=== SU5: Assess/improve quality of surface characterization ===

 * '''SU5.1 ECOCLIMAP activities. ECOCLIMAP cover map, corrections and studying the impact. Corrections mainly for Iceland, Greenland, Svalbard. Examining for Croatia and Spain.  Studying of urban areas. (Bolli, Ekaterina, Patrick, Mariken, Samuel, Teresa, Kristian)'''
 * '''SU5.2 Soil maps activities. HWSD and Soilgrids corrections and studying impact. Corrections will be done mainly for Denmark, Iceland, Greenland, Svalbard, Scandinavia. Examining for Iberia. (Bolli, Kristian, Ekaterina, Patrick, Mariken, Teresa, Samuel)'''
 * '''SU5.3 Tree height data activities. Tree height data upgraids and studying the impact. The work is planned for 2020, after upgrades of the database for Norway. (Mariken, Teresa, Patrick)'''
 * '''SU5.4 Lake database (GLDB). Participate in GLDB developments and studying the impact. (Ekaterina, Bolli, Laura, Patrick)''' Laura: no progress
 * '''SU5.5 ECOCLIMAP SG activities. Examining and and participate in developments if possible. (Teresa, Samuel, John, Ekaterina)'''
      > Patrick: Made ECO-SG working in cy43. A bug related to tree height averaging was solved by Marie Minvielle. I have a test run running for April 2018 over the !MetCoOp domain.
      > Samuel: First NWP tests with ECO-SG over Spain were delayed due to issues with CANARI at cca but it's solved now. First verification results should be ready in a week or two.
      > Emily: Working with Geoffrey on looking at SG for Ireland compared to local databases.

=== SU6: Coupling with sea surface/ocean ===

 * '''SU6.5 Coupling with sea surface/ocean'''
   * '''SU6.5.2 Wave model WAM using Surfex-OASIS technical implementation and validation (Malte)'''
   > Some email conversations is going on with respect to wave plans between Basanta (Ireland) and Malte, Erin Emily Thomas, Nicholas Szapiro, Yurii (Norway). Malte says: We are lacking some understanding with WW3. For example, the optimal time step settings for 2.5km setup and computational costs of WW3 compared to the WAM system. So possibly we could share work here and you start working from the WW3 side and as soon as we are ready with the Harmonie side we bring things together.

== Other aspects ==

 * A HARMONIE-Climate coordination hangout meeting was organised by Samuel on May 23. [https://hangouts.google.com/call/_X1gmcTBejjrYlunM2N1AEEI?authuser=0 Background material for the meeting is here.]

 * At the !MetCoOp meeting in Tallin May 27-29 some surface people met and discussed progress. Presentations were given by
  * [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/Surface_status_May_2019/progress_CANARI.pdf Katya: Status and progress of CANARI work]
  * [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/Surface_status_May_2019/satsnowana_tallin_190528_mariken.pdf Mariken: Use of Satellite Snow Extent in MetCoOp?]
  * [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/Surface_status_May_2019/magnus_tallinn_su.pdf Magnus: MetCoOp, Some snow data-assimilation experiences]
  * [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/Surface_status_May_2019/offline_snow_experiments.pdf Trygve: Offline snow experiments]
  * [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/Surface_status_May_2019/xrimax_tallinn_190526_mariken.pdf  Mariken: XRIMAX - a key to improve the forecasts in stable situations ?]
 
 * In summary the surface !MetCoOp plans involve:
   *  Medium term plans involving better surface physics and new assimilation method:
      * Åsmund is now running cy43h with diffusion soil (14 layers), explicit snow (12 layers), 2 patches + TITAN/gridPP + SEKF surface assimilation. Hopefully MEB can also be activated soon. Then we have our wish list for new surface physics and assimilation running : - )
      * Intense discussions related to which first-guess values to use for snow and T2m/Rh2m. Suggestion now is to use open-land patch for this and first try is to use the same innovation for open-land and forest patches. Maybe we increase observation error for forest patch to reflect the fact that observations represent open land…
   * Short term plans related to new surface options for cy43h:
      * Promising candidates for new cy43h: ECOCLIMAP-SG (in possible combination with decreased soil moisture increments and increased Rsmin) + modified snow assimilation + increased XRIMAX (in possible combination with new T2m diagnostic alternative and OROTUR). 

 * The autumn surface working week will be hosted by 
