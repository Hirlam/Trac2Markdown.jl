
[[PageOutline]]
[[Center(begin)]]
= '''Release notes of HIRLAM 7.3''' =
[[LastModified]]
[[Center(end)]]

== Highlights of Hirlam 7.3 ==

HIRLAM-7.3 is released on 2 November 2010. Hirlam 7.3 is the official version of the synoptic-scale HIRLAM forecast system. Compared to Hirlam 7.2, version 7.3 contains as default following main new or updated features:
 * Modified surface scheme with improved parameterisation of surface processes, e.g. that of snow and forest
 * Multi-loop multi incremental 4D-VAR minimisation
 * Modified physical parameterisation, such as those for Kain Fritsh Rasch Kristjansson condensation scheme
 * Parameterisation of meso-scale and subgrid scale orographic impacts (MSO-SSO)
 * Extended use of remote sensing data, with AMSU-A from Noaa 15/16/18 (default), from NOAA 19, Metop 2(optional), AMSU-B/MHS from Noaa 16/18, from NOAA 19, metop 2(optional), AMV (Meteosat 8, optional), ASCAT (optional), Radar RadiaWind (optional), Ground-based GPS (optional), Ocean Sea-Ice SAF data (optional)
 * Update in background error statistics, tuning in scaling of background error, observation error and bias correction data for ATOVS
 * Modification related to ensemble forecast, hybrid data assimilation
 * System overhaul, cleaning, new utilities, bug fixes

== Hirlam 7.3 tagging history ==

 * Hirlam-7.3, tagged on Nov 2, 2010
 * Third release candidate Hirlam-7.3rc3, tagged on Sept 13 2010
 * Second release candidate Hirlam-7.3rc2, tagged on July 2 2010
 * First release candidate Hirlam-7.3rc1, tagged on April 23 2010
 * Third beta version Hirlam-7.3beta3, tagged on April 9 2010
 * Second beta version Hirlam-7.3beta2, tagged on Jan 8 2010
 * Beta version Hirlam-7.3beta1, tagged on April 17 2009
 * Alpha version Hirlam-7.3alpha, tagged on Dec 22, 2008

== Hirlam 7.3 bugfix versions ==

 * [log:tags/hirlam-7.3.bf1 hirlam-7.3.bf1] contains the following changes 
   * Lake fixes [9298]
   * Correct ECSST/ICE entry for ensemble mode, [9273],[9277] 
   * Added new structure functions [9311]

 The only meteorological impact is through the corrected lake temperatures. 

 The code can be downloaded from: 

{{{
   svn co https://svn.hirlam.org/tags/hirlam-7.3.bf1
}}}

== Hirlam 7.3 source code downloads ==

The complete source code of Hirlam 7.3 can be obtained by using either

 * Subversion command
{{{
   svn co https://svn.hirlam.org/tags/hirlam-7.3
}}}
 * or source code tarball, available from hirlam.org as
{{{
https://hirlam.org/portal/download/src/hirlam-7.3.tar.gz
}}}
or ECMWF ecgate:/scratch/ms/dk/nhz/hirlam-7.3.tar.gz or ecfs:/hirlam/src/tar/hirlam-7.3.tar.gz which contains the sandbox (check-out version) of the Hirlam 7.3

== New Features in Hirlam 7.3 ==

=== Source changes in Hirlam 7.3 ===
The source changes in Hirlam-7.3, relative to Hirlam-7.2, are included in the Subversion changesets between [6096] and [8581] for trunk/hirlam, see also
[https://hirlam.org/trac/log/trunk/hirlam?action=stop_on_copy&mode=stop_on_copy&rev=8581&stop_rev=6866&limit=900 the detailed listing of the source code and script modifications]. 

=== New surface scheme ===

7.3 features an updated surface scheme (commonly referred to as '''newsnow'''). The main differences between the surface parameterizations in "'''newsnow'''" and '''old ISBA''' include
  * The force-restore formulation of temperature is replaced by heat conduction between three time dependent layers, forced from below by a climatological temperature. The heat conduction, is dependent on soil type and water content, and by a simplified treatment of soil ice. For sea ice the forcing from below is dependent on the water temperature.
  * A separate canopy temperature in the forest (double energy balance)
  * Two separate snow packs for open land/low veg (tile 6) and for forest floor (tile 7) with separate energy balances. Separate snow depths, temperatures, densities, liquid water content, albedos.

Technically the new tiles 6 and 7 are zero everywhere except within the phys routine, where the routine '''newfractions''' is calculating new local tiles. The snow on tiles 3 and 4 is moved to tile 6 and the forest snow on tile 5 is moved to tile 7. Thus locally within phys, tiles 3, 4 and 5 are snow free, and tiles 6 and 7 are completely covered by snow. After '''aisbah4''' the routine '''mirroring''' is moving the snow back again. This routine also take care of the change of temperatures within the soil, due to changed snow fractions (to be energy consistent). Note that all physical variables are stored within the two snow tiles 6 and 7, except that the fractions are zero outside phys.

For defining grid average values for post processing, the local fractions are also computed within '''putdat'''. Note that t2mland (140,105,2,  used as first guess in span) is excluding forest, since the 2m temperature in the forest is not well defined, and the synop observations are done over open land.

Main changes within span:

  * The first guess t2m (140,105,2) is now moved to the real orography, by a weighted value of the four points surrounding the observation point.
  * A bias correction on t2m dependence on soil moisture is introduced in cacsts.
  * The snow analysis first guess is based only on open land snow, and the snow density is taken directly from the first guess.
  * Different structure functions/error parameters, for the snow analysis (Mariken and Nils)
  * The updating of the deeper soil temperatures, are done within '''tempcorr''', using a spline from the previous (-6h) analysis and the latest analysed Ts.

The '''newsnow''' scheme is physically more solid than the previous scheme, and can describe more realistically the insulation of snow (cold nights), diurnal cycle with larger amplitudes in the canopy, and less amplitudes at the forest floor. Potentially also the deeper soil temperatures, although for a  more realistic description of ground frost and thawing, it would be preferable to define the soil moisture at the same levels as those of temperature. The reason for not doing this so far is that it would demand a complete retuning of the soil moisture/temperature analysis in span.

The latest update of the "newsnow" branch, called here "orosur", is shortly described. The orosur update contains everything of newsnow and trunk in early March 2009. In addition, it allows to switch on/off orography-related parametrizations and some postprocessing enhancements. It introduces "daily climate" files, contains some cleaning and small fixes all over the code. In addition, orosur provides a single-column version as well as tools for stand-alone postprocessing for the local platform, but these are not yet available in this repository.

=== Mesoscale and small-scale orography parametrizations (MSO-SSO) ===

The parametrizations include a scheme for mesoscale orography effects, based on Meteo France gravity wave code and a simple parametrization of the smallest scale orographic effects. Swithing ''MSO_PAR''=yes in '''Env_expdesc''' activates the schemes, replacing the old approach which uses enhances orographic roughness. Correspondingly, setting ''RADORO_PAR''=yes adds the parametrization of sub-grid-scale slope effects on surface radiation fluxes. 

Some basic documentation:
  * Rontu L., K. Sattler and R. Sigg, 2002. Parametrization of subgrid-scale orography effects in HIRLAM. HIRLAM Technical report, 56, 59 pp.
  * Rontu L., 2006. A study on parametrization of orography-related momentum fluxes in a synoptic-scale NWP model. Tellus, 58A, 68-81.
  * Rontu, L., K. Sattler, and M. Homleid, 2006: Parametrization of mesoscale and small-scale orography effects in HIRLAM - final tests. HIRLAM Newsletter, (50), 26-38, Available at http://hirlam.org.
  * Rontu, L., K. Sattler, A. Senkova, and M. Homleid, 2006. Orography-related parametrizations in HIRLAM. HIRLAM Newsletter, (51), 81-89, Available at http://hirlam.org.
  * Rontu, L., 2007. Studies on orographic effects in a numerical weather prediction model. Contributions (63) of Finnish Meteorological Institute. Available as https://oa.doria.fi/bitstream/handle/10024/13113/studieso.pdf?sequence=1
  * Senkova A.S., L. Rontu and H.Savijarvi, 2007. Parametrization of orographic effects on surface radiation in HIRLAM. Tellus 59A, 279-291.

=== Enhanced postprocessing ===

Interpolation to constant height and isentropic surfaces has been made possible, as well as calculation of some additional variables like isentropic potential vorticity or geometric vertical velocity. Postprocessing is possible for any forecast or analysis, during the model run or afterwards. For postprocessing afterwards, a script "Aposteriori" will be made available as an utility. It uses precompiled hlprog.x, intp.x and pgb2asi.x as well as mandtg.pl.

The following new subroutines in prpo are related to enhanced postprocessing under prpo:
 {{{
   fipint1.F  horadv.F  horder.F  hordiv.F  inthgt.F  intthe.F  metric.F  mfxcom.F  phgcal.F  pthcal.F  pvcomp.F  tpint1.F  
   upint1.F  veradv.F  vorave.F  vortic.F  vpint1.F  wcomp.F  xpint0.F  xpint1.F  xtrhgt.F  xzint.F
}}}

Enhanced postprocessing of any file (also forecast) in stand-alone mode required a small change of time definitions of the postprocessed file: internally, valid time is used while postprocessing.

The postprocessing routines and approach have been described in:

  * Rontu, L., and C. Fortelius, 2000: Recent developments in postprocessing. HIRLAM Newsletter, (36), 80-88, Available at http://hirlam.org.

An example of the possible use of such tools (note, however, that not all variables calculated in the paper are included in the present update) is shown in
  * Rontu L., 2006. Vorticity budget over mountains, estimated from HIRLAM analyses and forecasts. Met.Z.,15,199-206.

=== Daily climate ===

A simple linear interpolation in time between monthly climate files is provided, resulting in a daily climate file cl00$mm$dd00 for each day. This file is presently used only in the surface data assimilation, but would further be developed to allow following of the evolution of the surface characteristics e.g. in the climate type experiments. The daily climate is created using '''scripts/Climate''' and '''prpo/previ.F'''. Note that in the present approach, a list of '''clifld.lst''' is defined in and created by '''Climate''' and used further also by '''Vineta'''. Thus, the definition of needed climate and physiography files has now been moved from '''Vineta''' to the script '''Climate'''.

=== Update in Condensation parameterisation === 

KFRK-eta are now default option in hirlam-7.3. Four different combinations of KF and RK are now featured in the code

{{{
OPTION(2) 4 OPTION(10) 0 : prognostic ice in RK, classical KF (hirlam-7.2)
OPTION(2) 6 OPTION(10) 0 : diagnostic ice in RK, classical KF
OPTION(2) 4 OPTION(10) 1 : prognostic ice in RK, KF eta (default in hirlam-7.3)
OPTION(2) 6 OPTION(10) 1 : diagnostic ice in RK, KF eta
}}}

In the present KF-eta version the shallow convection is suppressed for low stratus by using an increased timescale for convection.
The reason for doing this is that KF-eta has a stronger mixing in case of shallow convection than the old KF. The stronger mixing
seems to be realistic in case of 'deeper' shallow convection ( e.g. cumulus ) but not for low stratus with weaker convective activity.

In CBR the moist turbulence does a similar mixing in case of moist unstable condition as the convection scheme. This is a double counting which is suppressed by assuming moist neutral condition in case moist unstable condition. (Except for dry unstable cases)
Here, the modification in CBR is only active when KF-eta is used.  (This modification has been used at SMHI for several years for operational forecasts also in connection with old KF.)

With the new KFRK,
 * The PBL height is not 'drifting' with forecast length any more. The old version had some tendency of an elevation with increased forecast length.
 * KF-eta gives less bias and a little lower RMS of temperature, relative humidity and dew-point between 850 and 500 hPa. (both winter and summer)
 * The RMS error of mslp will be a little larger in summertime due to somewhat deeper lows.  
 * An over-prediction of low clouds in summer night over land, and over sea (regardless of time of day and year) is somewhat reduced.
In other respects, there will be marginal effects on the changes.

=== Minor changes which require attention by the model user ===

When starting a new experiment using the orosur code, please start from beginning, i.e. recreating the climate files and boundary files!

  * Definition of climate files, see 3
  * Env_expdesc: define MSO_PAR, RADORO_PAR
  * Two grib codes are changed. 83 105 702 (sea roughness) is now 83 102 0 81 105 901-907, 702,706,705 are now 194 105 ... 901-907, 702,706,707, but the WMO standard land/water fraction 81 105 0 remains!
  * Definition of options in FCinput has been modified slightly, please see there. Also note that the previously implemented limited version of QNSE-turbulence parametrizations is again available as an option, please use it only if you know what you are doing.

== Meteorological Evaluation of Hirlam 7.3 ==

Hirlam-7.3 brings numerous improvement on meteorological quality. Among them, a general improvement in predicted surface temperature especially for diurnal evolution, precipitation especially for small events, surface wind over orographic areas. Meanwhile, for observation verification, some degradation in mean sea level pressure have been observed, and there tends to be a somewhat increased positive bias for surface wind speed.

Prior to the launch of hirlam-7.3, extensive real-time parallel runs with 7.3-release candidates have been run at FMI to ensure satisfactory the quality in technical and meteorological aspects.

== Running Hirlam 7.3-code series on the ECMWF platform ==

 * The default configuration setting is ecgate, where ecgate (HOST0) is used for launching jobs and simple serial tasks and C1A (HOST1) is for computations. Please use reference installation on `ecgate:~nhz/hirlam_release` 
 * To set up a 7.3 experiment "{exp}" on ecgate, one can go through following sequence of actions as in examples:
{{{
  mkdir ~/hl_home/{exp}; cd ~/hl_home/{exp} # note that experiment name {exp} shall not contain "."
  ~nhz/Hirlam setup -r 7.3                  # running system 7.3
}}}
 * To modify source code or scripts, first 'check out' the reference ones and modify them. e.g,
{{{
  ~nhz/Hirlam co Env_domain; vi scripts/Env_domain
  ~nhz/Hirlam co Env_expdesc; vi scripts/Env_expdesc
  ~nhz/Hirlam co putdat.F; vi scripts/putdat.F
}}}
 * Launch experiment, e.g,
{{{
  ~nhz/Hirlam start DTG=2009030100 DTGEND=2009033106    # to perform cycled experiments from start cycle DTG to end cycle DTGEND
}}}
 * Note that due to change of contents in climate data base (in connection with introduction for MSO-SSO), climate data from previous model version can not be re-used. A cold start in form of
{{{
   Hirlam start
}}} 
needs to be launched in order to achieve this.
 * See also further examples of job launch command in the following sections.

== Install and run Hirlam-7.3 on non-ECMWF platforms ==

 * On non-ECMWF platforms, a local installation is needed by either local system manager or user self. A local installation needs an climate data (HDF file) set updated to 7.2. The procedure is similar to [https://hirlam.org/trac/wiki/HirlamHowto/Install/General#WhatisanHDFSETandwherecanIfindtheHDFsets that of 7.0], except to replace all instances of `hdfdb-7.0` there with `hdfdb-7.2`.

 * Then install the HIRLAM source code on a local path $localpath:
{{{
   svn co https://svn.hirlam.org/tags/hirlam-7.3 7.3                   # with internet access, or
   tar -zxvf hirlam-7.3.tar.gz                                         # with a source code tarball
}}}
   1. `alias Hirlam $localpath/hirlam/config-sh/Hirlam`
   1. `Hirlam setup -r 7.3 -d $localpath`
   1. Launch the job with:
{{{
    Hirlam start DTG=$yyyy$mm$dd$hh
}}}

== Alternative configurations with HIRLAM 7.3 ==

== Technical Information ==
=== GRIB parameter list in 7.3 === 

The updated wiki [wiki:HirlamSystemDocumentation/Forecast/Outputlist73 listing of GRIB-parameter] details the parameter definition as appearing in GRIB output data from hirlam-7.3 series.

=== Sample Computation Cost === 

'''4D-VAR'''

||domain||tested 7.1 release||platform||simplified phys||nr of iterations ||minimization resolution|| nr of node,processors ||elapsed time||HPC billing unit||

||RCR 7.1||7.3 ||ECMWF-C1A||MFSP1, MFSP1||30,40||90, 45 km||2, 64||1200s||410||
||RCR 7.1||7.3 beta 1 ||ECMWF-HPCE||MFSP1, MFSP1||30,40||90, 45 km||3, 48||1910s||443||

[[BR]]
'''Forecast'''

||domain||tested 7.3 versions ||condensation schemes || platform||nr of nodes|| task per node || nprocx||nprocy||ncpu_hgs||nhalo||time step||elapsed time per step||48 h Forecast elapsed time||HPC Billing cost||

||RCR 7.1||7.3||KFRK || ECMWF-C1A||3||62 || 12||15||6||8||360s||~1.6s||870s||433||

[[BR]]
'''EPS forecast [[FootNote(numbers refer to one ensemble member)]]'''

||domain||tested 7.3 versions ||condensation schemes || platform||nr of nodes|| task per node || nprocx||nprocy||ncpu_hgs||nhalo||time step||elapsed time per step||48 h Forecast elapsed time||HPC Billing cost[[FootNote(one single forecast run)]]||

||EPS71||7.3 beta1||KFRK || ECMWF-C1A ||1||60 ||10|| 6||0||8||360s||~0.8s||~520s||99||
||EPS71||7.3 beta1||KFRK || ECMWF-HPCE||1||30 || 5|| 6||0||8||360s||~2.6s||~1500s||90||

 [[FootNote]]

== Acknowledgement ==
The following are acknowledged for their direct contribution to the the code and script updates featured in HIRLAM 7.3:

'''DA and EPS'''
Nils Gustafsson, Ole Vignes, Tomas Wilhelmsson, Magnus Lindskog,  Frank Tveter, Mariken Homleid, Kirsti Salonen, Reima Eresmaa, Jelena Bojarova, Sigurdur Thorsteinsson, Carlos Geijo, John de Vries, Bjarne Amstrup, Kai Sattler, Henrik Feddersen, Jose Antonio G. Moya, Roel Stappers, Xiaohua Yang


'''Forecast model'''
Stefan Gollvik, Sander Tijm, Laura Rontu, Karl-Ivar Ivarsson, Javier Calvo, Bent H. Sass, Kalle Eerola, Kristian Pagn Nielsen.


'''System'''
Ole Vignes, Tomas Wilhelmsson, Kai Sattler, Toon Moene, Kalle Eerola, Niko Sokka, Jacob Weissman Poulsen, Martynas Kazlauskas, Xiaohua Yang


----
[[Center(begin)]]
[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
