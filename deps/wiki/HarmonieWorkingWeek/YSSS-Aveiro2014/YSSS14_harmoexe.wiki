== Sensitivity studies on the aerosol effects in HARMONIE [[BR]]
Young Scientist's Summer School 6 to 11 July 2014 Aveiro
---------------------------------------------------------------------

'''HARMONIE [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/YSSS-Aveiro2014/Exercises_HARMONIE_MUSC.pdf exercise] contains three separate components: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/YSSS-Aveiro2014/Nielsen_2014-07_exercise_aerosol_direct_and_semi-direct_feedbacks.pdf preliminary task], introduction, student tasks. Results of the student tasks will be reported in the final session on Friday.
'''
----

=== Schedule of the exercises ===


'''Monday 7 July 13.30-19'''

Introduction to HARMONIE MUSC and to the tasks. 

Connecting to the FMI numlab.fmi.fi using own linux laptops or Aveiro desktops.

Demonstration/running of the reference experiment, visualisation of the results. 

Choice of tasks for the week, division to subgroups accordingly (3-4 groups).
 

'''Tuesday 8 July 13.30-18'''

Work with chosen tasks in subgroups continues.


'''Wednesday 9 July 13.30-18'''

Discussion of the stand-alone aerosol exercise (former "homework task") 

Work with chosen tasks in subgroups continues. 


'''Thursday 10 July 10.30-19'''

Demonstration of the 3D experiments and their results. 

Finishing chosen tasks in subgroups. 

Preparation of the report with contributions of each subgroup. 

----

=== Usage and setup of HARMONIE MUSC ===

For the purpose of this course, we have already prepared and compiled HARMONIE MUSC version 38 on the Finnish Meteorological Institute server numlab.fmi.fi. To use this computer you should connect from your Linux laptop first to Aveiro university gateway server and continue from there to a user account to numlab.fmi.fi, for example:

{{{
ssh -X laura@adamastor.dao.ua.pt
laura@adamastor.dao.ua.pt's password: xxxxxx
>(prompt-of-aveiro-server):~$
ssh -X op02@numlab.fmi.fi
op02@numlab.fmi.fi's password: zzzzzz
Linux numlab 3.2.0-4-amd64 #1 SMP Debian 3.2.51-1 x86_64
...
op02@numlab:~$
(your commands on numlab.fmi.fi)
}}}

The login information for adamastor.dao.ua.pt (user laura, password) has been provided by the local organisers, also the login and passwords for the student accounts at numlab.fmi.fi are ready. All passwords will be given to the HARMONIE group members at latest during the first exercise. 

In case you plan to contact the Aveiro -> Helsinki servers from a Windows or Macintosh system, you will need a suitable X-windows programme installed. The school organisers recommend: 
{{{
MobaXTerm from http://mobaxterm.mobatek.net/  
or 
XMing from http://sourceforge.net/projects/xming/ 
with 
putty from http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe 
}}}

([http://www.helsinki.fi/~jaraisan/numlab2013/x-ohje.html Here] is a piece of old advice for the University of Helsinki students who met a similar situation last year.) 

There is a possibility to install the whole HARMONIE MUSC system in your own Linux laptop, provided that you have the needed privileges to administer your system, e.g. to install fortran compiler and other needed tools, and that you agree to remove the code after the school (or get the permission of the HIRLAM consortium to use it for research in your institute). We will provide the code and limited support in the installation but would prefer not to use too much time for solving the possible technical problems at different platforms, sorry.

----

'''Task 0'''. Study of radiation-aerosol interactions with a stand-alone radiation transfer model.

- This is a preparatory task to be started home before the school. It will be discussed during one of the exercise sessions.

- The aim of this exercise is to study the influence of the direct and semi-direct aerosol effect from selected aerosol types. The main goal is to get an overview of the many factors that affect the forcing, and to get a general understanding of the radiative properties of aerosols with known optical properties.

- We hope to get the material for the preliminary task ready and sent to the participants by e-mail before the school. If not, we'll discuss it on Wednesday session.

------------

'''Task 1'''. Introduction to HARMONIE single-column model MUSC

- This is a demonstration task for all participants of the HARMONIE exercises to be done during the first session of the school

- The aim of the exercise is to show and try how to prepare and run a MUSC experiment: directories, scripts, input, output, modification of source code. The reference case from summer 2010 forest fire period will be introduced. 

- The basic reference MUSC experiment will be run during the first session, to be used as a starting point for modifications and the study tasks during the week

- The students need to connect their own laptops via the Aveiro server to the Finnish Meteorological institute server numlab.fmi.fi to run the MUSC experiments, or run the experiments in own laptops. 


-----------


Study tasks 

- These are MUSC experiments for understanding diffent aspects of aerosol-radiation interactions in HARMONIE. The experiments could be arranged in subgroups, each choosing one task to work with during the four afternoons and prepare 1-2 slides for the common report in the final session on Friday. 


'''Task 2'''. Changing the vertically integrated aerosol optical thickness, studying the effect with three different radiation schemes in two cases. 

In this experiment, code modifications and recompiling is not needed.

2.1. Rerun the reference MUSC experiment for 6.8.2010 at a location in the western Russia (56.517N, 30.788E) during the summer 2010 forest fire period using the reference input and namelist definitions. Study the input and results by plotting the profiles of aerosol extinction coefficient (need to calculate from AOD profile) of different aerosol species, temperature, radiation fluxes.

2.2  Rerun the same in Sodankylä (67.362N, 26.638E, in the North of Finland) 21.3.2014 clean-air spring equinox conditions. 

2.3  Try three different radiation schemes and study the effects in both locations. 

2.4. Change the vertically integrated AOT in both places by modifying the input MUSCIN_radaero_L65.fa file, run the experiments again and study the effects. Study the tropospheric and stratospheric aerosol effects separately, especially in the Arctic clean air conditions in Sodankylä. 

2.5. Modify the cloud-related input, run the experiments again and study the effects. You may modify the namelist settings to get more variations for handling of cloud-radiation interactions by the default IFS radiation scheme.

-----

'''Task 3'''. Changing the vertically integrated AOT and modifying the aerosol optical properties 

In this experiment, some Fortran code modifications and recompiling is needed.

3.1 Rerun the reference MUSC experiment for 6.8.2010 at a location in the western Russia during the summer 2010 forest fire period using the reference input and namelist definitions. Study the input and results by plotting the aerosol extinction coefficient profiles, temperature, radiation fluxes.

3.2  Change the vertically integrated AOT by modifying the input MUSCIN_radaero_L65.fa file, run the experiment again and study the effects.
You could do sensitivity experiments with AOT of different aerosol species changing from 0 to 4 and compare the results to no aerosol case.

3.3  Change the aerosol single scattering albedo and asymmetry by modifying the code in ./src/arp/phys_radi/suaersn.F90, where you can find [[BR]]
 
{{{
! SIX SPECTRAL INTERVALS (0.185-0.25-0.44-0.69-1.19-2.38-4.00microns)
SSA := ZPIZA6, g := ZCGA6 
}}}

For example, you can do comparison for the forest fire case with the default SSA and g for soot and land aerosol and SSA=0.954 and g=0.632 for all short-wave spectral intervals as high SSA values were observed.
Recompile, run the experiments again and study the effects.

3.4  Modify the cloud-related input and settings, run the experiments again and study the effects. 

-----

'''Task 4'''. Changing the vertically integrated AOT and its vertical distribution 

In this experiment, a bit more Fortran code understanding, modifications and recompiling is needed.

4.1 Rerun the reference MUSC experiment for 6.8.2010 at a location in the western Russia during the summer 2010 forest fire period using the reference input and namelist definitions. Study the input and results by plotting the profile of aerosol extinction coefficient, temperature, radiation fluxes.

4.2 Change the vertically integrated AOT by modifying the input MUSCIN_radaero_L65.fa file, run the experiment again and study the effects.
You could do sensitivity experiments with AOT of different aerosol species changing from 0 to 4 and compare the results to no aerosol case.

4.3 Study and modify the functions CVDAE... used by ./src/arp/phys_dmn/radaer.F90 to create the AOT vertical profiles. They are provided by ./src/arp/phys_ec/suaerv.F90. You need to find out how to modify the source code. Then recompile, run the experiment again and study the effects. Try the find the "worst case" vertical aerosol distribution.
Study the effect of elevated dust layer (dust layer situated higher up in the troposphere), compare results to the experiment with default dust vertical profile (exponential decrease with height).  

4.4  Modify the cloud-related input and settings, run the experiments again and study the effects.

----
 
'''Task 5'''. Demonstration of aerosol effects in three-dimensional HARMONIE experiment with and without aerosol

- This demonstration will be prepared and run (in an external HPC computer) by the participants from Odessa State Environmental University, Ukraine. It will be discussed on the last exercise session and the results presented in the common final report.

----

=== How to run the reference "radaero" experiment (introduction and tasks 2.1, 3.1, 4.1) ===

[https://hirlam.org/trac/browser/branches/harmonie_MUSC_cy38h1/test/radaero radaero in code browser]

'''*** Note that to start at this point, the HARMONIE-MUSC reference code and/or your own experiment code (radaero in this case) needs to already be compiled.'''

1. To set the environment when the experiment has already been precompiled:

   
{{{
mur radaero linkown
   . ./tool.path
}}}

*** Now $MU_WD is your working directory from where you run your experiments. The code in src here can be modified and recompiled. The MASTER (executable file) in use will be in $MU_WRK/lib. Once an experiment is run, the output appears in $MU_OUT

2. To copy reference input to $MU_WD : 

   {{{
   cp input/eaeroin.tgz . (These are files from a location close the Estonian-Russian border 8 August,2010)
   gzip -d eaeroin.tgz
   tar -xvf eaeroin.tar
   cp eaeroin/MUSCIN_radaero_L65.fa_eori MUSCIN_radaero_L65.fa
   cp eaeroin/MUSCIN_radaero_L65.lfi_eori MUSCIN_radaero_L65.lfi
   cp eaeroin/MUSCIN_radaero_L65_PGD.lfi_eori MUSCIN_radaero_L65_PGD.lfi
}}}
   
   The surface-related lfi-files will not be modified further because
   they only depend on the location

3. To start the reference experiment with IFS radiation scheme :

 {{{
   with no aerosol: ./Runmusc_ori0 lecmr eori0                  
   with reference aerosol: ./Runmusc_ori lecmr eori                  
}}}

4. To have a first look on the output :

{{{
   ls -ltr $MU_OUT 
   cd $MU_OUT
   cp $MU_WD/scripts/lfa* .
   cp $MU_WD/scripts/convert* .
   ./lfa2ascii_hourly.sh AROM_60s_L65_lecmr-eori0/
   ./lfa2ascii_hourly.sh AROM_60s_L65_lecmr-eori/
}}}

5. To apply grads for studying the results

{{{   
   ./convert_to_grads_hourly.sh AROM_60s_L65_lecmr-eori0    
   ./convert_to_grads_hourly.sh AROM_60s_L65_lecmr-eori
   *** Note that the files for GrADS will appear in a subdirectory of each experiment: AROM_60s_L65_lecmr-eori0/grads etc
 }}}
   
 {{{
grads            (opens a window where the next commands are given)

reinit
open AROM_60s_L65_lecmr-eori0/grads/output_1_hourly.ctl
open AROM_60s_L65_lecmr-eori/grads/output_1_hourly
set gxout contour
set t 1 7
q file 1 
d ptcls_moy.1
d ptcls_moy.2
printim test1.png
clear
close 2
close 1

open AROM_60s_L65_lecmr-eori0/grads/output_65_hourly
open AROM_60s_L65_lecmr-eori/grads/output_65_hourly
set yflip on
set vrange 0 1.0E-2
d zaer1_moy.1
d zaer1_moy.2
printim test2.png
close 2
close 1
}}}

'''* Note that the above commands can be added to a text file (e.g. plotgra) [[BR]]
and run on the command line within GrADS but typing e.g. the following: exec plotgra'''


'''* Plotting vertical profile of aerosol extinction coefficient'''

Height level info is in grads control files, but to make it easier, separate grads files with layer-thickness info is made available for our experiments.
layerthickness.ctl and layerthickness.grads are copied to 
adamastor.dao.ua.pt /mega3/home/harmonie1/height_info

Plotting may look like that:
{{{
reinit 
open output_65_hourly
open layerthickness
set yflip on
set grads off
* plotting profile of extinction coefficent (1/m)
d zaer1_moy.1/deltaz_moy.2
d zaer2_moy.1/deltaz_moy.2
d zaer3_moy.1/deltaz_moy.2
d zaer4_moy.1/deltaz_moy.2
printim aero_profile.png
close 2
close 1
}}}

Later, an alternative was found by updating src/arp/phys_dmn/writemusc.F90 which writes most of the lfa file output. Variable deltaz was added there and into the script lfa2ascii_hourly.sh. These can be found in harmonie1@adamstor in a file radaero_upd_20140708.tgz. In this case, you can plot in grads directly like this (as in above but including division with the layer thicknesses and perhaps a scaling factor to get the result in km-1:


{{{
open AROM_60s_L65_lecmr-eori0/grads/output_65_hourly
open AROM_60s_L65_lecmr-eori/grads/output_65_hourly
set yflip on
set vrange 0 1.0
d 1000*zaer1_moy.1/deltaz_moy.1
d 1000*zaer1_moy.2/deltaz_moy.2
draw title Vertical profile of aerosol extinction coefficient
printim test3.png
close 2
close 1
}}}

Definition from the NASA page: 
It is a measure of attenuation of the light passing through the atmosphere due to the scattering and absorption by aerosol particles. Extinction coefficient is the fractional depletion of radiance per unit path length (also called attenuation especially in reference to radar frequencies). It has units of km-1. The integrated extinction coefficient over a vertical column of unit cross section is called aerosol optical depth or optical thickness.


'''* Index or GrADS commands: http://www.iges.org/grads/gadoc/gadocindex.html'''

What was there in your input files which could explain some differences? Try this in $MU_WD:

gl -l -m MUSCIN_radaero_L65.fa | grep -i aero

gl is a universal tool for handling various HARMONIE file formats. It should be available in the MUSC binary directory, which is on your $PATH already.

6. Think and make notes what you have been doing

   - What does the script 'mur' do? What is the directory structure of your experiment?

Example of mur:

{{{
#!/bin/bash
# mur
#===================================================================
# This script creates user's MUSC experiment environment. Copy it to
# $HOME/bin and check that the directory is included in your $PATH
#
# usage: mur myexperimentname [ version action config option value ]
# e.g.   mur aradtest 38h1 recompile ecgb n 2
#        would recompile aradtest in cycle 38h1 in ecgb using 2 processors
# modifications:
# November 2011  Laura Rontu   original version
# March    2012  Laura Rontu   minor tuning
# January  2013  Laura Rontu   more minor tuning
# June     2013  Laura Rontu   info about version
# November 2013  Laura Rontu   rearrangements, grib_api library
#===================================================================
set +x

####################Check directories!################
scratch=$HOME/scratch
uhome=$HOME
hhome=/home/hirlam
######################################################

me=mur
EXP=${1-test38}; export EXP

action=${2-linkref}
# linkref | linkown | recompile | envonly

versio=harmonie_MUSC
cy=${3-38h1}
if [ $cy != 37h1 ] 
then 
cy=_cy${cy} 
versio=${versio}${cy}
else
cy=""
fi

confi=${4-debian.gfortran}
confile=config.${confi}
makedir=makeup.${confi}

opt=${5-undef}
if [ ${opt} = undef ]
then
 opt=
 opt1=
else
 opt=-${opt}
 opt1=${6}
fi

if [ -z "${MU_WD}" ] 
then
    export newshell=yes
else
    export newshell=no
fi

export refmusc=${hhome}/${versio}
export refbin=${refmusc}/bin
export utimusc=${refmusc}/util
export basemusc=${uhome}/musc${cy}
export scrimusc=${basemusc}/scr
export wrkmusc=${scratch}/musc${cy}

export GRIB_API=$refmusc/${makedir}/util/grib_api
export MUSC_CONSTANTS=${refmusc}/const
#export DDHI_LIST=${utimusc}/ddhtoolbox/ddh_budget_lists/conversion_list
#export DDHB_BPS=${utimusc}/ddhtoolbox/ddh_budget_lists
#export DDH_PLOT=dd2met

export MU_WD=${basemusc}/EXP/$EXP
export MU_WRK=${wrkmusc}/$EXP
export MU_OUT=${MU_WRK}/OUTPUT
export MU_IN=${MU_WRK}/muscin
export ownbin=${MU_WRK}/bin
export ownlib=${MU_WRK}/lib
export MYOWNEXE=${ownbin}/MASTER

test -d ${MU_WD}   || mkdir -p ${MU_WD}
test -d ${MU_WRK}  || mkdir -p ${MU_WRK}
test -d ${MU_IN}   || mkdir -p ${MU_IN}
test -d ${ownbin}  || mkdir -p ${ownbin}
test -d ${ownlib}  || mkdir -p ${ownlib}
test -d ${scrimusc}|| { cp -r -p $refmusc/scr ${basemusc} ; echo  ; echo "Copied reference scripts to ${scrimusc} !!!" ; }


compok=yes
if [ $action = recompile ] ; then
echo
echo RECOMPILING $MYOWNEXE 
echo from modifications in $MU_WD/src
echo PLEASE WAIT WHILE SYNCHRONISING AND COMPILING
echo
sleep 3

compok=yes
test -e ${MYOWNEXE} && rm ${MYOWNEXE}
test -e ${ownlib}/bin/MASTER && rm ${ownlib}/bin/MASTER
cp -r -u ${refmusc}/util ${ownlib}
cp -r -u ${refmusc}/src ${ownlib}
cp -r -p ${MU_WD}/src ${ownlib}
cp -r -p ${MU_WD}/util ${ownlib}
cd ${MU_WRK}
pwd

${ownlib}/util/makeup/build ${opt} ${opt1} ${confile} 
test -e ${ownlib}/bin/MASTERODB && ln -s ${ownlib}/bin/MASTERODB ${MYOWNEXE} || compok=no 

elif [ $action = linkref ] 
then
    rm -f ${MYOWNEXE}
    ln -s ${refbin}/MASTERODB ${MYOWNEXE} || compok=no

elif [ $action = linkown ]
then
    test -h ${MYOWNEXE} && rm ${MYOWNEXE}
    ln -s ${ownlib}/bin/MASTERODB ${MYOWNEXE} || compok=no
elif  [ $action = envonly ]
then
    test -e ${MYOWNEXE} || compok=no
fi

cd $MU_WD
cp $HOME/.bashrc tool.path
cat >> ./tool.path <<EOF
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${GRIB_API}/fortran/.libs:${GRIB_API}/src/.libs
PATH=.:${utimusc}:${basemusc}/scr:${ownlib}/bin:${refbin}:${utimusc}/ddhtoolbox/tools/lfa:${utimusc}/ddhtoolbox/tools:$PATH: ; export PATH
echo
echo "Your PATH is now: \$PATH" 
echo
EOF

chmod 755 ./tool.path
echo
echo ============================================================
echo Your executable MASTER is:
ls -la $MYOWNEXE 

if [ $compok = no ] 
then 
echo CORRECT ERRORS before starting your experiment
echo 

else 
echo Start experiment with appropriate $MU_WD/Runmusc_xxx

fi

cat > ./mu_ver <<EOF
Experiment $EXP of ${versio} using $confile
Environment created by ${me} 
EOF

if [ ${newshell} = no ]
then
echo ============================================================

else
echo Created new shell with MUSC ENVIRONMENT in 
echo $MU_WD and 
echo $MU_WRK
echo Please run '. ./tool.path' to setup utility paths
echo ============================================================
exec /bin/bash 
fi
exit
}}}
 
   - Study the three Runmusc-scripts: what do they do, what are the differences? 

   - What does the conversion script lfa2ascii_hourly.sh do? 

   - Convert_to_grads_hourly.sh converts lfa2ascii_hourly output to grads binary and ctl

---------


'''If you wish to extract ASCII data from the files (e.g. the hourly averaged files) and plot them in some other package e.g. the R Statistics package, the following is an example of how this could be done:'''

for file in AROM_60s_L65_lecmwr-eori/Outmoy* ; do #### This extracts the U component of the wind - model level data
lfac $file PU > $file.PU
done

paste *PU >> OutputPU ### This is a text file which I read into R - the file is in matrix format which is handy for area contour plots in R


R script

z<- read.table(file="OutputPU",header=FALSE)
x<-seq(1,7)
y<-seq(1,65)
y<-rev(y)
mylevels <-seq(-30,30,5)

jet.colors <-colorRampPalette(c("#00007F", "blue", "#007FFF", "cyan","#7FFF7F", "yellow", "#FF7F00", "red", "#7F0000")) ### This colour scheme resembles the Matlab default scheme
cols <- jet.colors(length(mylevels) - 1)
customAxis <- function() {
   n <- length(mylevels)
   # Generate even spacing over y-scale range
   y <- seq(min(mylevels), max(mylevels), length.out=n)
   # Draw main key with rectangles
   # (using same colours as in main plot)
   rect(0, y[1:(n-1)], 1, y[2:n], col=cols)
   # Draw key axis
   # NOTE: labels do not correspond to "real" y-locations
   axis(4, at=y, labels=mylevels,cex.axis = 1.7)
}
jpeg('outputPU.jpg')
filled.contour(x,rev(y),t(z),levels=mylevels,col=cols,ylim=rev(c(1,65)),plot.title= title(xlab = "forecast hours", ylab = "model level ",cex.main=2,cex.lab=1.3),key.title=title(main = "m/s",cex.main=1.3))
dev.off()

To run the above in R you can do any of the following:
1. Copy the commands to the R command line 
2. Save the commands to a script example.R and run the following within R: source("example.R")
3. Run the script from the bash command line: R CMD BATCH example.R


--------

'''Converting output to NetCDF, plotting with python'''

The Climate Data Operators (CDO) can convert GrADS binary file to netCDF.
The ctl file is given as argument.

{{{
cdo -f nc import_binary input_file.ctl output_file.nc
}}}

The data in the generated NetCDF file can be plotted with python using netcdf4-python package for reading NetCDF format, previously mentioned R or other software.
In python matplotlib can be used for plotting http://matplotlib.org/
Another possibility to use python for plotting is to plot data from ascii files (reading and aggregating data in python is also done inside convert_to_grads_hourly.sh).  

--------

=== How to modify the input data and namelist settings ===


In the directory $MU_WD/input you can find a file MUSCIN_radaero_L65.fa.ascii_eeaero . This contains the input profile and some additional variables, including integrated AOD, which was used to make the input file MUSCIN_radaero_L65.fa_eeaero. (In addition to the original variables,
AOD for VOLCAN and SULFAT aerosol were added). It is possible to copy this file to another, e.g.  MUSCIN_radaero_L65.fa.ascii_myexp1, and edit it with any editor (emacs, vi ...). You may modify e.g. the integrated AODs (the number 0 is technical indicator, no need to change):

{{{
 SURFAEROS.SEA   
  1.28568330974409141E-003           0
 SURFAEROS.LAND  
  1.285E-000                         0
 SURFAEROS.SOOT  
  2.000E-000                         0
 SURFAEROS.DESERT
  1.5132E-002                        0
 SURFAEROS.VOLCAN
  0.0E-003                           0
 SURFAEROS.SULFAT
  4.5E-003                           0
}}}

This kind of lines contain cloud liquid and ice at model levels (levels 1-65 from the top to bottom, here e.g. level 17 and 18):

{{{
 S017LIQUID_WATER
   0.0000000000000000                0
 S018LIQUID_WATER
   0.0000000000000000                0

 S017SOLID_WATER 
   0.0000000000000000                0
 S018SOLID_WATER 
   0.0000000000000000                0
}}}

SI units are used, e.g. for specific cloud water/ice contents typical values might be of the order of 1.0E-006 kg/kg. You could add water or ice at some levels and see the effect. In this experiment, the fractional cloud cover is assumed to be 1 if there is any liquid or solid water, otherwise it is 0. This is set by hardcoding in ./src/arp/phys_dmn/apl_arome.F90. In the setup of this experiment, the input values do not change during the time integration. 

The edited file should be copied to  MUSCIN_radaero_L65.fa.ascii . This is input to the script Asc2fa.sh, found in the scripts directory, which converts the ascii file to a new MUSCIN_radaero_L65.fa.ascii.fa. This resulting file should be moved to MUSCIN_radaero_L65.fa before running an experiment. Thus, after editing the ASCII file, do this:

* ./Asc2fa.sh MUSCIN_radaero_L65.fa

* Output file is MUSCIN_radaero_L65.fa.ascii.fa

* mv MUSCIN_radaero_L65.fa.ascii.fa $MU_WD/MUSCIN_radaero_L65.fa

* Then run Runmusc_aero if you included the VOLC/SULF aerosols in the modified input. In Runmusc_ori those 2 aerosols are set to .false. by default, which is suitable for running from the original MUSCIN_radaero_L65.fa. Runmusc_ori0 excludes all aerosol available in any input file.

A HARMONIE experiment is controlled by namelists. There are a lot of them, also in the simple MUSC single-column setup, which is in this respect very similar to the full 3D HARMONIE run. For this experiment, all namelist settings have been gathered inside the run-scripts Runmusc_ori, _ori0 and _aero. Essential changes can be made in the namelists &NAERAD and &NAMPHY . You might compare how the three Runmusc scripts differ for these two namelists (there are other smaller differences which are not important, they are related to output). You can use the unix command 'diff' for comparison, Emacs allows even more graphical comparison between two or three buffers.

Please note also that the choice of the radiation scheme is done at the command line, e.g.

{{{
sh ./Runmusc_ori0 lecmr eori0
sh ./Runmusc_ori0 lhirr eori0
sh ./Runmusc_ori0 lalar eori0
}}}

Here the first parameter selects the ECMWF, HIRLAM or ALARO radiation scheme. The second one is a tag to remember the settings used (eori0 for no aerosol here, you can choose the tag as you like). These parameters influence the name of the output directory in $MU_OUT.

--------

=== How to modify the code and recompile ===

Not everything is controlled by namelist and input choices. Some changes need to be introduced to the source code, e.g. the change of aerosol vertical distribution functions can only be done this way. A selection of most relevant pieces of code are available under the directory $MU_WD/src, all these differ from the reference code under $refmusc/src . If you need to modify something else, you should copy it here first, e.g. :

{{{
cp $refmusc/src/arp/phys_ec/suaerv.F90 $MU_WD/src/arp/phys_ec/
cp $refmusc/src/arp/phys_radi/suaersn.F90 $MU_WD/src/arp/phys_radi/
}}}

and then edit it. (How to know what you need to edit? Please ask the leaders of the exercise, they may know or help to find out!) The modifications done under $MU_WD/src will be taken aboard when the code is recompiled. When you run the reference experiment (see above), you created the environment with this:

{{{
mur radaero linkown
   . ./tool.path
}}}

Now, you should exit this environment and recompile:

{{{
exit
mur radaero recompile
}}}

If there are compilation errors, correct the code and repeat exit and recompile until you are done, then do not forget to say again:
{{{
   . ./tool.path
}}}

Next, you may copy one of the Runmusc scripts to be modified and used in your experiment. Perhaps you do not need to modify the namelists, then use a suitable script without changes.

--------

=== Example of variable names in the lfa output files ===

NB The lfa tools are installed on the FMI Numlab machine but should you wish to compile these yourself (on ecgb or a local machine) do the following:
{{{
cd $PATH_TO_MUSC/util/ddhtoolbox/tools
sh ./install.sh
}}} 

lfa is a file format used for diagnostics. There are lfa tools used to handle it. This output has been produced by lfaminm.

check that the tools are in your path: "which lfac" for example - if not (for whatever reason) you can add the path to your .bashrc file.

Examples:

lfaminm ${foldername}/Out.000.0000.lfa - returns the min, mean and max of each variable in the lfa file.
lfac ${foldername}/Out.000.0000.lfa PFRSODS - returns the global SW radiation at the surface.
LFAMINM from file AROM_60s_L41_lecmr-ql500g/Out.000.0167.lfa :

 || l=       1, ||  min=AROM          || max=AROM         ||                   ||                  ||    || INDICE EXPERIENCE  || 
 || l=      41, ||  min=  -7.749      || max=  -2.000     ||  mea=  -3.053     ||  rms=   3.599    || R4 || ZFUGEO             || 
 || l=      41, ||  min=  0.1769E-01  || max=   2.000     ||  mea=   1.637     ||  rms=   1.764    || R4 || ZFVGEO             || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || ZFU                || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || ZFV                || 
 || l=      41, ||  min= -0.2500E-04  || max=   0.000     ||  mea= -0.4338E-05 ||  rms=  0.9747E-05 || R4 || ZFT                || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || ZFQ                || 
 || l=      41, ||  min=  0.1000E-11  || max=   1.000     ||  mea=  0.1220     ||  rms=  0.3492    || R4 || PCLFS              || 
 || l=      41, ||  min=   0.000      || max=  0.4255E-03 ||  mea=  0.4149E-04 ||  rms=  0.1328E-03 || R4 || ZQLI               || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || ZQICE              || 
 || l=       1, ||  min=  0.1800      || max=  0.1800     ||  mea=  0.1800     ||  rms=  0.1800    || R4 || [[Color(blue, ZALBP1)]] || 
 || l=       1, ||  min=  0.1800      || max=  0.1800     ||  mea=  0.1800     ||  rms=  0.1800    || R4 || [[Color(blue, ZALBD1)]] || 
 || l=       6, ||  min=  0.1800      || max=  0.1800     ||  mea=  0.1800     ||  rms=  0.1800    || R4 || ZALBP              || 
 || l=       6, ||  min=  0.1800      || max=  0.1800     ||  mea=  0.1800     ||  rms=  0.1800    || R4 || ZALBD              || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAESEA)]] input AOD sea || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAELAN)]] input AOD land || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAESOO)]] input AOD soot || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAEDES)]] input AOD desert || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAEVOL)]] input AOD volcanic ash || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAESUL)]] input AOD stratosph.sulph. || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAER1)]] aerosol 1 AOD profile || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAER2)]] || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAER3)]] || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAER4)]] || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAER5)]] || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, ZAER6)]] || 
 || l=      41, ||  min=  0.1000E-11  || max=   1.000     ||  mea=  0.1220     ||  rms=  0.3492    || R4 || [[Color(blue, PCLFR)]] cloud fraction profile || 
 || l=       1, ||  min=   771.1      || max=   771.1     ||  mea=   771.1     ||  rms=   771.1    || R4 || [[Color(blue, PFRSOPT)]] direct SW TOA || 
 || l=       1, ||  min=   192.4      || max=   192.4     ||  mea=   192.4     ||  rms=   192.4    || R4 || [[Color(blue, PFRSOPS)]] direct SW sfc || 
 || l=       1, ||  min=   9.050      || max=   9.050     ||  mea=   9.050     ||  rms=   9.050    || R4 || [[Color(blue, ZFRSOFS)]] diffuse SW sfc || 
 || l=       6, ||  min=  0.1000E-07  || max=   132.8     ||  mea=   32.07     ||  rms=   58.07    || R4 || [[Color(blue, ZZSFSWDIR)]] direct SW sfc, spectral || 
 || l=       6, ||  min=  0.1000E-07  || max=   8.961     ||  mea=   1.508     ||  rms=   3.658    || R4 || [[Color(blue, ZZSFSWDIF)]] diffuse SW sfc, spectral || 
 || l=      41, ||  min=  0.9430E-03  || max=   1.167     ||  mea=  0.6326     ||  rms=  0.7483    || R4 || RHO                || 
 || l=      42, ||  min=  0.9430E-03  || max=   1.170     ||  mea=  0.6325     ||  rms=  0.7505    || R4 || RHO_flux           || 
 || l=       1, ||  min=          41  || max=          41 ||  mea=   41.00     ||  rms=   41.00    || I4 || KLEV               || 
 || l=       1, ||  min=   60.00      || max=   60.00     ||  mea=   60.00     ||  rms=   60.00    || R4 || TSPHY              || 
 || l=       1, ||  min=    20120320  || max=    20120320 ||  mea=  0.2012E+08 ||  rms=  0.2012E+08 || I4 || NINDAT             || 
 || l=       1, ||  min=       43200  || max=       43200 ||  mea=  0.4320E+05 ||  rms=  0.4320E+05 || I4 || NSSSSS             || 
 || l=       1, ||  min=          41  || max=          41 ||  mea=   41.00     ||  rms=   41.00    || I4 || KCLPH              || 
 || l=       1, ||  min=   90.00      || max=   90.00     ||  mea=   90.00     ||  rms=   90.00    || R4 || RSTATI             || 
 || l=      41, ||  min=  -5.509      || max=  -2.000     ||  mea=  -2.777     ||  rms=   3.076    || R4 || PU                 || 
 || l=      41, ||  min= -0.5073      || max=   2.000     ||  mea=   1.376     ||  rms=   1.726    || R4 || PV                 || 
 || l=      41, ||  min=   2.828      || max=   5.531     ||  mea=   3.387     ||  rms=   3.527    || R4 || PVENT              || 
 || l=      41, ||  min=   83.97      || max=   135.0     ||  mea=   121.9     ||  rms=   123.8    || R4 || PDIRVENT           || 
 || l=      41, ||  min=   213.0      || max=   299.5     ||  mea=   256.7     ||  rms=   258.4    || R4 || [[Color(blue, PT)]] Temperature     || 
 || l=      41, ||  min=  0.2489E-06  || max=  0.1176E-01 ||  mea=  0.3331E-02 ||  rms=  0.5308E-02 || R4 || PQ                 || 
 || l=      41, ||  min=  0.3029E+06  || max=  0.6875E+06 ||  mea=  0.3515E+06 ||  rms=  0.3609E+06 || R4 || ZH                 || 
 || l=      41, ||  min=   298.2      || max=   1855.     ||  mea=   410.2     ||  rms=   491.6    || R4 || THETA              || 
 || l=      41, ||  min=   299.7      || max=   1855.     ||  mea=   410.8     ||  rms=   492.0    || R4 || THETAV             || 
 || l=      41, ||  min=   298.2      || max=   1855.     ||  mea=   410.2     ||  rms=   491.6    || R4 || THETAL_KE          || 
 || l=      41, ||  min=   298.2      || max=   1855.     ||  mea=   410.2     ||  rms=   491.6    || R4 || THETAL_BS          || 
 || l=      41, ||  min=   298.2      || max=   1855.     ||  mea=   410.2     ||  rms=   491.6    || R4 || THETAL             || 
 || l=      41, ||  min=   299.7      || max=   1855.     ||  mea=   410.8     ||  rms=   492.0    || R4 || THETAVL            || 
 || l=      41, ||  min=  0.1000E-05  || max=  0.4923E-01 ||  mea=  0.1312E-02 ||  rms=  0.7697E-02|| R4 || PECT               || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PQI                || 
 || l=      41, ||  min= -0.3137E-06  || max=  0.4253E-03 ||  mea=  0.4146E-04 ||  rms=  0.1327E-03|| R4 || PQL                || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PQSN               || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PQR                || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PQG                || 
 || l=       1, ||  min=           1  || max=           1 ||  mea=   1.000     ||  rms=   1.000    || I4 || KGL1               || 
 || l=       1, ||  min=           4  || max=           4 ||  mea=   4.000     ||  rms=   4.000    || I4 || KGL2               || 
 || l=       1, ||  min=           0  || max=           0 ||  mea=   0.000     ||  rms=   0.000    || I4 || KSGST              || 
 || l=       1, ||  min=           1  || max=           1 ||  mea=   1.000     ||  rms=   1.000    || I4 || KSTEP              || 
 || l=       1, ||  min=           0  || max=           0 ||  mea=   0.000     ||  rms=   0.000    || I4 || KCSS               || 
 || l=       1, ||  min=  0.5599      || max=  0.5599     ||  mea=  0.5599     ||  rms=  0.5599    || R4 || [[Color(blue, PMU0)]] cosine of solar zenith angle || 
 || l=       1, ||  min=  0.8290      || max=  0.8290     ||  mea=  0.8290     ||  rms=  0.8290    || R4 || PGEMU              || 
 || l=       1, ||  min=  0.8599E-01  || max=  0.8599E-01 ||  mea=  0.8599E-01 ||  rms=  0.8599E-01 || R4 || PGELAM             || 
 || l=      42, ||  min=   0.000      || max=  0.6875E+06 ||  mea=  0.1012E+06 ||  rms=  0.1652E+06 || R4 || PAPHI              || 
 || l=      42, ||  min=   0.000      || max=  0.1013E+06 ||  mea=  0.5018E+05 ||  rms=  0.6136E+05| | R4 || PAPRS              || 
 || l=      41, ||  min=   175.0      || max=  0.4633E+06 ||  mea=  0.9273E+05 ||  rms=  0.1390E+06 || R4 || PAPHIF             || 
 || l=      41, ||  min=   60.41      || max=  0.1011E+06 ||  mea=  0.5013E+05 ||  rms=  0.6106E+05 || R4 || PAPRSF             || 
 || l=      41, ||  min=  0.2021E-02  || max=   1.000     ||  mea=  0.8914E-01 ||  rms=  0.1900    || R4 || PALPH              || 
 || l=      41, ||  min=   271.8      || max=   3618.     ||  mea=   2471.     ||  rms=   2675.    || R4 || PDELP              || 
 || l=      41, ||  min=  0.4046E-02  || max=   4.500     ||  mea=  0.2565     ||  rms=  0.7525    || R4 || PLNPR              || 
 || l=      41, ||  min=  0.2764E-03  || max=  0.3679E-02 ||  mea=  0.6138E-03 ||  rms=  0.8929E-03 || R4 || PRDELP             || 
 || l=      41, ||  min=   1005.      || max=   1015.     ||  mea=   1008.     ||  rms=   1008.    || R4 || PCP                || 
 || l=      41, ||  min=   287.1      || max=   289.1     ||  mea=   287.6     ||  rms=   287.6    || R4 || PR                 || 
 || l=      41, ||  min=   0.000      || max=  0.2101E-05 ||  mea=  0.4960E-06 ||  rms=  0.8712E-06 || R4 || PVERVEL            || 
 || l=      41, ||  min= -0.1651E-01  || max=  -0.000     ||  mea= -0.4073E-02 ||  rms=  0.7095E-02 || R4 || ZW                 || 
 || l=      41, ||  min=   0.000      || max=  0.1200     ||  mea=  0.3710E-01 ||  rms=  0.6282E-01 || R4 || ZOMEGA             || 
 || l=      42, ||  min=  -256.3      || max= -0.2318     ||  mea=  -152.0     ||  rms=   177.4    || R4 || PEMTD              || 
 || l=      42, ||  min=  -256.3      || max= -0.2318     ||  mea=  -152.0     ||  rms=   177.4    || R4 || PEMTU              || 
 || l=      42, ||  min=  0.5903E-01  || max=  0.3129     ||  mea=  0.1860     ||  rms=  0.2069    || R4 || PTRSO              || 
 || l=       1, ||  min=  0.9963      || max=  0.9963     ||  mea=  0.9963     ||  rms=  0.9963    || R4 || PCLON              || 
 || l=       1, ||  min=  0.8588E-01  || max=  0.8588E-01 ||  mea=  0.8588E-01 ||  rms=  0.8588E-01 || R4 || PSLON              || 
 || l=      42, ||  min=   45.52      || max=   241.3     ||  mea=   143.4     ||  rms=   159.6    || R4 || [[Color(blue, PFRSO)]] net SW || 
 || l=      42, ||  min=  -255.3      || max=  0.8215     ||  mea=  -150.9     ||  rms=   176.5    || R4 || [[Color(blue, PFRTH)]] net LW || 
 || l=       1, ||  min=   300.2      || max=   300.2     ||  mea=   300.2     ||  rms=   300.2    || R4 || [[Color(blue, PTCLS)]] screen-level temperature || 
 || l=       1, ||  min=  -3.343      || max=  -3.343     ||  mea=  -3.343     ||  rms=   3.343    || R4 || PUCLS              || 
 || l=       1, ||  min= -0.3529      || max= -0.3529     ||  mea= -0.3529     ||  rms=  0.3529    || R4 || PVCLS              || 
 || l=       1, ||  min=  0.1237E-01  || max=  0.1237E-01 ||  mea=  0.1237E-01 ||  rms=  0.1237E-01 || R4 || PQCLS              || 
 || l=       1, ||  min=   1.000      || max=   1.000     ||  mea=   1.000     ||  rms=   1.000    || R4 || [[Color(blue, PCLCT)]] total cloud fraction || 
 || l=       1, ||  min=  0.1000E-11  || max=  0.1000E-11 ||  mea=  0.1000E-11 ||  rms=  0.1000E-11 || R4 || [[Color(blue, PCLCH)]] high cloud fraction || 
 || l=       1, ||  min=   1.000      || max=   1.000     ||  mea=   1.000     ||  rms=   1.000    || R4 || [[Color(blue, PCLCM)]] medium cloud fraction || 
 || l=       1, ||  min=   1.000      || max=   1.000     ||  mea=   1.000     ||  rms=   1.000    || R4 || [[Color(blue, PCLCL)]] low cloud fraction || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PCLCC              || 
 || l=       1, ||  min=   3.362      || max=   3.362     ||  mea=   3.362     ||  rms=   3.362    || R4 || VENTCLS            || 
 || l=       1, ||  min=   83.97      || max=   83.97     ||  mea=   83.97     ||  rms=   83.97    || R4 || DIRCLS             || 
 || l=       1, ||  min=  -155.7      || max=  -155.7     ||  mea=  -155.7     ||  rms=   155.7    || R4 || PFCLL              || 
 || l=       1, ||  min=  -0.000      || max=  -0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PFCLN              || 
 || l=       1, ||  min=  -66.79      || max=  -66.79     ||  mea=  -66.79     ||  rms=   66.79    || R4 || PFCS               || 
 || l=      41, ||  min=  0.1000E-11  || max=  0.1000E-11 ||  mea=  0.1000E-11 ||  rms=  0.1000E-11 || R4 || PNEB               || 
 || l=       1, ||  min=   3.156      || max=   3.156     ||  mea=   3.156     ||  rms=   3.156    || R4 || ECT_INT            || 
 || l=       1, ||  min=  0.5028      || max=  0.5028     ||  mea=  0.5028     ||  rms=  0.5028    || R4 || [[Color(blue, LWP)]] liquid water path || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || [[Color(blue, IWP)]] ice water path || 
 || l=       1, ||  min=  0.5028      || max=  0.5028     ||  mea=  0.5028     ||  rms=  0.5028    || R4 || [[Color(blue, CWP)]] cloud condensate path || 
 || l=       1, ||  min=   27.73      || max=   27.73     ||  mea=   27.73     ||  rms=   27.73    || R4 || [[Color(blue, WVP)]] water vapour path || 
 || l=      42, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PFPLSL             || 
 || l=      42, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PFPLSN             || 
 || l=      42, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PFPLSG             || 
 || l=      42, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PFPLSHL            || 
 || l=      42, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PREC_TOT           || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PQICE              || 
 || l=      41, ||  min= -0.3137E-06  || max=  0.4253E-03 ||  mea=  0.4146E-04 ||  rms=  0.1327E-03 || R4 || PQLI               || 
 || l=      41, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PRH                || 
 || l=       1, ||  min=   302.3      || max=   302.3     ||  mea=   302.3     ||  rms=   302.3    || R4 || PTS                || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || PQS                || 
 || l=       1, ||  min=   55.51      || max=   55.51     ||  mea=   55.51     ||  rms=   55.51    || R4 || [[Color(blue, PFRSODS)]] SW global sfc || 
 || l=       1, ||  min=   435.0      || max=   435.0     ||  mea=   435.0     ||  rms=   435.0    || R4 || [[Color(blue, PFRTHDS)]] LW down sfc || 
 || l=       1, ||  min=   1.000      || max=   1.000     ||  mea=   1.000     ||  rms=   1.000    || R4 || PITM               || 
 || l=      42, ||  min=  0.1660      || max=  0.1660     ||  mea=  0.1660     ||  rms=  0.1660    || R4 || PSTRTU             || 
 || l=      42, ||  min=  0.1752E-01  || max=  0.1752E-01 ||  mea=  0.1752E-01 ||  rms=  0.1752E-01 || R4 || PSTRTV             || 
 || l=       2, ||  min=   468.5      || max=   631.8     ||  mea=   550.1     ||  rms=   556.2    || R4 || PFRSOC             || 
 || l=       2, ||  min=  -286.1      || max=  -103.1     ||  mea=  -194.6     ||  rms=   215.1    || R4 || PFRTHC             || 
 || l=       1, ||  min=   301.2      || max=   301.2     ||  mea=   301.2     ||  rms=   301.2    || R4 || THETAS             || 
 || l=       1, ||  min=  0.1323E+05  || max=  0.1323E+05 ||  mea=  0.1323E+05 ||  rms=  0.1323E+05 || R4 || HCLA               || 
 || l=       1, ||  min=  0.1323E+05  || max=  0.1323E+05 ||  mea=  0.1323E+05 ||  rms=  0.1323E+05 || R4 || HCLA_AY1996        || 
 || l=      42, ||  min=   0.000      || max=   1015.     ||  mea=   983.5     ||  rms=   995.5    || R4 || ZCP_flux           || 
 || l=      42, ||  min=  0.2432E+07  || max=  0.2850E+07 ||  mea=  0.2690E+07 ||  rms=  0.2697E+07 || R4 || ZLH_flux           || 
 || l=       1, ||  min=  0.4086      || max=  0.4086     ||  mea=  0.4086     ||  rms=  0.4086    || R4 || ZUSTAR             || 
 || l=       1, ||  min=   7.877      || max=   7.877     ||  mea=   7.877     ||  rms=   7.877    || R4 || SAT_DEF_0-15       || 
 || l=       1, ||  min=   6.058      || max=   6.058     ||  mea=   6.058     ||  rms=   6.058    || R4 || SAT_DEF_1-15       || 
 || l=       1, ||  min=   11.65      || max=   11.65     ||  mea=   11.65     ||  rms=   11.65    || R4 || SAT_DEF_2.5-4.5    || 
 || l=       1, ||  min=   10.95      || max=   10.95     ||  mea=   10.95     ||  rms=   10.95    || R4 || SAT_DEF_1.4-3      || 
 || l=       1, ||  min=  -3.069      || max=  -3.069     ||  mea=  -3.069     ||  rms=   3.069    || R4 || SAT_DEF_QV_0-15    || 
 || l=       1, ||  min=  -2.062      || max=  -2.062     ||  mea=  -2.062     ||  rms=   2.062    || R4 || SAT_DEF_QV_1-15    || 
 || l=       1, ||  min=  -2.872      || max=  -2.872     ||  mea=  -2.872     ||  rms=   2.872    || R4 || SAT_DEF_QV_2.5-4.5 || 
 || l=       1, ||  min=  -4.880      || max=  -4.880     ||  mea=  -4.880     ||  rms=   4.880    || R4 || SAT_DEF_QV_1.4-3   || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || ZCLDTOP            || 
 || l=       1, ||  min=   0.000      || max=   0.000     ||  mea=   0.000     ||  rms=   0.000    || R4 || ZCLDBAS            || 
 || l=       1, ||  min=   17.85      || max=   17.85     ||  mea=   17.85     ||  rms=   17.85    || R4 || ZMAXFRAC           || 

--------

'''A few notes on aerosol in the 3 radiation schemes: IFS, hlradia and Acraneb2'''

'''IFS'''
* In the IFS scheme, there are 6 input aerosol types: 1.Land 2.Sea 3.Desert 4.Soot/urban 5.Background 6.Volcano

* In the radaer.F90 subroutine they are set as follows with constants used in the linear combination equations:

* ZAER1 = LAN + SUL
* ZAER2 = SEA
* ZAER3 = DES
* ZAER4 = SOOT
* ZAER5 = none of the 6 aero types used in its eqn.
* ZAER6 = VOL (or none of the 6 aero types used in its eqn. if VOL=.FALSE.)

* By default the SUL and VOL are set to .FALSE. (e.g. if you run Runmusc_ori or Runmusc_ori0, where in the latter all aerosols are zero)

* Within Runmusc_aero all 6 input aerosol types are set to .TRUE. but note that ZAER5 from radaer.F90 is doesn't depend on any aerosol input

* Note that the values read in from the Runmusc namelists are AODs. The aerosols are then distributed vertically by radaer.F90 using the constants set in the setup file suaerv.F90

'''HLRADIA'''

* In hlradia called by apl_arome in HARMONIE-MUSC, input aerosol for hlradia is prepared by radaer.F90 as for IFS radiation, see above. As in the IFS case NAER=0 means that no aerosols are used.
* It is possible to do some additional hard-coding in apl_hlradia.F90 in order to include original simplified aerosol coefficients or multiply the input values with coefficients. Please use these only if you urgently need to find bugs or try something exotic - better modify the inputvertically integrated aerosol values.
  * In the original hlradia radiation routine, the aerosols were constant and not split into types (tuning coefficients rather than real aerosol - see poster by Gleeson et al on http://www.cnrm.meteo.fr/aladin/spip.php?article166). If you wish to use the original constant aerosol set-up set zatest(:)=0 in apl_hlradia caak/cask=1.2/1.25
  * zatest=1. switches on the full aero_rt6  parametrizations using input aerosol (in our case the same 6 values as in the IFS example) and caak/cask=1.0. he ZAER[1-6] are scaled by multiplying by zatest[1-6] (in our case these are all 1 so there's no effect). Take a look at the AER[1-6]?H parameters in any of the hlradia experiment output.

'''ACRANEB'''
* In acraneb called by apl_arome in HARMONIE-MUSC, input aerosol for hlradia is prepared by radaer.F90 as for IFS radiation, see above
* In the present MUSC environment only acraneb2 is available and activated with the namelist parameter NRAY in the Runmusc_XXX scripts set 2 
* Acraneb2 uses the same 6 aerosols as IFS as long as LRSTAER=.F., otherwise the ACRANEB aerosols will be initialized with the old "standard aerosols", having only one category. 

----

Participants of the Harmonie groups

Ana Claudia Parracho, U. Aveiro, Portugal, task 3 [[BR]]
Anna Pavlova, OSENU, Ukraine, task 3 [[BR]]
Baas Mijling, KNMI, The Netherlands, task 4 [[BR]]
Chinmay Jena, IITM, India, task 2 [[BR]]
David Allende, UTN-FRM, Argentina, task 2 [[BR]]
Diogo Lopez, U. Aveiro, Portugal, task 4 [[BR]]
Dora Lazar, U. Etvos Lorand, Hungary, task 2 [[BR]]
Emily Gleeson, Met Eireann, Ireland, support [[BR]]
Fabrizio Ferrari, U. Brescia, Italy, task 2 [[BR]]
Kristian Pagh Nielsen, DMI, Denmark, support [[BR]]
Laura Rontu, FMI, Finland, support [[BR]]
Luke Surl, U. East Anglia,UK, task 3 [[BR]]
Matthias Reif, U. Innsbruck, Austria, task 4 [[BR]]
Sergiey Ivanov, OSENU, Ukraine, task 5 [[BR]]
Velle Toll, U. Tartu, Estonia, support [[BR]]

----

'''Suggestions for reporting'''

Each of three groups could have about 8 minutes for the presentation and 2 minutes for discussion, which would mean 3-5 slides per group. In the presentations there could be

* background information
* description of own task
* results and conclusion

Possible topics for background information, one to be chosen by each group

* HARMONIE-MUSC
* Summer 2010 forest fire case
* Role of aerosols in NWP

The tasks focus on

* Task 2 : reaction of different radiation schemes on aerosol changes
* Task 3 : sensitivity to changing aerosol optical properties
* Task 4 : sensitivity to changing aerosol distribution 

One of the groups could include a slide about 3D experiments done by the Odessan team

----
README of the aerosol [https://www.hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/YSSS-Aveiro2014/YSSS14_harmoexe/test_aero.tgz test experiment]

1)  After unzipping the zip file in a desired directory with: "unzip test_aero.zip", the makefile is run with: "make". If gfortran is not present, modify the fortran compiler specified in Makefile.

2) aero_rt6.F90 is the same subroutine as is used in the HARMONIE radiation branch.

3) test_aero.F90 is a simple program that reads the input in input.dat and write to output.dat. It is run with the executable: "./test_aero.x". The program contains a loop, where the input aerosol optical depth are scaled with factors from 0.0 til 10.0 in increments of 0.01. The program can be modified for other experiments such as varying the input relative humidity (rh) and the input cos(solar zenith angle) (pscos). Notice that changes will only work after recompiling by running "make". This also applies for experiments with aero_rt6.F90 - if such are desired.

4) The input file defines 1D input for test_aero.x in 8 lines. In the first line the cos(solar zenith angle) is specified. In the second line the relative humidity is specified in 10 atmospheric levels. In the last six lines the profiles of the layer by layer IFS aerosol optical thicknesses at 550 nm are specified, with one line per aerosol type. 

5) The output in output.dat depends on the definitions in the WRITE statement ie to output.dat. It is run with the executable: "./test_aero.x". The program contains a loop, where the input aerosol optical depth are scaled with factors from 0.0 til 10.0 in increments of 0.01. The program can be modified for other experiments such as varying the input relative humidity (rh) and the input cos(solar zenith angle) (pscos). Notice that changes will only work after recompiling by running "make". This also applies for experiments with aero_rt6.F90 - if such are desired.

4) The input file defines 1D input for test_aero.x in 8 lines. In the first line the cos(solar zenith angle) is specified. In the second line the relative humidity is specified in 10 atmospheric levels. In the last six lines the profiles of the layer by layer IFS aerosol optical thicknesses at 550 nm are specified, with one line per aerosol type. 

5) The output in output.dat depends on the definitions in the WRITE statement in test_aero.F90. In the current configuration the output lines contain the elements: Total aerosol optical depth (AOD), shortwave aerosol transmittance (zaswt), shortwave aerosol diffuse transmittance (zaswtd) and longwave aerosol transmittance (zalwt).

6) Plotting the output in output.dat can be done for instance with Gnuplot: First start Gnuplot by writing: "gnuplot". Then write: plot 'output.dat' u 1:2 t 'SW transmittance', 'output.dat' u 1:4 t 'LW transmittance'

---

Return to https://www.hirlam.org/trac/wiki/HarmonieWorkingWeek/YSSS-Aveiro2014/