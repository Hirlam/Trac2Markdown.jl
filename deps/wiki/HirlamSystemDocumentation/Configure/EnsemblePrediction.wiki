[[PageOutline]]

[[Center(begin)]]
== Hirlam System Documentation ==
= Hirlam Ensemble Prediction =
[[Center(end)]]

[[Center(begin)]]
== Overview ==
[[Center(end)]]

=== Status ===
 * The HIRLAM ensemble prediction system first beta version has been released with changeset [4941]
 * Further developments for GLAMEPS in the trunk by changesets (a/o) [5007], [5065], [5173], [5255], [5294], [5404], [5561], [5634], [5706], [5769], [6011], [6096], [6104], [6105], [7085]

=== Main characteristics ===
 1. allows both for a single ''deterministic'' and single or multi-member ensemble simulations
 1. use of different boundary data
    [[FootNote(Note that the boundary data do not cover all date periods. The temporary data pool on ```ectmp:``` for example covers usually data from the last 3 months. Please check the respective data pool for availablility.)]]
    :
    1. ECMWF deterministic boundaries:
       * 1 boundary member only - useful when running a SLAF ensemble
       * 12h cycle frequency
       * data availability:
         * data access via MARS
    1. ECMWF-EPS boundaries:
       * 50+1 members
       * 12h cycle frequency
       * data availability:
         * online data (usually only the 2-3 most recent days, and Hirlam DA not possible, because of non-availability of OBS)
         * Hirlam boundary data pool [[Color(green, ectmp:/hirlam/bnd/eps_ec/)]] ([[Color(red, NOTE)]]: no permanent storage!)
    1. European TEPS boundaries:
       * 20+1 members
       * 12h cycle frequency
       * Hirlam boundary data pool [[Color(green, ec:/hirlam/bnd/teps_eur/)]]
    1. Norwegian operational TEPS:
       * 20+1 members
       * 24h cycle frequency
       * Hirlam boundary data pool [[Color(green, ectmp:/hirlam/bnd/teps_no/)]] ([[Color(red, NOTE)]]: no permanent storage!)
 1. use of analysis in control run, and perturbed analysis for members without own DA
 1. ensemble member specific environment settings
 1. ensemble cycling independent from data assimilation cycle
 1. random selection of convection/condensation scheme for the perturbed members
 1. stochastic physics
 1. tolerance option for failing ensemble member forecasts

 [[FootNote]]

=== Available ensemble methods ===
 * initial perturbation methods
   * ensemble downscaling of ECMWF-EPS, Norwegian TEPS, European TEPS
   * simple perturbed analysis based on control data assimilation and perturbed boundaries
   * SLAF (Scaled Lagged Average Forecasting)
   * processing of perturbation increments from Hirlam SVs. However, the SV calculation is currently not part of the Hirlam  system and must be done externally.
 * model error treatment
   * explicit or stochastic choice of convection/condensation scheme
   * stochastic physics

=== Implementation, data flow ===

 * build process and climate generation are in common for all members
 * boundary preparation is done for each member separately
 * observations are processed for each member separately
 * cycling for each member separately
 * archiving of ensemble member output as well as ensemble initiation information
 * postprocessing external and in common

A specific mechanism for accessing boundary data at ECMWF platform has been implemented in form of a data pool under ECFS ([[Color(green, ectmp:/hirlam/bnd/)]], [[Color(green, ec:/hirlam/bnd/)]]). This data pool contains MARS retrieved boundary data from ECMWF-EPS and TEPS. In cases where data is stored in ECTMP the data pool keeps data available for a period of about 3 months only. The support of ready made MARS retrievals in the data pool has two reasons:
 * MARS does not archive all model-level data necessary to run Hirlam
 * MARS retrieval of enormous amounts of model-level data for ensembles is very time consuming
The access to the Hirlam data pool is specified by `MARS_TMPDIR` in the script `Env_ecmwf`.

[[Center(begin)]]
== Relevant code and scripts ==
[[Center(end)]]

 * The primalrily relevant source codes are currently:
{{{
   grdy/pertana.F
   phys/rand3.F90
   phys/stocphys.F
}}}
 * The primalrily relevant scripts are
{{{
   Env_ensmbr
   EnsInit
   EnsListener.pl
   EnsStrategy.pl
   hireps.tdf
   PertAna
}}}
[[Center(begin)]]
== Relevant namelists, tunables ==
[[Center(end)]]

=== Ensemble Mode ===
 In general '''Ensemble mode''' is controlled in `Env_expdesc` by
 {{{
  ENSSIZE
  ENSFIRST
 }}}
 which define the number of ensemble members as well as which members to run
 || ENSSIZE || ENSFIRST || description ||
 ||    -1   ||    -1    || deterministic mode (in case of ECMWF boundaries: boundaries from deterministic model) ||
 ||   000   ||   000    || control run only mode (in case of ECMWF boundaries: boundaries from EPS-control)      ||
 ||   nnn   ||   001    || perturbed ensemble mode, no control run ||
 ||   nnn   ||   000    || full ensemble mode (perturbed members plus control) ||

 '''[[Color(red, NOTE:)]]''' In order to run HIRLAM in ensemble mode, it is necessary to specify the Hirlam ensemble TDF file for mini-SMS when launching Hirlam:
{{{
  Hirlam start PLAYFILE=hireps DTG=<yyyymmddhh> DTGEND=<yyyymmddhh> LL=<fclen>
}}}