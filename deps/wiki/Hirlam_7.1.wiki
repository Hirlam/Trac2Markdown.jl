[[PageOutline]]
[[Center(begin)]]
== '''HIRLAM 7.1''' ==
[[LastModified]]
[[Center(end)]]

== Main Features of 7.1 ==

HIRLAM 7.1 features following main updates, many of them with meteorological significances:
 * __Model resolution increase__ For the reference model domain RCR (Regular Cycle of the Reference model), the resolution is increased in both horizontal and vertical, from the grid mesh in Hirlam 7.0 with 438x348 at 0.2 degree resolution and 40 levels, to the grid mesh with 538x440 at 0.15 degree resolution and [https://hirlam.org/trac/wiki/SixtyLevel 60 levels]. The model bottom and top remain unchanged. The resolution increase applies to all levels but with more weight to the lower troposphere.
 * __3D-VAR__ remains default upper air data assimilation scheme with the following changes:
   * assimilation interval has been changed to 6 h
   * the minimization is performed at full model resolution
   * the variational quality control on-off limits has been changed to 20 and 30, respectively
   * conjugate gradient minimization package replace M1QN3 minimization as default scheme
 * __Optional 4D-VAR__ for upper air data assimilation, formulated with incremental approach. In the current baseline system, the 4D-VAR configuration consists of following main characteristics:
   * single outerloop with innerloop resolution at 0.45 degree (3 times coarser resolution than the forecast model) and linear grid
   * assimilation cycle is 6 h
   * observation data cut off time at 2h30m, thus the assimilation window is 3.5 h before nominal analysis time and 2.5 h after
   * 30 minute time step used for integration with tangent linear and adjoint models during minimization
   * observation time slot is 1 h, centered at even hours
   * no special tuning of background and observation error statistics have been applied in comparison to 3D-VAR
   * simplified vertical diffusion scheme, imported from Meteo-France Arpege global 4D-VAR, is included in the tangent linear and adjoint models
   * re-forecast scheme, in which ECMWF analysis is coupled to HIRLAM first guess via incremental digital filter initialization, is applied to provide background field for 4D-VAR analysis
   * surface analysis (SPAN) is performed after the nonlinear trajectory forecast and only for synoptic hour
   * weak constraint for gravity wave damping during 4D-VAR inner loop, using digital filtering. No explicit initialization during or after 4D-VAR
   * variational quality control is applied between iteration number 15 and 25
   * conjugate gradient minimization package is used with iteration limit set to 60. An alternative minimization method with M1QN3 method is available
   * tangent linear model used to project 4D-VAR analysis increment, which is valid at the start of assimilation window, to the nominal analysis time to obtain the nominal analysis valid at the analysis time. Forecast is started from analysis time as in 3D-VAR
 * __Moist CBR and tuned STRACO__ are the main features in the upgrade of the HIRLAM physics package.
   * Prognostic cloud water and cloud ice is now introduced instead of prognostic cloud condensate. NSVAR is set to 2. Note that in the new code with STRACO and NSVAR=2, the variable cw and grib-parameter 76 has been redefined as cloud water, not cloud condensate as in the case of NSVAR=1. On the other hand, this does not affect KF option.
   * Cloud ice has been assigned parameter number 58 and appear in the model history file
   * The schemes can still imitate the earlier setup with one cloud condensate variable by using NSVAR=1 instead of NSVAR=2
   * In CBR scheme, moist conserved variables are mixed implying radically different treatment of clouds due to turbulence parameterization. The scheme allows some flexibility with regard to mixing and coupling to convection schemes
   * In STRACO condensation scheme, convective cloud cover has been updated and tuned
 * __Statistical balance structure function__ has been derived from the RCR forecasts, using NMC method and for both 40 and 60 levels and is now the reference. The size of the scaling factor is around 0.5 by default
 * __Hirlam physics in F90__. This brings the main physical parameterization package in HIRLAM in phase with the one introduced into the ALADIN/IFS cycle 31 in 2006. The recoded physics parameterization package includes CBR, STRACO and radiation processes
 * __No filtering of cloud water/ice__ in digital filter initialization; Addition of 3D total cloud cover to the model states for history i/o to allow recycling of cloud cover information
 * __Extended post-processing stream__ with more diagnostic parameters such as CAPE, precipitation type, gust wind, visibility, screen-level wind and temperature maxima/minima etc. See the detailed  [https://hirlam.org/trac/attachment/wiki/Hirlam_7.1/Hirlampostpp.doc description], and the updated HIRLAM forecast model [https://hirlam.org/trac/wiki/HirlamSystemDocumentation/Forecast/Outputlist HIRLAM output list]
 * __HIRLAM ensemble forecast generation scripts__ in their first version
 * __Revised standard forecast output stream__ and additional templates for convenience of user-specified output stream
 * __Optional analysis strategy NOUA__ to allow dynamic adaptation cycling using combination of external upper air analysis and nested surface analysis
 * __Optional SL-SETTLS advection scheme__ is introduced to the grid-point model, using the DMI implementation
 * __Revised archiving strategy__ which be default archives significantly less data
 * __An enhanced ECMWF MARS data retrieval__  to enable use of BC-suite data, the option to retrieve data on rotated grid and with frame
 * __MSO/SSO parameters in climate generation__ opening up the possibility to parameterize mesoscale and subgrid scale orographic effects
 * __HPCE__ as the standard platform on ECMWF
 * __Optional surface relative humidity assimilation__ module
 * __Bug corrections in climate generation__ to avoid data hole problem and round-off effects are implemented
 * __A number of improvements and cleaning of code and scripts__
 * __AMV assimilation module__ to assimilate Atmospheric Motion Vector data from polar satellite (MODIS) and geostationary satellites (Meteosat 8). The option is still non-default at the moment.

We note here also that several code developments have been carried out within the Hirlam-A programme in parallel but they have been implemented separately, and scheduled to be introduced in post-7.1 releases (as part of the Hirlam 7.2
series):
 * __Surface scheme__ with a major upgrade. The scheme is still under testing and has been implemented separately for the time being as a separate branch "newsnow". A synchronized version of the branch to 7.1alpha3 is tagged as hirlam-7.1alpha3newsnow)
 * __RTTOV 8__ radiative transfer module and the corresponding algorithm to derive bias correction
 * __AMSU-A assimilation module__ upgrade
 * Facility to __assimilate OSI-SAF SST and ice data__

== Meteorological Impact ==

Hirlam 7.1 has been tested extensively during its development stages and noticeable positive impact on forecast results have been found in several parameters, such as improvement on surface pressure bias, scores for geopotential height, reduced over-prediction of precipitation in winter season and improved precipitation in summer seasons for high precipitation events. 

In May 2007, bugs are found in physical parameterisation in which cloud ice failed to be represented in radiation parameterisation for both STRACO and Kain Fritsch Rasch Kristjansson scheme. From two month-long validation test using STRACO scheme the deficiency has been found to have a significant impact on temperature profile, especially that of the upper air. The correction for the bug is introduced in the release Hirlam 7.1.1. 

In July 2007, a bug was discovered which causes no use of updated "moist CBR" turbulence scheme. For experiments on ECMWF platform, a script deficiency caused no use of AMSU-A satellite data. The overall impact of these bugs to forecast results are estimated to be small. The correction for the bugs are introduced in the release Hirlam 7.1.2. 

In December 2007, a bug was discovered in diagnosis of total precipitation in STRACO condensation scheme, in which snowfalls have not been included in calculation of total precipitation. An error in initialisation of cloud cover has also been found. The corrections are introduced in the release Hirlam 7.1.3. 

In February 2008, a deficiency was discovered from the operational FMI-RCR in which unrealistic rainfalls have been found at sub-freezing temperature conditions. This leads to a correction in STRACO precipitation release. Meanwhile, an unrealistically loose criterion for use of AMSU brigthness temperature in 3DVAR screening has been found. The corrections for the deficiencies are introduced in the release Hirlam 7.1.4. 

In April 2009, the default computational platform at ECMWF for 7.1 is switched over from HPCE to C1A. This change, together with bug fix about surface pressure correction in lateral boundary interpolation algorithm, is introduced in the release Hirlam-7.1.5.

More information about test and validation, both about new components and forecast system as a whole, can be found in [wiki:Hirlam_7.1TestEvaluation Hirlam_7.1TestEvaluation].

== Hirlam 7.1 Release History ==
 * 7.1.5 released on 17 April, 2009, see [wiki:ReleaseNotes7.1.5], switches to ecgate-C1A as the default ECMWF computer platform.
 * 7.1.4 released on 18 February, 2008, see [wiki:ReleaseNotes7.1.4], correcting unrealistic rainfalls under sub-freezing condition in STRACO option
 * 7.1.3 released on 6 Dec, 2007, see [wiki:ReleaseNotes7.1.3], correcting errorneous summation for total precipitation in STRACO option and error in cloud cover initialisation
 * 7.1.2 released on Aug 3, 2007, see [wiki:ReleaseNotes7.1.2], correcting selection for moist CBR and missing ATOVS AMSU-A data on ECMWF platform
 * 7.1.1 released on May 30, 2007, see [wiki:ReleaseNotes7.1.1], correcting bugs in radiation subroutines
 * 7.1 released on March 28, 2007, see [wiki:ReleaseNotes7.1]
 * 7.1 rc 2 released on March 14, 2007, see [wiki:ReleaseNotes7.1rc2]
 * 7.1 rc 1 released on February 19, 2007, see [wiki:ReleaseNotes7.1rc1]
 * 7.1 beta 3 released on February 16, 2007, see [wiki:ReleaseNotes7.1beta3]
 * 7.1 beta 2 released on February 1, 2007, see [wiki:ReleaseNotes7.1beta2]
 * 7.1 beta 1 released on January 9, 2007, see [wiki:ReleaseNotes7.1beta1]
 * 7.1 alpha 3 released on November 27, 2006, see [wiki:ReleaseNotes7.1alpha3]
 * 7.1 alpha 3-newsnow released on November 27, 2006, see [wiki:ReleaseNotes7.1alpha3newsnow]
 * 7.1 alpha 2 released on November 8, 2006, see [wiki:ReleaseNotes7.1alpha2]
 * 7.1 alpha 2-newsnow released on November 8, 2006, see [wiki:ReleaseNotes7.1alpha2newsnow]
 * 7.1 alpha 1 released on September 27, 2006, see [wiki:ReleaseNotes7.1alpha1]

== Hirlam 7.1 source code downloads ==

 * 7.1 release series can be obtained via Subversion command, e.g.,
{{{
   svn co https://svn.hirlam.org/tags/hirlam-7.1.5                    # for hirlam-7.1.5
}}}
 * On ECMWF, export version (checkout of the source code with Subversion export command) of the 7.1 releases are available, on ecgate, e.g.,
{{{
   ecgate:/home/ms/dk/nhz/hirlam_release/7.1.5
}}}
 * The export tarball of the Hirlam 7.1.5, released on 17 April 2009, is available on ECMWF:ecgate as `/scratch/ms/dk/nhz/hirlam-7.1.5.tar.gz`, or on ECFS: `ec:/hirlam/src/tar/hirlam-7.1.5.tar.gz`

== Technical aspects ==

With the adoption of background error structure function derived from the reference model itself, the default analysis scheme, 3D-VAR in Hirlam 7.1 has been changed to use full resolution in minimization. This has resulted in some increased computation cost, which has been found to be minor in platforms such as HPCE, SGI-ALTIX but significant in LinuxPC. More information about computation aspect of the Hirlam 7.1 can be found in second part of the [wiki:Hirlam_7.1TestEvaluation Hirlam_7.1TestEvaluation].

== Running Hirlam 7.1 on the ECMWF platform ==

 * The default configuration setting is ecgate, where ecgate (HOST0) is used for launching jobs and simple serial tasks and C1A (HOST1) is for computations. Please use reference installation on `ecgate:~nhz/hirlam_release` 
 * To set up an experiment "exp" on ecgate, you can go through the sequence of actions in the following example:
{{{
  mkdir ~/hl_home/exp; cd ~/hl_home/exp
  ~nhz/Hirlam setup -r 7.1.5            
}}}
 * To modify source code or scripts, first 'check out' the reference ones and modify them. e.g,
{{{
  ~nhz/Hirlam co scripts/Env_domain; vi scripts/Env_domain
  ~nhz/Hirlam co scripts/Env_expdesc; vi scripts/Env_expdesc
  ~nhz/Hirlam co grdy/putdat.F; vi scripts/putdat.F
}}}
 * Launch experiment, e.g,
{{{
  ~nhz/Hirlam start DTG=2006030500 DTGEND=2006030506    # to perform cycled experiments from start cycle DTG to end cycle DTGEND
  ~nhz/Hirlam prod DTGEND=2006030506    # to resume an experiment starting from cycle DTG as defined in progress.log to end cycle DTGEND
}}}

== Install and run 7.1 on non-ECMWF platforms ==

 * On non-ECMWF platforms, a local installation is needed by either local system manager or yourself. A local installation needs an climate data (HDF file) set updated to 7.1, because some HDF file contents have changed since 7.0. The procedure is simillar to [https://hirlam.org/trac/wiki/HirlamHowto/Install/General#WhatisanHDFSETandwherecanIfindtheHDFsets that of 7.0], but replace all instances of `hdfdb-7.0` with `hdfdb-7.1`.

 * Then install the HIRLAM source code on a local path $localpath:
{{{
   svn co https://svn.hirlam.org/tags/hirlam-7.1.5                      # with internet access, or
   svn co file:///$local_repository_path/svnroot/tags/hirlam-7.1.5      # with local svnroot.tar.gz, or
   tar -zxvf hirlam-7.1.5.tar.gz; mv hirlam-7.1.5 7.1.5                 # with a source code tarball
}}}
   1. `alias Hirlam $localpath/hirlam/config-sh/Hirlam`
   1. `Hirlam setup -r 7.1.5 -d $localpath`
   1. Launch the job with:
{{{
    Hirlam start DTG=$yyyy$mm$dd$hh
}}}

== Performing experiments with HIRLAM 7.1 ==

 * __Running non-reference configuration__
   * It is strongly advised that, in setting up model configurations which in any way deviates from that of reference settings, please only do modifications on top of a checked-out version of the reference source code or script. Do not copy directly source code or scripts from previous experiments that were based on different model versions. See also [wiki:HirlamHowto/Install/ECMWF wiki page] for instructions on such procedure.
 * __Choice of model domain__
   * The default reference model domain is RCR_7.1. Several commonly used model domains have been defined in scripts/Env_domain with environmental variable DOMAIN as RCR_7.1, RCR_7.0 etc. which in turn are specified in scripts/Env_expdesc.
 * __Data assimilation with 3D-VAR__
   * 3D-VAR assimilation scheme is default scheme.
   * For 3D-VAR, the default options is 6h cycling (FCINT=06) with FGAT.
   * Default background error structure function is now based on statistical balance, which is available for both 40 and 60 levels. The new structure function data is obtained from RCR forecast using the NMC method.
   * Minimization at full resolution is now default, LOWRESINCR=no as the structure function is now at 0.15 degree resolution
 * __Data assimilation with 4D-VAR__ is optional since Hirlam 7.1 beta1. If you have questions about experiment settings, write to the HIRLAM 4DVAR mailing list ([mailto:4dvar@hirlam.org 4dvar@hirlam.org])
   * 4D-VAR assimilation scheme is activated by specifying ANALYSIS=4DVAR in scripts/Env_expdesc
   * Default background error structure function is now based on statistical balance, which is available for both 40 and 60 levels
   * In scripts/Env_expdesc the following baseline configuration of 4D-VAR has been choosen but users can explore alternative options:
{{{
     NOUTERLOOP=1           # number of outer loops. Choose 1 for single loop and 2 or 3 for multi-loops
     ILRES=3,2              # resolution decrease for consecutive inner loops relative to forecast model resolution
     OBSCUT=0230            # observation cutoff time in hhmm
     MINALG=CG,CG           # minimization for inner loops: M1QN3, LZ for Lanczos, CG for conjugate gradient
     ASSWIN=06              # length of assimilation window
     ILPHYS=MFSP1,MFSP2     # innerloop physics NONE,BUIZZA,MFSP1 (Meteo France simplified vertical diffusion),MFSP2 (MFSP1+simplified large scale condensation)
     SPNDTIME=1800,1800     # time step size for spectral TLM and ADM in consecutive loops
     NQLIMIT=60,30          # iteration limits for consecutive innerloops
     VARQCSTART=15          # onset time for VarQC (iteration step)
     VARQCEND=25            # turn off time for VarQC (iteration step)
     SPHALO=10,7             # halo zone width in number of grid point for consecutive loops
     NBZONE=6,7             # boundary relaxation zone width in inner loop
     JCDFI=yes              # yes to use weak constraint JcDFI, no to use strong constraint normal mode initialization in 4D-VAR minimization
     LBCCONTROL=no          # yes to use lateral boundary control in 4D-VAR (under development)
     PROPAGATECONTROL=yes   # yes for projection of analysis increment with tangent linear model, no for using forecast model to derive nonminal analysis
}}}

 * __Choice of implicit horizontal diffusion scheme__
   * 4th order implicit horizontal diffusion remains the default option
   * Users can modify NDIF in scripts/Env_expdesc from 4 to 6 to use higher order implicit horizontal diffusion
 * __Choice of physics scheme__ If you have questions about experiment settings, write to the HIRLAM physics forum mailing list ([mailto:physics@hirlam.org physics@hirlam.org])
   * STRACO remains the default condensation scheme. KF may be used by changing COND_SCHEME from STRACO to KF in scripts/Env_expdesc
   * In scripts/FCinput, one may choose to turn off explicit parameterization of cloud ice by setting NSVAR=1
   * Moist CBR is the standard option and defined as NOPTION(3)=3 in the scripts FCinput. Technically its dry version is available with NOPTION(3)=2
 * __Choice of output data streams__
   * Edit Env_domain to request more model level output data than the default
   * Edit Env_expdesc for OUTSTREAM to add or reduce post-processing data stream and parameters
 * __Choice of archiving location and amount at ECMWF platform__
   * Use "ectmp" instead of "ec" to specify temporal instead of permanent archiving site. Note that data archived to "ectmp" disappear after about 3 months
   * Specify ARSTRATEGY=maximum in order to maintain the current archiving practice. But this is strongly adviced against. The default is medium instead.
 * __Choice of permissions for archived results at ECMWF platform __
   * Choose "hirlam" instead of "default" for ECFSGROUP to ensure accessibility of experiment results by other hirlam colleagues. (A new feature introduced in 7.1.2)
 * __Choice of boundary strategy BDSTRATEGY__
   * Use "bc" for data from ECMWF-BC suite
   * Use rotated coordinate and frames by specifying parameter ROTATE and FRAMES. Note however, that these options have not yet been validated
 * __Ensemble prediction__
   * Ensemble prediction is switched off per default (ENSSIZE=-1 and ENSFIRST=-1)
   * Currently limited data availability:
     * Only use of online ECMWF-EPS boundary data is possible (not more than 48h)
     * Observation data is not available online, but first after 48h
     * This means that in order to run the EPS (control run) with 3DVAR, two steps need to be performed:
       1. a dummy run with ANALYSIS=NONE for the current date in order to collect the boundaray data to HL_ARCH.
       1. second run two days later with ANALYSIS=3DVAR, run for the same date as in the first step
   * Ensemble mode is switched on by setting in Env_expdesc
     * ENSSIZE (ensemble size) to a number larger than 000 (Note: use 3 digits!)
     * ENSFIRST to 000, if the control run is to be performed, or to 001 to skip control run and start the ensemble with the first perturbed member from ECMWF-EPS
   * Data is archived in a sub-directory for each member under the normal cycle-directory
   * '''WARNING''': Note that performing ensemble experiments take a multiple of the computer resources than a single deterministic run. Please use the billing units at ECMWF with care.

== Acknowledgement ==

The system 7.1 is result of a collective efforts in the HIRLAM community. The following are acknowledged for their direct contribution to the development work for the code and script updates featured so far in HIRLAM 7.1. The list is
most likely incomplete:

'''DA'''
 * Nils Gustafsson, Xiaohua Yang, Magnus Lindskog, Ole Vignes, Jana Sanchez, Frank Tveter, Bjarne Amstrup, Carlos Geijo, Per Dahlgren

'''Forecast model'''
 * Sander Tijm, Bent Hansen Sass, Laura Rontu, Sami Niemela, Nastya Senkova, Kalle Eerola, Maria Diez, Aidan !McDonald, Javier Calvo, Karl-Ivar Ivarsson

'''System'''
 * Xiaohua Yang, Tomas Wilhelmsson, Ole Vignes, Kai Sattler, Kalle Eerola, Jacob Weismann Poulsen, Toon Moene, Niko Sokka, Carl Fortelius

[[FootNote]]
----
[[Center(begin)]]
[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
