[[PageOutline]]
[[Center(begin)]]
== '''HARMONIE 40t1 phasing''' ==

This page summarizes the HIRLAM efforts and contributions to the cy40t1 phasing.

[[Center(end)]]

[[BR]]

== '''Summary table''' ==

|| '''Contribution'''    || '''Author'''            || '''Comments''' || 
|| '''Changes to be sent to phasing'''||
|| [#AddwitnessfilefromIOserver IO server] || Ulf Andrae || || 
|| [#OpenMPfixes OpenMP]                  || Ole Vignes || ||
|| [#Observationoperator Observation operator]                   || Roger R || ||
|| [#Bettercomments Code documentation]               || Toon Moene || ||
|| [#Outofboundsfixes Out of bounds]             || Several || ||
|| [#ODBfixes ODB]                     || ECMWF || || 
|| [#LFIFAtoolsupdate LFI/FA tools]             || Several || ||
|| [#SAMIO SAMIO pruning]                        || Ulf Andrae || ||
|| [#CANARI CANARI]                              || Trygve Asplien || ||  
|| [#SURFEX SURFEX]                              || Trygve Asplien || || 
|| Technical cleaning || Rimvydas Jasinkas || [https://hirlam.org/trac/attachment/wiki/Phasing/cy40t1/Coding_cy40_v1.pdf Coding cy40] ||
|| '''Changes still under discussion or not completed'''||
|| Coupling in spectral space || Mariano Hortal || ||
|| Remove station ID hardcoding and limits in arp/op_obs/inv_refl1dstat.F90. Should be done in BATOR instead? || Martin Ridal || ||
|| Corrections for GPS assimilation. || Magnus Lindskog || Discussion ongoing with ECMWF || 
|| '''Things to be checked in cy40'''||
|| [#EmptyPoolfix Empty pools]                 ||
|| [#Compilationproblemfix Portability]        ||
|| '''Local Deviations (kept)'''||
|| [#VarBC VarBC]                        || Roger R || VarBC cleaning discussion ongoing, target cy41 ||
|| [#4DVARfixes 4DVAR] ||
|| [#Nameconventionofcloudfieds Name conv] ||
|| [#BDIFF BDIFF]                      ||
|| [#Batorchanges BATOR]               ||



== '''All differences''' ==

Below is a list of differences between the current phasing branch for [source:harmonie/branches/phasing/cy40/src cy40_phasing] based on cy40 and [source:vendor/aladin/current cy40] as extracted from git. This is so far only an inventory and should serve as an input for further discussions.

------------------------------------------------------------------------

=== CY40 fixes ===
Eoin Whelan, r12301

Cy40 technical fixes

{{{
Files:
   arp/var/sualctv.F90
   uti/combi/combi.F90
}}}


------------------------------------------------------------------------

=== Solid microphysics ===
Karl-Ivar Ivarsson, r12250

More strict separation of liquid- and ice microphysics in arome condensation The scheme is controlled by the switch LOCND2 in namparar and is switched off by default 


{{{
Files:
  arp/module/yomparar.F90
  arp/phys_dmn/apl_arome.F90
  arp/phys_dmn/suparar.F90
  mpa/micro/externals/aro_adjust.F90
  mpa/micro/externals/aro_rain_ice.F90
  mpa/micro/interface/aro_adjust.h
  mpa/micro/interface/aro_rain_ice.h
  mpa/micro/internals/condensation.F90
  mpa/micro/internals/ini_rain_ice.F90
  mpa/micro/internals/rain_ice.F90
  mpa/micro/module/modi_condensation.F90
  mpa/micro/module/modi_ice_adjust.F90
}}}


------------------------------------------------------------------------

=== Add witness file from IO server ===
Ulf Andrae, r11860,r12099

{{{
Files:
  arp/io_serv/io_serv_write.F90:
}}}


------------------------------------------------------------------------

=== SAMIO ===
Ulf Andrae: Prune SAMIO, r12263


{{{

Files:
arp/control/cnt0.F90 
arp/programs/master.F90
xrd/lfi/lfiecc.F90 
xrd/lfi/lfiedo.F90 
xrd/lfi/lfifer.F90 
xrd/lfi/lfilcc.F90 
xrd/lfi/lfildo.F90 
xrd/lfi/lfiouv.F90 

Removed:
xrd/module/samio_mod.F90
xrd/support/csamio.c 
}}}


------------------------------------------------------------------------

=== VarBC ===
Roger R, r12082

Could we make the zplev list in varbc_pred.F90 namelist driven instead of having LECMWF, LMF and at least another option for HIRLAM?

{{{
  arp/module/varbc_pred.F90
}}}

------------------------------------------------------------------------

=== OpenMP fixes ===
Ole Vignes: r11737,r11858

 - Declare some variables threadprivate to avoid an OpenMP race condition in lapineb.
 - Correct cptime for the OpenMP case.

{{{
Files:
  arp/module/yomgmv.F90
  xrd/support/cptime.F
}}}

------------------------------------------------------------------------

=== Observation operator ===
Roger R, r12061

 - Correct extrapolation above model top

{{{
Files:
  arp/op_obs/hradpad.F90
}}}

------------------------------------------------------------------------

=== Better comments ===
Toon Moene: r11711

{{{
Files:
  arp/pp_obs/ppreq.F90
}}}

------------------------------------------------------------------------

=== Out of bounds fixes ===
- Ulf Andrae: r12076,r11095,r11917
- Toon Moene: Enlarge length of subdomain name, r11713

{{{
Files:
  arp/module/parfpos.F90
  arp/op_obs/dopplsim_tl.F90
  arp/var/ecset_thsafe.F90
  xrd/module/mpl_allreduce_mod.F90
}}}

------------------------------------------------------------------------

=== LFI/FA tools update ===

 - Backport of cy39 functionality
 - Add split functionality to facat
 - '''Program directory should contain program not subroutines => subroutines moved from xrd/programs to xrd/misc'''

{{{
Files:
  xrd/programs/lfitools.F90
  xrd/misc/datefa.F
  xrd/misc/facat.F90
  xrd/misc/faempty.F90
  xrd/misc/faidx.F90
  xrd/misc/lficat.F90
  xrd/misc/lfidiff.F90
  xrd/misc/lfilist.F90 
  xrd/misc/lfisplit.F90
  xrd/misc/lfixxx.F90
  xrd/misc/lfixxxx.F90
  xrd/misc/testfa.F90
  xrd/misc/tstlfi.F90
  arp/setup/sugridsfx.F90
  mse/programs/sfxtest.F90
}}}

------------------------------------------------------------------------

=== CANARI ===

 Trygve Asplien, SODA inline related changes. To be documented

------------------------------------------------------------------------

=== SURFEX ===
Trygve Asplien
- EKF changes
- SODA inline ( CANARI ) changes
- OpenMP fix
- Weighting of T2M in coastal areas
- Make sure that "decades" with 11 days are treated consistent with the calculated "decadal" variation
- Move assim code to surfex/ASSIM

{{{
Files:
  surfex/OFFLIN/ini_assim.F90
  surfex/OFFLIN/oi_control.F90
  surfex/OFFLIN/oi_control.h
  surfex/OFFLIN/oi_hor_extrapol_surf.F90
  surfex/OFFLIN/ol_read_atm_ascii.F90
  surfex/OFFLIN/ol_read_atm_conf_ascii.F90
  surfex/OFFLIN/open_close_bin_asc_forc.F90
  surfex/SURFEX/assim_nature_isba_ekf.F90
  surfex/SURFEX/av_pgd.F90
  surfex/SURFEX/average_diag.F90
  surfex/SURFEX/default_diag_surf_atm.F90
  surfex/SURFEX/diag_surf_atmn.F90
  surfex/SURFEX/init_surf_atmn.F90
  surfex/SURFEX/isba_fluxes.F90
  surfex/SURFEX/modd_assim.F90
  surfex/SURFEX/modd_diag_surf_atmn.F90
  surfex/SURFEX/modn_assim.F90
  surfex/SURFEX/modn_surf_atmn.F90
  surfex/SURFEX/prep_ver_isba.F90
  surfex/SURFEX/read_namelists_surfn.F90
  surfex/SURFEX/update_data_cover.F90
  surfex/SURFEX/vegetation_update.F90
}}}


------------------------------------------------------------------------

=== cy38t1_bf.03, ===
Niko Sokka, r12083

{{{
Files:
  arp/obs_preproc/obadat.F90
  arp/op_obs/hretr.F90
}}}

------------------------------------------------------------------------

=== Empty Pool fix ===
To be removed when any other solution is introduced

{{{
Files:
  arp/obs_preproc/readoba.F90
  odb/cma2odb/shuffle_odb.F90
}}}

------------------------------------------------------------------------

=== Blacklisting ===

{{{
Files
  bla/mf_blacklist.b
}}}

------------------------------------------------------------------------

=== ODB fixes ===
r11827 | uandrae | 2013-04-24 18:14:40 +0200 (Wed, 24 Apr 2013) | 3 lines

Anne Foullioux: Correct NMXUPD to match the sql requests
- With this fix cy39 compiles with makeup

{{{
Files:
  odb/ddl/cma.h
}}}

------------------------------------------------------------------------

=== Bator changes ===
- Reading of HDF5
- Decoding of satellite BUFR data, LMFBUFR flag.
- Radar settings

{{{
Files:
  odb/pandor/module/bator_decodbufr_mod.F90
  odb/pandor/module/bator_init_mod.F90
  odb/pandor/module/bator_lectures_mod.F90
  odb/pandor/module/bator_module.F90
  odb/pandor/module/bator_util_mod.F90
  odb/pandor/namelist/bator_namelist.h
  odb/tools/Bator.F90
  odb/pandor/module/bator_decodhdf5_mod.F90
}}}
------------------------------------------------------------------------

=== Compilation problem fix ===

{{{
Files:
  odb/tools/Simulobs2odb.F90
}}}

------------------------------------------------------------------------

=== 4DVAR fixes ===
r7973 | ovignes | 2010-04-26 15:36:10 +0200 (Mon, 26 Apr 2010) | 2 lines

Port 4DVAR changesets (7141,7167,7181,7200,7220,7545,7957) from 35h1branch

{{{
Files:
  ald/fullpos/suefpg3.F90
  ald/programs/blendsur.F90
}}}

------------------------------------------------------------------------

=== BDIFF ===
Gergely Boloni, r8768

{{{
Files:
  arp/module/yemct0.F90
  arp/pp_obs/ppreq.F90
  arp/setup/suctrl_gflattr.F90
  ald/programs/bdiff.F90
}}}

------------------------------------------------------------------------

=== Name convention of cloud fieds ===

r9414 | trygveasp | 2011-06-07 09:27:54 +0200 (Tue, 07 Jun 2011) | 32 lines

{{{
Files:
  ald/programs/blend.F90
}}}


------------------------------------------------------------------------
== Mitraillette tests ==
=== c2a ===
 * eoin: "mono" tests comparing vendor/aladin/cy40 vs branches/phasing/cy40 phasing branch (including HIRLAM contributions) - identical
 * eoin: "multi" tests yet to come as I have yet to adjust c2a config files for new mitraillette changes
== Changes worth noting ==
 * addition of -DGRIB_API_1 pre-processor flag to indicate use of GRIB-API version 1.X.x
 * ECOCLIMAP input files for SURFEX/PGD have changed. Please take a copy from ecgate:/scratch/ms/ie/dui/cy40_ecoclimap.tar.gz

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
