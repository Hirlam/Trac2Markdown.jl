[[PageOutline]]
[[Center(begin)]]
= '''Cy47 compilation notes in cca''' =
[[Center(end)]]

= Instructions to compile cy47 using harmonie-43h2.1 scripting =

=== How to obtain the sources ===

{{{
mkdir /home/ms/es/sp2b/MF_git_repo
cd arpifs
git clone ssh://reader054@git.cnrm-game-meteo.fr/git/arpifs/git
cd arpifs
git checkout CY47T0
}}}


== Creating a "local branch" ==

After that I created a "local branch" in 

{{{
/perm/ms/es/sp2b/branches/harmonie-47T0
}}}

To create this branch I copied the needed cy47 projects from /home/ms/es/sp2b/MF_git_repo/arpifs and put the harmonie-43h2.1  scripting on top.
 
I started the compilation using the experiment 

{{{
/home/ms/es/sp2b/hm_home/47t0-compilaton
}}}
== Changes needed ==

All the files that I changed due to the compilation problems that I found are in

{{{
/home/ms/es/sp2b/hm_home/47t0_compilation
}}}

=== BLACKLIST ===

Include all  harmonie-43h2.1/src/blacklist/hirlam*  into src/blacklist
{{{
hirlam_blacklist.B
hirlam_blacklist.b.data_selection_after_20140601
hirlam_blacklist.b.data_selection_before20081209
hirlam_blacklist.b.data_selection_from20081209_to_20140601
hirlam_blacklist.b.monthly_after_20140601
hirlam_blacklist.b.monthly_before20081209
hirlam_blacklist.b.monthly_from20081209_to_20140601
hirlam_blacklist.b.monthly_recent
hirlam_blacklist.b.monthly_recent_carra
hirlam_external 
}}}

 == 1 .DOES NOT WORK ==
=== IFSOBS ===

Include ifsobs project: 
{{{
cp -r /perm/ms/es/sp2b/mf-git/arpifs/ifsobs ~/hm_home/cy47_compilation/src/. 

./Harmonie co main.mk
./Harmonie co util/makeup/configure
}}}

Add ifsobs in PROJ and LIBS of main.mk

{{{
PROJ=ifsaux ifsobs algor trans etrans surf arpifs aladin blacklist mpa mse surfex biper satrad utilities odb mpi_serial utilgl $(enkf_proj)
ROOT=.
CMDROOT=.
VPATH=
INCL=
LIBS=-L$(LIBDISK) -lifsaux -lifsobs -lalgor -ltrans -letrans -lsurf $(enkf_lib) -larpifs -laladin -lblacklist -lmpa -lmse -lsurfex -lbiper -lsatrad -lutilities -lodb

extlibs: binutils grib_api netcdf eccodes

intfb:
    @echo "Checking interface blocks up to date ..."
    @[[ -d $(ROOT)/.intfb ]] || mkdir -p $(ROOT)/.intfb
    set -e; \
    export LOC_INTFBDIR=$(ROOT)/.intfb ; \
    export INTFBDIR=$(ROOT)/.intfb ; \
    cd $(ROOT) ; \
    $(FIND) arpifs aladin satrad ifsaux/ddh ifsobs -name '*.F90' -type f -print | $(XARGS) perl -I$(CMDROOT) $(MKINTFBL) > intfb.stderr.all 2>&1
    @cd $(ROOT) ; \
    echo "Projects/dirs arpifs,aladin,satrad,ifsaux/ddh : $$(fgrep 'WRITE INTERFACE BLOCK' intfb.stderr.all | wc -l) interface block(s) (re-)generated"



}}}

Add ifsobs project in configure

{{{
PROJ=${PROJ:="ifsaux ifsobs algor trans etrans surf arpifs aladin coupling blacklist mpa mse surfex biper satrad utilities odb odbport odbdummy odbmain mpi_serial $ODBS"}

#-- Generate interface blocks (if not available)

dirs_intfb="arpifs aladin satrad ifsaux/ddh ifsobs surfex"

 ENKF_LIBS="-lifsaux -lifsobs -lalgor -ltrans -letrans -lsurf -lenkf -lutilgl -larpifs -laladin -lblacklist -lmpa -lmse -lsurfex -lbiper -lsatrad -lutilities -lodb -lodbport -lCCMA -lECMA"
}}}



copy some files in misc
{{{
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src> cp dbase_view/dbase_kinds_mod.F90 misc/.
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src> cp dbase/dbase_mod.F90 misc/.
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src> cp dbase_view//dbase_view_mod.F90 misc/.
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src> cp aux/ifsobs_abort_mod.F90 misc/.
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/hash_map_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../dbase_view/bitfield_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/ll_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/utilities_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../dbase_view/column_mod.F90  .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/rle_compression_mod.F90  .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/quicksort_mod.F90  .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../dbase/dbase_factory_mod.F90  .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/ascii_file_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../dbase/ascii_dbase_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../dbase/ifsobs_dbase_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/abstract_data_file_mod.F90 .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/data_container_mod.F90  .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../parallel/dbase_view_distribute_mod.F90  .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../parallel/dbase_view_parallel_mod.F90  .
/scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/misc> cp ../aux/stats_aggregator_mod.F90 .

}}}

Manually compilation of several 

{{{
source /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/config-sh/choose_PrgEnv.cca
}}}
{{{
cp /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/mpl_module.mod .
cp /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/yomhook.mod .

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c ifsobs_abort_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c hash_map_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c ll_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c utilities_mod.F90

 ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c bitfield_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c quicksort_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c dbase_view_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c ascii_file_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c dbase_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c ascii_dbase_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c ifsobs_dbase_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c data_container_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c abstract_data_file_mod.F90 

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c dbase_view_distribute_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c dbase_view_parallel_mod.F90

 ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c partition_dbase_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c stats_aggregator_mod.F90

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c superob_dbase_mod.F90
}}}


cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/tools

{{{
ln -s ../misc/*o .
ln -s ../misc/*mod .
}}}

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/paralells

{{{
ln -s ../misc/*o .
ln -s ../misc/*mod .
}}}


cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/dbase_view

{{{
ln -s ../misc/*o .
ln -s ../misc/*mod .
}}}

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/aux

{{{
ln -s ../misc/*o .
ln -s ../misc/*mod .

}}}

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsobs/src/dbase

{{{
ln -s ../misc/*o .
ln -s ../misc/*mod .
ln -s ../dbase_view/*o .
ln -s ../dbase_view/*mod .
ln -s ../../../odb/include/hdr_aligned_tables.h .
ln -s ../../../odb/module/*.mod .
ln -s ../../../odb/module/*.o .
ln -s ../../../ifsaux/module/*mod .
ln -s ../../../ifsaux/module/*o .
}}}
{{{
ln -s /usr/local/apps/eccodes/2.12.5/GNU/73/include/eccodes.mod .
}}}
Comment all encodes calls before manual compilation
{{{
ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c bufr_file_mod.F90
}}}

= PROBLEMS WITH  MODULES !!! Dead End !!! =

== 2. dbase_mod.F90 in ALGOR ==

m1qn3.o needs dbase_mod.o 

{{{
  ~/hm_home/cy47_compilation$ mkdir -p src/algor/external/minim/
   cd src/algor/external/minim/.
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/dbase/dbase_mod.F90  .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/aux/ifsobs_abort_mod.F90 
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/dbase_view/dbase_kinds_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/dbase_view/dbase_view_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/aux/hash_map_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/aux/ll_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/aux/utilities_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/dbase_view/column_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/aux/rle_compression_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/aux/quicksort_mod.F90 .
    cp /perm/ms/es/sp2b/mf-git/arpifs/ifsobs/src/aux/ascii_file_mod.F90 .


IN CCA:


module switch PrgEnv-cray/5.2.82 PrgEnv-gnu
cd  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/algor/external/minim/
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/mpl_module.mod .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/mpl_module.o . 
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/yomhook.mod .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/yomhook.o .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/parkind1.mod .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/parkind1.o .

Manually compile all this new files  and at the end: 


ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c dbase_mod.F90

}}}

`crmdims.o', needed by `par_gfl.o'.

{{{

cd  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/algor/external/minim/
cp /perm/ms/es/sp2b/mf-git/arpifs/crm/module/crmdims.F90 .

IN CCA:

ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/parkind1.mod .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/parkind1.o .

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c crmdims.F90

}}}


par_gfl.F90:4:4:

 USE CRMDIMS   ,ONLY : CRMBUFSIZE
    1
Fatal Error: Can't open module file 'crmdims.mod' 


{{{
cd  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/module/
cp /perm/ms/es/sp2b/mf-git/arpifs/crm/module/crmdims.F90  .
 

IN CCA:

ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/parkind1.mod .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/parkind1.o .

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c crmdims.F90

}}}

`radiation_aerosol_optics.o', needed by `radiation_setup.o'

{{{
cd  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/module/
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_aerosol_optics.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_delta_eddington.h .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_config.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_cloud_optics_data.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/easy_netcdf_read_mpi.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/easy_netcdf.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_io.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_aerosol_optics_data.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_pdf_sampler.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_thermodynamics.F90  .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_constants.F90  .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_single_level.F90  .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_gas.F90  .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_aerosol.F90 .

IN CCA

 module load netcdf/3.6.3

ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/yomhook.mod .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/yomhook.o .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/include/abor1.intfb.h .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/yomlun_ifsaux.mod .
ln -s  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/ifsaux/module/mpl_module.mod .

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c radiation_aerosol_optics.F90

}}}

`radiation_cloud.o', needed by `radiation_interface.o'. 

{{{
cd  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/module/

cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_cloud.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_cloud_optics.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_ice_optics_fu.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_ice_optics_baran.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_ice_optics_baran2017.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_ice_optics_yi.F90 . 
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_liquid_optics_socrates.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_liquid_optics_slingo.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_flux.F90  .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_spartacus_sw.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_optical_depth_scaling.h .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_overlap.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_matrix.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_two_stream.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_spartacus_lw.F90  .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_lw_derivatives.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_tripleclouds_sw.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_tripleclouds_lw.F90 .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_mcica_* .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_adding_ica_* .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_cloud_generator.F90  .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_homogeneous_* .
cp /perm/ms/es/sp2b/mf-git/arpifs/radiation/module/radiation_save.F90 .


!!!ERROR on radiation_adding_ica_sw.F90 it is equal to radiation_adding_ica_lw.F90 !!!!!
edit lw in sw F90

Comment the calls from radiation_mcica_sw.F90 and radiation_homogeneus_sw.F90






IN CCA:

ln -s ../../algor/module/random_numbers_mix.mod . 

ftn -m64 -g -fopenmp -fpic -O2 -fbacktrace -fno-second-underscore -DLINUX -DCNL -DLITTLE -DLITTLE_ENDIAN -DHIGHRES -DADDRESS64 -DPOINTER_64 -D_ABI64 -DBLAS -DSTATIC_LINKING -DNO_CURSES -Din_surfex -DSFX_ARO -DSFX_ASC -DSFX_OL -DSFX_TXT -DSFX_FA=sfx_fa -DSFX_LFI -DGRIB_API_1 -DOLDBUFR -fconvert=big-endian -dynamic -ffree-form -ffree-line-length-512  -c radiation_cloud.F90

vi radiation_interface.F90 and comment (imposible to compile in our infrastructure)

!    use radiation_ifs_rrtm,       only :  setup_gas_optics
!    use radiation_ifs_rrtm,      only : set_gas_units_ifs   => set_gas_units


}}}


obsop_sets.F90:39:4:

 use dbase_mod, only : dbase
    1
Fatal Error: Can't open module file 'dbase_mod.mod'

{{{

cd  /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/module/

IN CCA:

ln -s ../../algor/external/minim/dbase_mod.mod .
ln -s ../../ifsaux/module/rttov_const.mod .

vi obsop_sets.F90  and comment intfb.h include and 

!  call ecset(ydodb,ktslotno,kobtot,kofftot,this%ntotal_sets,&
!      itypob,ilnset,imxbdy,isumbdy,itslset,this%mmapomm,this%zenith,&
!      ldthsafe_replication=


}}}

No rule to make target `dbase_mod.o', needed by `m1qn3a.o'.  Stop.
{{{
IN CCA
cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/algor/internal/minim
ln -s ../../external/minim/dbase_mod.o .
ln -s ../../external/minim/dbase_mod.mod .
ln -s ../../interface/mlis0.h .
ln -s ../../../ifsaux/module/parkind1.mod .
ln -s ../../../ifsaux/module/yomhook.mod .
ln -s ../../../arpifs/module/geometry_mod.mod .
ln -s ../../../arpifs/module/fields_mod.mod .
ln -s ../../../arpifs/module/mtraj_mod.mod .
ln -s ../../../arpifs/module/varbc_class.mod . 
ln -s ../../../arpifs/module/type_model.mod .
}}}

No rule to make target `dbase_kinds_mod.o', needed by `ifs_dbase_view_mod.o'.
{{{
IN CCA:

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/module 

ln -s ../../algor/external/minim/dbase_mod.o .
ln -s ../../algor/external/minim/dbase_mod.mod .
ln -s ../../algor/external/minim/dbase_kinds_mod.o .
ln -s ../../algor/external/minim/dbase_kinds_mod.mod .
ln -s ../../algor/external/minim/dbase_view_mod.mod .
}}}


acraneb2.F90:134:4:

 USE YOERDI   ,ONLY : TERD

{{{
IN CCA:

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/phys_radi 
ln -s ../module/yoerdi.mod .
ln -s ../module/yoerdi.o .

}}}


radiation_scheme.F90:66:4:

 USE RADIATION_SINGLE_LEVEL,   ONLY : SINGLE_LEVEL_TYPE
    1
Fatal Error: Can't open module file 'radiation_single_level.mod'

{{{
IN CCA:

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/phys_radi

ln -s ../module/radiation_single_level.mod .
ln -s ../module/radiation_single_level.o .
ln -s ../function/fcttim.func.h .
ln -s ../module/type_model.o .
ln -s ../module/type_model.mod .
ln -s ../module/parkind1.mod .
ln -s ../module/parkind1.o .
ln -s ../module/yomhook.o .
ln -s ../module/yomhook.mod .
ln -s ../module/yomrip0.o .
ln -s ../module/yomrip0.mod .



comment in vi radiation_scheme.F90

!#include "liquid_effective_radius.intfb.h"
!#include "ice_effective_radius.intfb.h"
!#include "cloud_overlap_decorr_len.intfb.h"
!#include "satur.intfb.h"
!#include "abor1.intfb.h"


vi liquid_effective_radius.F90

Comment 

!#include "abor1.intfb.h"

radiation_scheme.F90:364:29:

      &  ZRE_LIQUID_UM, PPERT=PPERT)
                             1
Error: Keyword argument requires explicit interface for procedure 'liquid_effective_radius' at (1)
radiation_scheme.F90:369:26:

      &  ZRE_ICE_UM, PPERT=PPERT)
                          1
Error: Keyword argument requires explicit interface for procedure 'ice_effective_radius' at (1)
354 YLCLOUD%Q_ICE(KIDIA:KFDIA,:)    = PQ_ICE(KIDIA:KFDIA,:) + PQ_SNOW(KIDIA:KFDIA,:)
CALL LIQUID_EFFECTIVE_RADIUS(YDMODEL%YRML_PHY_RAD%YRERAD, &
radiation_scheme.F90:379:29:

      &  PDECORR_LEN_EDGES_KM=ZDECORR_LEN_KM, PDECORR_LEN_RATIO=ZDECORR_LEN_RATIO)

Remove =  and maintain the arguments

}}}

aeolus_getamd.F90:47:4:

 USE IFS_DBASE_VIEW_MOD, ONLY: IFS_DBASE_VIEW
    1
Fatal Error: Can't open module file 'ifs_dbase_view_mod.mod'

{{{

IN CCA

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/op_obs

ln -s ../module/*.mod .
ln -s ../module/*.o .
}}}


gmake[3]: *** No rule to make target `ll_mod.o', needed by `calc_varqc_weights.o'.  Stop.
gmake[3]: *** Waiting for unfinished jobs....

{{{
In CCA

cd /scratch/ms/es/sp2b/hm_home/cy47_compilation/lib/src/arpifs/op_obs 
ln -s ../../algor/external/minim/ll_mod.o .
ln -s ../../algor/external/minim/ll_mod.moe .

Comment intfb.h 

!#include "abor1.intfb.h"
!#include "cmoctmap.intfb.h"
!#include "hop_decide_required_sqls.intfb.h"
#include "fcobs.func.h"
!#include "map_varno_to_nvar.intfb.h"

}}}