
== MUSC working week in Helsinki 29 Nov - 2 Dec 2011 ==

FMI, Helsinki, meeting room Sykloni, 4th floor

Working days site at http://netfam.fmi.fi/muscwd11/ 

http://netfam.fmi.fi/muscwd11/Agenda.html contains the presentations given during the working days.

[[BR]]

'''General aims of the MUSC working week were'''

- To learn about MUSC, try it and exchange experiences of its usage
- To contribute to building of the first version of  harmonie_MUSC
- To develop tools for handling input and output 
- To produce material for a harmonie_MUSC user guide document
- To plan further steps of development, maintenance and application of harmonie_MUSC

We succeeded to work with all these items and learn things for further application and development.


Our starting point was the situation where

- harmonie_MUSC atmospheric code based on cycle 37h1 was available in the repository and executables built by makeup for different flavours of linux (ubuntu, debian, fedora, redhat) and ECMWF c1a
- SURFEX - atmospheric connection was ony available separately in an older MUSC setup of cycle 35 from Meteo France
- acadfa_1d was available for creation of atmospheric input for MUSC, using a ready-made namelist from Meteo France/KNMI
- a simple README document and a simple script could be used to set up environment and start the experiment
- a test experiment testmusc (based on CONVECTION IDEALISE input and definitions from Meteo France) was available and tested to work with ARPEGE without SURFEX connection
- ddhtoolbox tools were available for handling of MUSC output at the same platforms as the main code

During the week we were able to took several significant steps ahead, including

- gl was updated so that it can be used for creation of MUSC input, by extracting an atmospheric column from AROME fa-files and surface data from SURFEX lfi-files . A test experiment test_arome_gl was prepared and tested to work. Using gl allows to build systems where 3D experiments or operational runs are continued by MUSC, to see effects of different physical parametrisations. Operational extraction of MUSC input for chosen points like Sodankyl√§, Cabauw etc. could be realised in this way.
- Building of PGD and PREP (v.6.1) was added to harmonie_MUSC added. This allowed to create academic input based on data given in namelists. A test experiment test_gabls3 was prepared and tested to work. 
- In principle, running any ARPEGE-AROME-ALARO experiments using SURFEX should be possible with the present harmonie_MUSC code. A HIRLAM-style working environment (script mur instead of the HIRLAM hir and har used in 3D) allows flexible compilation of modified code for each experiment. Some modifications to the radiation code were tried during the working week and shown to work technically. 
- Compatibility of the main HARMONIE code and harmonie_MUSC can be tested by running a full three-dimensional AROME experiment with harmonie_MUSC where MUSC is switched off. We did not have time to finish this experiment, but it should be already possible. If successful, this will allow full integration of the harmonie_MUSC branch to the trunk code and usage of MUSC with proper namelist definitions only, plus some additional tools like ddhtoolbox.
- Preparation of MUSC user guide was started, with a deadline for release next spring, before the All staff meeting / Workshop 2012. A latex template with some preliminary contents is available.

[[BR]]

'''To-do list''' 

A list of things to do in near future was discussed. It includes


Make a document of lfa output variables: name, definition, unit, ... Study the possible and still required variables, find a way to add them to lfa files. Study the lfa tools which allow to do a lot of useful file operations with lfa. Apply these tools to create a list of presently available variables. To produce additional output it is possible during the MUSC experiment to call the routines WRSCMR (ARPEGE/ALADIN/ALARO) and WRAROM (AROME) from inside any physics subroutine by adding the interface blocks in the heading and writing the call to needed place (see http://netfam.fmi.fi/muscwd11/Bazile_output.pdf).  Cisco will work with the lfa output document and additional output.


----


With gl, we are able to produce reasonable input for MUSC-AROME from AROME/SURFEX output. We have evidently realistic run-time namelists. However, depending of compiler and compiler options the run may crash within the first time step, when U-component grows too much at the uppermost model levels. Find the reason, which may be related to out-of-bounds definitions.

'''SOLVED'''

The spectral coupling LESPCPL has to be turned off for reasons still unknown. AROME experiment works in MUSC after this.


----


Andres' converter (available in attachments below) from ASCII to grads is applicable to test output, creating grads ctl and binaries. Further playing, tuning and a possible way towards python matplotlib are considered useful. Python visualisation seems to be a good alternative if a completely new tool for visualisation is needed. Andres will continue and support everyone testing the tools.

----


MUSC input files contain forcing data from different time steps (forecast lenghts). gl allows to pick one column (fa) + surface (lfi) at a time. A way to combine these to one input file should be found. Also, add writing of runtime namelist when creating the input. Read resolution and gridpoint coordinates from the input 3D files. A program written by Yves Bouteloup could be used as starting point for the namelist generation. Action: Ulf & Trygve.


----

gl could be adapted to extract data from ARPEGE, which has a different grid geometry. There is a link to interoperability project for data exchange. Eric will discuss in Meteo France.


----


For academic cases, we need acadfa1d - pgd - prep way to convert namelist input to MUSC input fa and lfi files. The target is to use the standard 3D mse/program/pgd and prep for this purpose, with an appropriate namelist. The first step is to compare the existing MUSC-specific prepsurf_arome and pgd_arome codes with the cycle37 code and see how to continue. Ulf is working with prep and pgd building with makeup in harmonie_MUSC, where they do not exist yet. Eric will study the differences and suggest modifications for MUSC usage of prep and pgd.

'''SOLVED'''

Standard PGD and PREP are built in harmonie_MUSC and provide needed input. A template for OPTIONS.nam used for the input generation and usage during the MUSC experiments is available in the GABLS3 test experiment.


----

Run a three-dimensional AROME/ALARO experiment with the harmonie_MUSC code to be sure the source code modifications behind LMUSC switches and additional code do not conflict with something else. In the first step, introduce all non-conflicting MUSC code to the cy37h1 cycle, Ulf is working with this.


----

Preparation of a user guide. Here is a template for a draft ([http://netfam.fmi.fi/muscwd11/MUSC_userguide.tex tex]), please download and edit. Hopefully later we can convert latex file to wiki and pdf and everything else. Laura will coordinate the work, with the aim of having a first useful draft for this document in early spring 2012. The output documentation will be added here as soon as ready.


----

Test cases to prepare and make available for checking of code, for science, for testing of the new cycles with MUSC switched on: input and corresponding output, plotting tools and perhaps plots for validation. To be stored in hirlam.org repository in a suitable directory. A testset test_gabls3 was made available in the repository and will be updated with output files for comparison. It has been tested for work for AROME and ARPEGE, to be tested with ALARO just to be sure. Karl-Ivar will do testing of this package. The case of idealised convection is in the musctest.tgz and works for ARPEGE/ALARO only, because it contains surface temperature forcing in old format. The testset test_arome_gl uses input created by gl.
 

----

SURFEX 7.1 - 7.2 : version cy37h1.n or cy38 ? For the time being harmonie_MUSC might contain different version of SURFEX (older 6.1 or later 7.2) than the corresponding cy37h1.n - not a problem? Aim is to integrate totally, and have the possibility to run 3D cases with harmonie_MUSC code. 

'''Status'''

harmonie_MUSC now contains consistently SURFEX v.6.1 as the corresponding cycle 37h1 of the 3D HARMONIE. Testing of harmonie_MUSC code is ongoing by Ulf. Ulf and Eric will introduce SURFEX 7.2 to the harmonie_MUSC till the end of January 2012? Or only within the cycle 38, where MUSC should be fully integrated with the 3D code?


----

Initial data creation: levels in vertical? gl picks exactly the levels available in 3D file, acadfa1D does the same according to predefined namelist. Do we need interpolations in vertical? In principle this should not be complicated in gl if reasonable a's and b's are provided. Main question is the definition these hybrid coordinate coeffiecients.

----

Tune the makeup compilation of utilities. Now ddhtoolbox is compiled separately because it does not depend on the main libraries. Perhaps for convenience, building together with all other pieces of code could be considered. Also, ways to compile parts of the code, perhaps using commands of the type: 'make PROJ=utilgl' could be considered and documented.

----

It is important to use and contribute to the branch, but testing the modifications locally before committing. All modifications should documented sufficiently. Locally you should update your own reference MUSC with svn update every now and then, especially before committing changes to the branch. If you have bugfixes and improvements please share them with others via the branch!

----



Appendixes

'''Agenda''' 


[[BR]]


'''Tuesday 29.11'''

08.30	Technical preparations for participants computers


Centra session 1 29th November 7.30 - 8.30 UTC

09.30	Introduction to harmonie_MUSC: status, plans, tasks of the workshop
		Laura Rontu
09.40	Introduction MUSC_export37t: structure, usage, status 
		Eric Bazile
10.10	Intoduction to harmonie_MUSC setup
		Sami Saarinen


10.30	Coffee break

11.00	How to run a harmonie_MUSC experiment
		Laura Rontu

11.30	Installations in participants' debian/ubuntu/redhat/fedora laptops, at ECMWF c1a

12.30	Lunch

13.30	Introduction to HARMONIE file formats and tools
		Ulf Andrae

14.00	Practical work continues with coffee break inserted: 
	finishing installations, running test experiment, understanding basics of input/output

17.00	End of the first day

[[BR]]


'''Wednesday 30.11'''


Centra session 2: 30th November 7 - 8 UTC

9.00	Experiences on (GABLS and other) case studies with MUSC
		Eric Bazile
9.20	KNMI Testbed experiences with MUSC-33t1
		Cisco de Bruijn
9.40	AEMET MUSC-35 experiences
		David Martin


10.00	Coffee break with FMI NWP group



Centra session 3 30th November 8.30 - 9.30 UTC

10.30	Relations between MUSC and SURFEX
		Stephanie Faroux
11.00   Introduction to the graphics tools (presentation given via Centra from Tartu)
                Andres Luhamaa

11.30	Handling output of MUSC: file formats, tools 
		Eric Bazile

12.00	Lunch

13.00	Practical session to run experiments,
	study and analyse the output, with coffee break inserted

17.00	End of the second day

[[BR]]

'''Thursday 1.12'''

Centra session 4 1st December 7.00 - 8.00 UTC

9.00	Introduction to DDH and DDH toolbox
		Tomislav Kovacic
9.30	Definition of MUSC input: contents, file format, tools
		Eric Bazile

10.00	Coffee break with FMI NWP group

10.30	Namelist definitions for MUSC
		Eric Bazile
11.00	Practical work to define and build own input for MUSC

12.30	Lunch

13.30	How to modify source code and recompile
		Laura Rontu
13.45	Practical session continues with coffee break inserted
	experimenting with modified input, namelists, source code

17.00	End of the third day

18.30	Start by tram 6 to the restaurant Saaga. We have reserved 14 seats for a dinner together at 19:00-23:00, payment by participants.

[[BR]]


'''Friday 2.12'''

9.00	Draft of working days' report and further plans
	Start of discussion

10.00	Coffee break with FMI NWP group

10.30	Finishing experiments, improving the plan

11.30	Final discussion, agreement of the next steps

12.30	Closure of the working days, lunch

Possibility to continue practical work, meet FMI people, drink coffee before leaving back home ...

[[BR]]

Info: password for all Centra sessions is muscwd11

[[BR]]


'''Classroom participants'''

Ulf Andrae, SMHI
 
Eric Bazile, Meteo France
 
Cisco de Bruijn, KNMI
 
Stephanie Faroux, Meteo France
 
Sergiy Ivanov, OSENU (Ukraina)
 
Karl-Ivar Ivarsson, SMHI
 
Evgeny Kadantsev, FMI
 
Tomislav Kovacic, DHMZ (Croatia)
   
Gopalkrishnan Kokkatil, U.Helsinki
  
Daniel Martin, AEMET
  
Kristian Pagh Nielsen, DMI
  
Laura Rontu, FMI
  
Sami Saarinen, CSC (Finland)
 
Niko Sokka, FMI

'''Online participants'''


Participants attended the online sessions via EUMETCAL Centra

Doina Banciu, Meteo Romania
Tilly Driesenaar, KNMI (session 3)
Emily Gleeson, Met Eireann (session 1)
Ekaterina Khoreva, RSHU
Andres Luhamaa, U.Tartu
Javier Calvo, AEMET
Xiaohua Yang, DMI
Eoin Wheelan, Met Eireann

