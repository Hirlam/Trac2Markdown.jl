[[PageOutline]]

[[Center(begin)]]
= '''Migration of HIRLAM and HARMONIE from ecgate to ecgb''' =
[[Center(end)]]

== General information ==

ECMWF will replace the current IBM based ecgate with a linux cluster named ecgb. For detailed information about the migration look at the ECMWF [http://www.ecmwf.int/services/computing/ecgate/migration.html pages]. In this page the status of the HIRLAM/HARMONIE migration is described.

== Prepare yourself for ecgb ==

Before you try to start a HIRLAM or HARMONIE experiment on ecgb you are adviced to login at least once from ecgb to c2a and c2a-batch to make sure that all verification keys are in place.

 {{{
 snh@ecgb11:~> ssh c2a 
 The authenticity of host 'c2a (136.156.40.10)' can't be established.
 RSA key fingerprint is 29:e5:30:61:9e:53:ae:31:2c:84:38:63:de:02:79:fe.
 Are you sure you want to continue connecting (yes/no)? yes
 Warning: Permanently added 'c2a,136.156.40.10' (RSA) to the list of known hosts.
 }}}

== HIRLAM ==

=== Repository location changes ===

At ECMWF the HIRLAM repositories are available under: 

 {{{
 
  ecgate:

   ~hlam/hirlam_release -> /ms_perm/hirlam/hirlam_release

  ecgb:

   /perm/ms/spsehlam/hlam/hirlam_release/

  }}}

To setup and experiment on ecgb use this as follows (trunk only):

  {{{

     /perm/ms/spsehlam/hlam/hirlam_release/trunk/config-sh/Hirlam setup -h ecgb -d /perm/ms/spsehlam/hlam/hirlam_release

     /perm/ms/spsehlam/hlam/hirlam_release/trunk/config-sh/Hirlam start DTG=YYYYMMDDHH

  }}}

'''On the 16th of December 2013 the paths to the repositories will be changed to'''

 {{{
 
  ecgate:

   /ms_perm/hirlam/hirlam_release

  ecgb:

   ~hlam/hirlam_release -> /perm/ms/spsehlam/hlam/hirlam_release/

  }}}


To be able to continue your experiment on ecgate the path in the file {{{config-sh/hl_rev}}} has to be changed

 {{{
 
  from
 
  /home/ms/spsehlam/hlam/hirlam_release/YOUR_REFERENCE

  to

   /ms_perm/hirlam/hirlam_release/YOUR_REFERENCE

  }}}

There is no need to change anything in experiments running on ecgb.

=== Migrated HIRLAM versions ===

The following versions have been tested and are working on ecgb

 {{{
     /perm/ms/spsehlam/hlam/hirlam_release/trunk 
 }}}

'''Please report back as soon as possible if you need access to other versions.'''

== HARMONIE ==

=== Repository location changes ===

At ECMWF the HARMONIE repositories are available as:

 {{{
 
  ecgate:

   ~/hlam/harmonie_release -> /ms_perm/hirlam/harmonie_release

  ecgb:

   /perm/ms/spsehlam/hlam/harmonie_release/

  }}}

'''On the 16th of December 2013 the paths to the repositories will be changed to'''

 {{{
 
  ecgate:

   /ms_perm/hirlam/harmonie_release

  ecgb:

   ~hlam/harmonie_release -> /perm/ms/spsehlam/hlam/harmonie_release/

  }}}

To be able to continue your experiment on ecgate the path in the file {{{config-sh/hm_rev}}} has to be changed

 {{{
 
  from

   /home/ms/spsehlam/hlam/harmonie_release/YOUR_REFERENCE

  to

   /ms_perm/hirlam/harmonie_release/YOUR_REFERENCE

  }}}

There is no need to change anything in experiments running on ecgb.

=== Migrated HARMONIE versions ===

The following versions have been tested and are working on ecgb

 {{{
     /perm/ms/spsehlam/hlam/harmonie_release/trunk
     /perm/ms/spsehlam/hlam/harmonie_release/tags/harmonie-38h1.beta.3
     /perm/ms/spsehlam/hlam/harmonie_release/branches/harmonie-37h1
     /perm/ms/spsehlam/hlam/harmonie_release/branches/harmonEPS-37h1
     /perm/ms/spsehlam/hlam/harmonie_release/tags/harmonie-37h1.2
     /perm/ms/spsehlam/hlam/harmonie_release/tags/harmonie-37h1.1
 }}}

'''Please report back as soon as possible if you need access to other versions.'''

=== How to move your HARMONIE experiment from ecgate to ecgb ===

 On ecgate synchronize your experiment on scratch to ecgb scratch by

 {{{
  rsync -vaux $SCRATCH/hm_home/EXP ecgb:$SCRATCH/hm_home/
 }}}

 On ecgb do the following to get the ecgb settings for your experiment:

 {{{
  cd ~/hm_home/EXP
  rm -f config-sh/hm_rev Env*
  /perm/ms/spsehlam/hlam/harmonie_release/YOUR_VERSION/config-sh/Harmonie setup -r /perm/ms/spsehlam/hlam/harmonie_release/YOUR_VERSION -h ecgb
 }}}

 Make sure you make the same changes to your ecgb files in config-sh as you have done to the ecgate ones.

 Remove the experiment_is_locked file to have other script changes related to ecgb. Note if you are working with a moving branch and it is important to keep your local copy untouched you should '''NOT''' do this.

 {{{
  rm -f experiment_is_locked
 }}}

 Continue your experiment and make sure to rebuild to get the required binaries on ecgb.
 {{{
   /perm/ms/spsehlam/hlam/harmonie_release/YOUR_VERSION/config-sh/Harmonie prod LL=... DTGEND=... BUILD=yes
 }}}

 '''Report back any problems with the migration.'''

== Known problems ==

 - There has been reported several problems with rsync failing without any obvious reasoni during the InitRun task. ECMWF is notified and the only available solution at the moment is to rerun the job until it works.

 - The {{{ecgate:$SCRATCH}}} disk is no longer visible from c2a. If you insist on continuing your HARMONIE experiment from ecgate you have to change the location of the job files. To do this redefine the SMSJOB variable in msms/harmonie.tdf like: 

 {{{
 39 edit SMSJOBOUT $ENV{JOBOUTDIR}%SMSNAME%.%SMSTRYNO%
 40 edit SMSJOB  $ENV{JOBOUTDIR}%SMSNAME%.job%SMSTRYNO% <--------------------------
 41 edit SMSCMD "ENSMBR=%ENSMBR% perl -S Submit.pl -o %SMSJOBOUT% %SMSJOB% >> mSMS.log 2>&1"
 }}}

----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
