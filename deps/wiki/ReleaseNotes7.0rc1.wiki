[[PageOutline]]
[[Center(begin)]]
= '''Release notes of HIRLAM 7.0 rc1''' =
[[LastModified]]
[[Center(end)]]  

== Highlights of 7.0 rc1 ==

 * Removal of revision control from the reference script set
 * A reduction of memory use in semi-lagrangian advection subroutines
 * Relocation of climate generation input data (HDF files) to {{{ec:/hirlam/dat/hdfdb-7.0}}} and the related script change
 * Elimination of race condition in the re-forecast scenario
 * Less memory usage for HGS servers, and signalling problem at end of forecast with multiple servers fixed
 * Reduced print-out during surface and upper air analyses.
 * Code corrections related to 4D-VAR

In terms of the the reference configuration, the above modifications will not have meteorological impact compared to the previous feature release, 6.4.4. For 4D-VAR analysis option, the current update-set provides crucial correction and improvement for the upper air analysis.

== Description of the changes ==
This is the release candidate targeted for HIRLAM 7.0 official release. The features contained in this release, compared to the previously released version 7.0 beta1, is purely technical in terms of reference configuration. 

 * '''Remove revision control feature from the script set'''. This is done in order to increase portability of the HIRLAM system. With removal of revision control feature within the script-set, the system compilation and execution no longer assume existence of a vision control system such as svn, cvs or rcs, nor does it require accessability of the HIRLAM source code repository. Instead, the script-set assumes existence of a check-out/export version of the HIRLAM source code

 * '''Reduction of memory use in semi-lagrangian scheme'''
    * The computations to interpolate quantities in the departure point are now done level by level, as they are independent; this reduces the memory footprint of the work arrays for these computations.
 * '''Remove race conditions in re-forecast and 4D-VAR scenario'''
 * '''Use standard intrinsic DATE_AND_TIME to obtain date and time information'''. Specifically in library libgen5.
 * '''Relocation of climate generation input data'''
    * HDF files are located under ECFS in {{{ec:/hirlam/dat/}}} in the release related directory hdfdb-7.0. The different HDF file sets are located in subdirectories herein.
    * Each HDF file set conatins all necessary files in order to perform all the tasks in the {{{Climate}}} script. This facilitates easier local installations so climate generation functionality is given already, if just one HDF file set is downloaded for local installation.
    * At ECMWF the climate generation script retrieves the needed HDF files automatically into  a common release-related buffer, from where they are utilized
 * '''Enhancements in climate generation error diagnostics'''
    * The latest working directory is allways retained as {{{ClimateFailed}}}
    * In case of multiple SMS trials, the {{{ctopo}}} aggregation will be called with a verbosity option, and the special field {{{coverage}}} is created in the working HDF file to facilitate diagnostics
 * '''Improved reproducability of Kain Fritch scheme'''
 * '''Reduced print-out'''. Individual observation information is no longer printed out during surface analysis. In Upper air analysis using AMSU-A data, a large number of print-out designed for code test is deleted
 * '''4D-VAR correction''' solves the long-standing equivalency problem between the HIRLAM tangent linear and adjoint codes. Non-SETTLS option removed
    * Bug correction in sislrhs.F in which the erroneous sign for one of the Coriolis terms in the TL equation is reverted
    * Bug correction in maksirhs.F and bndbalnew.F related to the control of lateral boundaries
    * The subroutine semla2t.F has been split into semla2t_dyn.F, semla2t_phys.F, semla2t_sirhs.F and semla2t_sihdiff.F. This was done in order to allow scalar product tests of each splitted block.
    * TL and AD test facility further expanded and corrected.  
    * non-SETTLS and non-TRFIS codes eliminated.

== Working with the new script set ==
The new script-set assumes a pre-existing check-out of the HIRLAM source code. Such a check-out can be obtained via a number of different approaches:
  * On ECMWF-ecgate or any local platform with a reference installation, the check-out source is already available. e.g., on ECMWF-ecgate, /home/ms/dk/nhz/hirlam_release/$hirlam-version/ provides the source
  * Given internet access and assuming subversion client available, the source can be obtained via one of the svn checkout commands such as
{{{
   svn co https://svn.hirlam.org/tags/$version       # a HIRLAM sandbox for specified version      
   svn export https://svn.hirlam.org/tags/$version   # a pure checkout of source code with no svn feature
   svn co file://$localpath/svnroot/tags/$version    # a HIRLAM sandbox using local repository copy
   svn co https://svn.hirlam.org/trunk               # a sandbox with the latest HEAD version  
}}}
 * The source can be obtained through a copy of the HIRLAM tarball, such as the one on ECGATE:/scratch/ms/dk/nhz/hirlam-7.0rc1.tar.gz. In addition, starting from 7.1, the export version of a HIRLAM release will be made available, in addition, via a HIRLAM system CD-ROM/image

To set up and run HIRLAM forecast system for the new versions, you may do following:
 1. make an alias of the script Hirlam, e.g.,
{{{
alias Hirlam /home/ms/dk/nhz/Hirlam                                  # on ECMWF ecgate
alias Hirlam $localpath/$version/hirlam/config-sh/Hirlam             # on local platform with a HIRLAM checkout
}}}
 1. mkdir ~/hl_home/$exp
 1. cd ~/hl_home/$exp
 1. set up:
{{{
Hirlam setup                 # with default, on ECMWF-ecgate, use source in ~nhz/hirlam_release/current
Hirlam setup -r 7.0rc1       # with 7.0rc1, on ECMWF-ecgate, use source in ~nhz/hirlam_release/7.0rc1
Hirlam setup -d $localpath -h LinuxPC    # on a local pc platform in which source code is in $localpath/current
Hirlam setup -d $localpath -r trunk -h LinuxPC    # on a local pc in which source code (HEAD version) is in $localpath/trunk
}}}
 1. If necessary, check out a specific source and specify local modification
{{{
Hirlam co scripts/Env_input; vi scripts/Env_input                # ''e.g.'', modify content in Env_input
Hirlam co hlvar/hirvda.F; vi hlvar/hirvda.F                          # ''e.g.'', modify hirvda.F
}}}
 1. Finally, execute:
{{{
Hirlam start DTG=2006041000 DTGEND=2006041006 LLMAIN=36              # run long forecast up to 36 h
}}}

Note that after the 7.0rc1 release, in order to run other recent versions of HIRLAM (6.4.1 to 7.0beta1), please use the earlier version of the top level script Hirlam, which is available as  ~nhz/Hirlam_6 on ECMWF-ECGATE, for system setup.

== Meteorological impact ==

None, comparing to the previous beta release 7.0beta1, for the default (reference) configurations.

== Changes in the source libraries ==

See the link https://hirlam.org/trac/wiki/CodeUpdate#a7.0rc1

== Code test and validation, known problems ==

Code test with limited assimilation cycles has been performed on the ECMWF-HPCD and on Linux platforms. Since the change set is a technical one, no specially designed data assimilation tests at cycling mode is scheduled. For other details of the relevant issues concerning releases leading to HIRLAM 7.0, see the HIRLAM system wiki page: https://hirlam.dmi.dk/trac/wiki/TestEvaluation7.0

== Bug reports ==

April 20, 2006: The script for combination of 4D-VAR and LSMIX options has been found problematic. A fix will be introduced later. Up to then, 4D-VAR should only be tested with LSMIX turned off. (Xiaohua Yang)

== Acknowledgement ==

'''Source code and script update'''
 * Tomas Wilhelmsson provided Hirlam script change to remove revision control features
 * Toon Moene provided updates to reduce memory use in forecast model
 * Ole Vignes provided script change to avoid race conditions for rerun and 4D-VAR scenario, and HGS improvement
 * Kai Sattler provided updates to the climate generation scripts
 * Torgny Fax√©n provided fixes for Kain Fritch scheme which removed a dependence on the number of processors
 * Xiaohua Yang added variable in Env_expdesc to select horizontal diffusion order
 * Nils Gustafsson provided many 4DVAR improvements and fixes.

'''Code test'''
 * Xiaohua Yang, Ole Vignes performed technical tests on the ECMWF platform. Toon Moene and Xiaohua Yang performed some code tests on !LinuxPc platform.

'''Source code management'''
 * Tomas Wilhelmsson, Toon Moene and Ole Vignes committed the changes to the Subversion repository.