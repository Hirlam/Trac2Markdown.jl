[[PageOutline]]
[[Center(begin)]]
== '''HARMONIE 37h1''' ==

[[Center(end)]]

== Highlights of Harmonie 37h1 ==

Harmonie 37h1 is HIRLAM's adaptation to the IFS/ALADIN Cycle 37T1 released in June 2011 and the subsequent bugfix versions 1 to 5.

On 13th of June 2012, [source:tags/harmonie-37h1.1 harmonie-37h1.1] is tagged as the first official release of cy37h1. At its default, HARMONIE-37h1 features a meso-scale forecast system with convection-permitting AROME physics, 3D-VAR upper air assimilation, and an optimal interpolation-based surface analysis, on a model grid with 2.5 km grid-spacing in horizontal and 65 vertical levels. Harmonie-37h1 also includes a comprehensive set of scripts and utilities supporting various optional components and applications.

Harmonie 37h1 includes features contained in cycle 37T1 and the subsequent 5 source code bug fixes in addition to the HIRLAM developments. The major updates in cy37h1 compared to cy36h1.4.bf1 are:

 * Physics
  * SURFEX 6.1
  * Updated EDMFM scheme for shallow convection
  * Improved spinup of surface variables through a corrected handling of frozen soil moisture when starting with ECMWF/HIRLAM data.
  * Diagnostics of cloud heights according to WMO definitions is now default for AROME. 
  * Cellular automata in ALARO
  * MUSC, the single column model in HARMONIE
  * Optional usage of ECOCLIMAP2 ( experimental ) through the ECOCLIMAP_VERSION flag

 * Assimilation
  * Simple single obs experiment through the SINGLEOBS flag
  * Experimental EKF setup for surface assimilation with SURFEX
  * Allow for assimilation cycles shorter than 6h ( RUC )
  * Use deep soil temperatures as a proxy for lake temperatures in assimilation.

 * Technical
  * Open-MP adaptations and other I/O optimizations
  * Internal optional build of grib_api
  * Reproducibility checks in testbed
  * Introduce RUNNING_MODE=operational|research for different behaviour in error treatment
  * Stand alone code norm checker
  * Several mSMS updates
  * More efficient MARS retrievals at ECMWF
  * All namelists are created on the fly
 
 * Verification
   * Extended station list for verification
   * New generalized input format for larger flexibility
   * New and corrected skill scores.

 * Diagnostics and postprocessing
   * Rewritten listener with fewer tasks.
   * Exteded list of postprocessing
   * '''[wiki:HarmonieSystemDocumentation/Forecast/Outputlist/37h1 A completely new FA2GRIB conversion table]'''

 * HARMONEPS ( experimental )
   * Towards multi model ensemble capabilities
   * Several technical updates for better performance.

See the detailed listing as contained in the documentations attached at the bottom of this page about features entering cycle 37T1.
 
== Harmonie-37h1 downloads ==

 * On ECMWF, the check-out version of harmonie-37h1.1 is available as,
{{{
   ecgate:/home/ms/spsehlam/hlam/harmonie_release/tags/harmonie-37h1.1
}}}
 * Via Subversion command:
{{{
   svn co https://svn.hirlam.org/tags/harmonie-37h1.1
}}}
 * The export tarball is available on hirlam.org, https://hirlam.org/portal/download/harmonie-37h1.1.tar

 * The testbed data set including boundaries, observations, climate files and background statistics for assimilation can be downloaded [https://hirlam.org/portal/download/testbed/cy37h1/testbed_data.tar here].

== Model Installation and Experiment Configuration ==

Users are referred to the system wiki documentation about [wiki:HarmonieSystemDocumentation/Installation Information and Instruction on basic system installation and experiment configuration] and to the 
[https://hirlam.org/trac/wiki/HarmonieSystemDocumentation/Harmonie-mSMS Harmonie-mSMS configuration documentation] for running an experiment at ECMWF in particular and on your local platform in general.

The version is available on ecgate as:

{{{
~hlam/harmonie_release/tags/harmonie-37h1.1/config-sh/Harmonie setup
}}}

=== Default configuration in Harmonie-37h1 and available alternatives ===
 * Default computer platform: ECMWF ecgate-c1a; Reference installation at ecgate: /ms_perm/hirlam/harmonie_release/tags/harmonie-37h1.1
 * Default build with MAKEUP
 * Default configuration (available when setup using "Harmonie setup" or "Harmonie setup -c AROME_3DVAR")
   * dynamics with non-hydrostatic (nh)
   * physics with AROME, see attached namelist in the reference.
   * Upper air analysis with 3DVAR using conventional data, surface analysis with CANARI_OI_MAIN
   * DENMARK domain with 2.5 km resolution, 65 vertical leveling, nested to ifs lateral boundary
 * Other predefined options, available under "Harmonie setup -c $option")
   * AROME physics
     * "AROME"
       * same as AROME_3DVAR above but with upper air blending, taking interpolated boundary data
   * ALARO physics
     * "ALARO_3DVAR"
       * SCANDINAVIA_5.5 domain with 5.5 km resolution, HIRLAM-65 vertical levels, nested to ifs lateral boundary
       * Upper air analysis with 3DVAR using conventional data, surface analysis with CANARI_OI_MAIN
       * Hydrostatic dynamics
       * physics with ALARO
       * surface scheme 'surfex'
       * incremental digital filtering initialisation
       * Update the first guess with large scales features throu the LSMIXBC option
     * "ALARO"
       * same as "ALARO_3DVAR" above but with 'blending' for upper air by use of interpolated boundary data
   * ALADIN physics
     * "ALADIN_3DVAR_SURFEX"
       * SCANDINAVIA_5.5 domain with 5.5 km resolution, HIRLAM-65 vertical levels, nested to ifs lateral boundary
       * Upper air analysis with 3DVAR using conventional data, surface analysis with CANARI_OI_MAIN
       * Hydrostatic dynamics
       * physics with ALADIN
       * surface scheme 'old_surface' (ISBA)
       * surface scheme 'surfex'
       * incremental digital filtering initialisation
     * "ALADIN"
       * same as "ALADIN_3DVAR" above but with 'blending' for upper air by use of interpolated boundary data

== Meteorological performance of Harmonie-37h1 ==

 An extensive validation of the Harmonie-37h1 performance can be seen [wiki:Harmonie_37h1/ValidationTests here]. A summary of the findings can be found in the presentation from the ASM in Marrakech by [http://www.cnrm.meteo.fr/aladin/spip.php?action=acceder_document&arg=2318&cle=8b02f5cc831481b5bdd7f88f25d305fe406632af&file=pdf%2F38-asm_37h1_validation.pdf Yang et.al.].

== Technical aspects of Harmonie-37h1 ==

=== Tested platforms, configurations, components for Harmonie-37h1 ===

 Reports on the outcome of testbed configurations on different platforms can be found in the [https://hirlam.org/pipermail/testbed testbed mailing list]. The configurations included in the testbed are 

 {{{

   AROME AROME_1D AROME_3DVAR AROME_MUSC
   ALARO ALARO_1D ALARO_3DVAR ALARO_MUSC \
   AROME_EKF
   AROME_EPS AROME_EPS_COMP
   ALADIN_3DVAR_SURFEX
   ALADIN_TLAD

 }}}

=== Known problems ===

 * 4DVAR option does not work properly
 * ATOVS assimilation still under technical evaluation
 * The above and other reported problems for cy37h1 are listed on the [https://hirlam.org/trac/query?status=accepted&status=assigned&status=new&status=reopened&version=37h1&order=priority&report=11 ticket page]. Some problems of [https://hirlam.org/trac/query?status=accepted&status=assigned&status=new&status=reopened&version=36h1&order=priority&report=12 cy36h1] are also valid for cy37h1. Please report any problem on [http://hirlam.org/index.php?option=com_kunena&Itemid=160&func=showcat&catid=2 forum] or create a [https://hirlam.org/trac/newticket ticket] if you are sure that it is a unknown bug.

=== Sample computational costs for running HARMONIE-37h1 ===

The Following tables list a sample of computational costs for SUCCESSFULLY tested HARMONIE-37h1 runs with various configuration.

 * Compilation 
|| '''Platform''' || '''Tested components''' || '''Build option''' ||  '''Nr of PE''' || '''Total elapse time''' || '''SBU cost''' || '''Version''' ||
|| ECMWF C1A (IBM) || Full build || Makeup || 16|| 6800s || n/a  || 37h1 ||
|| redhat6.1 quad core || Full build || Makeup || 4 || 1400s || n/a  || 37h1 ||
|| gimle, Linux || full build || makeup || 8 || 1131s || n/a || 37h1 ||
||armoin, Linux (2xquad core) || full build || makeup || 1 ||  6960s || 270|| 37h1trunk 20120207 ||
||armoin, Linux (2xquad core) || full build || makeup || 6 ||  2061s || n/a || 37h1 ||
||stokes, Linux (2xquad core) || full build || makeup || 2 || 13468s || n/a || 37h1 ||
||stokes, Linux (2xquad core) || full build || makeup || 6 || 10748s || n/a || 37h1 ||

 * Cycle
|| '''Domain''' || '''Platform''' || '''Tested components''' || '''Nr of cores''' || '''Forecast length''' || '''Total elapse time''' || '''SBU cost''' || '''Version''' || '''Commments''' || 
{{{#!td
 SCANDINAVIA_5.5
}}}
{{{#!td
 c1a
}}}
{{{#!td
 ALARO_3DVAR
}}}
{{{#!td
 9x10
}}}
{{{#!td
 36h
}}}
{{{#!td
 !MakecycleInput 700s [[BR]]
 Date 8500s [[BR]]
 !PostProcessing 3000s [[BR]]

}}}
{{{#!td
 !MakecycleInput 20SBU [[BR]]
 Date 2700SBU [[BR]]
 !PostProcessing 5SBU [[BR]]
}}}
{{{#!td
 37h1 (trunk)
}}}
{{{#!td
 N/A
}}}

{{{#!td
 DENMARK
}}}
{{{#!td
 c1a
}}}
{{{#!td
 AROME_3DVAR
}}}
{{{#!td
 9x10
}}}
{{{#!td
 24h
}}}
{{{#!td
 !MakecycleInput 400s [[BR]]
 Date 4300s [[BR]]
 !PostProcessing 1200s [[BR]]
}}}
{{{#!td
 !MakecycleInput 7SBU [[BR]]
 Date 1400SBU [[BR]]
 !PostProcessing 3SBU [[BR]]
}}}
{{{#!td
 37h1 (trunk)
}}}
{{{#!td
 N/A
}}}

 * Forecast
|| '''Domain''' || '''Platform''' || '''Components''' || '''Nr of nodes, total PE''' || '''Wall clock time (per step, I/O step, total )''' || '''SBU cost''' || '''Version''' ||
|| DENMARK[[FootNote(384x400x65)]] || c1a || 24h AROME  || 2, 90 || 1.2s, 2.0s, ~3700 s || ~1290 || 37h1alfa ||
|| DENMARK[[FootNote(384x400x65)]] || c1a || 36h AROME  || 2, 90 || 1.2s, 2.9s, ~4900 s || ~1630 || 37h1beta1||
|| DENMARK || c1a || 24h AROME  || 4, 10x18 || 0.65s, 1.5s, ~2200 s || ~1460 || 37h1beta ||
|| DENMARK || c1a || 24h AROME, edmfm || 2, 9x10 || 1.2s, n/a, ~4000 s || ~1340 || 37h1beta1 ||
|| IBERIA_2.5[[FootNote(576x480x65)]] || c1a || 24h AROME, edkf || 2, 9x10 || 2.3s, 5.3s, ~9300 s || ~3100 || 37h1beta1 ||
|| IBERIA_2.5[[FootNote(576x480x65)]] || c1a || 24h AROME, edmfm || 2, 9x10 || 2.4s, 5.3s, ~9600 s || ~3200 || 37h1beta1 ||
|| IRELAND25[[FootNote(540x500x65)]] || c1a || 30h AROME, edkf || 2, 9x10 || 2.2s, 5.0s, ~7120 s || ~2370 || 37h1beta1 ||
|| SCANDINAVIA_5.5[[FootNote(540x600x60)]] || c1a || 36h ALARO || 2, 90 || 3.0s, 12.0s, ~7100s || ~2340 || 37h1 ||
|| DENMARK || c1a || 24h AROME || 2, 9x10 || 1.2s, n/a, ~4000 s || ~1320 || 36h1.3 ||
|| IBERIA_2.5[[FootNote(576x480x65)]] || c1a || 24h AROME, edmfm || 6, 12x25 || 1.1s, 2.1s, ~4580 s || ~4580 || 37h1beta1 ||
|| IRELAND25[[FootNote(540x500x65)]] || c1a || 24h AROME, edkf || 2, 9x10 || 2.5s, 3.7s, ~8050 s || ~2700 || 36h1.4bf1 ||
|| SCANDINAVIA_5.5 || c1a || 36h ALARO || 2, 90 || 3.3s, n/a, ~7300s || ~2430 || 36h1.3 ||


 [[FootNote]]

== Acknowledgements ==

37h1-system is the result of collective development and implementation work of HIRLAM-A programme under the cooperation context of HARMONIE, with major scientific and technical contribution from partners in ECMWF, Meteo France and members of ALADIN consortia. We thank colleagues at our partner institutes for all the valuable contribution and assistance during the implementation of CY36T1.

Toon Moene, KNMI, is the responding system manager for 37h1-code series. Bjarne Andersen, Ulf Andrae, Trygve Aspelien, Lisa Bengtsson, Javier Calvo, Mats Dahlbom, Per Dahlgren, Carl Fortelius, Nils Gustafsson, Estrella Guierrez, Mariken Holmleid, Karl-Ivar Ivarsson, Rimvydas Jasinskas, Martynas Kauzlaukas, Magnus Lindskog, Andres Luhamaa, Sami Niemela, Enda O'Brien, Roger Randriamampianina, Wim De Rooy, Sander Tijm, Sami Saarinen, Niko Sokka, Ole Vignes, Villaume Sébastien, Eoin Whelan and Xiaohua Yang contributed in different ways through development, evaluation and testing.

----
[[Center(begin)]]
[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]''
