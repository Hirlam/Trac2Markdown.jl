[[PageOutline]]
[[Center(begin)]]
== '''HARMONIE 38h1''' ==
 ''The Guinness release''
[[Center(end)]]

== Description of Harmonie 38h1 ==

Harmonie 38h1 is HIRLAM's adaptation to the IFS/ARPEGE CY38T1 released in August 2012 and the subsequent bugfix versions 1 to 3. 

At its default, Harmonie-38h1 comprises the following features:

 * A meso-scale NWP forecast system with convection-permitting AROME physics and non-hydrostatic dynamics on a model grid with 2.5 km grid-spacing in horizontal and 65 vertical levels.
 * Treatment of surface processes by SURFEX
 * 3D-VAR upper air assimilation with 3h cycling using conventional observations and AMSUA AMSUB/MHS satellite information.
 * Optimal interpolation-based surface analysis using CANARI for the spatialization and SODA for the update of surface variables.
 * A comprehensive set of utilities for observation preprocessing, model diagnostics, monitoring and verification.
 * A scheduler, mSMS, and a graphical interface, mXCdp, for running an controlling the full suite.

== News in Harmonie-38h1 ==

=== Major changes ===

The major changes in cy38h1.1 compared to cy37h1.2 are:

 * Physics
  * SURFEX 7.2, for documentation of SURFEX versions see the [http://www.cnrm.meteo.fr/surfex-lab/spip.php?rubrique12 SURFEX webpage]
  * Use of ECOCLIMAP 2.2
  * Improved statistical cloud scheme
  * Use different cloud droplet number concentration depending on land/sea/town
  * Changes in coupling treatment of cloud variables
  * ALARO physics updates

 * Dynamics
  * Optional application of boundary conditions in spectral space

 * Assimilation
  * 3h cycling
  * RTTOV V10
  * Assimilation of ATOVS default
  * Support added for OPLACE observation data structure
  * Corrections for handling of RADAR, GPS and VarBC, ATOVS and AMV data

 * Technical
  * Surfex output as FA files for improved scalability
  * Call of SODA from inside of CANARI
  * Optional IO-server for improved scalability
  * Externalization of RTTOV coefficient files
  * Various performance improvements
 
 * Verification
  * New skill scores introduced
  * Added verification of min/max temperature, visibility and precipitation with different accumulation lengths
  * Allow eaiser separation of different initial times and forecasts valid at the same time

 * Diagnostics and postprocessing
   * Fully integrated inline postprocessing
   * Extended list of postprocessing variables and changes in GRIB1 conventions
     * [wiki:HarmonieSystemDocumentation/Forecast/Outputlist/38h1]

 * HarmonEPS
   * Several technical updates for better performance.

=== Changes between CY37T1 and CY38T1 ===

The changes in the common IFS/ARPEGE code are documented in the following documents.

  * [https://hirlam.org/trac/attachment/wiki/Harmonie_38h1/cy37t1.pdf CY37T1 memorandum] for reference
  * [https://hirlam.org/trac/attachment/wiki/Harmonie_38h1/cy38.pdf CY38 memorandum] A common cycle between ECMWF and Meteo France.
  * [https://hirlam.org/trac/attachment/wiki/Harmonie_38h1/cy38t1.pdf CT38T1 memorandum] 
   * [https://hirlam.org/trac/attachment/wiki/Harmonie_38h1/cy38t1_bf.01.txt CY38T1 bugfix 1]
   * [https://hirlam.org/trac/attachment/wiki/Harmonie_38h1/cy38t1_bf.02.txt CY38T1 bugfix 2]
   * [https://hirlam.org/trac/attachment/wiki/Harmonie_38h1/cy38t1_bf.03.txt CY38T1 bugfix 3]

=== Changes between harmonie-38h1.beta.3 and harmonie-38h1.1 ===

 Read more about the release notes of harmonie-38h1.beta3 and the differences compared to older versions [wiki:ReleaseNotes/harmonie-38h1.beta.3 here]
 The main differences between 38h1.beta.3 and 38h1.1 are summarized in the list below. For a full list of changes please look at the [https://hirlam.org/trac/log/trunk/harmonie/?action=stop_on_copy&mode=stop_on_copy&rev=12139&stop_rev=12752&limit=500 change log].

 * Support added for OPLACE observation data structure
 * Corrections in usage of prep to allow downscaling of e.g. AROME to AROME
 * Config files for Turkish HPC and support for ECMWF ecgb platform
 * Qubic interpolation of boundary fields in gl_grib_api
 * ALARO0 to SURFEX interface fixes
 * Improved treatement of error handling in operational mode
 * New variables and fixes in the verification package
 * GRIB1 encoding corrections
 * Experimental forcing generation for offline SURFEX
 * Corrections for handling of RADAR, GPS and VarBC, ATOVS and AMV data
 * Add OpenMP directives to speed up gl_grib_ap
 * Switched off SSO parameterization
 * Correction for extracion of direct/diffuse SW radiation from the ECMWF radiation scheme
 * Optional application of lateral boundary conditions in spectral space

=== Changes between harmonie-38h1.1 and harmonie-38h1.2.beta.2 ===

 * Data assimilation and observations
  * Streamlined background error generation including back phasing of parallel festat from cy40t1
  * GNSS handling + VARBC namelist settings
  * General VARBC and satellite updates ( Roger)
  * Updates for new TEMP format (Eoin)
  * Add recognition of ECMWF SHIP BUFR
  * New satellite coefficient file for Meteosat 10, Seviri
  * For LSMIXBC, only use HOST (ECMWF) scales larges than ~100km
 * Physics
  * Mixed phase clouds, LOCND2=T and saturation w.r. to water
  * Safety fix for CROUGH=Z01D
  * Tuning of CA coupling
 * EPS
  * Perturbation of observations
  * New developments ( to be described )
 * Numerics
  * Updates to spectral BD handling
  * De-aliasing and upper BD conditions set default on
  * Switch off PC scheme for ALARO
 * Bugfixes ( main ones )
  * DFI settings for ALARO
  * Missing NH settings for ALARO
  * Reintroduce soil assimilation change ( influence of increments in deep layers )
  * Ensure consistency between upper air and surface orography.
  * ODB environment variable change fixes spurious crashes in Canari
 * Postprocessing
  * Update of visibility diagnostics
  * Scripted support for several output streams
  * New obsmonitor
  * New vfld file version (4)
  * Fully replace gl by gl_grib_api in all components ( but keep the code )
  * Optional ODB1 to ODB2 conversion, experimental
 * MUSC
  * Bugfix in MUSC forcing generation
  * MUSC ascii format to allow easier manipulation of profiles
 * Technical
  * cca default platform
  * mSMS server – host communication through webports rather than files. (Ole)
  * Possibility for parallel Makegrib listeners
  * Possibility for parallel FLDEXTR tasks
  * Several smaller bugfixes
 * Verification
  * MAE introduced
  * Fix for !Tmin/Tmax
  * Various smaller bugfixes

=== Difference between CY38T1 and harmonie-38h1 ===

 Harmonie-cy38h1 contains a number of developments not introduced in or done after the release of CY38T1. The difference between harmonie-38h1.2.beta.2 and CY38T1_bf.03 can be summarized as:

 * Satellite BUFR file decoding in Bator and treatment of empty pools
 * ATOVS blacklisting and VARBC predictor treatment
 * Corrections for handling of RADAR, GPS and VarBC, ATOVS and AMV data
 * IO-server changes, IO optimization ( some backporting from CY39T1)
 * SURFEX FA format file manipulation tools. ( backporting from CY39T1 )
 * Ability to run SODA inline CANARI
 * Use different cloud droplet number concentration depending on land/sea/town for cloud sedimentation
 * Added OpenMP directives in SURFEX related parts
 * Changed weights between land/sea for T2M diagnostics
 * Snow analysis changes
 * Update of SURFEX SST from the boundary files, for climate simulations
 * Easier output of 2D diagnostics fields [12371]
 * Improved initialisation for the initial surfex state.
 * Separate evaluation of liquid/sold microphysics, switched off, experimental
 * ALARO0 interface changes to surfex
 * Optional application of lateral boundary conditions in spectral space
 * Correction for extraction of direct/diffuse SW radiation from the ECMWF radiation scheme
 * Back phasing of femars and parallel festat from cy40t1
 * GNSS preprocessing
 * Mixed phase clouds, LOCND2=T
 * Safety fix for CROUGH=Z01D
 * Tuning of CA coupling
 * Perturbation of observations
 * Updates to spectral BD handling (Mariano)
 * De-aliasing and upper BD conditions
 * Reintroduce soil assimilation change ( influence of increments in deep layers )
 * ODB environment variable change fixes spurious crashes in Canari

The full list of changes can be found in the following [https://hirlam.org/trac/attachment/wiki/Harmonie_38h1/svndiff_all_cy38h1.1.txt document]. Some of the differences have already been introduced in [wiki:Phasing/cy39t1 CY39T1] or [wiki:Phasing/cy40t1 CY40T1] and some will be discussed for introduction to [wiki:Harmonie_41h1/41t1_contributions CY41T1].

=== Tested configurations ===

The following configurations have been tested and are working technically at ECMWF and several linux clusters.

 * AROME_3DVAR: AROME physics with surface assimilation and 3DVAR, the default configuration
 * AROME: AROME physics with surface assimilation and upper air blending 
 * AROME_MUSC: Single column model (MUSC) with AROME physics
 * ALARO_3DVAR_OLD: ALARO physics and old ISBA with surface assimilation and 3DVAR
 * ALARO_OLD: ALARO physics and old ISBA with surface assimilation and upper air blending
 * ALARO: ALARO + SURFEX
 * AROME_CLIMSIM: Climate simulation with AROME physics
 * AROME_EPS: HarmonEPS setup 
 * AROME_EKF: AROME with SODA+EKF
 * AROME_3DVAR_FA_IO_SERVER: As AROME_3DVAR but with the IO-server activated

=== Releases ===

The following versions of harmonie-38h1 have been released

 * Second beta version of 38h1.2 [browser:tags/harmonie-38h1.2.beta.2 harmonie-38h1.2.beta.2], tagged on August 29th 2014
 * First beta version of 38h1.2 [browser:tags/harmonie-38h1.2.beta.1 harmonie-38h1.2.beta.1], tagged on July 3rd 2014
 * First full version [browser:tags/harmonie-38h1.1 harmonie-38h1.1], tagged on February 12th 2014
 * First release candidate [browser:tags/harmonie-38h1.1.rc1 harmonie-38h1.rc1], tagged on January 15th 2014
 * Third version for meteorological evaluation [browser:tags/harmonie-38h1.beta.3 harmonie-38h1.beta.3], tagged on October 18th 2013
 * Second version for meteorological evaluation [browser:tags/harmonie-38h1.beta.2 harmonie-38h1.beta.2], tagged on July 25th 2013
 * First version for meteorological evaluation [browser:tags/harmonie-38h1.beta.1 harmonie-38h1.beta.1], tagged on May 1st 2013
 * Second technical version [browser:tags/harmonie-38h1.alpha.2 harmonie-38h1.alpha.2] tagged on Mar 12th 2013
 * First technical version [browser:tags/harmonie-38h1.alpha.1 harmonie-38h1.alpha.1], tagged on Jan 24th 2013

== Harmonie-38h1 downloads ==

 * On ECMWF, the check-out version of harmonie-38h1.2.beta.2 is available as,
{{{
   ecgate:/home/ms/spsehlam/hlam/harmonie_release/tags/harmonie-38h1.2.beta.2
}}}
 * Via Subversion:
{{{
   svn co https://svn.hirlam.org/tags/harmonie-38h1.2.beta.2
}}}

 * The testbed data set including boundaries, observations, climate files and background statistics for assimilation can be downloaded [https://hirlam.org/portal/download/testbed/38h1/38h1.tar here]. Read more about the testbed [wiki:HarmonieSystemDocumentation/Evaluation/HarmonieTestbed here].

 * Climate data for cy38h1 can be found under [https://hirlam.org/portal/download/harmonie_climate/38h1.1.tar.gz] or on c2a under {{{/project/hirlam/harmonie/climate/38h1.1}}}.
 * RTTOV constants for cy38h1 can be found under [https://hirlam.org/portal/download/sat_const/sat_const_cy38h1.tar.gz] or on c2a under {{{/project/hirlam/harmonie/sat_const/cy38h1.2}}}.

== Model Installation and Experiment Configuration ==

Users are referred to the system wiki documentation about [wiki:HarmonieSystemDocumentation/Installation Information and Instruction on basic system installation and experiment configuration] and to the [https://hirlam.org/trac/wiki/HarmonieSystemDocumentation/Harmonie-mSMS Harmonie-mSMS configuration documentation] for running an experiment at ECMWF in particular and on your local platform in general.

The version for starting an experiment is available on ecgate as:

{{{
~hlam/harmonie_release/tags/harmonie-38h1.2.beta.2/config-sh/Harmonie setup
}}}

== Meteorological performance of Harmonie-38h1.1 ==

Harmonie-38h1 is the first HARMONIE release which is accompanied by operational suits running in form of Regular Cycle of Reference HARMONIE (HARMONIE-RCR) at operational centers, i.e., Danish Meteorological Institute (DMI, on DKA domain, pre-operational since late Nov 2013, scheduled launch in late March 2014) and !MetCoOp (joint operational suite at MET and SMHI, on METCOOP25B domain, scheduled launch in March 2014). In addition, Finnish Meteorological Institute (FMI) operationalised 38h1-based operational suite on SCANDINAVIA25 domain in Jan 2014. 

Prior to the tagging of 38h1.1, large number of sensitivity experiments and validation tests have been performed throughout the HIRLAM member services, using development trunks or earlier tagged alpha, beta and rc versions. Aspects of validation tests includes those on various domains covering Spain & Canari Islands, Netherland, Denmark, Lithuania, Scandinavia, Iceland, with a large variety of data assimilation schemes (4DVAR, 3DVAR, 3DVAR-RUC, blending), use of observation data (AMSU-A, AMSU-B/mhs, AMV, MODES, Radar, GNSS, ASCAT), physical parameterisation (AROME, ALARO), and EPS configurations. 

An incomplete listing about configurations and evaluation about meteorological performances using various versions of 38h1 can be seen on the wiki page about [wiki:Harmonie_38h1/ValidationTests]. In general, in comparison to the previous official release 37h1.2, the meteorological performance of the new versions has been satisfactory. At its default, 38h1 has been shown to, generally,  
 * improved surface wind forecast for high wind conditions. 
 * improved forecast for mountain area especially on surface wind. 
 * improved surface humidity forecast. 
 * improved forecast for summer time surface temperature. 
Meanwhile, no significant changes have been seen on performance about forecast of precipitation, cloud and fog. For winter period, 38h1 runs have been seen to suffer a slightly increased negative bias in surface temperature for larger part of northern Europe.  

From validation studies it has been seen that observed changes in meteorolgical performances often are strongly related to the update in physiogeographic data base (ECCOCLIMAP2), tunning in SURFEX parameterisation (canopy drag and subgrid scale orographic parameterisation). It is noted that similar changes do not alwways results in positive impact. e.g., when applied to other domains. 

More about the meteorological status and validation of Harmonie-38h1 can be seen [wiki:Harmonie_38h1/ValidationTests here]

== Meteorological performance of Harmonie-38h1.2 ==

Harmonie-38h1.2 is still under evaluation. The progress can bee seen [wiki:Harmonie_38h1/38h1.2_validation here].

== Technical aspects of Harmonie-38h1 ==

=== Performance numbers ===

|| !Version/Platform/Domain || Canari          || OI_main            || Screening       || Minimisation    || Forecast                   ||
|| 37h1.2 c2a DKCOEXP      || 100s ( nproc=4) || 269s               || 43s (nproc=128) || 105s (nproc=128) || ~4800s (36h) (nproc=16x16, 3h output freq) ||
|| 38h1.1 c2a DKCOEXP      || 471s ( nproc=4) || Included in Canari || 32s (nproc=128) || 79s  (nproc=128) || ~4900s (36h) (nproc=16x16, 3h output freq, no io-server) ||
|| 37h1.2 Cray XT5 DKA      || 89s ( nproc=36) || 113s (nproc=6) || 103s (nproc=240) || 121s  (nproc=240) || ~4474s (58h) (nproc=48x31, 1h output freq, no io-server) ||
|| 38h1.1 Cray XT5 DKA      || 153s ( nproc=24) || Included in Canari || 154s (nproc=240) || 191s[[FootNote(DKA-38h1 uses ATOVS and AMV data, with 48 iterations)]]  (nproc=240) || ~3914s (58h) (nproc=48x31, 1h output freq, io-server=2) ||
|| 38h1.1 SGI Norw METCOOP25B || 90s (nproc=64) || Included in Canari || 30s (nproc=64) || 300s (nproc=64) || ~1600s (66h) (nproc=16x45, 1h output freq, io_server=16, 8 OpenMP threads ||
[[FootNote]]

=== Problems and bugfixes ===

There are still unresolved problems with cy38h1. For the latest status see [https://hirlam.org/trac/query?status=accepted&status=assigned&status=new&status=reopened&version=38h1&order=priority&report=11 ticket page]. Please look at
[https://hirlam.org/trac/log/branches/harmonie-38h1.1.bugfix the bugfix branch] for resolved problems.
== Acknowledgements ==

38h1-system is the result of collective development and implementation work of HIRLAM-B programme under the cooperation context of HARMONIE, with major scientific and technical contribution from partners at ECMWF, Meteo France and members of the ALADIN consortia. We thank colleagues in our partner institutes for all the valuable contribution and assistance during the implementation of CY38T1.

Niko Sokka, FMI, is the responding system manager for 38h1-code series. Bjarne Andersen, Ulf Andrae, Trygve Aspelien, Lisa Bengtsson, Jelena Bojarova, Dag Björge, Javier Calvo, Mats Dahlbom, Per Dahlgren, Inger-Lise Frogner, Mariken Holmleid, Mariano Hortal, Karl-Ivar Ivarsson, Rimvydas Jasinskas, Martynas Kauzlaukas, Magnus Lindskog, Sami Niemela, Enda O'Brien, Roger Randriamampianina, Laura Rontu, Sander Tijm, Sami Saarinen, Niko Sokka, Ole Vignes, Villaume Sébastien, Eoin Whelan and Xiaohua Yang contributed in different ways through development, evaluation and testing.

----
[[Center(begin)]]
[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]