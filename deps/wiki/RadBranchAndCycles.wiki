'''3D Radiation Branch HARMONIE-AROME'''

- Cycle 43 radiation branch failed at initrun at ECMWF. (update - can run it now for ifs, partly for HLRAD, retrying with fixed ACRA)
- Now trying harmonie-43t2. Failed at make_gl_grib_api_simple but I've set it to "complete". Still failed for ODBTOOLS this time - retrying with Intel rather than gnu compilers at ECMWF (changed l.87 in Env_submit). Failed at same place using Intel compilers. Got more updates from Niko which should solve ODB issue - yes it did.
- Now trying LR's orog style cy43 expt - changes in src, scr, nam and config_exp.h relative to the harmonie-43rb branch.
- ACRANEB2 does not work when RADGR and RADSN are > 0 and LRADFLEX and LINTFLEX need to True for acraneb2. Still failing - now have fixed bug and retrying.
- Need to bring new suintflex to rb and also remove RADSN/GR from the namelist.

||= Name   =||= Details                =||= Who =||= Status=||
|| cau43rb2 || cy43rb, IFS radiation, Sochi domain    || EG||complete, no issues ||
|| cau43rb3 || cy43rb, HLRAD radiation, Sochi domain, suintflex update, RADSN/GR zero    || EG||Ran for a few cycles, failed for strong winds||
|| cau43rb5 || cy43rb, ACRA radiation, Sochi domain, suintflex update, RADSN/GR zero    || EG||failed - ELARMES issue  ||
||  ||    || ||  ||
|| cau43rb_hl_ie || cy43rb, HLRAD radiation, IRE domain, suintflex update, RADSN/GR zero    || EG||BDY issue||
|| cau43rb_ac_ie || cy43rb, ACRAD radiation, IRE domain, suintflex update, RADSN/GR zero, OCMD2 off    || EG||failed - ELARMES issue||
|| cau43rb_hl_ie_oro_on || cy43rb, HLRAD radiation, IRE domain, suintflex update, RADSN/GR zero    || EG||failed on the 2nds day - seems to be SL, ELASCAW routine||
|| cau43rb_hl_ie_oro_off|| cy43rb, HLRAD radiation, IRE domain, suintflex update, RADSN/GR zero, ORORAD off, CROUGH = none    || EG||complete||
||  ||    || ||  ||
|| ie43_def_ifs || cy43t2, IFS radiation, IRE domain    || EG||no issues||
|| ie43_def_ifs_flex_on || cy43t2, IFS radiation, IRE domain,suintflex update, flex=T    || EG|| complete; this means issue with ACRA is not related to Flex interface||
||  ||    || ||  ||
|| ie43_def_acra || cy43t2, ACRA radiation, IRE domain,suintflex update, RADSN/GR zero, OCND2 off, LHLRADUPD=T, flex =F, NSW=6    || EG||failed - ELARMES issue||
|| ie43_def_acra_defaults || cy43t2, ACRA radiation, IRE domain,suintflex update, RADSN/GR zero, OCND2 off,LHLRADUPD=F, flex=T, NSW=1    || EG||failed - ELARMES issue||
|| ie43_def_acra_intermitt_off || cy43t2, ACRA radiation, IRE domain,suintflex update, RADSN/GR zero, OCND2 off,LHLRADUPD=F, flex=T, NSW=1,NSORAYFR/NTHRAYFR/NRAUTOEV =1    || EG||failed - ELARMES issue|
|| ie43_def_acra_intermitt_on_LCLSATUR_T || cy43t2, ACRA radiation, IRE domain,suintflex update, RADSN/GR zero, OCND2 off, LCLSATUR=T   || EG||failed - ELARMES issue||
|| ie43_def_acra_intermitt_on_LCLSATUR_T_CROUGH || cy43t2, ACRA radiation, IRE domain,suintflex update, RADSN/GR zero, OCND2 off, LCLSATUR=T, CROUGH=Z01D,XFRACZ0=10   || EG||same errors as before||
|| ie43_def_acra_intermitt_on_LCLSATUR_T_bf || cy43t2, ACRA radiation, IRE domain,suintflex update, RADSN/GR zero, OCND2 off, LCLSATUR=T, acra bf implemented   || EG||Runs to completion||
|| cau43rb4 || cy43rb, IFS radiation, Sochi domain 1.5km/65L with SRTM topo, ororad/senkova and orotur on    ||LR 18May||complete, no issues ||
|| cau43rb4 || cy43rb, ACR radiation, Sochi domain 1.5km/65L with SRTM topo, ororad/senkova and orotur on    ||LR 18May||complete, no issues ||
|| cau43rb4 || cy43rb, HLR radiation, Sochi domain 1.5km/65L with SRTM topo, ororad/senkova and orotur on    ||LR 20May||runtime error tiwmx after some cycles and hours||


'''Cycle 40 MUSC Experiments'''

'''test_arome_gl'''

- Har2musc_arome_fa.sh uses an ICM, ICM*sfx and Const.Clim.sfx 3D files as input to create MUSC files (** not sure where the 3 input files I used came from - think they are in the repository**)
- 3 of each file are created (the file, the file in ascii and the file converted back from ascii to FA): MUSC_Const.Clim.sfx  MUSC_Const.Clim.sfx.ascii  MUSC_Const.Clim.sfx.ascii.fa  MUSCIN+0006  MUSCIN+0006.ascii  MUSCIN+0006.ascii.fa  MUSCIN+0006.sfx  MUSCIN+0006.sfx.ascii  MUSCIN+0006.sfx.ascii.fa
- The ascii.fa files work with the Runmusc_arome_fa script (for ifs)
- Can replace the filenames in Runmusc_arome_fa to run without the ascii.fa files (eg change MUSCIN+0006.sfx.ascii.fa to MUSCIN+0006.sfx etc)
- works with the ifs and acraneb2 schemes (this is not the rb so hlradia not included)
- Since there are no src changes in this expt, it runs off same code as cy40- not sure which version we are currently using.
- Figured out that can run cy40 with LMICRO off if also set LMFSHAL to false.
- Cy40 MUSC runs for ifs with LMICRO etc on or off. 
- Acra doesn't run when LMICRO etc are off - fails at actqsat. Runs with LMICRO on.

- Har2musc_arome.sh uses an ICM, ICM*sfx files as input to create MUSC files MUSCIN+0006.fa MUSCIN+0006 and PGD.lfi
- My expt fails on creating the SURFEX infile to lfi so I can only use the FA method not lfi.


'''Cycle 43 MUSC Experiments'''

'''test43rb:'''

- contains no additional src changes so running of the cy43rb branch
- started with MUSCIN_norr.atm  MUSCIN_norr.pgd  MUSCIN_norr.sfx but did not generate them using Har2MUSC....
- need MPICH lib to run -- not needed in cy40 though
- Ran for ifs and hlradia without issues but failed after some time-steps for ACRANEB2. 

- Looking into ACRA further:
- LHLRADUPD T - crashed
- LHLRADUPD F - crashed
- LHLRADUPD F and LMICRO F - crashed
- LHLRADUPD F and LMICRO F and LOCND2 F - crashed

- Copied the 3 MUSC*fa files from the cy40 test_arome expt to cy43.
- ifs and hlradia ran without issues
- ACRANEB2 failed as before - one error message points to acraneb_coefs.F90:223
- Using exact same input files, compared ifs rad output for cy40 and cy43rb --- differences due to cloud - LMICRO=F doesn't work in cy40 though for acraneb so difficult to compare.
- BUG in call to ACRANEB2 from apl_arome.F90 - variables in the wrong order - found by comparing to cy40 - Jan will enter to next b/f

- Using cy43 input files: LMICRO etc off - ifs runs, acra fails at actqsat.F90
- In 43rb - the TKE check has been commented out
- Using cy43 input files: LMICRO etc on - ifs runs, acra runs
- Using cy40 input files: LMICRO etc on - ifs runs, acra fails at acraneb_coefs.F90:223
- Using cy40 input files: LMICRO etc off - ifs runs, acra fails at actqsat.F90:228


'''test_arome_gl - running from the cy43t2 branch not the 43rb branch'''

- Now getting error when run with IFS using cy40 and cy43rb input files:  "ABORT!    1 TKE < 0 under APL_AROME check YTKE_NL%NREQIN"
- Running with that line commented out - may be related to MUSC namelists but don't know which part. YTKE_NL%NREQIN is the same as in cy40 which doesn't fail for ifs.
- IFS now fails after some time-steps in icecloud.F90 (cy43rb input files) and elarmes.F90 (cy40 input files)
- Turned off LMICRO,LOCND2 and HARATU, ifs with cy40 inputs runs ok, ifs with cy43rb inputs fails at prandtl.F90
- Cy40 inputs, LMICRO defs: acra fails in turb scheme
- Cy43rb inputs, LMICRO defs: acra fails in fonctions.F90
- Cy40 inputs, LMICRO etc off: acra fails in actqsat.F90:228
- Cy43rb inputs, LMICRO etc off: acra fails in prandtl.F90:241 
- But all the 43rb IFS expts run with/without LMICRO. Differences in the nameslists include - Haratu on here, YTKE_NL%NREQIN=1 rather than -1 and pgdsfx=${INFILE_PATH}/Const.Clim.sfx rather than MUSCIN*pgd.
- When I make all 3 namelist changes (all 3 are needed) IFS runs using cy43rb or cy40 input and LMICRO etc on or off. 
- With the 3 namelist changes acra runs for cy43rb input when LMICRO etc is on. Fails when it's off actqsat.F90:228. When cy40- inputs are used, acra runs with LMICRO but fails for actqsat again otherwise.
- In the above LHLRADUPD=T
- When HLRADUPD=F (now acra runs with NSW=1 rather than 6): cy40 input and MICRO on, acra runs; micro off fails at gp_spv.F90:122
- When HLRADUPD=F (now acra runs with NSW=1 rather than 6): cy43 input and MICRO on, acra runs; micro off fails at actqsat.F90:228
Summary: IFS runs with 40/43 input and LMICRO on/off but HARATU needs to be off. ACRA runs with 40/43 input and micro on but fails when it's off - mostly for actqsat.F90:228.


'''ororad43:'''

- using 43ma files provided by Laura Rontu (atm, sfx and pgd)

- When LDSL,LDSH,LDSV (ororad related) are set to True IFS, ACRANEB2 and HLRADIA experiments run to completion. 
- When they are False and CROUGH=None (ie orotur off) all 3 schemes work
- When ororad is off but orotur is on IFS and HLRADIA work, ACRANEB2 fails after a few time-steps
- When ororad is on and orotur is off IFS and HLRADIA work but ACRANEB2 fails again after a few time steps - logfile suggests issue in TIWMX_TAB from RAIN_ICE
- BUG in call to ACRANEB2 from apl_arome.F90 - variables in the wrong order - found by comparing to cy40 - Jan will enter to next b/f
- Now re-running each rad scheme to check some settings
- Ororad, orotur, haratu, lmicro, locnd, lmshal, flex on: IFS, ACRA and HLRADIA all work
- Ororad/orotur = off, haratu, lmicro, locnd, lmshal, flex on: IFS, ACRA and HLRADIA all work
- Ororad off, orotur on, haratu, lmicro, locnd, lmshal, flex on: IFS, ACRA and HLRADIA work
- Ororad on, orotur off, haratu, lmicro, locnd, lmshal, flex on: IFS, ACRA and HLRADIA work
- Need to check namelists in other cy43 expts to see why they fail when ororad ones do not!

- LR 18 May: all oro combinations seem to work for IFS, ACR, HLR

'''What's needed for MUSC?'''


- gcc g++ gfortran
- libmpich-dev
- liblapack-dev (contains libblas-dev)
- ksh
- rsync
- make
- flex, bison, byacc

When building of fclibs failed, I found advise in the end of util/makeup/configure, which suggested to 
 cd makeup.debian-FImpich.gfortran/src
 make show_fclibs

that indeed hinted about missing lapack this time

Elements of this list of prerequisites for MUSC are in very old documents like http://www.helsinki.fi/~jaraisan/numlab2013/MUSC_userguide_v0.pdf ,
