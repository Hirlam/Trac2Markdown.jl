[[PageOutline]]
[[Center(begin)]]
= '''Harmonie System Documentation''' =
== ''' Experiment configuration''' ==
[[Center(end)]]

== Introduction ==

There are several levels on configuration available in HARMONIE. The highest level of configuration is done in [source:tags/harmonie-37h1.2/sms/config_exp.h config_exp.h]. It includes the environment variables, which are used to control the experimentation. In the following we describe the meaning of the different variables.


== General settings ==

 * ''RUNNING_MODE'' can be operational or research. Operational is more forgiving in the error handling and e.g. the assimilation will be skipped if Bator doesn't find any observations.
 * ''SIMULATION_TYPE'' Switch between nwp and climate type of simulation


== General paths ==

 * ''BINDIR'' is the path to executable directory. You can use this to point to binaries outside of your experiment.
 * ''WRK'' is the work directory. The suggested path on c1a is $TEMP/hm_home/${EXP}/$CYCLEDIR
 * ''ARCHIVE_ROOT'' is the path to forecast file archive. '''Note that at ECMWF this directory is not a permanent storage!'''
 * ''EXTRARCH'' is the path to field extraction archive. '''Note that at ECMWF this directory is not a permanent storage!'''

 === ECMWF settings ===
 Since $TEMP and $SCRATCH are cleaned regularly on c1a and ecgate all files are transferred to ECFS for a more permanent storage by the scripts [source:tags/harmonie-37h1.2/scr/Archive_c1a Archive_c1a] and [source:tags/harmonie-37h1.2/scr/Archive_ecgate Archive_ecgate]. 
 There are three parameters for this archiving:
 * ''ARCHIVE_ECMWF'' Archive to $ECFSLOC at ECMWF (__yes__|no)
 * ''ECFSLOC'' Archiving site at ECMWF-ECFS  (__ectmp__|ec)
 * ''ECFSGROUP'' Group in which to chgrp the ECMWF archive, (__hirald__|default)
 
 '''Note that files archived on ectmp will be lost after 90 days.''' If you wish your files to stay longer you should set ECFSLOC=ec.

== Build options ==

 * ''BUILD'' Switch for building your binaries (IFS and utilities) ( __yes__|no).

 There are currently two ways of building the code. The choice is done through the environment variable ''MAKEUP'' in the [source:tags/harmonie-37h1.2/config-sh/config.ecgate config file] for your particular system. The aladin style [http://www.cnrm.meteo.fr/gmapdoc/spip.php?page=recherche&recherche=gmkpack gmkpack] or the new more make like system [wiki:HarmonieSystemDocumentation/37h1.2/Build_with_makeup Makeup]. For makeup there are no explicit settings to be done in the experiment configuration. For gmkpack however there are some options.

 === gmkpack settings ===

 * ''REVISION'' is the revision ( or cycle ) number, has to be set even for the trunk!
 * ''BRANCH'' sets the rootpack branch
 * ''VERSION'' is the version of revision/branch to use
 * ''OPTION'' sets which gmkpack/arch/SYSTEM.HOST.OPTION file to use
 * ''PROGRAM'' is the main MODEL program to be compiled with gmkpack
 * ''OTHER_PROGRAMS'' are other optional programs to be compiled with gmkpack
 * ''BUILD_ROOTPACK'' Switch for building the rootpack when running HARMONIE install. Can be useful to turn off for debugging. (__yes__|no).

In the general config file for your system, like [source:tags/harmonie-37h1.2/config-sh/config.ecgate config.ecgate] the path to the rootpack of gmkpack is defined as ROOTPACK.

== Model domain settings ==

 * ''DOMAIN'' defines your domain according to the settings in [source:tags/harmonie-37h1.2/scr/harmonie_domains.pm harmonie_domains.pm]. For each domain we set variables related to the geometry and the resolution like:

 * ''TSTEP'' is model timestep in seconds
 * ''NLON'' is number of points in x-direction.
 * ''NLAT'' is number of points in y-direction.

''NLON'' and ''NLAT'' should satisfy the equation 5^b^ * 3^d^ * 2^e^, where a-e are integers >= 0.

 * ''EZONE'' is number of points over extension zone in both x- and y-direction. Default value 11. 
 * ''LONC'' is the longitude of domain centre in degrees.
 * ''LATC'' is the latitude of domain center in degrees.
 * ''LON0'' is the reference longitude of the projection in degrees.
 * ''LAT0'' is the reference latitude of the projection in degrees. __If ''LAT0'' is set to 90, the projection is '''polar stereographic'''. If ''LAT0'' < 90, the projection is '''lambert'''.___  
 * ''SINLAT0'' is sin(LAT0), this is meaningful only when running with SURFEX
 * ''GSIZE'' is grid size in meters in both x- and y-direction.

== Vertical levels ==

 * ''VLEV'' is the name of the vertical levels defined in [source:tags/harmonie-37h1.2/scr/Vertical_levels.pl Vertical_levels.pl]
    * 65 is the default level definition.

Note that '''VLEV''' is the name of the set of A/B coefficients defining your levels. There are e.g. more than one definition for 60 levels. To print the levels just run 

 {{{./Vertical_levels.pl }}}

To get e.g. the AHALF coefficients for a level definition run

 {{{ ./Vertical_levels.pl 65 AHALF }}}

If you intend to run upper air assimilation you need select the same domain and level definition for which you have derived structure functions for. [wiki:HarmonieSystemDocumentation/37h1.2/Structurefunctions Read more]


== Climate file settings ==

 * ''CLIMDIR'' is the path to the generated climate files for your specific domain. The input data for the climate generation is defined by HM_CLDATA defined in your system config file.
 * ''CREATE_CLIMATE'' Run climate generation (__yes__|no) If you already have a full set of climate files generated in CLIMDIR you can set this to no for a faster run.
 * ''ECOCLIMAP_VERSION'' is the version of ECOCLIMAP to be used with SURFEX (__1__|2). Version 2 is experimental and still under evaluation.

== High level forecast options ==

 === Physics ===
 * ''PHYSICS'' Main model physics flag (__arome__|alaro|aladin)
 * ''MASS_FLUX_SCHEME'' Version of EDMF scheme (__edmfm__|edkf). Only applicable if PHYSICS=arome
    * edkf is default AROME version
    * edmfm is the KNMI implementation of Eddy Diffusivity Mass Flux scheme for Meso-scale
 * ''SURFACE'' Surface physics flag (__surfex__|old_surface)
 * ''CISBA'' # Type of ISBA scheme in SURFEX. (__3-L__|2-L)
 * ''CROUGH'' # SSO scheme used in SURFEX. (__Z01D__|BE04)

 === Dynamics ===
 * ''DYNAMICS'' Hydrostatic or non-hydrostatic dynamics (__nh__|h)

 === Digital filter ===
 * ''DFI'' Digital filter initialization (__none__|idfi|fdfi)
    * idfi Incremental dfi
    * fdfi Full dfi
    * none No initialization
 * ''TAUS'' cut-off frequency in seconds 
 * ''TSPAN'' length of DFI run in seconds

== Boundaries and initial conditions ==

 * ''HOST_MODEL'' defines the host model (boundaries).
   * hir for HIRLAM.
   * ald for ALADIN 
   * ala for ALARO
   * aro for AROME
   * ifs for ECMWF-IFS. 
 * ''BDLIB'' is the experiment to be used as boundaries. Possible values, __ECMWF__ for IFS from MARS (default), __RCRa__ for HIRLAM-RCR from ECFS or other __HARMONIE experiment__. 
 * ''BDDIR'' is the boundary file directory. The possible date information in the path must be given by using UPPER CASE letters (@YYYY@=year,@MM@=month,@DD@=day,@HH@=hour,@FFF@=forecast length).  
 * ''BDSTRATEGY'' Which boundary strategy to follow i.e. How to find the right boundaries with the right age and location. [wiki:HarmonieSystemDocumentation/37h1.2/BoundaryFilePreparation#Boundarystrategies Read more]
 * ''BDINT'' is boundary interval in hours.
 * ''BD_METHOD'' (__gl_only__|old) how to interpolate boundaries. Old is not maintained and should be pruned.
 * ''BDCLIM'' is the path to climate files corresponding the boundary files, when nesting HARMONIE to HARMONIE.
 * ''INT_BDFILE'' is the name and location of the interpolated boundary files. These files are removed every cycle, but if you wish to save them you can specify a more permanent location here. By setting INT_BDFILE=$ARCHIVE the interpolated files will be stored in your archive directory.
 * ''INT_SINI_FILE'' is the name and location of the initial SURFEX file
 * ''HOST_SURFEX'' Set to yes if host model runs with SURFEX. (__no__|yes)
 * ''NBDMAX'' Number of parallel boundary interpolation tasks in mSMS. The current default value is 4.
 * ''SURFEX_PREP'' Use SURFEX tool PREP instead of gl+FULLPOS to prepare SURFEX initial conditions. This is still experimental (__no__|yes)

 Read more about boundary file preparation [wiki:HarmonieSystemDocumentation/37h1.2/BoundaryFilePreparation here].

== Assimilation ==

  More assimilation related settings can be found in [source:tags/harmonie-37h1.2/scr/include.ass include.ass ]

 * ''FCINT'' Assimilation cycle interval in hours. (__6__|3|1)
 * ''OBDIR'' Path to directory with BUFR data. At ECMWF this is where you data extracted from MARS will be stored.

 === General upper air assimilation ===

 * ''ANAATMO'' Atmospheric analysis (__3DVAR__|4DVAR|blending|none)
 * ''LSMIXBC'' Spectral mixing of LBC0 file before assimilation (__no__|yes)
 * ''JB_INTERPOL'' Interpolation of structure functions from a pre-defined domain to your domain (__no__|yes). Note that this has to be used with some caution.

 === 4DVAR settings ===

 * ''NOUTERLOOP'' Number of outer loops, need to be 1 at present
 * ''ILRES''  Resolution (in parts of full) of outer loops
 * ''TSTEP4D'' Timestep length (seconds) of outer loops TL+AD


 === Surface assimilation ===

 * ''ANASURF'' Surface analysis (__CANARI_OI_MAIN__|CANARI|CANARI_EKF_SURFEX|none)
 * ''SODA'' Use SODA instead of OI_MAIN for surface assimilation (__yes__|no)
 * ''SST''  Which SST fields to be used in surface analysis (___BOUNDARY___|none)
             * BOUNDARY  SST interpolated from the boundary file. ECMWF boundaries utilize a special method. HIRLAM and HARMONIE boundaries applies T0M which should be SST over sea.
 * ''ANASURF_MODE'' When surface analysis should be done with respect to ANAATMO (__before__|after|both). The latter is only applicable for 4DVAR

 * ''INCV'' Active EKF control variables. 1=WG2 2=WG1 3=TG2 4=TG1
 * ''INCO'' Active EKF observation types (Element 1=T2m, element 2=RH2m and elemt 3=Soil moisture)



 === Observation monitoring and general diagnostics ===

 ''OBSMONITOR'' Selection for observation statistics plots
    * obstat Daily usage maps and departures
    * obtime Observation usage timeseries
    * sabimon Satellite bias monitoring
    * plotlog IFS log statistics
       - Grid point and spectral norms evolution
       - CPU cost
       - Surface assimilation increments, if applicable
       - Cost function evolution, if applicable
       - Observation usage from the minimization, if applicable
    * no No monitoring

 '''Note that this is only active if ANAATMO != none'''

== Forecast output ==

The writeup times of model output can be defined as a space separated list or as a fixed frequency for model history files, surfex files and postprocessed files respectively. The unit of the steps of WRITUPTIMES, SWRITUPTIMES, PWRITUPTIMES and OUTINT should be in hours or minutes depending on the '''TFLAG''' Regular output interval can be switched on by setting OUTINT>0. Consequently, OUTINT will override the WRITUPTIMES lists!

 * ''TFLAG'' Time flag for model output. Hourly or minute-based output (__h__|min)
 * ''OUTINT'' Output interval in minutes. Used only if TFLAG="min".
 * ''SURFEXOUTPUT'' Sets the level of the content in the surfex output files (___large___|small|none). Note that to be able to run surface assimilation with surfex it has to be set to large.

 * ''WRITUPTIMES''  Output list for history files
 * ''SWRITUPTIMES''  Output list for history files

== Ensemble mode settings ==

 * ''ENSMSEL''  Ensemble member selection, comma separated list, and/or range(s):
    # m1,m2,m3-m4,m5-m6:step    mb-me == mb-me:1 == mb,mb+1,mb+2,...,me
    # 0=control. ENSMFIRST, ENSMLAST, ENSSIZE derived automatically from ENSMSEL.
 * ''ENSINIPERT'' Ensemble perturbation method (bnd). Not yet implemented: etkf, hmsv, slaf.
 * ''ENSMFAIL'' Failure tolerance for all members. Not yet implemented.
 * ''ENSMDAFAIL'' Failure tolerance for members doing own DA. Not yet implemented.
 * ''ENSCTL'' Which member is my control member? Needed for ENSINIPERT=bnd. See harmonie.pm.
 * ''ENSBDMBR'' Which host member is used for my boundaries? Use harmonie.pm to set.


== Postprocessing ==

 === Fullpos switches ===
 * ''POSTP'' is the switch for offline postprocessing by Fullpos (yes|__no__)
 * ''PWRITUPTIMES'' is the requested postprocessing times
 * ''PPTYPE'' Postprocessing type, space separated list
    * pp = pressure levels
    * md = model level diagnostics
    * zz = height levels
    * sat = satellite radiances (AROME)
 * ''INLINE_FULLPOS'' Inline postprocessing by Fullpos (no|yes). For setup of variables and frequency see scr/Setup_inline_postp, not that this is still under development.
 * ''FPOUTINT'' Regular (inline) fp output interval if > 0, not used if FPOUTINT <= 0.

More options on offline fullpos postprocessing can be found in [browser:trunk/harmonie/scr/Postpp Postpp]

More options on inline fullpos postprocessing can be found in [browser:trunk/harmonie/scr/Setup_inline_postp Setup_inline_postp]


 === GRIB switches ===

 * ''MAKEGRIB'' Conversion to GRIB (yes|__no__)

More options on file conversion can be found in [browser:trunk/harmonie/scr/Makegrib Makegrib]

== Verification and monitoring ==

 === Perparation for verification ===

 * ''OBSEXTR'' Extract observations for verification from BUFR (__yes__|no)
 * ''FLDEXTR'' Extract model data for verification from model files (__yes__|no)

 === Online verification ===

 * ''VERIFY'' Main switch for running verification during the epxeriment. (yes|__no__) (Experimental)
 * ''VERINT'' Verification interval in hours (01|03|06)
 * ''VER_SDATE'' Start verification date in format ($DTGBEG|YYYYMMDDHH)

Read more about the verification package [wiki:HarmonieSystemDocumentation/37h1.2/PostPP/Verification here]

 === Field verification ===
 * ''FLDVER'' Main switch for field verification (__yes__|no). The field verification extracts some selected variables for calculation of bias, rmse, stdv and averages on the model grid.
 * ''FLDVER_HOURS'' Hours for field verification

 More options on field verification can be found in [browser:trunk/harmonie/scr/Fldver Fldver] and [browser:trunk/harmonie/scr/AccuFldver AccuFldver]

 === Field monitoring ( experimental ) ===

Make various charts for daily monitoring

 * ''FIELDMONITOR'' Main switch (__no__|yes)
 * ''MAPBIN'' Path to plotting settings. Read more in [source:tags/harmonie-37h1.2/scr/Monitoring_maps]


[[Center(begin)]]
[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]
[[Center(end)]]
----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
