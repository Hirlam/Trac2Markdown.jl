[[PageOutline]]
[[Center(begin)]]
= '''File conversions''' =
[[Center(end)]]

= FA --> GRIB =

HIRLAM/HARMONIE users are more used to dealing with the GRIB data. The default HARMONIE output is in FA format. Users have the option to convert HARMONIE FA format files to GRIB. 

'''Please note:''' Use of gl related binaries in all scripts have been replaced by gl_grib_api. From now on ALL gl development should be done in gl_grib_api only. gl using gribex will be kept in the cy38h1 series but will be removed in future cycles

== sms/config_exp.h ==

The option to convert model output to GRIB can be selected in the [source:tags/harmonie-38h1.2/sms/config_exp.h] file:
{{{
# **** GRIB ****
MAKEGRIB=yes                            # Conversion to GRIB (yes|no)
}}}

== Details ==
By setting MAKEGRIB to ''yes'' the [wiki:HarmonieSystemDocumentation/38h1.2/PostPP/gl gl] tool will be called from the [source:tags/harmonie-38h1.2/scr/Makegrib Makegrib] script to convert HARMONIE output from FA to GRIB. 

Conversion of FA/lfi files to grib by gl:
{{{
    gl [-c] [-p] FILE [ -o OUTPUT_FILE ] [ -n NAMELIST_FILE ]

    gl -c FA/LFI-FILE -- converts the full field (including extension zone)
    gl -p FAFILE      -- excludes the extension zone ( "p" as in physical domain only) 
}}}

By default, '''Makegrib''' removes the biperiodic zone from FA files and creates GRIB files. HARMONIE data is produced on a Lambert projection. GRIB data can be interpolated onto different projections using gl_grib_api. Further information is available in the [source:tags/harmonie-38h1.2/util/gl_grib_api/README gl_grib_api README].

Forecast output is converted from FA to GRIB in [source:tags/harmonie-38h1.2/scr/Makegrib Makegrib] using the following command:
{{{
  $MPPGL $BINDIR/gl_grib_api -p $1 -o $2 -n namelist_makegrib${MG} || exit
}}}
where 
 * $1 is the input HARMONIE FA-file (ICSMHHARM+${ffff}, $ffff is the forecast minute/hour)
 * $2 is the output HARMONIE GRIB file (fc${DATE}${HH}+${FF}grib)
 * namelist_makegrib${MG} is 
{{{
&naminterp
outkey%date=$DATE,
outkey%time=${HH}00,
outkey%endstep=$FF,
time_unit=$time_unit
pppkey(1:3)%shortname = 'pres','tp','tpsolid',
pppkey(1:3)%levtype   = 'heightAboveSea','heightAboveGround','heightAboveGround'
pppkey(1:3)%level     =   0,  0,  0,
pppkey(1:3)%tri       =   0,  4,  4,
skipsurfex = .TRUE.,
fstart(15) = $fstart,
fstart(16) = $fstart,
fstart(162) = $fstart,
fstart(163) = $fstart,
}}}
In the namelist:
 * $DATE is the forecast date in the form YYYYMMDD
 * $HH is the forecast hour in the form HH
 * $time_unit is the units of time to be used min/h
 * pppkey: selection of requested post-processed products (See: [wiki:HarmonieSystemDocumentation/38h1.2/PostPP/gl Postprocessing with gl] for more details)
 * $fstart is the start hour for time-range products such as maximum temperature.

[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]

----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]