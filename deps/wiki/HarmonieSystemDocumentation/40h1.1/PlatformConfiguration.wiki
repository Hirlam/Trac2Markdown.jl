[[PageOutline]]
[[Center(begin)]]
= '''Harmonie System Documentation''' =
== '''Platform Configuration''' ==
[[Center(end)]]
== Overview ==
This wiki page outlines the configuration files required by HARMONIE for successful compilation and running of the systme.

== Basic requirements ==
All experiments require a valid host to "setup" an experiment using the Harmonie script. Recall from the [wiki:HarmonieSystemDocumentation/40h1.1/QuickStartLocal quick start] instructions that in order to setup a new experiment on your platform, called YOURHOST, using HARMONIE downloaded to PATH_TO_HARMONIE one must issue the following command:
{{{
cd hm_home/my_exp
PATH_TO_HARMONIE/config-sh/Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST
}}}
hm_home/my_exp contains:
{{{
Env_submit -> config-sh/submit.YOURHOST           ## YOURHOST platform specific settings
Env_system -> config-sh/config.YOURHOST           ## YOURHOST task submission settings
./config-sh/hm_rev                                ## contains PATH_TO_HARMONIE
./config-sh/Main                                  ## The script used to run HARMONIE
./config-sh/submit.YOURHOST                       ## YOURHOST platform specific settings
./config-sh/config.YOURHOST                       ## YOURHOST task submission settings
./msms/harmonie.pm                                ## mini-SMS perl module to define ensemble settings
./sms/config_exp.h                                ## your experiment definition (scientific type options)
./scr/include.ass                                 ## assimilation specific settings
}}}
But, what if your host configuration is not available in the HARMONIE system? Host specific configuration files in PATH_TO_HARMONIE/config-sh must be available for your host and configuration files for the compilation of the code must be available for Makeup and/or GMKPACK. This documentation attempts to describe what is required.
== Host config files ==
=== Env_system -> config-sh/config.YOURHOST ===
The config.YOURHOST file defines host specific variables such as some input directory locations. If your YOURHOST is not already included in HARMONIE it may be work looking at config.* files in [source:tags/harmonie-40h1.1/config-sh config-sh] to see what other people have done. The table below outlines variables set in config-sh/config-sh.YOURHOST and what the variables do:
||= Variable name       =||= Description                                                                                                                      =||
||COMPCENTRE             ||controls special ECMWF solutions (such as MARS) where required. Set to LOCAL if you are unsure                                      ||
||MAKEUP                 ||which compilation system to use. yes=>use Makeup. no=>use  GMKPACK                                                                  ||
||MAKEUP_BUILD_DIR       ||location of where Makeup compiles the HARMONIE code                                                                                 ||
||MAKEUP_BUILD_GRIB_API_FLAG ||if this is set to "-A" Makeup will compile GRIB-API source in util sub-directory                                                ||
||HARMONIE_CONFIG        ||defines the config file used by Makeup compilation                                                                                  ||
||MAKE_OWN_PRECOMPILED   ||yes=>install pre-compiled code in $PRECOMPILED                                                                                      ||
||PRECOMPILED            ||location of (optional) pre-compiled HARMONIE code                                                                                   ||
||ROOTPACK               ||location of rootpack is GMKPACK is used                                                                                             ||
||GMKROOT                ||location of GMKPACK code                                                                                                            ||
||GMKFILE                ||GMKPACK config file to used by GMKPACK                                                                                              ||
||GMKTMP                 || ????                                                                                                                               ||
||HM_CLDATA              ||location of climatology databases (GTOPO, PGD, ...) See [wiki:HarmonieSystemDocumentation#Downloadinputdata input data] section     ||
||GMTED2010_INPUT_PATH   ||location of GMTED tiff files. See [wiki:HarmonieSystemDocumentation/40h1.1/How_to_use_hires_topography hi-res topography] section          ||
||HM_SAT_CONST           ||location of satellite constanyt files read by HARMONIE code                                                                         ||
||JBDIR                  ||location of background error statistics. See [wiki:HarmonieSystemDocumentation/40h1.1/Structurefunctions_ensys Structure functions section ||
||PERL_TK                ||location of perl                                                                                                                    ||
||PERLTKDIR              || ????                                                                                                                               ||
||RSYNC_EXCLUDE          ||used to exclude .svn sub-directories from copy of source code for compilation                                                       ||
||DR_HOOK_IGNORE_SIGNALS ||environment variable used by Dr Hook to ignore certain "signals"                                                                    ||
||HOST0                  ||define host name                                                                                                                    ||
||HOST_INSTALL           ||0=> install on HOST0                                                                                                                ||
||SMSHOST                ||host that mini-SMS runs on                                                                                                          ||
||HM_COMDAT              ||location of common code modifications                                                                                               ||
||MAKE                   ||make command may need to be explicity defined. Set to make for most platforms                                                       ||
||MKDIR                  ||mkdir command (default: mkdir -p)                                                                                                   ||
||SMSMETER               ||${SMSMETER-$HM_LIB/msms/smsmeter}                                                                                                   ||
||CDP                    ||${CDP-$HM_LIB/msms/sms_cdp}                                                                                                         ||
||JOBOUTDIR              ||where mini-SMS writs its log files (default: $HM_DATA/sms_logfiles                                                                  ||
||SMSTASKMAX             ||set the maximum number of tasks that mini-SMS can launch on your platform                                                           ||
||GRIB_DEFINITION_PATH   ||location of "local" GRIB-API definition files                                                                                       ||
|| .....                 || ..... may be more info to come ....                                                                                                ||
=== Env_submit -> config-sh/submit.YOURHOST ===
The Env_submit file uses perl to tell the HARMONIE scheduler how to execute programs - which programs should be run on multiple processors and define batch submissions if required.
||= perl                =||= description                                                                                                                       ||
||%backg_job             ||defines variables for jobs run in the background on HOST0                                                                           ||
||%scalar_job            ||defines variables for single processor batch jobs                                                                                   ||
||%par_job               ||defines variables for multi-processor batch jobs                                                                                    ||
||@backg_list            ||list of tasks to be submitted as a background job                                                                                   ||
||@scalar_list           ||list of tasks to be submitted as a scalar job                                                                                       ||
||@par_list              ||list of tasks to be submitted as parallel job                                                                                       ||
||default                ||"wildcard" task name to defined default type of job for unlisted tasks                                                              ||

=== Host summary ===
||= YOURHOST            =||= Host type                   =||= batch     =||= Contact            =||
||KNMI-Altix             ||KNMI SGI HPC                   ||none         ||                      ||
||LinuxPC                ||General Linux PC no MPI        ||none         ||                      ||
||LinuxPC-MPI            ||General Linux PC with MPI      ||none         ||                      ||
||LinuxPC-MPI-ubuntu     ||Ubuntu Linux PC with MPI       ||none         ||                      ||
||METIE.LinuxPC          ||METIE CentOS 6 PC with MPI     ||none         ||Eoin Whelan           ||
||METIE.LinuxRH7gnu      ||METIE Redhat 7 server with MPI ||none         ||Eoin Whelan           ||
||METIE.fionn            ||METIE SGI HPC                  ||PBS          ||Eoin Whelan           ||
||SMHI.Linda4            ||SMHI ???                       ||             ||                      ||
||SMHI.LinuxPC           ||SMHI PC                        ||             ||                      ||
||bi                     ||                               ||             ||                      ||
||blade12                ||                               ||             ||                      ||
||blade12-wfma           ||                               ||             ||                      ||
||byvind                 ||                               ||             ||                      ||
||crayx1                 ||                               ||             ||                      ||
||crayxt5m               ||                               ||             ||                      ||
||ecgb                   ||                               ||             ||                      ||
||ecgb-cca               ||ECMWF HPC with MPI dual host   ||slurm/PBS    ||                      ||
||fmisms                 ||                               ||             ||                      ||
||jumbo                  ||                               ||             ||                      ||
||krypton                ||                               ||             ||                      ||
||odin                   ||                               ||             ||                      ||
||uv2                    ||                               ||             ||                      ||
||vilje                  ||                               ||             ||                      ||
||xt5intel               ||                               ||             ||                      ||
||xtpathscale            ||                               ||             ||                      ||

== Compilation config files ==
=== Makeup ===
config files required for compilation of code using Makeup ...

More information on Makeup is available here: [wiki:HarmonieSystemDocumentation/40h1.1/Build_with_makeup Build with Makeup]
=== GMKPACK ===
config files required for compilation of code using GMKPACK ...

More information on GMKPACK is available here: [wiki:HarmonieSystemDocumentation/40h1.1/Installation Build with GMKPACK]
----

[[Disclaimer]]

[[Center(begin)]]
[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]