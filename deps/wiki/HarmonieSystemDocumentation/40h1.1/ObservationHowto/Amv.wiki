[[PageOutline]]

= Atmospheric Motion Vectors (AMV) =

== Introduction ==

== AMV data ==
AMV data is available via EUMETCast, the MARS archive at ECMWF or locally using NWCSAF software. All data are in BUFR format. An abstract from the 5th Winds Workshop on the quality control of EUMETSAT wind products ([https://hirlam.org/trac/raw-attachment/wiki/HarmonieSystemDocumentation/ObservationHowto/Amv/S2-3_Elliott-Parallel.pdf S2-3_Elliott-Parallel.pdf]) provides some useful information on how AMV BUFR is encoded.
== HARMONIE changes ==
=== scr/include.ass ===
In scr/include.ass should be edited to "swtich on" the use of AMVs (SATOB/geowinds):
{{{
export AMV_OBS=1               # Satob geowind
}}}

=== param.cfg ===
The BUFR template used by your AMV data should be defined in the param.cfg file used by Bator. param.cfg files for Bator are in the [source:/trunk/harmonie/nam nam] namelist directory. The geowind param.cfg template should be something like this:
{{{
BEGIN geowind
A 0 4 18
codage       1  aaaaaa
  :          :    :
codage       A  aaaaaa
offset       1      24  offset for QI_3 (eumetsat & tokyo)
offset       2      28  offset for QI_1 (NOAA)
offset       3      14  offset for QI_2 (NOAA)
offset       4      48  offset for QI_2 (eumetsat & tokyo)
values       1  001007  SATELLITE IDENTIFIER
values       2  001031  IDENTIFICATION OF ORIGINATING/GENERATING CENTRE (SEE NOTE 10)
values       4  002221  SEGMENT SIZE AT NADIR IN X DIRECTION
values       5  002222  SEGMENT SIZE AT NADIR IN Y DIRECTION
values       6  004001  YEAR
values      12  005001  LATITUDE (HIGH ACCURACY)
values      13  006001  LONGITUDE (HIGH ACCURACY)
values      14  002252  SATELLITE INSTRUMENT DATA USED IN PROCESSING
values      15  002023  SATELLITE DERIVED WIND COMPUTATION METHOD
values      16  007004  PRESSURE
values      17  011001  WIND DIRECTION
values      18  011002  WIND SPEED
values      21  012193  COLDEST CLUSTER TEMPERATURE
values      22  002231  HEIGHT ASSIGNMENT METHOD
values      23  002232  TRACER CORRELATION METHOD
values      24  008012  LAND/SEA QUALIFIER
values      25  007024  SATELLITE ZENITH ANGLE
values     211  033007  % CONFIDENCE
END geowind
}}}

=== BATOR namelist ===
Depending on the satellite and channel you may have to add entries to the NADIRS namelist in the Bator script like the following:
{{{
   TS_GEOWIND(isatid)%T_SELECT%LCANAL(ichanal)=.TRUE.,
}}}
 * Satellite identifiers are available here: [http://data-portal.ecmwf.int/odbgov http://data-portal.ecmwf.int/odbgov]
 * Bator defaults for MSG AMV data are set in [source:tags/harmonie-40h1.1/src/odb/pandor/module/bator_init_mod.F90#L648 src/odb/pandor/module/bator_init_mod.F90]
== Source code ==
The reading and processing of AMV is taken care of by the geowind subroutine in [source:tags/harmonie-40h1.1/src/odb/pandor/module/bator_decodbufr_mod.F90 src/odb/pandor/module/bator_decodbufr_mod.F90]. This subroutine reads the following parameters defined in the param.cfg file:
||= Name            =||= Description =||
|| Date and time     || derived from the tconfig(004001) - assumes month, day, hour and minute are in consecutive entries in the values array ||
|| Location          || latitude and longitude are read from tconfig(005001) and tconfig(006001)                                              ||
|| Satellite         || the satellite identifier is read from tconfig(001007) and the wind computation method is read from tconfig(002023)    ||
|| Height (pressure) || the height of the AMV observation is read from tconfig(007004)                                                        ||
|| Wind              || the wind speed and direction  are read from tconfig(011002) and tconfig(011001)                                       ||
|| '''More'''        || '''to follow ...''' ||



