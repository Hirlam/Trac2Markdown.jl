[[PageOutline]]

[[Center(begin)]]
== '''Harmonie System Documentation''' ==
= '''General requirements''' =
[[Center(end)]]


=== Get the Harmonie source ===

To obtain the HARMONIE source, assuming the computer platform has svn client available, one may check out from the repository at the host hirlam.org:
{{{
        svn export https://svn.hirlam.org/tags/harmonie-35h1                # for the recently tagged (stable-) HARMONIE system
        svn export https://svn.hirlam.org/trunk/harmonie                    # for the latest updated (unstable-) version
}}}
For Harmonie build using miniSMS script, it suffices that you have access to the HARMONIE system source. On ECMWF HPCE, on which svn client is not available, the HARMONIE sources are available under sub-directories of 
{{{
 ecgate:/home/ms/dk/nhz/harmonie_release/35h1    # on ecgate
   hpce:/ms_perm/hirlam/harmonie_release/35h1    # on hpce
}}}
One may also get a HARMONIE source code tarball, e.g., from ECMWF computer, 
{{{
        ecgate:    /scratch/ms/dk/nhz/harmonie-35h1.tar.gz        # for the recently tagged (stable-) HARMONIE system
        ecfs:      ec:/hirlam/src/tar/harmonie-35h1.tar.gz
        ecgate:    /scratch/ms/dk/nhz/harmonie_trunk.tar.gz       # for the (unstable-) version updated daily
}}}

=== Compiler version ===

If you are using the [http://gcc.gnu.org/ GNU compiler system], make sure you have gfortran 4.3 or higher. You can find a binary for a 32 bit Intel Linux system at [http://quatramaran.ens.fr/~coudert/gfortran/gfortran-i686-linux.tar.bz2]. The installation instructions are at [http://gcc.gnu.org/wiki/GFortranBinaries32Linux].


=== BLAS and LAPACK libraries ===

You need [http://netlib.org/ BLAS and LAPACK-lite] libraries.

If they are already on your system, verify they have been made with the correct compiler, or rebuild them.

First build BLAS (untarring blas.tgz places it in the BLAS directory). Go to that directory, and edit make.inc to set the compiler and linker to 'gfortran'. Then type 'make'.

Subsequenty, for LAPACK, after untarring lapack-lite-3.1.1.tgz, go to the lapack-lite-3.1.1 directory.

Copy make.inc.example to make.inc.
Edit make.inc to point to the proper compiler/loader (gfortran) and to put the variable PLAT to the empty string. Set TIMER to INT_ETIME.

Copy the blas.a library from the BLAS directory to the lapack-lite-3.1.1 directory, run ranlib on it, then type 'make'.

Then put the libraries in $HOME/auxlibs with names libblas.a and liblapack.a, respectively, else the default configuration will not find them. Run ranlib on them.

=== Auxiliary libraries ===
Next you need some auxiliary libraries, provided by ECMWF and Meteo France. The libraries contain GRIB and BUFR software as well as dummies for routines available only at ECMWF. They can be found on ECFS at ECMWF under:
{{{
ecfs :/rme/hirald/install/auxlibs_installer.1.3.tar.gz
}}}


They will untar in the directory auxlibs_installer.1.3. There you'll find the following directories:
 * bufr_000350
 * dummies_001
 * eclite_001
 * gribex_000350
 * rgb_001

In each of these directories, run the script ./build_library.  You'll have to answer the following
questions:

 * Which compiler to use
 * Whether you want 64 bit reals (yes)
 * Where to store the library on completion of the build (choose a subdirectory of your home directory
   where you have write permission - note: full path; e.g. the GFORTRAN.LINUX configuration assumes these
   libraries are in $HOME/auxlibs and include files in $HOME/auxinclude)

After build_library finishes, run ./install - this will put the library in the directory you've chosen above.

=== Perl requirements ===
To be able to launch the mSMS mXdcp window you need to have perl toolkit installed. Define PERL_TK and PERLTKDIR in your system config file, read more below.


=== Preparation of source codes for HARMONIE system on ecgate ===

 * Make sure you belong to the hirald group at ECMWF platform. Write to Claude Fisher at Meteo France (for ALADIN users) and Xiaohua Yang (for HIRLAM users) requesting it if you do not.
 * Due to limitation of the ECMWF HPCF currently preparation and compilation of the HARMONIE-related software need to be done using ecgate and HPCE platforms, separately. For retrieving of the HARMONIE source code/updates (from https://svn.hirlam.org) using Subversion (svn) command, it needs to be done at ecgate platform. The compilation and experiment submission are then done at HPCE platform. 
   * Log in to ecgate platform. Subversion is installed at ecgate but you have to edit the server configuration file for subversion to be able to access hirlam.org. 
{{{  
Change in $HOME/.subversion/servers
from
# http-proxy-exceptions = *.exception.com, www.internal-site.org
to
  http-proxy-exceptions = *.ecmwf.int, localhost
  http-proxy-host = www-gw.ecmwf.int
  http-proxy-port = 3333
}}}
   * If $HOME/.subversion/servers does not exist, use the copy of ''servers'' attached to this page.
   * All subversion commands has to be done on ECGATE, even if you install the code on HPCE.


[[Center(begin)]]
[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]
[[Center(end)]]
----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
