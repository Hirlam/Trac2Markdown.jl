[[PageOutline]]

[[Center(begin)]]
== '''Harmonie System Documentation''' ==
= '''Running Harmonie under (m)SMS''' =
[[Center(end)]]

== Introduction ==

Mini SMS is a job scheduler used to control your experiments. A detailed description about mSMS can be found 
[wiki:HirlamSystemDocumentation#ReferenceScripts here]. This documentation describes how to get started with your first experiment. The description follows the setup at ECMWF, but your local system setup would be very similar but simple. The main complication is the dual host setup at ECMWF.

== Build HARMONIE from the HARMONIE repository ==

If this is the first time you install HARMONIE on your local platform please take a look at the basic install [wiki:HarmonieSystemDocumentation/35h1/Installation instructions].


== Preparations ==

=== Configure and launch Harmonie experiments from ECMWF-ecgate ===

The reference Harmonie system on ECMWF platform assumes dual-hosts setup, resembling now more the traditional settings for the synoptic Hirlam using mini-SMS. By default, the mSMS script uses the front-end ecgate to configure and launch experiments, whereas HPCE is used for all computations except those for operations related to observation verification and monitoring. 

Following example shows the steps to launch an Harmonie experiment my_exp on ECMWF platform:

 1. Create an experiment directory under $HOME/hm_home and run the setup
{{{
   mkdir -p $HOME/hm_home/my_exp; cd $HOME/hm_home/my_exp
   PATH_TO_HARMONIE/config-sh/Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST   
}}}

 1. Edit basic configuration files such as [source:tags/harmonie-35h1/config-sh/config.ecgate Env_system -> config-sh/config.YOURHOST] and [source:tags/harmonie-35h1/sms/config_exp.h sms/config_exp.h] to configure your experiment scenarios. Modify specifications for model versions (ALADIN, AROME, ALARO), data locations, settings for dynamics, physics, domain, coupling host model etc. If applicable, put your local source or script changes, which are different but consistent with the reference version as installed in the ROOTPACK, into the current $HOME/hm_home/my_exp directory, with exactly the same subdirectory structure as in the reference. e.g, if you want to modify a subroutine 

{{{
   PATH_TO_HARMONIE/config-sh/Harmonie co scr/RunCanari         # retrieve default script RunCanari
   vi scr/RunCanari                                             # modify the script
}}}

 2. Launch the experiment
{{{
      PATH_TO_HARMONIE/config-sh/Harmonie start DTG=YYYYMMDDHH DTGEND=YYYYMMDDHH
                                    # e.g., ~nhz/Harmonie start DTG=2008030500 DTGEND=2008030506 LL=12
}}}

If successful, mSMS will identify your experiment name, launch mXcdp and start build and run. If not, you need to examine the mSMS log file $HM_DATA/mSMS.log. $HM_DATA is defined in your Env_system file


=== Directory structure ===

On ecgate, you can follow the progress of the runs on $SCRATCH/hm_home/my_exp. More complete results data are available on HPCE:$TEMP
under $HM_DATA: $TEMP/hm_home/my_exp. Under this directory you will find:

   * All binaries under '''bin'''
   * IFS libraries, object files and source code under '''gmkpack_build'''
   * Scripts, config files, sms and msms definitions under '''lib/'''
   * Utilities such as gmkpack, gl and verification under '''lib/util'''
   * Climate files under '''climate'''
   * Archived files under '''archive'''
       * A '''YYYY/MM/DD/HH''' structure for per cycle data
       * verification input data under '''extract'''
   * Working directory for the current cycle under '''YYYYMMDD_HH'''
   * Verification working directory on '''ecgate:$SCRATCH/hm_home/$EXP/lib/util/monitor'''
   * Log files under my_exp. All logfiles are also archived in archive.

=== Performing model inter-comparison using Harmonie verification tools ===

For comparison between HIRLAM and HARMONIE experiments it is now possible to extract verification files from your HIRLAM experiment
[source:trunk/hirlam/scripts/VER_create_fld VER_create_fld]. Read more on how to use the 
[wiki:HarmonieSystemDocumentation/35h1/PostPP/Verification verification].

== Running HARMONIE under full SMS ==

FMI is running HARMONIE using the full SMS system. The SMS playfile produced from the mSMS tdf-file by running the --prepare setup of mini-SMS. The created def-file can then be used in full SMS.


[[Center(begin)]]
[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]
[[Center(end)]]
----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]