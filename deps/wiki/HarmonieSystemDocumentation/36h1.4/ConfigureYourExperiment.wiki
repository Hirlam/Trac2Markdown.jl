[[PageOutline]]
[[Center(begin)]]
= '''Harmonie System Documentation''' =
== ''' Experiment configuration''' ==
[[Center(end)]]

== Introduction ==
There are several levels on configuration available in HARMONIE. The highest level of configuration is done in [source/trunk/harmonie/sms/config_exp.h config_exp.h]. It includes the environment variables, which are used to control the experimentation. In the following we describe the meaning of the different variables.

== General paths ==

 * ''BINDIR'' is the path to executable directory.
 * ''WRK'' is the work directory. The suggested path at hpce is $TEMP/hm_home/${EXP}/$CYCLEDIR
 * ''ARCHIVE'' is the path to forecast file archive. '''Note that at ECMWF this directory is not a permanent storage!'''
 * ''EXTRARCH'' is the path to field extraction archive. '''Note that at ECMWF this directory is not a permanent storage!'''

 === ECMWF settings ===
 At ECMWF all files are transferred to ECFS by the script [browser:trunk/harmonie/scr/Archive_ECMWF Archive_ECMWF]. 
 There are three parameters for this archiving:
 * ''ARCHIVE_ECMWF'' Archive to $ECFSLOC at ECMWF (__yes__|no)
 * ''ECFSLOC'' Archiving site at ECMWF-ECFS  (__ectmp__|ec)
 * ''ECFSGROUP'' Group in which to chgrp the ECMWF archive, (__hirald__|default)
 
 '''Note that files archived on ectmp will be lost after 90 days!'''

== Build options ==

 * ''BUILD'' Switch for building your binaries (IFS and utilities) ( __yes__|no).

 There are currently two ways of building the code. The aladin style [http://www.cnrm.meteo.fr/gmapdoc/spip.php?page=recherche&recherche=gmkpack gmkpack] or the new more make like system [wiki:Build_with_makeup Makeup]. For makeup there are no explicit settings to be done in the experiment configuration. For gmkpack however there are some options.

 === gmkpack settings ===

 * ''REVISION'' is the revision ( or cycle ) number, has to be set even for the trunk!
 * ''BRANCH'' sets the rootpack branch
 * ''VERSION'' is the version of revision/branch to use
 * ''OPTION'' sets which gmkpack/arch/SYSTEM.HOST.OPTION file to use
 * ''PROGRAM'' is the main MODEL program to be compiled with gmkpack
 * ''OTHER_PROGRAMS'' are other optional programs to be compiled with gmkpack
 * ''BUILD_ROOTPACK'' Switch for building the rootpack when running HARMONIE install. Can be useful to turn off for debugging. (__yes__|no).


== Model domain settings ==

Several domains are predefined in config_exp.h. For each domain we set variables related to the geometry and the resolution.

 * ''TSTEP'' is model timestep in seconds
 * ''NLON'' is number of points in x-direction.
 * ''NLAT'' is number of points in y-direction.

''NLON'' and ''NLAT'' should satisfy the equation 5^b^ * 3^d^ * 2^e^,
where a-e are integers >= 0.

 * ''EZONE'' is number of points over extension zone in both x- and y-direction. Default value 11. 
 * ''LONC'' is the longitude of domain centre in degrees.
 * ''LATC'' is the latitude of domain center in degrees.
 * ''LON0'' is the reference longitude of the projection in degrees.
 * ''LAT0'' is the reference latitude of the projection in degrees. __If ''LAT0'' is set to 90, the projection is '''polar stereographic'''. If ''LAT0'' < 90, the projection is '''lambert'''.___  
 * ''SINLAT0'' is sin(LAT0), this is meaningful only when running with SURFEX
 * ''GSIZE'' is grid size in meters in both x- and y-direction.

== Vertical levels ==

 * ''VLEV'' is the name of the vertical levels defined in [browser:trunk/harmonie/scr/Vertical_levels.pl Vertical_levels.pl]
    * 65 is the default level definition.

Note that '''VLEV''' is the name of the set of A/B coefficients defining your levels. There are e.g. more than one definition for 60 levels. To print the levels just run 

 {{{./Vertical_levels.pl }}}

To get e.g. the AHALF coefficients for a level definition run

 {{{ ./Vertical_levels.pl 65 AHALF }}}

If you intend to run upper air assimilation you need select the same domain and level definition for which you have derived structure functions for. [wiki:HarmonieSystemDocumentation/36h1.4/Structurefunctions Read more]



== Climate file settings ==

 * ''CLIMDIR'' is the path to climate files. The input data for the climate generation is defined by HM_CLDATA defined in your system config file.
 * ''CREATE_CLIMATE'' Run climate generation (__yes__|no) If you already have a full set of climate files generated in CLIMDIR you can set this to no.

 * ''SPSMORO'' High order spectral smoothing for orography (yes|__no__). Not that running with SPSMORO requires a linear grid.


== High level forecast options ==

 === Physics ===
 * ''PHYSICS'' Main model physics flag (__arome__|alaro|aladin)
 * ''SURFACE'' Surface physics flag (__surfex__|old_surface)
 * ''MASS_FLUX_SCHEME'' Version of EDMF scheme (__edmfm__|edkf). Only applicable if PHYSICS=arome
    * edkf is default AROME version
    * edmfm is the KNMI implementation of Eddy Diffusivity Mass Flux scheme for Meso-scale

 === Dynamics ===
 * ''DYNAMICS'' Hydrostatic or non-hydrostatic dynamics (__nh__|h)

 === Digital filter ===
 * ''DFI'' Digital filter initialization (__none__|idfi|fdfi)
    * idfi Incremental dfi
    * fdfi Full dfi
    * none No initialization
 * ''TAUS'' cut-off frequency in seconds 
 * ''TSPAN'' length of DFI run in seconds

== Boundaries ==

 * ''HOST_MODEL'' defines the host model (boundaries).
   * hir for HIRLAM.
   * ald for ALADIN 
   * ala for ALARO
   * aro for AROME
   * ifs for ECMWF-IFS. 
 * ''BDLIB'' is the experiment to be used as boundaries. Possible values, __ECMWF__ for IFS from MARS (default), __RCRa__ for HIRLAM-RCR from ECFS or other __HARMONIE experiment__. 
 * ''BDDIR'' is the boundary file directory. The possible date information in the path must be given by using UPPER CASE letters (@YYYY@=year,@MM@=month,@DD@=day,@HH@=hour,@FFF@=forecast length).  
 * ''BDSTRATEGY'' Which boundary strategy to follow [wiki:HarmonieSystemDocumentation#Boundarystrategies Read more]
 * ''BDINT'' is boundary interval in hours.
 * ''BD_METHOD'' (__gl_only__|old)
 * ''BDCLIM'' is the path to climate files corresponding the boundary files, when nesting HARMONIE to HARMONIE.
 * ''INT_BDFILE'' is the name and location of the interpolated boundary files
 * ''INT_SINI_FILE'' is the name and location of the initial SURFEX file

 Read more about boundary file preparation [wiki:HarmoniesystemDocumentation/BoundaryFilePreparation here].

== Assimilation ==

 * ''ANAATMO'' Atmospheric analysis (__3DVAR__|4DVAR|blending|none)
 * ''ANASURF'' Surface analysis (__CANARI_OI_MAIN__|CANARI|CANARI_EKF_SURFEX|none)
 * ''SST''  Which SST fields to be used in surface analysis (___BOUNDARY___|none)
             * BOUNDARY  SST interpolated from the boundary file. ECMWF boundaries utilize a special method. HIRLAM and HARMONIE boundaries applies T0M which should be SST over sea.
 * ''LSMIXBC'' Spectral mixing of LBC0 file before assimilation (__no__|yes)
 * ''ANASURF_MODE'' When surface analysis should be done with respect to ANAATMO (__before__|after|both). The latter is only applicable for 4DVAR
 * ''FCINT'' Assimilation cycle interval in hours. Default is 6h.
 * ''OBDIR'' Path to directory with BUFR data. At ECMWF this is where you data extracted from MARS will be stored.

 More assimilation settings can be found in [browser:trunk/harmonie/scr/include.ass include.ass ]

 === 4DVAR settings ===

 * ''NOUTERLOOP'' Number of outer loops, need to be 1 at present
 * ''ILRES''  Resolution (in parts of full) of outer loops
 * ''TSTEP4D'' Timestep length (seconds) of outer loops TL+AD

 === Observation monitoring ===
 ''OBSMONITOR'' Selection for observation statistics plots
    * obstat Daily usage maps and departures
    * obtime Observation usage timeseries
    
 '''Note that this is only active if ANAATMO != none'''

== Forecast output ==

The writeup times of model output can be defined as aspace separated list or as a fixed frequency for model history files, surfex files and postprocessed files respectively. The unit of the steps of WRITUPTIMES, SWRITUPTIMES, PWRITUPTIMES and OUTINT should be in hours or minutes depending on the '''TFLAG''' Regular output interval can be switched on by setting OUTINT>0. Consequently, OUTINT will override the WRITUPTIMES lists!

 * ''TFLAG'' Time flag for model output. Hourly or minute-based output (__h__|min)
 * ''OUTINT'' Output interval in minutes. Used only if TFLAG="min".
 * ''SURFEXOUTPUT'' Sets the level of the content in the surfex output files (___large___|small|none). Note that to be able to run surface assimilation with surfex it has to be set to large.

 * ''WRITUPTIMES''  Output list for history files
 * ''SWRITUPTIMES''  Output list for history files


== Postprocessing ==

 * ''OPERATIONAL_POSTP'' Chose to do post processing and/or file conversions directly as the forecast files are written or in the general postprocessing step. The former is important in an operational environment where you are interested to get the files as quickly as possible. 

 === Fullpos switches ===
 * ''POSTP'' is the switch for postprocessing by Fullpos (yes|__no__)
 * ''PWRITUPTIMES'' is the requested postprocessing times
 * ''PPTYPE'' Postprocessing type, space separated list
    * pp = pressure levels
    * md = model level diagnostics
    * zz = height levels
    * sat = satellite radiances (AROME)
 
More options on fullpos postprocessing can be found in [browser:trunk/harmonie/scr/Postpp Postpp]

 === GRIB switches ===

 * ''MAKEGRIB'' Conversion to GRIB (yes|__no__)
 * ''TOGRIB'' GRIB file types to be converted, space separated list
   * his = history (+ surfex) files
   * pp = pressure levels
   * md = model level diagnostics
   * zz = height levels

More options on file conversion can be found in [browser:trunk/harmonie/scr/Makegrib Makegrib]

== Verification ==

 === Perparation for verification ===
 * ''OBSEXTR'' Extract observations from BUFR (__yes__|no)
 * ''FLDEXTR'' Extract model data for verification from model files (__yes__|no)
 * ''USE_STNLIST'' Use predefined station list or use what is in the BUFR files (__yes__|no) If set to no the corresponding observation file has to be available

 === Online verification ===

 * ''VERIFY'' Main switch for running verification during the epxeriment. (yes|__no__) (Exerperimental)
 * ''VERINT'' Verification interval in hours (01|03|06)
 * ''VER_SDATE'' Start verification date in format ($DTGBEG|YYYYMMDDHH)

 === Field verification ===
 * ''FLDVER'' Main switch for field verification (__yes__|no). The field verification extracts some selected variables for calculation of bias, rmse, stdv and averages on the model grid.
 * ''FLDVER_HOURS'' Hours for field verification

 More options on field verification can be found in [browser:trunk/harmonie/scr/Fldver Fldver] and [browser:trunk/harmonie/scr/AccuFldver AccuFldver]

[[Center(begin)]]
[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]
[[Center(end)]]
----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
