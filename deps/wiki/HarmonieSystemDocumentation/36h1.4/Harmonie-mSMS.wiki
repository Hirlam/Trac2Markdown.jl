[[PageOutline]]

[[Center(begin)]]
== '''Harmonie System Documentation''' ==
= '''Running Harmonie under (m)SMS''' =
[[Center(end)]]

== Introduction ==

Mini SMS is a job scheduler used to control your experiments. A detailed description about mSMS can be found 
[wiki:HirlamSystemDocumentation#ReferenceScripts here]. This documentation describes how to get started with your first experiment. The description follows the setup at ECMWF, but your local system setup would be very similar but most likely simpler. The main complication is the dual host setup at ECMWF. Some links to local system setup tutorials:

* [wiki:HarmonieSystemDocumentation/36h1.4/Harmonie-local-njord met.no]

== Build HARMONIE from the HARMONIE repository ==

If this is the first time you install HARMONIE on your local platform please take a look at the basic install [wiki:HarmonieSystemDocumentation/36h1.4/Installation instructions].


== Preparations ==

=== Configure and launch Harmonie experiments from ECMWF-ecgate ===

The reference Harmonie system on ECMWF platform assumes dual-hosts setup, resembling now more the traditional settings for the synoptic Hirlam using mini-SMS. By default, the mSMS script uses the front-end ecgate to configure and launch experiments, whereas c1a is used for all computations except those for operations related to observation verification and monitoring. 

Following example shows the steps to launch an Harmonie experiment my_exp on ECMWF platform:

 1. Create an experiment directory under $HOME/hm_home and run the setup

{{{
   mkdir -p $HOME/hm_home/my_exp
   cd $HOME/hm_home/my_exp
   PATH_TO_HARMONIE/config-sh/Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST   
}}}

 This would give you the default setup which currently is ALADIN physics with CANARI surface assimilation and 3DVAR upper air assimilations on a domain covering Scandinavia using 10km horisontal resolution.

 2. Edit basic configuration files such as [source:tags/harmonie-36h1.4/config-sh/config.ecgate Env_system] and [source:tags/harmonie-36h1.4/sms/config_exp.h sms/config_exp.h] to configure your experiment scenarios. Modify specifications for model versions (ALADIN, AROME, ALARO), data locations, settings for dynamics, physics, domain, coupling host model etc. You can also use some of the predefined configurations by calling

{{{
   PATH_TO_HARMONIE/config-sh/Harmonie setup -r PATH_TO_HARMONIE -h YOURHOST -c CONFIG 
}}}

 where {{{CONFIG}}} is one of the setups defined in [source:tags/harmonie-36h1.4/scr/Harmonie_testbed.pl Harmonie_testbed.pl]. If you give {{{-c}}} with out an argument or a non existing configuration a list of configurations will be printed.

 If applicable, put your local source or script changes, which are different but consistent with the reference version as installed in the ROOTPACK, into the current $HOME/hm_home/my_exp directory, with exactly the same subdirectory structure as in the reference. e.g, if you want to modify a subroutine 

{{{
   PATH_TO_HARMONIE/config-sh/Harmonie co scr/RunCanari         # retrieve default script RunCanari
   vi scr/RunCanari                                             # modify the script
}}}

 3. Launch the experiment by giving start time, DTG, end time, DTGEND, and forecast length, LL

{{{
      PATH_TO_HARMONIE/config-sh/Harmonie start DTG=YYYYMMDDHH DTGEND=YYYYMMDDHH LL=12
                                    # e.g., ~nhz/Harmonie start DTG=2008030500 DTGEND=2008030506 LL=12
}}}

 Would you like to only run long forecasts at 00/12 UTC and short (6h) at 06/18 you specify the longer forecast length as LLMAIN. 

{{{
      PATH_TO_HARMONIE/config-sh/Harmonie start DTG=2010123100 LLMAIN=24
}}}

 If successful, mSMS will identify your experiment name, launch mXcdp and start build and run. If not, you need to examine the mSMS log file $HM_DATA/mSMS.log. $HM_DATA is defined in your Env_system file

 4. Restart of mXcdp

 The graphical window, mXcdp runs independently of the mSMS job and can be closed and restarted again. If you close mXcdp you can restart by

{{{
      PATH_TO_HARMONIE/config-sh/Harmonie mon
}}}

=== Directory structure of your experiment ===

On ecgate, you can follow the progress of the runs on $SCRATCH/hm_home/my_exp. More complete results data are available on c1a:$TEMP
under $HM_DATA: $TEMP/hm_home/my_exp. Under this directory you will find:

   * All binaries under '''bin'''
   * IFS libraries, object files and source code under '''gmkpack_build'''
   * Scripts, config files, sms and msms definitions under '''lib/'''
   * Utilities such as gmkpack, gl and verification under '''lib/util'''
   * Climate files under '''climate'''
   * Archived files under '''archive'''
       * A '''YYYY/MM/DD/HH''' structure for per cycle data
       * verification input data under '''extract'''
   * Working directory for the current cycle under '''YYYYMMDD_HH'''
   * Verification working directory on '''$HM_DATA/archive/extract/WebgraF''' or on ecgate '''ecgate:$SCRATCH/hm_home/$EXP/archive/extract/WebgraF'''
   * Log files per task can be find under $HM_DATA/my_exp. on ecgate/c1a log files are found under /c1a/ms_perm/ms/$COUNTRY/$USE/HARMONIE/my_exp. If an experiment fails it is usefull to check the IFS log file, NODE.001_01, in the working directory of the current cycle ( $HM_DATA/YYYYMMDD_HH ). The failed job will be in a directory called something like Failed_this_job. All logfiles are also gathered in html files named like e.g. HM_data_YYYYMMDDHH.html which are archived in archive and on ecfs.

=== Performing model inter-comparison using Harmonie verification tools ===

For comparison between HIRLAM and HARMONIE experiments it is now possible to extract verification files from your HIRLAM experiment
[source:trunk/hirlam/scripts/VER_create_fld VER_create_fld]. Read more on how to use the 
[wiki:HarmonieSystemDocumentation/36h1.4/PostPP/Verification verification].

== Running HARMONIE under full SMS ==

FMI is running HARMONIE using the full SMS system. The SMS playfile produced from the mSMS tdf-file by running the --prepare setup of mini-SMS. The created def-file can then be used in full SMS.


[[Center(begin)]]
[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]
[[Center(end)]]
----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]