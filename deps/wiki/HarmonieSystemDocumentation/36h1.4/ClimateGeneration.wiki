[[PageOutline]]

[[Center(begin)]]
= '''Harmonie System Documentation''' =
== ''' Generation of climate and physiography files''' ==
[[Center(end)]]

== Introduction ==

There are four projections available in HARMONIE, polar stereographic, lambert, mercator and rotated mercator. The model itself choses the best (least distortion) projection among the first three given your domain specifications. The rotated mercator projection is selected through the variable ''LROTMER''. Note that the polar stereographic project is defined at 90^o^N(S) whereas in GRIB1 it is defined at 60^o^ N(S).

[[Image(projections1.png)]][[BR]]
Polar stereographic, Lambert and Mercator projection[[BR]]
[[Image(rotmer.png)]][[BR]]
Rotated mercator projection[[BR]]

For a model domain we have to define the following properties in [source:tags/harmonie-36h1.4/sms/config_exp.h config_exp.h]

 * ''NLON'' is number of points in x-direction.
 * ''NLAT'' is number of points in y-direction.

Both cover the C+I+E zone of the domain. To be able to represent a field in spectral space (and the FFT used) ''NLON'' and ''NLAT'' should satisfy the equation 5^b^ * 3^d^ * 2^e^, where b-e are integers >= 0. Further we must define

 * ''EZONE'' is number of points over extension zone in both x- and y-direction. Default value 11. 
 * ''LONC'' is the longitude of domain centre in degrees.
 * ''LATC'' is the latitude of domain center in degrees.
 * ''LON0'' is the reference longitude of the projection in degrees.
 * ''LAT0'' is the reference latitude of the projection in degrees. __If ''LAT0'' is set to 90, the projection is '''polar stereographic'''. If ''LAT0'' < 90, the projection is '''lambert''' unless LMRT=.TRUE..___  
 * ''LMRT'' switch for rotated Mercator projection. If LMRT=.TRUE. LAT0 should be zero. Cannot be stored in GRIB1.
 * ''GSIZE'' is grid size in meters in both x- and y-direction.

The default HARMONIE area is the Denmark domain. The following values for C+I zone and truncation are calculated in config_exp.h from the values above. 

 * ''NDLUXG'' is number of points in x-direction without extension (E) zone.
 * ''NDGUXG'' is number of points in y-direction without extension (E) zone.
 * ''NMSMAX_LINE'' is truncation order for a linear grid in longitude. By default (''NLON''-2)/2. 
 * ''NSMAX_LINE'' is truncation order for a linear grid in latitude. By default (''NLAT''-2)/2. 

[[Image(cie_domain.png)]][[BR]]

=== '''Create a test domain with gl''' ===

Before you go through the full climate generation process you can generate a test domain using gl. Define your domain in the namelist like:

{{{

&NAMINTERP
OUTGEO%NLON = 300 ,
OUTGEO%NLAT = 300,
OUTGEO%PROJECTION = 3,
OUTGEO%WEST = 17.0,
OUTGEO%SOUTH = 58.0,
OUTGEO%DLON = 2500.0
OUTGEO%DLAT = 2500.0
OUTGEO%PROJLAT = 60.0
OUTGEO%PROJLAT2 = 60.0
OUTGEO%PROJLON = 0.0,
/

}}}

Running gl using this namelist by

{{{

gl -n namelist_file

}}}

will create an GRIB file with a constant orography which you can use for plotting. [[BR]]


The generation of climate files includes two parts. The first part is the generation of climate files for the atmospheric model, the so called 
[http://www.cnrm.meteo.fr/gmapdoc/spip.php?page=recherche&recherche=e923 e923] configuration. The second part is the generation of the physiography information for 
[http://www.cnrm.meteo.fr/gmapdoc/spip.php?page=recherche&recherche=SURFEX SURFEX]. In the following we describe how it is implemented in HARMONIE.

[[Image(Screenshot-10.png)]][[BR]]
''Climate generation in mSMS''

== Input data for climate generation ==
The location of your input data for the climate generation is defined by the '''HM_CLDATA''' environment variable defined in the [source:tags/harmonie-36h1.4/config-sh/config.ecgate-c1a config.yourhost] file. At ECMWF the climate data is available under

{{{ c1a:/ms_perm/hirlam/harmonie_climate }}}

You can also download the data from 

https://hirlam.org/portal/download/harmonie_climate/


== Preparation of SURFEX physiography file ==

At present the most applied configuration is to run with SURFEX as the surface scheme. SURFEX needs information about the distribution of different available tiles like nature, sea, water and town. The nature tile also needs information about type of vegetation and soiltypes. The main input source for this is the [http://www.cnrm.meteo.fr/gmapdoc/spip.php?page=recherche&recherche=ECOCLIMAP ECOCLIMAP data base]. We also need a topography database which currently is gtopo30.

The data base for SURFEX-file preparation is located under HM_CLDATA/PGD
 * ecoclimats_v2.* : Landtypes
 * gtopo30.* : Topography
 * sand_fao.* : Soil type distribution
 * clay_fao.* : Soil type distribution

The generation of SURFEX physiography file ('''PGD.lfi''') is done in [source:tags/harmonie-36h1.4/scr/Prepare_pgd Prepare_pgd]. The script creates the namelist OPTIONS.nam based on the ''DOMAIN'' settings in [source:tags/harmonie-36h1.4/sms/config_exp.h config_exp.h]. Note that the SURFEX domain is only created over the C+I area. In the namelist we set which scheme that should be activated for each tile.
 || |||||||||| Tile || 
 ||= PHYSICS =||= Nature =||= Sea =||= Water =||= Town =||
 ||AROME  ||ISBA  ||SEAFLX||WATFLX ||TEB         ||
 ||ALARO  ||ISBA  ||SEAFLX||WATFLX ||Town as rock||

The program PGD produces one SURFEX physiography file ('''PGD.lfi'''), which is stored in ''CLIMDIR'' directory.

To make sure we have the same topography input for the atmospheric part we call Prepare_pgd two times. One time to produce a PGD.lfi for SURFEX and a second time to produce a PGD.fa file that can be used as input for the climate generation described below. Note that for the atmosphere the topography will be spectrally filtered and the resulting topography will be imposed on SURFEX again.
 
== Generation of a non SURFEX climate file ==

[source:tags/harmonie-36h1.4/scr/Climate Climate] is a script, which prepares climate file(s) for 
prefered forecast range. Climate files are produced for past, present and following month. The outline of '''Climate''' is as follows:

 * Check if climate files already exists.
 * Creation of namelists. The definition of domain and truncation values is taken from [source:tags/harmonie-36h1.4/sms/config_exp.h config_exp.h].
 * Part 0: Read the PGD.fa file generated by SURFEX and write it to Neworog
 * Part 1: Filter  __Neworog__ to target grid with spectral smoothing
 * Part 2: generation of surface, soil and vegetation variables, without annual variation.
 * Part 3: creation of monthly climatological values and  modif of albedo and emissivity according to the climatology of sea-ice limit.
 * Part 4: definition and modification of the vegetation and surface characteristics
 * Part 5: modification of fields created by step 2 and 4 over land from high resolution datasets (for each month)
 * Part 6: modification of climatological values
 
 The result is climate files for the previous, current and next month. The files are named after their month like '''m01''', '''m02''' - '''m12''' and stored in ''CLIMDIR''.

Further reference [http://www.cnrm.meteo.fr/gmapdoc/IMG/ps/e923_users.ps e923]

[[Center(begin)]]
[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]
[[Center(end)]]
----

[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]
