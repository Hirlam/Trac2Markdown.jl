[[PageOutline]]

[[Center(begin)]]
== '''Harmonie System Documentation''' ==
= ''' Surface Data Assimilation in HARMONIE''' =
[[Center(end)]]

HARMONIE has two different surface schemes. In sms/config_exp.h they are known as:

* old_surface
  The surface fields are a part of the atmospheric file (ICMSHXXXX+LLLL) in FA format.
* surfex
  The surface fields are in a separat AROMOUT_.LLLL.lfi file in LFI format. 

The way that surface assimilation is performed is quite different depending on which scheme you choose to use. In both cases one needs a spatial interpolation tool, which can communicate with the observational data base (ODB) and in a sophisticated manner use observational operators to set a spatial distribution of point observations. Independent of which surface scheme you are using will this be performed by the binary called CANARI (Code for the Analysis Necessary for ARPEGE for its Rejects and its Initialization). The ODB database used for surface analysis is odb_can, and is found in the cycle directory of your experiment.

==== old_surface ====
For the surface scheme old_surface, only one option exists and is called:

* [wiki:HarmonieSystemDocumentation/36h1.4/Analysis/CANARI CANARI]

CANARI finds both the analysis increments and progagates this information into the ground by using a built-in OI scheme. First guess is re-linked to be the result of CANARI and is used for blending/3DVAR/4DVAR.

==== SURFEX ====
For SURFEX two options exist:
* [wiki:HarmonieSystemDocumentation/36h1.4/Analysis/CANARI_OI_MAIN CANARI_OI_MAIN]
* [wiki:HarmonieSystemDocumentation/36h1.4/Analysis/CANARI_EKF_SURFEX CANARI_EKF_SURFEX]

The default surface model is SURFEX and the default surface assimilation scheme is CANARI_OI_MAIN. CANARI_EKF_SURFEX was first implemented in cy37 and will be undergoing tests in experimental and research mode before it can be used in operational setups.

In both cases CANARI is here used first to find the observation increments. The SURFEX assimilation schemes use two different techniques to propagate this information into the ground. The two ways CANARI is used is separated by two namelist settings needed when running with SURFEX:

* LAEICS=.FALSE.
 No initialization of ground variables are done as they are in the SURFEX file
* LDIRCLSMOD=.TRUE.
 2 metre variables taken directly from inputfile because they without surfex are diagnosed from 0 metre and lowest model height with the model specific routine achmt.

CANARI was designed before SURFEX was introduced and some of the climate cariable that normally exist in the input file for CANARI, do not exist when using SURFEX. This means the task Addsurf is run before CANARI, adding the needed fields from the FA climate file (mMM).

The screen level analyisis (eg. T2m) used in blending/3DVAR/4DVAR is the same as for CANARI in the old_surface case.

=== Variables updated in CANARI for old_surface and SURFEX ===

[source:tags/harmonie-36h1.4/src/arp/module/qactex.F90 Module of namelist variables]

HARMONIE namelist settings:
{{{
!  * LAEPDS  : .F. surface pressure analysis
!  * LAEUVT  : .F. wind and temperature analysis
!  * LAEHUM  : .F. humidity analysis
!  * LAET2M  : .T. 2 meter temperature analysis
!  * LAEH2M  : .T. 2 meter humidity analysis
!  * LAEV1M  : .F. 10 meter wind analysis
!  * LAESNM  : .T. snow analysis (Cressman)
!  * LAESST  : .F. SST analysis
!  * LECSST  : .T. use ECMWF SST
}}}

[[Center(begin)]]
[wiki:HarmonieSystemDocumentation Back to the main page of the HARMONIE System Documentation]
[[Center(end)]]

