[[PageOutline]]
[[Center(begin)]]
= '''HARMONIE System Working Week''' =
''SMHI, 28 Feb - 3 Mar 2011''

Last modified [[LastModified]]
[[Center(end)]]

== Participation, period and location ==

The working week starts at 1000 on Monday morning, Feb 28, at SMHI, finishes at 1600 on Thursday afternoon, 3 March 2011. 

Participates are,
 * FMI:     Niko Sokka
 * DMI:     Xiaohua Yang (Monday 1200 - Thursday 1500),  Kai Sattler
 * KNMI:    Toon Moene 
 * met.no:  Ole Vignes, Trygve Aspelien
 * SMHI:    Ulf Andrae 

== Objectives ==

The main goal for the practical part of this working week is to prepare contributions for cy37t1. We also need to discuss a number of general issues as listed below.

== Discussion on general issues ==

- Use of tickets
 * The Trac ticket system was used in the beginning of HIRLAM-A but never gained any popularity and no real good working practice were established. We agreed on giving it a new try again for bugs. Ole upgraded to Trac 0.12 to get some new features. We still have to find good working practices for the tickets, but the coming cy37t1 phasing will be a good learning period.

 '''ACTION''' 

   * Start writing tickets '''ALL'''


- Helpdesk, Xiaohua
 * Tentative design: form a rotating team of 12 - 24 + staffs with different expertise on system, physics, data assimilation, probabilistic forecasts, quality monitoring to 
   * take actions on requests: troubleshoot, forward, reply, document, follow-up
   * daily maintenance monitoring of HIRLAM system-wide activities (data portal, including that of GLAMEPS product portal)
 * Motivation
   * The idea of having a rotating team comes with the increasing need in operational collaboration and also the increased work load on system and quality assurance area, for which there is a growing need for a consortia-wide team for routine support/monitoring/maintenance efforts, which are untypical in the days of HIRLAM programme with only focus on 'research collaboration'
 * Type of work on monitoring:
   * [blog:startupofmonitoringworkinggroup Earlier proposal about rotating monitoring group]
   * [blog:cheklistofmonitoringworkinggroup Potential tasks with monitoring]
   * [blog:ObervationModelIntercomparison example of regular blogging about monitoring data portal]
 * The type of arrangement seem to be more relevant in view of a general lack of staffs that can be allocated specifically for such type of duties
 * Discussion
   * duties and priorities: tasks with regular maintenance and support nature, mainly on project on system, QA, operational aspects, but also on all science projects (EPS, DYN, PHYS, DA)
     * Support tasks on operational problems, requests from users: staff, non-NWP community such as academia
       * Likely category of questions/needs for support, monitoring, troubleshooting
         * System (Compilation; Climate data base; climate generation; LBC data handling (MARS, GRIB2, netcdf...); Obs data handling (MARS retrieval, ERA data, ENDA data, historical data); academic users
         * Forecast model (configuration, troubleshooting/error diagnose: crash, debugging tools, postprocesisng tool/graphics, validation)
         * Data assimilation (structure functions, bias correction, blaklisting, initialisation)
     * EPS (GLAMEPS maintenance, monitoring of GLAMEPS web interface; report failure, interpretation)
     * data portal maintenance
   * organisation platform, a combination of many?
     * [https://hirlam.org/trac/report/1 trac-ticketing, starting on trouble-shooting, bug correction tasks]
     * mailing-list: helpdesk@hirlam.org, to be hosted in shift by the one on shift
     * [http://hirlam.org/index.php?option=com_agora&Itemid=159 HIRLAM forum], with subjects on QA_on_36h1, QA_on_73, Monitoring, GLMEPS, support, etc. Consider feasibility with open forum
   * Formation: "assignment"
     * Accounting: net working hour of max 1 week/ps (0.25 y), under QA/EPS/Operational/Sys projects
     * How to rotate?
       * organised by assignment team. Kai investigate an easy interface for automatic reminding of staffs on shift

 '''ACTION'''
  * Create new forum. The current (never used) one, Agora, has become commercial. (Trygve) '''DONE'''
  * Instruction helpdesk, on duty list, annonce helpdesk (Ulf)
  * Instruction and checklist HIRLAM/HARMONIE monitoring (Xiaohua) '''DONE'''
    * [blog:cheklistofmonitoringworkinggroup]

  * On duty list for monitoring/helpdesk ( when helpdesk is established ) ( Xiaohua )

  * Instruction and checklist glameps (Kai)
    * [wiki:MonitoringCheck/GLAMEPS]
 

- Organization and collection of results from benchmarking, Xiaohua
 * Recent results/experiences from benchmark preparations, Ole, Niko
   * [wiki:HarmonieSystemDocumentation/AromeRAPSBM AROME RAPS benchmark package]
 * [wiki:HarmonieWorkingWeek/System201001#TentativediscussionaboutHarmoniesystembenchmarking Earlier discussion in Jan 2010]
 
 '''ACTION''' Niko and Ole updates the benchmark wiki and points to their latest packages and boundaries. '''DONE'''

- GRIB2 status, implications for HIRLAM/HARMONIE
 * GRIB2 <-> GRIB1 converter

  The converter by Toon works from GRIB1 to GRIB2 but not yet the other way around. '''Deadline end of March'''. To be able to handle more than 126 levels the tool needs to be able to select levels and restrucuture the A/B definitions. 
 * Running HARMONIE from GRIB2 using grib_api converter.

   Trygve has tested that GRIB2 to GRIB1 conversion using grib_set, a tool in the grib_api package. It works for both HIRLAM and HARMONIE but will not be able to handle the extended levels. See presentation by Trygve [attachment:SYSTEM_WW_2011.ppt here].
 * gl_grib_api

   A branch as been created with [source:branches/gl_grib_api gl using grib_api] instead of gribex. So far it can read a GRIB1/GRIB2 file and extract relevant information. Next step is to read the fields needed to create boundary files. '''Deadline end of March'''. This is a solution for boundary generation for HARMONIE only and it has no limitation concerning the number of levels.

- Peaceful coexistence of HARMONIE/HARMEPS, lessons learned from HIREPS/GLAMES, Kai

  ''''''From HirEPS to HarmonEPS''''''

  In Hirlam the EPS mode was included into the existing script system, and thus
  has become an integral part of Hirlam, in principle.

  An alternative to this approach could be to leave the model system as a
  pure deterministic one, and build an EPS framework around it.

  Which one is the better choice?

  The alternative approach may be more flexible with respect to implementation
  of different ensemble methods, but the first one is closer to the model
  code ... (e.g. ensemble methods that closely interact with DA (think
  of cycling 00/12 06/18 e.g.), disk sanitation)

  Some script issues:

   + simplification of ensemble member specification - in Hirlam: ENSFIRST, ENSSIZE, ENSSEL - Harmonie: ENSMBRS

   + the Env_ensmbr approach used in HirEPS is good, but hasn't been used much

   + bad experience with separate tdf files for deterministic and ensemble mode - many developers only cared about the deterministic part

   + important question: is it desirable to design the ensemble mode - such that all model runs are reproducable (e.g. by using predefined random lists)?

     Note: There is no way - the system becomes more complex when introducing ensemble methodology to the system

  ''''''Context to GLAMEPS''''''

  Within the GLAMEPS SMS script system, two Hirlam implementations necessary:
    + experimentation
      . as close as possible to the reference version for easy upgrade

    + production
      . for operational use

      . fully integrated into GLAMEPS SMS suite

      . no dependency on either MARS or ECFS

  Does the original GLAMEPS idea hold for Harmonie?

   + multiple institutes contributing to a common EPS production

   + production either distributed or at one centre

  Intention of GLAMEPS

   + multi-model system with Hirlam and Harmonie makes sense down to 3km hor. resol.

   + not solely Harmonie based

   + common domain may be problematic

 * Version control of GLAMEPS - first steps using GIT
 
   '''ACTION''' Kai puts a copy of his "master" git repository on hirlam. Kai and Ole investigates if git and subversion can coexist under trac. Interface to glameps repository if possible.

- HIRLAM working practices during phasing, Ulf
 * [attachment:cy36_phasing.ppt Experiences from cy36], Ole 
 * Status of cy37
   * cy37_bf.01 imported to vendor branch
 * [attachment:SYSTEM_WW_2011.ppt Working with the Testbed], Trygve
   
   '''ACTION''' 
     * Clean testbedd use test domain as the default to allow quick testing and debugging. (Trygve)
     * Introduce cy37 mitraillette namelists in testbed (Trygve)

 * Strategy for the (remote) phasing of cy37
   * Toon (others) will take part in all phasing meetings.
   * ALACODE list used for communication.
   * Announce your availability for general testing or specific action to phasing leader.
   * Notify that you are working with a problem by creating a ticket.
   * Toon prepare/update the HIRLAM clearcase branch once a week.

 * Strategy for longer term changes
   * Should be able to extract from the release plan ( not yet available )


- User friendliness

 * Documentation ( user guide )
   * Content of a get started guide
     * Overview
     * General requirements ( code, dependencies, test data )
     * Installation
     * Run your first experiment
     * Examine your results
     * Troubleshooting
    
   * Do we need documentation in another format than the wiki?
   * Strategy to keep things up to date
 
 * Simplified version for academia
   * Simplified scripts?
   * QUESTION: How do we add extra output fields (3D/2D)? 

- From subversion to GIT
 * Glameps will server as a first test
 * Host our development of OOPS?

- Communication platform: Trac-ticketing? forum? mailing-list? ( See helpdesk section )

- HIRLAM system repository
 * technical procedure for HARMONIE reference version (release procedure ...)
 * national branches: what's suitable to be in the reference vs in national branches
 * naming convention of HIRLAM releases
   * Agreement to follow the HIRLAM alfa,beta,rc strategy. Situation is different from HIRLAM due to the connection to ECMWF/Meteo France.

- Needs to make HARMONIE operational, Ulf 
  * Pre-release technical and meteorological validation of HARMONIE (and also for HIRLAM-7.4)
    * what, how, who and when to handle portability issue?
      * local data stream: observation, boundary, post-processing and archiving
      * local computational architecture, compilers
      * operational domains, structure functions, bias correction data, blacklist settings
      * backup strategy
    * how, who and when to organise technical test?
    * how and when to organise meteorological evaluation? 

 '''ACTION''' 
  * Find one person on each service that can do the first basic local installation and technical testing to test the portability. (Ulf)
  * See RUNNING_MODE task further down

- Maintenance of HIRLAM system
 * how to organise, pre-7.4; post-7.4

- mSMS or ecflow

 * Pros and cons of moving from mSMS to SMS ( or rather ecflow ).
    * [http://www.ecmwf.int/newsevents/training/2011/computing/contents.html#ECFLOW ecflow training]

  '''ACTION''' Ask ECMWF about possible licenses/limitation  for use of xcdp/ecflow.


- Problems with and performance of makeup/gmkpack
 * We had different opinions about the usefulness of the extra synchronization (Makeup_sync). E.g. at FMI the operational suite has several compilations ( with different compiling options ) under the same experiment. Left untouched for the time being.
 * How to add new binaries in makeup if the main program is not in a program directory?

== cy36h1 tasks ==

 * edmfm test
  
   After updates by Wim it now works properly and is currently evaluated in parallel [wiki:Harmonie_36h1/ValidationTests#Post-releasetuningexperiments runs]. EDMFM is about 20% faster than EDKF! (Xiaohua) '''DONE'''

 * ECPHY option
   * Port Marianos changes from cy35 to cy36. (Xiaohua) '''ONGOING'''

 * Handling of satellite data; buoy data; local data

 * Run HARMONIE from HIRLAM 7.3
   
   gl can not handle the new surface field structure introduced with newsnow. This is a clear bug, the question of urgency is dependent on to what extent HARMONIE is forced with HIRLAM data operationally. Investigate urgency first (Ulf)

 * Port RUNNING_MODE=operational from SMHI branch. Check how it works for SURFEX (not tested yet) (Ulf)

 * Clarify which BDSTRATEGY to be used in an operational environment ( rename operational-> as_operational ) in sms/config_exp.h and in a Blog post. (Ulf)

 * '''Any other problem in cy36h1?'''

 === Outstanding tasks from last working week ===

     * Currently users on ECMWF platform needs to fiddle with resource requests in Env_submit in order to run their own configurations. Note that 3DVAR screening and minimisation appear to require large memory, thus many nodes. On [wiki:Harmonie_36h1#SamplecomputationalcostsforrunningHARMONIE-36h1 wiki page about 36h1], some sample information have been given to illustrate technical information for successful runs
     * '''ACTIONS (Ole, Ulf, Xiaohua)'''
       * Gather relevant data form different runs and see some empirical relations can be designed

   * Streamlining of GRIB parameter-translation problems, 
     * In first go, examine what's currently applied in GL
     * '''ACTIONS (Toon, Ulf, Laura)'''
       * Bring this up in the coming interoperability meeting at ECMWF to see what general recommendations can be made in GRIB-II framework 
       * Try to avoid conflict between HARMONIE and HIRLAM parameter definitions; A discussion about conventions shall be done within a few months

   * extension of configuration domain options
     * add MF ALADIN and AROME domains; Add LACE option ( domain already in sms/config_exp.h). These will enable easier comparisons/sanity check about HARMONIE configurations in comparison to other centers
     * '''ACTIONS (Ole)'''
       * MF and LACE will be contacted
   * Add variables like Tmax/Tmin from HARMONIE
     * T2m (max, min) is to be looked at later. Need further enhancement of fldextr and monitor.

== cy37t1 tasks ==

 * Upgrade gmkpack to 6.5.1 (Niko) '''DONE'''

 * Upgrade src to Cycle 37_br.01 from Meteo France's !ClearCase (Toon) '''DONE'''
   * Reverted OI_MAIN and subroutines to previous version at request of Mariken Homleid (Toon)

 * Compilation
   * gmkpack (Toon) '''DONE'''
   * makeup (Niko) '''DONE'''

 * Start compilation of contribution to clearcase (Ulf, Ole) '''DONE'''

 * Missing components
  * edmfm fix, [changeset:9087] (Toon) '''DONE''' [changeset:9095]
  * SPSMORO fix, [changeset:9086](Toon) '''DONE''' [changeset:9096]
  * JCDFI, waiting for cleaned version from Nils '''DONE'''
  * port LMSE_CC01 for continuous update of SST from [changeset:9047] (Ulf)

== Summary ==

== Reference: HARMONIE working weeks ==

 * [wiki:Meetings/System System Working Weeks and Meetings]
