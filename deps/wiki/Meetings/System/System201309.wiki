[[PageOutline]]
[[Center(begin)]]
= '''HARMONIE System Working Week''' =
''DMI, Copenhagen, 2nd - 6th of September 2013''

Last modified [[LastModified]]
[[Center(end)]]

== Practical ==

 The meeting will be held at DMI, Copenhagen

 * Participants, arrival, departure, hotel:
  * KNMI:    Toon Moene, Sunday 23:00, Friday 16:00, Ibsen hotel
  * SMHI:    Ulf Andrae, Monday 10.30am, Friday 2.30pm, Ibsen hotel
  * FMI:     Niko Sokka, Monday 12 am, Friday 1 pm, Sct Thomas hotel
  * met.no:  Ole Vignes, Monday 10:00, Friday 15:00, Ibsen Hotel
  * met.no:  Trygve Aspelien, Monday 10.25, Friday 15:30, Ibsen Hotel
  * Met Éireann: Eoin Whelan, virtual
  * IMO: Bolli Palmason, Sunday 21:00, Saturday 13:00, Cabinn Scandinavia
  * DMI: Xiaohua, Yang, Kai Sattler, Thor Olason, Mats Dahlbom (Tuesday-Friday), Bjarne Stig Andersen 
  * AEMET: Daniel Santos, Monday afternoon to Friday
 
== Preparations ==

 * How to get to DMI
DMI Headquarters is located in the immediate vicinity of Ryparken S-train station, 2 zones away from central railway station and 3 zones from Copenhagen airport. Ryparken station is most conveniently reachable by S-train with line A or H toward FARUM direction. After arriving to Ryparken, exit from the southern end and use the stairs to the left that leads directly up to the DMI. When approaching reception, tell the staff that you come for the GLAMEPS/HIRLAM working week. Kai Sattler and Xiaohua Yang are local contact persons.

Address: Danish Meteorological Institute, Lyngbyvej 100, 2100 Copenhagen. Phone 39 15 75 00
 * Hotel options: Participants are suggested to do their own booking via internet. The following two are hotels in central Copenhagen that have been commonly used by HIRLAM colleagues visiting DMI, with reasonable prices and relatively convenient transportation to DMI and to airport.
  * [http://www.firsthotels.com/Our-hotels/Hotels-in-Denmark/Copenhagen/First-Hotel-Osterport/ Hotel Østerport]
  * [http://www.ibsenshotel.dk/ Ibsens Hotel]
 * Misc
  *  [http://www.rejseplanen.dk/bin/query.exe/en? DSB]
  * Weather forecast: 
   * [https://hirlam.org/portal/dmi/s05eps/meteograms.php?typ=fan&age=new&stn=06184&rgn=dk DMI-HIRLAM forecast for Copenhagen/Jagersborg]; 
   * [http://www.dmi.dk/dmi/index/danmark/byvejr_danmark.htm?by=1000 Public forecast Copenhagen ]

== Objectives ==

The main goal for the practical part of this working week is to 
  * Migrate to the new hirlam.org server '''DONE'''
  * Finalize cy38h1.1
  * Prepare for cy40t1
  * Work with HARMONIE under ecflow

== Agenda ==

 * Monday: Gathering, setup
  * Presentations
    * Operational status, problems, '''ALL'''
  * Discussion points
 * Tuesday-Friday: Hard work!
 * Friday:
  * Summary, continuation 
 * Meeting locations: Millibar-room on Tuesday, else in HIRLAM-meeting room for rest of the week.

== GLAMEPS ==

  * HIRLAM SST bug detected and fixed
  * ALARO cycling bug detected and fixed

== HIRLAM ==

 * Migrate to the new ecgate server [http://www.ecmwf.int/services/computing/ecgate/migration.html] '''Toon'''
   * Migration partly completed by [12281]. Perl-tk is still missing but ECMWF is working on it. To be tested fully later.
 
== HARMONIE ==

 * Migrate to the new ecgate server [http://www.ecmwf.int/services/computing/ecgate/migration.html] '''Toon'''
   * HARMONIE, to be started when

=== General about ARPEGE/IFS ===


=== cy37h1.2 problems and experiences ===

  * Humidity problem on mountain area seen from DMI platform, eventually a local implementation problem? '''This is now solved by use of N2M=2 option in surfex.'''
  * #109, less robust calculation in surfex, also check in cy38. '''Toon. Fixed in [12255]'''

=== cy38h1 ===

 * Physics

   * ALARO + SURFEX does not work. Patrick S + David L. SMHI working on this. Some progress after introducing a coupling between exchange variables in atmosphere and surface, [12246]. However we still have problems with the stability. Discussion is ongoing with the ALARO team. Namelists for ALARO0 without SURFEX will be provided and used as a baseline. Partick will continue the debugging with input from Rafiq Hamid and Ivan Barstad. '''ONGOING'''
   * #100, edmfm not reproducible. '''Martynas'''
   * #113 Considered less important for the time beeing. Works in cy38t1_bf.03 for large domains but the problem we see for smaller domains is confirmed by Yann Seity. '''ONGOING'''
   * Add mixed phase condensation from Karl-Ivar Ivarsson. Handled by LOCND2 and set off by default. '''Introduced in [12250].''' 

 * Upper air assimilation
  * Fix problematic RH calculations in oulan. '''NOT FIXED'''
  * Mats tested several observation on the platforms from a technical point of view
    * AMSUA/AMSUB '''OK''
    * AMV '''OK'''
    * ASCAT '''OK'''
    * GPSRO ''' Need for an update param.cfg in bator'''

 * Surface assimilation
   * Time window for surface observations. Problems seen by Xiaohua with the current +/- 30 min window. '''Considered OK for the current cycling'''
   * Test and integrate the new_soda branch. '''ONGOING'''
     * The branch have been updated and some bugs fixed. Currently unexplained differences in soil water is under investigation. Later three experiments should be run:
        * Trunk as is
        * New soda with SODA called from CANARI
        * New soda with SODA called from CANARI and initialization using PREP.

   * Split Canari task in ODB merge and CANARI? '''Postponed'''

 * HarmonEPS
   * Correct BDSTRATEGY for all current cases '''Postponed'''

 * Dynamics
   * Introduce spectral coupling '''Mariano'''

 * OpenMP
   * A problem have been found in the nested OpenMP in av_pgd.f90 when running the forecast model. The threading is crucial for the SODA performance but has negative side effects when running the forecast model on a large number of threads. The solution we are aiming at is to integrate the new_soda branch and run SODA inside CANARI. This gives a better scalability of SODA and would allow us to remove the problematic OpenMP directives causing trouble in he forecast model. '''ONGOING'''

 * mSMS/script

   * File name convention to handle minute/second output hh/mm/ss '''Agreed, partly done in [12099]'''
   * Correct Get_timing.pl to use file stat as time stamp '''Ulf, not done'''

   * Improve the speed of makeup based on Jacobs ideas '''Postponed'''
     * Start with absolute paths in makefiles
     * Gather include files in one directory
     * How to avoid recursive make
   * Traj out of ground to Severe_warnings.txt

 * Cleaning
   * Clean gmkpack settings from sms/config_exp.h. Move them to an include file ( perl hash ? ) used by CheckOptions and written to config_update.h
   * Config options that could be removed
     * SURFEXOUTPUT is redundant and should be removed ''' Done in [12247] '''

 * External libraries
   * Update and clean auxlibs and grib api in cy38, '''Niko, done in [12251]'''
   * use eclite from xrd instead of auxlibs ''' POSTPONED'''

 * Diagnostics
   * Gustiness missing from ALARO in cy37-with surfex /cy38? '''ALARO+SURFEX not yet working'''
   * Output of any variable from phys (postpp) (as arbitrary GFL output)
   * Additional output parameters: Xiaohua is working with Sander Tijm et al to look for additional output parameters requested by DMI forecasters 
 	 	* CAPE, maximum cape (in similar definition as in HIRLAM-7.4); LCL, CIN, LNB (level of neutral buoyancy). CAPE from fullpos, what about the others?
                * wind gust of last 6h 
 	 	* geopotential height of freezing level from top and bottom, tropopause height 
 	 	* equivalent potential temperature, web-bulb temperature 
                * Inventory of averaging parameters from GL.
 
 * gl/gl_grib_api, '''This should be looked at in gl_grib_api'''
   * tri for MIN/MAX values in gl. '''FIXED'''
   * GL staggering bug.
   * Speed of gl in Makegrib.
   * New grib tables for surfex. Mandatory to make gl_grib_api work properly
   * GRIB codes for radiation variables, check with Kristian/Laura

 * Monitor
   * WebgraF interface for glameps.org my_con + my_xml does not work '''Ulf'''
   * More dynamic plot generation in monitoring and verification. See discussion mail from Trygve
     * As a first priority the current observation monitoring and work done within MetCoOp should be merged. The longer term goal is to create "on demand" plotting functionality based on ideas in HARP. Monitoring working days planned, to be settled.

 * Computational
   * Ensure gmkpack/makeup compatibility on c2a.

 * Initialization
   * Test Prep vs fullpos+prep. ''' See new soda comments '''
   * Memory increase in Prep_ini_surfex ( e927+fullpos ) between cy37 and cy38 reported by MetCoOp. Problems generation initial condition on 1200x1200 domain.

 * Evaluation:
   * [https://hirlam.org/portal/validation/38h1/trunk38 trunk runs] showed some degradation of scores, especially strong wind bias, too weak over mountains
   * First round of "testers" being contacted
   * Extract 381t1_oper for code comparison with the operational setup at MF
     * The branch have been extracted and does not reveal any alarming differences. '''DONE'''
   * Discussion about data assimilation monitoring for RCR per observation data types

 * Testbed data
   * Create new testbed data set based on TEST_IRELAND. '''Ulf POSTPONED'''

 * Derivation of structure functions in cy38h1. Help needed from DA staff '''POSTPONED'''
   * Add the generation of the forecast ensemble from HarmonEPS
   * Streamline the JB part

 * ECFLOW '''Bolli,Daniel,Kai'''
   * Start testing ecflow on ecgate and get make trials with cy38h1.beta.2.
     * Some first steps where taken. The main job is to translate mSMS variables to ECFLOW ones and define the submission rules for each task. Scripts will be created to make a mSMS setup running under ECFLOW. Bolli and Daniel will continue and document the work in [wiki:Harmonie_ecFlow here]. A follow up video meeting will be held in October.


=== cy39 and cy40t1 ===

 * The phasing for cy40t1 will start in !Nov/Dec. At this stage it's time to prepare our code changes based on the difference between [source:branches/phasing/cy39] and [source:vendor/aladin/cy39t1.05].
    * Update the cy39 branch with the latest cy38 changes and document in wiki. See [wiki:phasing/cy40t1]
    * Import cy40 to the vendor branch and merge it to the cy40t1 phasing branch. '''ONGOING''
    * Rimvydas has already a set of technical fixes that has been sent to MF/ECMWF for discussion.
    * Start mitraillette testing with and without our changes. '''TO BE DONE'''
    * Prune SAMIO in cy39t1 '''Ulf'''

 '''NB''' It's important to make sure that there is a connection from the branches back to the trunk to avoid problems with the future reintegration to the trunk.

 Further progress can be followed under [wiki:/phasing/cy40t1]

== Misc ==


 * New hirlam.org server, '''Thor, Ole, Trygve DONE'''
   * Software updates?
     * Linux distribution: Ubuntu 12.0.4
     * Joomla 2.5
       * DOCman
       * Kunena
       * Jevents
       * Communitybuilder
     * trac 0.12
     * git and gitolite
     * subversion
   * Cleaning


 * Move to git, testing, roadmap '''POSTPONED'''
   * Howto for subversion to git conversion: https://help.github.com/articles/importing-from-subversion
   * How to relate to the MF repository. MF will open up a mirror of their git repository 

== Reference: HARMONIE working weeks ==

 * [wiki:Meetings/System System Working Weeks and Meetings]

