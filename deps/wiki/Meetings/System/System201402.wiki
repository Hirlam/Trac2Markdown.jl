[[PageOutline]]
[[Center(begin)]]
= '''HARMONIE System Working Week''' =
''FMI, Helsinki, 24th - 28th of February 2014''

Last modified [[LastModified]]
[[Center(end)]]

== Practical ==

 The meeting will be held at FMI, Helsinki

 * External participants, arrival, departure, hotel:
  * SMHI:    Ulf Andrae, Arrival Mon:12.45, Departure: Fri:19.40, AVA hotel.
  * METIE:   Eoin Whelan, Arrival Mon:11.50 (from CPH), Departure: Fri:13:55, AVA Hotel.
  * KNMI:    Toon Moene, Arrival Mon:13.00, Departure: Fri:18.05, AVA hotel.
  * MET:     Trygve Aspelien, Arrival Mon: 11.05, Departure: Fri: 14.45, AVA Hotel.
  * AEMET: Daniel Santos , Arrival Mon: 15.10, Departure: Fri: 17.00, AVA Hotel.
  * OSENU: Sergei Ivanov, Arrival Mon: ..., Departure: Fri: ..., AVA Hotel.
  * DMI:   Xiaohua Yang, Arrival Mon:1130, Departure: Fri:1535, AVA hotel.
 
== Preparations, Hotels ==

== Agenda ==

  Start: Monday 24/2 14.00 [[BR]]

  Finish: Friday 28/2 lunchtime

  Documents on ECMWF XC30: [https://software.ecmwf.int/wiki/display/HPCM/Cray+XC30+Workshop+11-13+December+2013 XC30]

== HIRLAM ==

Port 7.4/trunk to Cray XC30 at ECMWF (Toon), initially using the GNU compilers; initially a single node implementation on the cct-login node, based on Niko's src/config/config.xc30gnu.
 * Needed to install the following libraries "by hand":
   * hdf4 (should come from the Linux distribution)
   * fftw3 (should come from the Linux distribution)
   * netcdf (should come from the Linux distribution)
   * grib_api (should be installed by ECMWF, or come from the Linux distribution)
 The libraries are actually installed, but to get the right ones using the module system is complicated - have to study this some more ...

 Because cct has no access to ECFS and MARS, I also had to install the climate database locally, and retrieve boundary and observation data "by hand" on ecgate.
 * TO DO:
   * Add job submission (PBS) and parallellism (aprun). '''Done''' (crudely). HOST0 is cct-login and HOST1 is cct-batch.

   Loose ends:
     * Need to differentiate job submission according to task (queue, resources).
     * Only checked with the GNU compilers.
     * No "concurrent" output from jobs under PBS (Trygve has a solution).
     * Not all result files get produced, or "disappear" shortly after being produced. '''This is a problem in Postproc, which first removes the file before retrieving it with scp from the compute host - which does not work when both hosts work on the same file system :-); this is due to running Listen2Forecast as a background job because scp from cct-batch to cct-login does not work.'''(
     * Therefore, prod the next cycle doesn't work, because it doesn't find the first guess '''(Fixed with the above - temporary - change)'''
   * As soon as
     * ssh from cct-batch to cct-login works, and
     * cct's $PERM and $SCRATCH are visible from ecgate, 
   convert the setup to one with HOST0 set to ecgate.
 
== HARMONIE ==

 * Misc cy38
  * CANARI problem fixed! See #115
  * Smaller cleaning tasks to be done
   * Clean ODB variables in include.ass
   * Unify sfx conv functions in OI_main, header.sh, Climate
   * Clean SMS variables to unify with ECFLOW
   * Clean ECFS interface in Access_lpfs

 * Work on implementation of cy40t1 into HARMONIE
   * Status (Eoin) [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/System201402/20140224_EW_CY40.ppt 20140224_EW_CY40.ppt]
   * Configurations tested but not evaluated:
     * Builds with makeup and/or gmkpack on c2a, krypton, laptop, armoin, vilje. Still problems with xlf and makeup.
     * PGD works, ecoclimap param filess and software to convert have been updated.
     * e923, climate generation, works. MPPEXEC for lfitools/sfxtools should probably be removed. The lfi/fa translation table have been updated.
     * Prep_ini_surfex works. Size of HREC have been changed to 12 to conform with surfex changes and then changed to len=*.
     * Forecast (AROME) runs after switching off the orography consistency check. We need to find out how to construct consistent atmospheric/surfex orography. Question sent to MF.
     * Fullpos inline works. Fullpos 2 not tested.
     * Canari crashes in ACHMT. Check status at MF. The git repository does not have anything more than in the cy40bf04 branch. SODA inline might give problems. We might have to go offline if problematic.
     * Screening, Minimization untested
     * ALARO, MUSC, EKF, 4DVAR, TL/AD, IO-SERVER untested
   * Rerun mitraillette tests with vendor and 40_send2 branch ( to be constructed ) to confirm the reproducibility.
 * Port cy37h1.2/cy38h1 to Cray XC30 at ECMWF
   * FMI experiences (Niko)
 * HARMONIE under ECFLOW at ECMWF
   * Status (Daniel)[https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/System201402/Harmonie_ecFLOW.pptx Harmonie migration to ecFLow]
     * Cleaning of ECFLOW/SMS variables to minimize the changes. We aim to have it as optional in 38h1.2 to allow usage for e.g. reanalysis runs at ECMWF (SMHI/MetEireann) 
 * Surfex
   * Status with cy40t1 (Trygve,Ulf)
     * NEW_PREP_HIRLAM accepted and all outstanding problems solved
     * Flake discussion. Agreed to start with surfex v7.2 to be able to test it in cy38h1.
     * SODA future discussion.
   * Comments to SURFEX steering committee? 
 * c903
   * Porting to cy38h1 level ( Toon ), ongoing

  * Migration to ECMWF XC30 (test build and stand-alone forecast run by Xiaohua)
    * The XC30 is far from ready at ECMWF and there is not date set yet for shutting down the IBM machines.
    * cca (the coming HPC with Cray XC30) was not available during the working week, all the tests were done on cct,  a smaller cluster (< 44 nodes). More tests were performed on cca in the following weeks
    * Gnu executibles for 38h1.1 used in the tests, with little optimisation efforts
      * per computation step CPU time in second with Gnu exe

|| domain || 10 nodes, 24 mpi tasks/node || 20 nodes, 24 mpi tasks/node || 30 nodes, 24 mpi tasks/node || 40 nodes, 24 mpi tasks/node || 60 nodes, 24 mpi tasks/node || 80 nodes, 24 mpi tasks/node ||
|| SKA 1200x1080 || 4.7  || 2.4  || 1.6  || 1.2 || 0.75 ~ 0.8 || ||
|| SCANDINAVIA_25 800x720 || 2.1 || 1.1  || 0.7 || 0.55  || || ||
|| METCOOP25B 960x750 || 2.6  || 1.3  || 0.9 || 0.68 || || ||
|| DKE 1080x720  || 2.8  || 1.4  || 0.96  || 0.72 || || ||
|| DKD 800x750, 1.5 km || 2.2  || 1.1  || 0.76 || 0.59  || || ||
|| DKA 800x600 || 1.7   || 0.88   || 0.62  || 0.44  ||  || ||
|| GLB 540x1000, 1.5km || 2.0   || 1.0  || 0.7  || 0.54 ||  || ||
|| GLE 1000x1000, 2 km || 3.6   || 1.8  || 1.26  || 0.96 ||  || 0.51 ||

      * tried also with ioserver, hyperthreading and OpenMP, but mostly only technical enabling
      * build and test with cce and intel yet to be done
    * No efforts done on the mini-SMS system yet.

 * Discussion points
  * How to connect to MF git repository
  * Coding standard discussions ( input from Marco Kupianen )
  * New physics-dynamics interface in cy40 (topic suggested by Laura)
    * Presentation by Laura
  * First experiences with OBSTAT using ODB-2 input (Eoin) [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/System201402/20140224_EW_OBSTAT.ppt 20140224_EW_OBSTAT.ppt]
    * The new Shiny interface and plots by Trygve/Per/Lars progressing well. We need to understand how/if OBSTAT can be used interactively before we consider any further steps. One thing missing is forecast departures from observations in ODB format as constructed by the screening. Xiaohua will search for someone to work on this.

 * Something about general system status and thoughts [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/System201402/System_status_2014_02_28.pdf here].

== Reference: HARMONIE working weeks ==

 * [wiki:Meetings/System System Working Weeks and Meetings]
