[[PageOutline]]
[[Center(begin)]]
= '''Video Meetings on ETKF 4DVAR 3DVAR and OOPS''' =

Last modified [[LastModified]]
[[Center(end)]]

== Fourth meeting: 16 January 2018, 10:00 CET ==

Claude: assimilation of humidity
 * q observations above 300 hPa not used (see mf_blacklist.b)
 * q increments set to 0 above 100 hPa. See src/arpifs/var/rdfpinc.F90 (see LSUSPQLIM switch)

Yannicks tech memo on M1QN3 and CONGRAD [https://www.ecmwf.int/sites/default/files/elibrary/2005/12821-incremental-4d-var-convergence-study.pdf]

== Third meeting: 17 March 2017, 10:00 CET ==


== Participants ==

 * Jan Barkmeijer 
 * Jelena Bojarova 
 * Florian Meier
 * Sigurdur Thorsteinsson
 * Roohollah Azad
 * Magnus Lindskog 
 * Martin Ridal
 * Jana Sanchez Arriola
 * Pierre Brousseau
 * Nils Gustafsson
 * Alena Trojakova
 * Wim Verkleij
 * Isabe Monteiro
 * Maria Monteiro
 * Sahlaoui Zahra
 * Guerguana
 * Marcin Kolonko
 * Siebren de Haan
 * Jeanette Onvlee
 * Roel Stapers
 * Hdidou Fatima Zahra
 * Alena Trojakova
 * Roger Randriamampianina

== Topics of the day: ==

**Initialisation:**[[BR]]
 - **Florian** Mentioned that they see somehow positive impact of  latent heat nudging (LHN).[[BR]]
 - ** Roger** informed the participants that Ole succeed to test a single observation of temperature in back and forth nudging scheme. By plotting the cross-section, the increment looks more flow-dependent compared to what a climatological B can provide. Also the balance on wind field looks reasonable.[[BR]]
 - **Roger** informed also the participants that Erik Gregow is working in close collaboration with Magnus, Tomas Landelius, Toon Moene and Sibbo van der Veen on cloud initilisation scheme implementation. He tested both SMHI and KNMI solutions with less success. **Magnus** said that Toon and Sibbo put the necessary code modifications into CY40. The pre-processing software needs to be put in Harmonie. **Florian** said that he prepared a tar file based on CY28h1.2 on the following modifications: adjustment of use of satellite data, read of input data in netCDF, additional nudging of observations, new critical humidity profile from ALARO, which is better for central Europe, better estimate of cloud base for mountainous stations.[[BR]]
 
**Incremental analysis update (IAU):** [[BR]]
 - Not discussed.[[BR]]
 
**3D-VAR:**[[BR]]
 - **Bad convergence** was detected in Harmonie and in Hungary as well. In Harmonie the problem was detected in CY40, while Hungarian test was with CY38. **Jelena** mentioned that she cannot get the Fourier transform working with the adjoint test. She also mentioned that without multiplication, the results look better. **Jan* mentioned that doing everything (variational computation) in spectral space give good results. **Pierre** mentioned that the adjont test works well with the Arpege model. He will do the adjoint test with the AROME DA configuration. [[BR]]

 - **Pierre** asked about any results of B computation and humidity increment life in Harmonie. **Roger** said they are working on two tests: computation of B using 1) GL and 2) FullPos for interpolation of LBCs. The life time of humidity increments will be checked in the use of the two computed B matrices. These tests will indicate, if so, the difference between Harmonie and Aladin/Meteo France ways of B computations.[[BR]]

**EDA:**[[BR]]
 -**MF** is working on an AROME EDA with 3.8 km resolution. The system is planned to be operational in 2018 and will provide flow-depend B of the day. In this EDA, all members are perturbed plus inflation to increase the spread; the use SPPT is not planned, since in creates too long B error length scale. Inflation technique at MF was implemented in CY41, which will be ported to CY42. It is based on Desroziers technique. Tests at MF use 25 members. The plan is to have 50 members in operational. [[BR]]
 - **Roger** Informed that they also started to work with EDA, but due to some re-start problem, the verification results show serious/strange problem with cloudiness. The experiment needs to be repeated.[[BR]]


**4D-VAR**[[BR]]
 - With cycle 40, the gradient test does not pass. With some changes in the configuration (like turning off a lot in physics, and turn off the use of humidity in grid point space) the gradient looks strange. Use of CONGRAD provides a faster decrease. Running 4D-Var fully in spectral space looks provides OK gradient, but this is not a setup for operational use. [[BR]]
 - The problem with gradient needs to be fixed.

 - **Jan** committed to the trunk the code needed for use of tendency in 4D-VAR.[[BR]]


**ETKF:**[[BR]]
 - **Jelena** will continue working with LETKF with CY43.

**!EnVar** [[BR]]
 - **Jelena succeeded to extend the control vector. All changes are submitted in the trunk. The modifications are based on the square-root B transform.
 - We learned from **Roel** that the there is no plan to have the square-root B in OOPS in the near future. 


**OOPS:** [[BR]]
 - **Roel** informed us that the VarBC is working technically. The interface is simple. During the video meeting Roel reported about a convergence problem. Being back to ECMWF, he found the source of the problem, which was related to aircraft varBC. He also reported about technical issue related to memory use to have access to many different things. The actual implementation needs a lot of memory. This needs to be fixed. [[BR]]
 - **Jan** asked the adjoint test is planned in OOPS? After the meeting, Roel reported that there is no plan of implementation of adjoint test in OOPS in the near future. [[BR]]
  

===========================================================================

== Second meeting: 30 September 2016, 10:00 CET ==


== Participants ==

 * Jan Barkmeijer 
 * Jelena Bojarova 
 * Florian Meier
 * Carlos Geijog 
 * Roohollah Azad
 * Magnus Lindskog 
 * Martin Ridal
 * Jana Sanchez Arriola
 * Pierre Brousseau
 * Claude Fischer
 * Xiaohua Yang
 * Nils Gustafsson
 * Alena Trojakova
 * Wim Verkleij
 * Ole Vignes
 * Roger Randriamampianina

**Actions from the previous meeting**: The Actions are kept.

**Initialisation:**[[BR]]
 -**Florian** presented their results on using of latent heat nudging (LHN). It give positive impact on the very short-range (up to 6 hours) precipitation forecasts. Also case studies show positive impact of LHN. It is able to remove and add precipitation where necessary, in principle.[[BR]]
 
 â€“ **Incremental analysis update (IAU):** Not used in AROME-France. **Pierre** reported that one hour cycling is not performing well with IAU. The reason of degradation of the analysis performance is not understood so far. The negative impact is seen in obs-guess and in forecasts.[[BR]]
 -**MF** don't need to reduce spinup. The wrote paper on it. It was, however necessary to tune the B matrix and account for use of analysis as first LBC. Their B was computed using EDA with the AROME model and using all available observations. Such kind of B matrix van be also good for a sub-hour assimilation cycling.[[BR]]
 -**Ole** very shortly presented his idea on back and forth nudging technique and its possible implementation.


**3D-VAR:**[[BR]]
 -**Jelena** reported that switching off the balance between wind and mass helps in prediction of convective phenomenon.[[BR]]
 -**Carlos** presented his idea on the use of semi-implicit scheme in B computation. The presentation can be found [reference here]. The method works with cubic but not with linear grid. Linear grid fails with memory problem, which is not fixed yet.[[BR]]

**EDA:**[[BR]]
 -**MF** has nothing special to report.


**4D-VAR**[[BR]]
 As reported during the last working week in Norrkoping, 4D-VAR fails with ATOVS and radar data in minimisation. This is not fixed yet.[[BR]]
 -**Jan** reported that he succeed to implement and test 4D-VAR without increments and using tendency perturbation (??). This can be used as weak constraint in the system.[[BR]]
 -CY40 have convergence problem. It can come from the physics package, which is working well in CY38. Nils suspect bug in the gradient computation related to the setup of 4D-VAR. But, gradient test and singular vector computation were OK with conventional obs only.[[BR]]
 -**Claude** mentioned that the test of AD is good at fewer digits only. Probably this came from earlier cycles.[[BR]]
 -**How to proceed?** Claude mentioned that if the setup of 4D-VAR is concerned, then touch the physics. Try to use only dry or moist physics and use the suspicious sources. Singular vector computation is probably OK and AD test is not passing through ...[[BR]]
 -**Nils** asked if it's in the AD, why we can not have the same problem in 3D-VAR?[[BR]]
 -We need to check the convergence in 3D-VAR!![[BR]]

 -**Jan** reported that their local implementation of 4D-VAR on BULL machine is not working yet. The would like to nest 4D-VAR system with 3D-VAR one. The resolution is not yet decided. They think to use outer loops with Mode-S, radar and GNSS data.[[BR]]

 -**Xiaohua** mentioned that he would like to test 4D-VAR next year using overlapping windows.[[BR]]
 
 

**ETKF:**[[BR]]
 -**Jelena** reported that she took everything from Pau and work on hybrid system development is progressing well.


**OOPS:** [[BR]]
 -**Pierre** (Claude has left at this time) reported that they have 4DEnVar working with ARPEGE, 3D-VAR with AROME. The working version of OOPS is based on CY40 at MF.[[BR]]
  



===========================================================================

== First meeting: 31 March 2016, 10:00 CET ==

== Participants ==

 * Jan Barkmeijer 
 * Jelena Bojarova 
 * Roel Stappers 
 * Gert-Jan Marseille 
 * Siebren de Haan 
 * Mate Mile 
 * Roohollah Azad
 * Magnus Lindskog 
 * Jana Sanchez Arriola
 * Mats Dahlbom 
 * Michal Nestiak 
 * Eoin Whelan 
 * Pierre Brousseau
 * Claude Fischer
 * Nils Gustafsson
 * Roger Randriamampianina

**Initialisation:**[[BR]]
 â€“ **Jelena** reported her work with Jk and large scale mixing (LSM) technique available in Harmonie using model with Aladin physics. She had to debug the Jk scheme before using it. As overall performance of these schemes, Jk appears to provide better scores compared to observations. However, she also reported that  Jk have larger errors at analysis time, but provides lower errors in longer forecast ranges.[[BR]]
 â€“ MF reported that Jk test gave improvement on large scale and bad impact on mesoscale.[[BR]]

**Action-1:** Compare Jk & LSM with the AROME model as well.[[BR]]

 â€“ **Incremental analysis update (IAU):** can someone fill this :) unfortunately not well noted â€¦[[BR]]

**3D-VAR:**[[BR]]
 â€“ **Artificial humidity increments in the MetCoOp analyses:**[[BR]]
 â€“**Magnus** mentioned that this can be result of the negative correlation between Ps and upper-air humidity in our background error statistics. Mainly, this can be due to lack of humidity observations in upper-air. Magnus showed impact with univariate Humidity analysis. Jelena is doing test without coupling Ps-q(Rhu) only.[[BR]]
 â€“ MF mentioned that Radar data provide good coverage of humidity in upper-air, so they don't observe this kind of problem.[[BR]]
 â€“ The MF system has 1.3km horizontal resolution, 90 vertical levels, and more radar with less thinning distances.[[BR]]

 â€“ **Carlos** asked about the use of latent heat nudging (LHN) at MF. The LHN at MF was tested in research framework only.[[BR]]

 â€“ **Jan** asked why the impact of observations lasts not too long in general (what they observe at KNMI without GPS and radar data). **Pierre** (MF) said that the impact of observations at MF lasts up to 12 hours (seen on surface parameters and precipitation verifications from long period experiments).[[BR]]

**EDA:**[[BR]]
 â€“ **Roger** mentioned that for EDA several observation perturbation techniques are implemented. This includes off-line way before (all observations) and after (only active observations) screening plus the IFS way of observation perturbation. He mentioned that the IFS observation perturbation is not suitable for observations simulation in an OSSE studies due to the fact that the perturbation randomly done for different observation points. He contacted Loik to understand better this technique, but so far without answer from him.[[BR]]
 â€“ **Roger** mentioned also that using an off-line technique for observation perturbation is problematic for satellite radiances due to the fact that for these observations the observation errors are set up in defrun.F90 during screening. Hence a light pre-screening run is needed if one would like to use radiances with off-line observation perturbation.[[BR]]
 â€“ MF uses all available observations in their EDA system.[[BR]]

**4D-VAR**[[BR]]
 â€“ **Nils** repoted that Jc-DFI is implemented in Harmonie, but needs to be carefully checked.[[BR]]
 â€“ **Nils** reported also that change of resolution in spectral space is working well. There was bug with LELAM was corrected.[[BR]]
 â€“ **Nils** reported that running more outer loops with update of ODB is still with problem.[[BR]]
 There was general question about 4D-VAR: AROME with surfex and ISBA (?). Is it the same physics in the trajectory? This probably an area of coordination between MF and Hirlam.[[BR]]
 â€“ **Pierre** mentioned that in his test, the full AROME physics are used in screening and Aladin physics are used in minimisation.[[BR]]
 â€“ **Pierre** metioned that he has been testing using radar data every 15 min and also hourly. Using radar data every 15 min gives better performances (he was using an analysis window between  â€œ- one and half to + one and half). He mentioned also that hourly cycling 3D-VAR with radar gives similar results copared to 4D-VAR. But, 4D-VAR is a bit better in convective cases (?)[[BR]]

 â€“ **Magnus** mentioned that in Harmonie the AROME runs with SURFEX and in hydrostatic mode (?)[[BR]]

**Action-2:** there is need of inter-comparison of namelists and settings of AROME 4D-VAR in Harmonie and at MF.[[BR]]

 â€“ **Jan B** showed the use Mode-S in 4D-VAR and showed that the increments have good extention showing that the analysis is more consistent with the physics (?).[[BR]]
 â€“ **Jan** also showed strange behaviour of the 3D-VAR with large scale mixing (LSM) with strange spectra after LSM and one hour integration.[[BR]]
 â€“ MF B matrix was computed with EDA with all available observations.[[BR]]
 â€“ AROME ensemble system with EDA is planned in 2018. Today the AROME EPS system consists of ensemble of productions(?).[[BR]]

**Action-3:** Given the fact that the B matrix used at KNMI (and also for the MetCoOp model) was computed using downscaled ECMWF ensemble and no assimilation involved. It would be nice to see the evolution of the (humidity) increment in a system using 3D-VAR without LSM and with B matrix estimated using EDA scheme. Such system today can be found at DMI. So, the video meeting participants decided to ask Xiaohua to check the performance of their 3D-VAR with respect to the evolution of the humidity increment within the first hour after analysis. (please correct if necessary).[[BR]]

**ETKF:**[[BR]]
 â€“ The ETKF scheme was implemented and working well in Harmonie with CY38. Porting to CY40 is under progress. The Harmonie ETKF scheme was adapted from the IFS system with help from Mats H.[[BR]]
 â€“ Using ETKF improves the moisture fields.[[BR]]

**OOPS:** [[BR]]
 â€“ **Roel** introduced his idea on using matrix free linear algebra with the aim to further simplify the OOPS C++ coding structure (see presentation).[[BR]]
 â€“ **Claude** informed the participants that the re-factoring work will end in CY44. Until that moment, lot of things need to done: Jb term, finalisation of the Jo, definition of increment, module objects, trajectory objects, development of units test... Even single loop 4D-VAR is not yet ready for IFS.[[BR]]
