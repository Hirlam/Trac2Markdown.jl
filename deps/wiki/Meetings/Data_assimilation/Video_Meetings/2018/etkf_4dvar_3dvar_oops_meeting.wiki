[[PageOutline]]
[[Center(begin)]]
= '''Video Meetings on ETKF 4DVAR 3DVAR and OOPS''' =

Last modified [[LastModified]]
[[Center(end)]]

== Fifth meeting: 6 April 2018, 14:00 CET ==



== Participants ==

 * Thibaut Montmerle 
 * Yann Michel
 * Jana Sanchez Arriola
 * Magnus Laindskog
 * Alena Trojakova
 * Roel Stapers
 * Carlos Geijo
 * Xiaohua Yang
 * Mate Mile
 * Erik Gregow
 * Claude Fischer
 * Roger Randriamampianina


== Topics of the day: ==  

** Actions from previous meetings **[[BR]]

 - ** Action 2 on Claude** to report about the experience on iteration and convergence wrt number of observations in variational analysis. Yann said that the minimisation in variational depends on the number of observations. The more obs we use the longer the needed iterations. CONJGRAD is good to monitor the convergence.[[BR]]

 - ** Action 3 Trouble with CY41: **  Ryad solved the problem related to using of FA file directly in Festat. In hHarmonie we have the updated version. The newer versions are a little bit different, but out of bugs and can be "parallelized". **Claude** suggested to take the Festat from the CY43, which should be compatible with any versions.[[BR]]

**Initialisation:**[[BR]]
 - ** Variational constraint scheme:** **Carlos** reported that the scheme was tested in 3D-Var and LETKF. The results showed the necessity of further tuning tuning, meaning that it looks to not fully integrated into the Harmonie system. Probably it will be useful in a shorter cycling systems. MSLP and T2m are degraded. [[BR]]

 - ** Field alignment:** **Carlos** will put it into the Harmonie system.[[BR]]
 
**Incremental analysis update (IAU):** [[BR]]
 - ** Claude** said the it's used when doing long-range forecasts at 00, when usually the analysis from 1 hour is already ready. We decided to talk about it in Toulouse during the ASM.[[BR]]
 
**3D-VAR:**[[BR]]
 - **Convergence issue**: The convergence issue was discussed (see above).[[BR]]


**EDA:**[[BR]]
 - **at MF**, AROME-based EDA is planned to be operational in May with CY42_op3 with 45 members, at 3.25km resolution.[[BR]]
 - In Harmonie the EDA system was tested by Inger-lise in MEPS. It produces very promising positive impact on surface parameters. Although issue related to high-level cloudiness was detected. This will be investigated soon when Mate joins MET Norway. **Roger** will check the use of stratospheric IASI channels in the system, since there are few of them having also influence widely in stratosphere. **Yann** mentioned that Philippe Chambon also reported problems related to stratus clouds at MF. Use of EDA in AROME-Fr is a work in progress.[[BR]]

** Action 1** To keep in touch regarding the issue with high level clouds in EDA.[[BR]]

**4D-VAR**[[BR]]
 - THe Harmonie trunk is updated with the 4D-Var that works t"technically" with all kinds of obs. Although using 2 outer loops shows problem with the ATOVS. Tskin is not used now. It's changed to surface temp. from surface field. There need to control the use of moving platforms in 4D-Var in different time slots. **Yann* said that the Tskin is used as sink variable.[[BR]]
 - **Eoin** confirmed that the above mentioned changes are in the trunk and in the latest tag of the cycles.[[BR]]

**ETKF:**[[BR]]
 - **Pau and Eoin** are working on the porting the changes in the branch. The solution is still using some of the GL routines, which needs to be changed later.[[BR]]
 - **Carlos** reported the testing of Var. Constr. scheme in LETKF, where FG=FG + VCfilter*[LETKF -FG]. Checking the impact in controlling the spinup through ECHKEVO showed that 3D-Var shows less impact than the LETKF with VC.[[BR]]

**!EnVar** [[BR]]
 - **Thibaut** mentioned that a paper describing their implementation will be soon out. It's about testing use of grid point or spectral representation in an AROME with 3.25km resolution. The hybrid system sows better results, where the noise is reduce when using time lagged, and localisation in grid point. Most efficient way is to use IAU in the first half hour. The IAU is laso applied in global scale. The IAU is available from CY41_T1_op1. It's only a branch in Harmonie. It should be also available in CY43. [[BR]]


**OOPS:** [[BR]]
 - **Roel** is discussing with Claude his visit to Toulouse. **Claude** mentined that ECMWF may be delayed with OOPS oper implementation. Plan is to be ready in May. They will not be ready, probably in the end of the year. Building the next joint ARP/IFS the end of the year. CY47 will start in the beginning of next year. Technical part of the development is still ongoing. ECMWF is working on VarBC/VarQC.[[BR]]

**New cycle**
 - ** Claude** asked about the status of CY43 in Harmonie. It works with the Intel compiler. Gnu Fortran is still problematic.
  

===========================================================================


== Fourth meeting: 16 January 2018, 10:00 CET ==



== Participants ==

 * Jan Barkmeijer 
 * Jelena Bojarova 
 * Magnus Lindskog 
 * Jana Sanchez Arriola
 * Nils Gustafsson
 * Alena Trojakova
 * Wim Verkleij
 * Maria Monteiro
 * Martin Ridal
 * Roel Stapers
 * Eoin Whelan
 * Pau Ecriba
 * Carlos Geijo
 * Xiaohua Yang
 * Claude Fischer
 * Roger Randriamampianina


== Topics of the day: ==  

**Initialisation:**[[BR]]
 - ** Roger** informed the participants that in this series, the report about the progress with cloud initialisation was taken during the video meeting on use of retrievals in DA. [https://hirlam.org/trac/wiki/Meetings/Data_assimilation/Video_Meetings/2017/Retrieval_data_assimilation see the minutes for more details] [[BR]]
 - **Magnus** said that the additional code from Florian Meier was sent to Daniel, who hopefully will put it in Harmonie CY40. 

 **Action-1** on Roger to ask Florian about his progress with the cloud initialisation and report back to the group.

 - **Variational constraint scheme**: **Carlos** said on top of [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/ALGO201711 what was reported] in Lanzarote, that he is testing the system now. He found good way of scaling the increments. The scheme is ready to be tested in 3DVar with **field alignment** and radar wind observations. **Carlos** asked about the where can he work with the implementation process with 3DVar. **Eoin** said that we have a dedicated branch for DA development. It's recommended to do development with that branch.
 
**Incremental analysis update (IAU):** [[BR]]
 - Not discussed. But, **Claude** mentioned that this scheme was tested in the Oversea's models without DA. It is also used in the first hour in the production (forecasts) in AROME-France.[[BR]]
 
**3D-VAR:**[[BR]]
 - **Convergence issue**: **Wim** reported that with limited sets of observations, he didn't experience any problem with 3DVar, except for some cases. He experienced with a lot of reflectivity data in the system, the gradient fails, but when reducing the number of reflectivity observations, the gradient is OK again.It looks like the convergence and gradient test in fine with the grid point humidity (Q).[[BR]]
 - **Roel** asked Wim if he checked also the number of iterations used in the minimisation? **Wim** said that he would like to understand the failure is related to some observations or not. He asked because of the [https://www.ecmwf.int/sites/default/files/elibrary/2005/12821-incremental-4d-var-convergence-study.pdf report by Yannick Tremolet] on relation between density of observations and the minimisers (MIQN3 and CONGRAD). [[BR]]
 - **Claude** reported about the settings at Meteo France fro humidity assimilation. He said for 3DVar, both grid point and spectral Q should work fine! This is thanks to the effort done by Pierre few years ago to adapt the code to make it working. [[BR]]
 - **Claude** Mentioned also for all applications at Meteo France, the key LSPRT is set to FALSE. This due to few bugs that come from the dynamics, but spread into the code. They didn't and don't have yet time to look into this issue until now, while keeping in touch with ECMWF. [[BR]]
 - At Meteo France, they don't do regularly gradient test, but they do it from time to time. [[BR]]
 - **Claude** mentioned that the use of M1QN3 and CONGRAD for minimisation should work fine. [[BR]]
 - **Jan** asked if at Meteo France they experience convergence problem in variational schemes? **Claude* couldn't recall about any issues with convergence.

 **Action-2** on **Claude** to ask his colleagues about any issues related to variational scheme convergence.

 - In addition to the [https://hirlam.org/trac/wiki/Meetings/Data_assimilation/Video_Meetings/2018/Meeting_on_radar_data_processing Action-3 on Claude], he added that for both AROME and ARPEGE DA the humidity above 300 hPa (see also [https://hirlam.org/trac/browser/tags/harmonie-40h1.1.rc.1/src/blacklist/mf_blacklist.b mf_blacklist.b]) is not used and the increments are set to zero in the upper-air above 100 hPa. This is set up in [https://hirlam.org/trac/browser/tags/harmonie-40h1.1.rc.1/src/arpifs/var/rdfpinc.F90 rdfpinc.F90] (see LSUSPQLIM switch). 
 -**Jan** asked about the increments providing negative value of Q? **Claude** said that there is no check in the end of DA, but in the beginning of the forecasts, the Q value is set to zero when it's negative. It was implemented in Aladin that negative or very small value of Q is set to zero for safety. 

**EDA:**[[BR]]
 - **MF** No changes from what is described in the minutes below see also [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/ALGO201711 Yann's reports in Lanzarote].[[BR]]
 - **Roger** Informed that with connection to the problem reported below during the previous meeting, Inger-Lise restarted the EDA experiments and the verification results look more promising that in the earlier results. The are still in the process of assessing the results. The will report soon the assessment is finished.[[BR]]
 - **MAgnus** asked Claude about the problem noticed by Yann in Lanzarote with the Festat program in Cycles higher than 38.

 **Action-3** on **Claude** to ask at Meteo France and report about the exact problem/bug in Festat in Cycles higher than 38.

**4D-VAR**[[BR]]
 - With connection the convergence in variational scheme under discussion above, it was mentioned that using Q in grip point space always have problem with the gradient test. According to **Claude's** comment above, additional work needs to be done to fix the use of Q in grid point space in 4DVar (see also [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/ALGO201711 the decision taken by the development group in Lanzarote] regarding the use of Q in 4DVar minimisation.[[BR]]


**ETKF:**[[BR]]
 - **Pau** [https://hirlam.org/trac/attachment/wiki/Meetings/Data_assimilation/Video_Meetings/2018/etkf_4dvar_3dvar_oops_meeting/LETKF_in_HARMONIE_Status_Jan2018.ppt reported] their work with **Jelena** and talked about the following topics:[[BR]]
  * He reported about the performance of 3 schmes: 3DVar, LETKF,and hybrid 3DVar-LETKF. The hybrid scheme was set as K*anLETKF + (1-K)*an3DVar, where K=0.5. The results showed that with left the best and right the worse, then the quality was 3DVar - LETKF - Hybdrid for ex. for wind and MSLP; and LETKF - hybrid - 3DVar for 2m humidity. So they are asking: if the LETKF is well tuned, will the hybrid scheme also perform better?[[BR]]
  * Assimilation of geopotential height above 500 meters up to 1000 meters. The impact in MSLP is positive at analysis time, then neutral in the forecast.[[BR]]
  * Why not to assimilate the T2m and Hu2m? The test of assimilation improves the analysis. [[BR]]
  * Balance in LETKF: Using the ECHKEVO diagnostic tool and checking the runs with and without DFI, DFI reduces the spinup up to 80 minutes. So, in the ETKF guesses are from 2 hours (120 minutes), so they are not affected.[[BR]]
  * After accounting for the above improvements in LETKF and comparing it with 3DVar shows that 3DVar is performing better than LETKF, while for humidity parameters, LETKF is slightly better.[[BR]]
  * Inflation parameter in LETKF (RHO): ut has impact in the performance of the LETKF. This needs to be worked out together with the localisation of the observations.[[BR]]
  * **Pau** addressed also the importance of trying the additive inflation with ECENS in model levels.[[BR]]
  * Bias correction of surface pressure (Ps): **Pau** said that he has been working with the Ps_Bias_Correction program at ECMWF and thinks that it can be activated in Harmonie. **Magnus** said that they tested the use of Ps instead of MSLP and found worse results, but commented that Ps bias correction is something worth to do.[[BR]]
  * Jelena mentioned that it's good to work with LETKF because it's working in grid point. But, most of the observations are from surface and aircraft. Using the localisation technique creates more local analysis. Implementation of more observation type is needed. [[BR]]

**!EnVar** [[BR]]
 - Not discussed this time due time constraint. [[BR]]


**OOPS:** [[BR]]
 - **Roel** informed that with respect to the last report, the square-root B is now part of the OOPS and the adjoint test will be also implemented. [[BR]]
  

===========================================================================