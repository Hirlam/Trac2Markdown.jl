[[PageOutline]]
[[Center(begin)]]
= '''HIRLAM Surface Working Week''' =
''Tromsø, Norway, May 28 - June 1, 2018''

Last modified [[LastModified]]


[[Image(DSC_0326.JPG, 20%)]] [[Image(DSC_0332.JPG, 20%)]] [[Image(20180528_142546_new.jpg, 20%)]]

[[Center(end)]]

== Background ==

All aspects of surface related development in HARMONIE-AROME can be covered. As usual, the exact topics that will be covered depend on who show up. But, special focus will be given to surface data assimilation in SURFEX/SODA since we finally have all the core assimilation people signed up for this week.

== Working items and comments ==

'''Please add items'''

 * Progress with EKF:
   * Within the project IMPREX Magnus has been working with a combination of satellite product for soil moisture and SEKF assimilation. Magnus reports progress/results/experience and recommendations on how we should proceed with EKF development.
   * Jelena has implemented STAEKF for LAI in a test version of cy40h1.1. It works technically... What are the next steps?
   * Crazy Jacobian values:
     * Magnus, Jelena and Patrick have experienced problems with crazy Jacobian values. Now, for practical reasons we have limited the Jacobians, otherwise it crashes in cholesky decomposition due to singular matrix etc.
     * Clément Albergel says: When I was working at ECMWF we used the following limits for soil moisture analysis: analysis was locally switched off if the Jacobians become larger than 50K/m3m-3, 5/m3m-3 and 2m3m-3 for T2m, RH2m and ASCAT satellite derived surface soil moisture. Figure 4 of the [https://www.researchgate.net/profile/Clement_Albergel/publication/320614137_Sequential_assimilation_of_satellite-derived_vegetation_and_soil_moisture_products_using_SURFEX_v80_LDAS-Monde_assessment_over_the_Euro-Mediterranean_area/links/59f04f95458515c3cc438416/Sequential-assimilation-of-satellite-derived-vegetation-and-soil-moisture-products-using-SURFEX-v80-LDAS-Monde-assessment-over-the-Euro-Mediterranean-area.pdf GMD paper] illustrates Jacobians distributions for different layers using the diffusion soil scheme of ISBA (ISBA-DIF), they tend to be smaller than those from ISBA-3L and I obtained much less spurious values. However I did not consider T2m or RH2m.
     * We know that within the OI scheme the assimilation is turned off during e.g. precipitation events. This should be done also for EKF.
     * An idea to test: In all the control and perturbed runs write out diagnostics for each point if we reach field capacity or wilting point. In the analysis part we read the diagnostics and turn off the update of the points where we can assume the linearity has broken because of reaching FC or WP.
   * Stefan has tested sEKF with ISBA diffusion scheme (using the standard 14 soil layers) for SWI (soil layers 1 to 6) in SURFEX 8.0
   * Steps toward EKF with evolving B-matrix. [https://hirlam.org/trac/attachment/wiki/Surface_physis_assimilation/EKF_surface_work/EKFvsSEKF.pdf See slides by Katya explaining the principles behind SEKF and EKF.]
   * HARMONIE-AROME includes 2 patches. Trygve has developed cy40h to make 2 patches and Explicit snow scheme compatible. 
   * Patrick has verified that the branch [https://svn.hirlam.org/branches/harmonie-40h1.2_EKF] works technically for the combination Force-restore/D95 and EKF with 2 patches.
   * Rearranging the Offline SURFEX runs in the HARMONIE system, Ecflow (move them from the Forecast part to the the post processing part).
   * [https://hirlam.org/portal/validation/40h1/OI_versus_EKF_13_16_May_export/ Monitor validation of first S(imple)EKF (versus OI) simulation with HARMONIE-AROME looks promising]. But no investigation of increments have been done yet. And no sensitivity test w.r.t. limitations of Jacobian values have been done. Validation is shown for the !MetCoOp domain for a short period !20160513-!2060619 proceeded by a spinup period from !20160501.
 * Progress with SURFEXv8 related processes
   * The wish list for new physics options in cy43/SURFEXv8 is currently tested by Samuel, Emily and Patrick. [https://hirlam.org/trac/wiki/Surface_physis_assimilation/New_SURFEX_options_cy43h See current wish list here].
   * The climate branch of cy43t2 is used for tests: [https://svn.hirlam.org/branches/harmonie-43t2_climate]. Samuel, Emily and Patrick report on progress and issues.[https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/cy43_climate_surfex80_tests.pdf]
   * Glacier development: A modified version of the Explicit snow scheme will be used for glaciers. Development is ongoing. [https://hirlam.org/trac/wiki/Surface_physis_assimilation/Glacier_plans See comments and plans from latest meeting on glacier development in Toulouse here]. Bolli reports on progress.
 * CANARI/MESCAN development
   * Start to utilize MESCAN and its non-isotropic structure functions. [https://hirlam.org/trac/wiki/Surface_physis_assimilation/MESCAN_tests See comments on MESCAN settings here.] Mariken Homleid is working on this now.
   * An inconsistency between land/sea mask between CANARI and SURFEX leads to problem with e.g. snow assimilation. Katya will look into this.
   * Utilisation of SURFEX variables in CANARI: Currently, as first guess grid-averaged values of T2m and Rh2m are used. But it would be more physically correct to use land (ISBA) and/or patch (open land) values. Ideas on how to proceed have been discussed but no concrete setup is available yet.
 * Parameter sensitivity studies:
   * Currently, given a new release of a HARMONIE-AROME cycle there are still a number of parameters in SURFEX which, if they are tuned, may give yet a bit better performance of a certain setup (domain). John reports progress and development plans.
 * Wave modelling:
   * [wiki:Surface_physis_assimilation/Sea_wave_modelling Modelling of sea waves in the ALADIN-HIRLAM NWP system]. Lichuan reports progress and plans. 
 * SURFEX forcing package in python:
    * Trygve develops a forcing preparation for SURFEX offline in Github ([https://github.com/metno/offline-surfex-forcing]): 
 * Orotur and ororad
    * Some slides for this meeting: https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Rontu_Surf18.pdf 
    * An ASW18 presentation: http://www.umr-cnrm.fr/aladin/IMG/pdf/rontu_asw18.pdf
    * A published paper on ororad: http://dx.doi.org/10.3389/feart.2016.00013 and an [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Harcau_v2.pdf older version], containing some orotur also
    * A [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/orotur40.tgz tarball] with orotur code from an ecgate/cca experiment:  
 * Other topics
    * Epygram is used at a few institutes. For those who build AROME/ALARO with gmkpack (e.g. in Slovakia) it seems pretty straight forward to couple the fa-reading/writing routines to Epygram and have it working. HIRLAM has the idea to build Epygram as part of the HARMONIE configuration (using make). But it is still unclear if needed compiling flags may influence the performance of the model in an unwanted manner. Thus, this still needs to be investigated by the HIRLAM system group. It is said that Alexander Mary (Méteó-France) has the intention to install Epygram at the ECMWF machine. This would be useful…
   * use GL to convert SURFEX output to GRIB1


== Preparations for the meeting, who does what... ==

Pre-Tromsø Google Hangouts meeting March 26 with participants: Patrick, Laura, Katya, Teresa, Yurii, Mariken, Tomas, Emily, Jelena, Stefan, Magnus, John, Samuel  

=== EKF stuff ===

Patrick: Has created a new branch for EKF development based on trunk (cy40h1.1.1 code):
[https://svn.hirlam.org/branches/harmonie-40h1.1.1_EKF]. The intention is to use this branch to develop an operational environment where OI is replaced by EKF in cy40h. The idea is to use a new set of control variables, TG2, WG2, WGI2. I.e., only second layer variables and also soil ice. This idea is based on good experience with running SEKF offline with Sodankylä (1 point) forcing in SURFEXv8.1 environment.
Until the May meeting the hope is to have at least one longer EKF simulation (compared with current OI setup). '''Action: Patrick'''

Jelena has development of STAEKF/LAI at ECMWF machine. Modifications concern e.g.:
 * Scripts to allow for flexible number of control variables (not hard coded to 4).
 * LAI is implemented as control variable but something still needs to be changed since any new LAI due to increment is now overwritten by ECOCLIMAP LAI. 

'''Action: Jelena/Patrick move this into the EKF branch'''

The SURFEX8.1 Sodankylä setup has recently been successfully used in snow-data-assimilation training. It’s an efficient tool to do sensitivity test with SEKF and investigate the behaviour of control variables, Jacobians, … [https://drive.google.com/drive/folders/1Vy_IhiB50qxyTzEhLi0SE7OvpzzaV2lU?usp=sharing This setup is available here]
It can be useful to download this and take a look before the May meeting to discuss aspects of (S)EKF. Reading papers is also useful of course :-) 
For example:
 * Is the new suggested setup of control variables good (TG2, WG2, WGI2)?
 * What to do during precipitation and snowmelt events? Should assimilation be turned off due to risk of non-linear behaviour? Yes, Jelena advices that. 
 * Alternatively, and/or, we should limit the Jacobians as Magnus has done in his IMPREX experiments. Most probably also needed. Tests will show...
 * Can someone test the Evolving B-matrix option in this Sodankylä setup? ** Åsmund has done this.**

Please, look into these questions and bring your experience/knowledge. '''Action: In principle all'''


=== cy43/SURFEX8.0/1 climate setup ===

Please follow progress in this [http://hirlam.org/index.php/forum/2-harmonie-system/1302-cy43 Forum discussion].

There are two branches related to this:

 * One branch is based on the NWP cy43 setup but is by default setup to be run in climate mode without any data assimilation: [https://svn.hirlam.org/branches/harmonie-43t2_climate]. This branch has been tested by mainly Samuel and Emily. The status is that it runs for a month or so with almost full SURFEX wishlist activated. But it normally crashes at the beginning of a new month in any of 3-4 subroutines related to soil ice or snow. '''Action: Samuel gives a status report''' 
 * The other branch is related to replacement of SURFEX8.0 with SURFEX8.1: [https://svn.hirlam.org/branches/harmonie-43t2_climate_SFX81].
This crashes almost directly independent on settings. Patrick is working on a solution…
Please note that ORORAD is missing in this setup since it is not part of SURFEX8.1.
'''Action: Patrick gives status report'''

Who else can join this development/testing? '''Question to all.'''

=== Glacier development ===

A modified version of the Explicit snow scheme will be used for glaciers. Development is ongoing. Action: Bolli reports on progress.

=== CANARI and gridpp ===

As most of you are aware of HIRLAM colleagues have been bothering/question CANARI shortcomings and how to deal with them in development needs. LACE colleagues are not yet bothered. Problems in HIRLAM are e.g.:

 * Inconsistent land/sea mask between SURFEX and CANARI which creates for example errors in snow data assimilation.
 * For analysis of observed snow depth (m) the first guess SWE (kg/m2) is divided by climatology snow density to create snow depth for analysis of snow. It should be SURFEX snow density.
 * For analysis of T2m/Rh2m, snow we would like to use first guess from relevant SURFEX tile/patch but that is currently not possible (only grid value).

Now a new tempting analysis tool is under development at !MetNorway: [https://docs.google.com/presentation/d/1IQF6H7Zi697HjMD1pAxq7gSFWw3auUbCFp-7fQj4Tj8 gridpp]

'''Action: Trygve reports on [https://docs.google.com/presentation/d/1MBpVjMyKwBWwV86KVjgmExbDYdi_YXLnCndK-xXmA9Y/edit?usp=sharing status/development/plans]'''

Strategic question: should we focus on gridpp as a replacement of CANARI? The feeling now is in yes direction but we still need to solve more urgent issues in CANARI. Katya will look into the snow data assimilation related to land/sea mask.

John reports that KNMI will do sensitivity tests related to surface analysis on/off to look into e.g. the problem with low soil moisture (evapotranspiration) during the summer period.

 '''Action: all to consider the strategic question'''

=== Physiography ===

We are now and then questioning our physiography (ECOCLIMAP). On this list we now have LAI which seems to increase too quickly during spring time in some domains, e.g. KNMI and !MetCoOp, which leads to excess evapotranspiration during spring time (possibly also related to strange soil water increments in OI).

SURFEX 2nd generation offers new physiography fields. Are they better? '''Action: John reports on ongoing investigation'''

I will probably have something to report here! - '''Bolli'''

Laura et al. have prepared a setup which enable us to test a new sand/clay database (soilgrid.org). A test by Esbjörn is currently running over the !MetCoOp domain. '''Action: Patrick reports results'''

We might discuss orography-related subgrid-scale variables for ororad and orotur, how to advance with their derivation from high-resolution DEM. '''Action: Laura prepare discussion point''' 

Teresa et al. is currently looking into physiography issues for Svalbard. Default cover descriptions are questionable. Also, a glance into ECOCLIMAP 2nd generation also indicates some issues...

Other physiography issues to consider? '''Action: all to report and show examples.'''


=== Simple Sea Ice (SICE) ===

SICE with prescribed ice thickness and no snow on top is in cy40h1.1 (operational in !MetCoOp, AROME-Arctic, …). Now, in pre-operational mode SICE with prognostic ice thickness is running for AROME-Arctic. Next steps include, for example, assimilation of ice/snow surface temperature...

'''Action: Yurii reports on status/plans/questions'''

=== Assimilation of satellite-based snow cover extent ===

Currently we use SYNOP snow depth observations for SWE assimilation. Tests are ongoing with satellite based snow extent product H-SAF 32. In principle it should be pretty straightforward to replace earlier tests other satellite products with H-SAF. Katya will let us know about progress.

NSIDC MODIS MOD10A1 daily product available from 2000 at 500 m resolution: [https://nsidc.org/data/mod10a1 MOD10A1]

'''Action: Mariken and Katya reports on status and plans.'''

=== Parameter sensitivity studies ===

Currently, given a new release of a HARMONIE-AROME cycle there are still a number of parameters in SURFEX which, if they are tuned, may give yet a bit better performance of a certain setup (domain). Parameters until now looked into by John are e.g. Rsmin, Interception capacity, ratio z0m/z0h, soil… On the list are also thermal and hydrological properties of the soil.  

'''Action: John reports progress and development plans.'''

=== EnKF development ===

Tomas is developing/running EnKF in SURFEX8.1/CMEM(HUT) environment. '''Action: Tomas reports on status/development.'''

=== Wave modelling ===

[https://hirlam.org/trac/wiki/Surface_physis_assimilation/Sea_wave_modelling This wiki describes some of the plans related to wave modelling]. Lichaun has a system running under cy43 climate branch where the OASIS-MCT coupler is used to couple WW3 to SURFEX. Wave people will not join the Tromö meeting but arrange a separate meeting. Lichuan, please tell us more useful information.


== Location of meeting, hotels and transport ==

The meeting will take place at [https://en.uit.no/startsida the University of Tromsø, Norway.]

[https://use.mazemap.com/#v=1&zlevel=-1&left=18.9626666&right=18.9893946&top=69.6834616&bottom=69.6766190&campusid=5&campuses=uit&sharepoitype=identifier&sharepoi=s05-E0103 See here for exact position of the meeting room E0103.] The building is next to a bus stop where buses from the town centre stops.

'''For hotels:'''

Please book yourself, e.g.:
 * [https://www.thonhotels.com/our-hotels/norway/tromso/thon-hotel-tromso/?utm_source=google&utm_medium=infoboks&utm_campaign=GMB Thon Hotel Tromsø]
 * [https://www.nordicchoicehotels.no/hotell/norge/tromso/clarion-hotel-the-edge/?utm_source=googlemybusiness&utm_medium=organic&utm_campaign=regular-pictures Clarion Hotel The Edge]
 * [https://www.radissonblu.com/en/hotel-tromso?facilitatorId=CSOSEO&csref=org_gmb_sk_en_sn_ho_TOSZH Radisson Blu]
 * [https://www.scandichotels.no/hotell/norge/tromso/scandic-ishavshotel Scandic Ishavshotel]

'''Transport:'''

E.g. buses 20 (towards Stakkevollan) and 34 (towards UiT) from town centre (bus stop currently opposite Radisson Blu Hotel) stops (bus stop UiT Tromsø) next to the building of the meeting.

You can use [https://play.google.com/store/apps/details?id=no.bouvet.routeplanner.troms&hl=en Troms Reise app] to check which bus to take and when.

You can buy bus ticket via the [https://play.google.com/store/apps/details?id=no.wtw.mobillett.tromso&hl=en Troms Mobillett app]. You register your credit card and then you can buy single tickets or 7-days ticket.

== Draft Agenda ==

=== Monday May 28 ===

Meeting starts at 09:00 [https://use.mazemap.com/#v=1&zlevel=-1&left=18.9626666&right=18.9893946&top=69.6834616&bottom=69.6766190&campusid=5&campuses=uit&sharepoitype=identifier&sharepoi=s05-E0103 in meeting room E0103.] The building is next to the bus stop UiT Tromsø where buses from the town centre stops.


 * Patrick: Welcome and introduction to meeting [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/HIRLAM_Surface_Patrick_180527.pdf pdf]
 * Patrick: Setup of offline SURFEXv8.1/SODA for the FMI Sodankylä site. This is very useful for development/tests of e.g. (S)EKF performance.
   * If you have access to the SURFEX Git repository you can [wiki:HirlamMeetings/Surface201610/SODA_development setup the SODA_V8 branch by following this wiki].
   * Even easier, [https://drive.google.com/drive/folders/1Vy_IhiB50qxyTzEhLi0SE7OvpzzaV2lU?usp=sharing download a SURFEXv8.1/SODA version here which includes the Sodankylä setup and also instructions].
 * Mariken  [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Task2.4_Surface_snow_Mariken_180507_v2.pdf CARRA-snow-extent-exp ]/ Katya: Assimilation of satellite product of snow extent
 * Samuel / Emily: cy43_climate experience so far. [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/cy43_climate_surfex80_tests.pdf pdf]
 * Bolli: New sources of LAI: MODIS satellite product [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/SFX_MODIS_LAI-201805.pdf pdf]
 * Laura: Status of subgrid-scale orography parametrizations ororad and orotur in HARMONIE-AROME [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Rontu_Surf18.pdf pdf]
 * Kristian: Radiation/albedo coupling AROME-SURFEX [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Nielsen_albedo_coupling_Tromsø_20180528.pdf pdf]

 * Discussion points and working items:
   * In the convection study initiated by Sander Tijm the role of LAI for evapotranspiration has been highlighted. Current ECOCLIMAP LAI fields are certainly questionable (often too high in spring time). Unfortunately, I would say, depending on climate region, we probably suffer more from bad LAI with present Force-restore scheme than we will do with more advanced physics. So, what alternatives do we have for LAI: 
     * LAI from new 2nd generation data base: John is looking into this. Does it look better than current ECOCLIMAP II?
     * LAI from MODIS: Bolli has looked into this for Iceland. Something we should consider also for other domains. Bolli, what do we need to do for this?
     * LAI from STAEKF: Jelena has implemented STAEKF/LAI in a cy40 setup. But we need (S)EKF running to utilize this. Should we put effort here rather than in new data bases???
     * At All Staff in Toulouse Balazs Szintai presented an idea to use satellite LAI product in combination with SURFEX offline simulations with A-gs (prognostic LAI) (meaning full number of patches in SURFEXv8) to estimate LAI fields which are then used as input for the operational model LAI. (Longer term solution...) 
   * cy43 progress
     * Where are the obstacles and how can we proceed together?
       * The last planned bug fix from Météo-France has just arrived. Is implemented by Niko in [https://svn.hirlam.org/branches/harmonie-43t2].
       * System related people will update the scripting system from cy40h development into the harmonie-43t2 branch.
       * Samuel and Emily are testing the harmonie-43t2_climate branch.
       * Samuels tests with [https://svn.hirlam.org/branches/harmonie-43t2_climate] in climate mode show that the cycling is correct, i.e. the surface variables are conserved for instance from the last file of October to the first of November where the Forecast still runs for IBERIA_2.5. Then in December it crashes with crazy field values in many surface variables (radiation, soil temperatures, canopy fields, isba & town fluxes, etc...) while the last SURFEX file from November is still okay. So the activation of Explicit Snow Scheme spoils a large number of fields when snow appears in a given domain. I checked and the crazy values are located in a few grid points around the Sierra Nevada mountains in SE Spain.
       * Okay, so how to tackle Explicit Snow Scheme problems? The plan is to replace SURFEXv8.0 with SURFEX8.1. This work is going on in branch [https://svn.hirlam.org/branches/harmonie-43t2_climate_SFX81]. But it is not yet successful. The setup crashes in the first time step but at different places depending on DOMAIN and HPC. We need more people here!
       * Also, SICE by Yurii is only available for cy43h via SURFEX8.1.

=== Tuesday May 29 ===

 * Magnus: HARMONIE-AROME surface data assimilation enhancements introduced within IMPREX Horizon 2020 project [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/magnus_imprex_tromso.pdf pdf]
 * Jelena: STAEKF for LAI in cy40 [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Surface_EKF_28052018.pdf pdf]
 * Åsmund: Offline tests with diffusion soil scheme and EKF [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/NILU_LDAS_activities_v02.pdf pdf] and [http://urn.nb.no/URN:NBN:no-63515 master_thesis]
 * Trygve: [https://docs.google.com/presentation/d/1MBpVjMyKwBWwV86KVjgmExbDYdi_YXLnCndK-xXmA9Y TITAN/gridpp and SODA]
 * Clément: Surface data assimilation development in the SURFEX/SODA team at Météo-France [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/0-Albergel_HIRLAM_SWW_Tromso_2018.pdf pdf0], [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/1-Bonan_LDASMonde_EnKF_G3TAssim_20180522.pdf pdf1], [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/2-presentation_asm_aladin_hirlam_CA.pdf pdf2], [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/3-Slides_SODA_Clement.pdf pdf3] [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/4-Albergel_LDASMONDE_ERA5_EGU2018.pdf pdf4]
 * Tomas: Spin-up ensemble for EnKF in SURFEX8.1/CMEM(HUT) environment [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/landelius_tromso_1805.pdf pdf]
 * Stefan: Surface assimilation work at ZAMG [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/SURFEX_activities_at_ZAMG.pdf pdf]
 * Yurii: using satellite surface temperature (product) for assimilation of sea-ice temperature. [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/sice_29052018.pdf pdf]
 * Katya: Principle sketch describing the principles of EKF and SEKF. [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/EKFvsSEKF.pdf pdf]
 * Katya: Data assimilation for FLake [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Kourzeneva_LAKE2015.pdf pdf]

 * Discussion points and working items:
   * The short-term plan is to head for replacing OI with (S)EKF. What is needed for that?
     * For assim_nature_isba_ekf.F90:
       * Investigate for which cases the Jacobians deviate much from linear behaviour.
       * Probably avoid WG/WGI updates during rain and snow melt periods (i.e. set dX2m/dWG2 and dX2m/dWGI =0)
       * Do not limit increments after analysis if e.g. WG2>Soil porosity but instead introduce lagrange multipliers before the Kalman Gain is solved for.
     * Merge in Jelena's development on STAEKF
     * Move offline perturbation runs for EKF in Ecflow to postprocessing
   * The long term plan is to go for EnKF. How/when?
     * Currently the "HIRLAM" work is done by Tomas within an external project. We should be careful that this job/knowledge is not forgotten.
     * Strategically, when is it time to push more man-power into the EnKF direction and stop developing EKF? 
   * CANARI issues
     * Inconsistencies between land/sea mask (SURFIND.TERREMER(?) in climate/m* files) and SFX.FRAC_*(?) in climate Const.Clim.sfx cause problems in snow analysis.
   * Cold start snow problem
     * [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/snow_crash_in_CANARI.txt Look at email from Ulf here.]


=== Wednesday May 30 ===

 * [https://docs.google.com/document/d/1z_iFX8m4Lae9umcHWaGsJL-sDVrCsQX5C76KF-NrHYQ/edit?usp=sharing See this link for work/discussion in possible group constellations]

 * Dinner at [https://fjellheisen.no/en/ Fjellheisen]
   * Dinner starts at 18:00 which means that we should take the cable car leaving from the lower station at 17:30. We go as a group for special price so be sure to join the group.
   * ... which means that the latest bus from Tromsö centre one should take is Bus 26 (towards Tromsdalen) at 17:15 from Stortorget (not Sjögata 1). To be more on the safe side one can take the bus at 16:55. The bus stops at Fjellheisen at 17:22.
   * At the beginning of the dinner everyone goes to the cashier and pay for food (Finnebiff 260 NOK, Bacalao 199 NOK), drink (as you wish), and cable car (130 NOK). Be sure to keep the receipt for going down with cable car.


=== Thursday May 31 ===

 * Work/discussion in different group constellations
 * In the afternoon: Summary of meeting (see below)
 * Time and focus of next surface working week

=== Friday June 1 ===

This day is a combined work and travelling-home-day. Thus, those of us who have an afternoon flight can still enjoy each other before lunch :-) 

== Memory notes ==

=== Proceeding with cy43 from a SURFEX perspective ===

People: Samuel, Emily, Trygve, Åsmund, Patrick,

 * cy43-climate-SFXv8.0:
   * Does run in principle but it is sensitive for Explicit Snow Scheme at the beginning of a month. It crashes for still unknown reasons. Samuel looks into this in 3D. Emily try to reproduce the crash in cy43-MUSC but there it does not crash. 
 * cy43-climate-SFXv8.1:
   * TS_WAT initialisation is not working correctly.
   * Compiler dependent problems appear. Intel seems to work while gnu does not. Trygve and Åsmund are looking into this.
 * harmonie-43h1.pre-alpha.1_SFX81
   * A new branch based on the alpha branch but where SURFEX is replaced by SURFEX8.1 from the SURFEX_NWP branch in the SURFEX git repository. Patrick is working on this.

When the climate setup of cy43/SURFEXv8.1 is working: Run multi-year simulations in climate mode to identify/reduce systematic biases before data assimilation is activated in operational mode.

 * Samuel and Emily have been looking into observational data sets for validation of climate runs.

=== Surface data assimilation ===

People: Magnus, Jelena, Stefan, Tomas, Katya, Clément, Yurii

 * Short term goals
   * In cy43 use SEKF with diffusion soil scheme and explicit snow scheme. First use conventional observations for assimilation (i.e. T2m and Rh2m) and then also satellite products. Later on cy43 will be updated with assimilation of sea-ice surface temperature in SICE but first this work will be done in the cy40 framework (required by external project).
   * Problems with crazy Jacobians is expected to be less with more advanced physics than with simple physics (Force-restore) but still we probably need some safety rules to avoid problematic behaviour.
   * We acknowledge problems with bad representation of LAI from ECOCLIMAP data base. During the discussion we conclude that STAEKF (technically implemented by Jelena in cy40) is not going to solve the real problem since STAEKF will simply optimize LAI to fulfil good fit with observations (T2m, Rh2m). Such an optimisation may not necessarily lead to e.g. better evapotransportation. Thus, we conclude that it is probably more beneficial to first look for best available LAI climatology (e.g. ECOCLIMAP 2nd generation) and then complement with assimilation of a LAI satellite product. See [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/ECMWF_albedo_LAI.pdf this paper by Boussetta et al.] on how it has been done by ECMWF. 
   * Snow assimilation work: Solve CANARI land/sea mask inconsitencies and use proper handling of snow density. (See CANARI memory notes below),
   * We suggest to not apply any assimilation for TEB right now: i) Observations representing town areas are missing and ii) as for FLake, town areas are smaller than nature areas. 

 * Medium term goals for EKF.
   * Regarding enhancements of above. Evolve B, check time scales and length of assim window + potential assimilation enhancements.
   * Include assimilation of FLake variables.

 * Medium / Longer term work EnKF
   * EnKF, assimilation of raw radiances (if availale soil moisture, temperature and snow (smos)). (Tomas, Jelena)
   * CMEM/HUT work with SSMIS, AMSR2 and MWRI and Sentinel 1 SAR data to be kept alive and coordinated (Tomas, Katya).

 * Pre-processing
   * Clément will provide stand alone open-source tool based on cdf to be included in HARMONIE system.


=== CANARI issues ===

 People: Katya with support from Patrick, Tryggve, Mariken, Yurii,

 * Inconsistencies between land/sea mask (SURFIND.TERREMER(?) in climate/m* files) and SFX.FRAC_*(?) in climate Const.Clim.sfx cause problems in snow analysis

 * Now first guess of T2m, Rh2m, and snow comes from grid-averaged values from previous cycle (e.g. ICMSHHARM+0003). So the idea is to transfer our preferred SURFEX fields:
   * Weighted new continuous fields of temperature and relative humidity, e.g. NewT2m = (T2mopen_land where it exists or T2mfor where it exist or T2m_grid). This new field needs to become available for CANARI and for SODA (read_isban.F90).
   * For snow this field should be used DSN_T_ISBA, right?
   * The new fields should be provided to CANARI via ICMSHHARM+0003, the atmosphere.

 * Provide snow depth from SURFEX to CANARI to assimilate snow depth in CANARI which is then sent to SODA (this variable should also be send via ICMSHHARM+0003). Or give snow density to CANARI to replace the climatology snow density now used in CANARI.

=== Snow ===

Currently the external CARRA reanalysis project initiate some snow related development that may also be useful for operational domains:

 * Assimilation of satellite snow extent products by Katya and Mariken. See [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Task2.4_Surface_snow_Mariken_180507_v2.pdf Mariken's presentation] for more information.

 * The formulation of snow albedo for the D95 snow scheme is now looked into by Patrick, Kristian and Bolli.

 * The initializing and re-initializing of snow over glaciers is looked into by Kristian, Bolli, Mariken. 


=== Orography-radiation (ORORAD) ===

Our Météo-France colleagues will transfer the development of ORORAD in cy43t2 as a contribution SURFEXv9 into the SURFEX Git repository. In this way it will become available for us in our cy43h/SURFEXv8.1 setup. When that is done we can perform tests and eventual further development. Laura is in contact with Météo-France colleagues to check status.

=== Orography - turbulence (OROTUR) ===

[https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201805/Rontu_Surf18.pdf See Laura's presentation on OROTUR]. So, OROTUR will affect the final grid-averaged momentum flux based on sub-grid orography information. Thus, largest impact will be seen in lower atmosphere wind fields. We discussed how the effect of OROTUR should be validated. We agree that U10m is not perfect since observations are sensitive for local conditions and may not always be representative. Still, a careful selection of SYNOP stations may give a number of stations that can be useful. 

It was suggested that sensitivity tests can be performed with cy40h over domains MetCoOp (Laura), Ireland (Emily), Spain (Javier?), Iceland (Bolli) where the OROTUR package by Laura is used (not part of official cy40 release).

Laura and Patrick will implement OROTUR into the SURFEX Git repository as a contribution to SURFEXv9. In this way it will become available in our cy43h/SURFEXv8.1 setup. 

=== cy43-MUSC setup ===

Laura and Emily has implemented a MUSC setup in a cy43 development branch: [https://hirlam.org/trac/browser/branches/harmonie-43t2_climate/util/musc].
See this [https://hirlam.org/trac/browser/branches/harmonie-43t2_climate/util/musc/test/test43t2clim/README README file] for additional information. 

=== TITAN / gridpp and SODA ===

See [https://docs.google.com/presentation/d/1MBpVjMyKwBWwV86KVjgmExbDYdi_YXLnCndK-xXmA9Y TITAN/gridpp and SODA presentation by Trygve].
Trygve has a HARMONIE / Ecflow draft setup where Canari is replaced by TITAN / gridpp. Development continues...

Although no people outside Met-Norway are involved yet the HIRLAM team supports this development with interest and will seriously consider this as an alternative for Canari.
Trygve keeps us up-to-date and tell us when it seems reasonable that other people outside Met-Norway can have a look at it.

=== Physiography and NORNWP PGD group ===

A few versions of ECOCLIMAP now exist:
 * The ECOCLIMAP binary file on 1x1km2 resolution with cover numbers has been modified. E.g. by
    * Katya for coastal area lake/sea/river definitions.
    * Bolli where he has re-used some cover numbers for Iceland specific surfaces.
    * AEMET where artificial water reservoirs have been added as lakes.
 * The ecoclimap parameter ascii files with characteristics for each cover type has been modified. E.g. by
   * Katya to remove lake water from wetland areas (not suitable to run these with FLake).
   * Bolli to specify low albedo values for dark sand / lava fields on Iceland.   

Bolli will coordinate an exercise within HIRLAM where local modifications will be merged into new versions. 

In a sub-meeting Bolli gave a presentation showing the activities within the NORNWP physiography group. Although the
organisation around NORNWP is currently unclear the physiography group will probabaly continue to exist.
Our Spanish colleagues would like to join these activities. Bolli will make sure a contact is established.

 



== Participants ==

I did a copy/paste from the doodle. I hope you have not changed your mind...?

Please indicate time of arrival, departure and hotel

 * Patrick Samuelsson (SMHI), Sunday-Friday, Thon Hotel Tromsø
 * Ekaterina Kourzeneva (FMI)
 * Laura Rontu (FMI), arrival Sunday evening departure Saturday morning living in apartment
 * Bolli Palmason (IMO), Sunday-Friday, Homestay hotel/guesthouse
 * Tomas Landelius (SMHI), Monday evening - Friday morning
 * Clément Albergel (Météo-France), travel Monday and Thursday so I will participate to 2 full days, Tuesday-Wednesday
 * Stefan Schneider (ZAMG), Sunday evening-Friday morning, Skansen Hotell Tromso
 * Samuel Viana (AEMET), Sunday evening - Friday early morning, Thon Hotel Tromsø
 * Yurii Batrak (!MetNorway)
 * Trygve Aspelien (!MetNorway)
 * Mariken Homleid (!MetNorway)
 * Åsmund Bakketun (!MetNorway)
 * Rafael Grote (!MetNorway)
 * Magnus Lindskog (SMHI)
 * Jelena Bojarova (SMHI)
 * Kristian P. Nielsen (DMI), Sunday evening - Friday afternoon, Skansen Hotell
 * Emily Gleeson (MET Eireann)

== Additional information ==

 * [wiki:Meetings/Surface Please find memory notes from earlier surface meetings here.]
 * [wiki:Surface_physis_assimilation Please find wiki pages dedicated to various surface development here.]

