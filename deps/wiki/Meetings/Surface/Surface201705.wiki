[[PageOutline]]
[[Center(begin)]]
= '''HIRLAM Surface Working Week''' =
''Norrköping, May 8-11, 2017''

Last modified [[LastModified]]

[[Center(end)]]

> '''Conclusions and comments are marked like this'''

== Working items and comments ==

 * Progress with SURFEXv8 related processes
   * Initialisation of snow and soil: Modifications and progress has been done for the Explicit snow scheme (12 layers) by Trygve and Mariken.
   > Now the PREP step works. Next steps in development include the assimilation and proper initialisation of snow where a history of neighbouring snow should be used. 
   * Glacier development: A modified version of the Explicit snow scheme will be used for glaciers. Development is ongoing. [wiki:Surface_physis_assimilation/Glacier_plans See comments and plans from latest meeting on glacier development in Toulouse here].
   > No known progress reported right now.
   * A wish list for new physics options in SURFEXv8 has been discussed. There are some open questions... [https://hirlam.org/trac/wiki/Surface_physis_assimilation/New_SURFEX_options_cy43h See current suggestion and questions marks here].
   > With the help of Patrick LM a few question marks were sorted out. A few still remains...
 * cy43h
   * When we have the forecast part of cy43h running we can start to test HARMONIE-AROME with our new SURFEX namelists in climate mode.
   > HIRLAM is waiting for Météo-France decision on whether to go fir cy43 or cy44. Then HIRLAM needs to decide...
 * CANARI/MESCAN development
   * Start to utilize MESCAN and its non-isotropic structure functions. [https://hirlam.org/trac/wiki/Surface_physis_assimilation/MESCAN_tests See comments on MESCAN settings here.]
   * Problem reported by Sander Tijm related to increments over clay/sand areas: Should clay/sand pattern affect the anisotropic structure functions in MESCAN as land/sea mask and orography? 
   * Utilisation of SURFEX variables in CANARI: Currently, as first guess grid-averaged values of T2m and Rh2m are used. But it would be more physically correct to use land (ISBA) and/or patch (open land) values.
 > See notes below under Canari sub-group meeting.
 * Currently, given a new release of a HARMONIE-AROME cycle there are still a number of parameters in SURFEX which, if they are tuned, may give yet a bit better performance of a certain setup (domain). How to develop a methodology for this?
 > See comments below related to presentation by John de Vries.
 * Assimilation of snow extent: Next step is to utilize the satellite based snow extent (SE) product [http://hsaf.meteoam.it/ H-SAF].  How about IMS ([http://www.natice.noaa.gov/ims/ Interactive Multisensor Snow product])? [wiki:Surface_physis_assimilation/Snow_assimilation_plans Status and plans on our snow wiki page.]
 > The IMS product was considered too coarse for NWP use according to Kalle Eerola (FMI). Thus, our best candidate is H-SAF. No progress yet.
 * Preparation of SURFEX forcing files: Currently, [https://hirlam.org/trac/browser/trunk/harmonie/util/forcing/doc offline forcing in HARMONIE-AROME by Trygve] is used by HARMONIE-AROME to create forcing for SURFEX from AROME simulations when surface EKF is activated. Trygve has been thinking on a new offline forcing generation in HARMONIE-AROME. Based now on the initiative by John de Vries to build a python based offline forcing generation, John and Trygve are asked to coordinate their ideas also with Daniel since there is a long term plan to build the HARMONIE-AROME scripting system around python. Stefan also mentions that Victor at Slovakia Met Service has done a similar solution in python.
 > See comments related to offline forcing side-group meeting below.
 * Progress with EKF. [wiki:Surface_physis_assimilation/EKF_surface_work#StrategicquestionsregardingsurfacedataassimilationmeetingJanuary262017 See memory notes on latest discussion on plans here] 
   * Connection EKF and 2 patches need some development.
   * Rearranging the Offline SURFEX runs in Ecflow (move them to post processing?).
   * [https://hirlam.org/portal/validation/40h1/OI_versus_EKF_13_16_May_export/ Monitor validation of first S(imple)EKF (versus OI) simulation looks promising]. But no investigation of increments have been done yet. And no sensitivity test w.r.t. limitations of Jacobian values have been done. Validation is shown for the short period !20160513-!2060619 proceeded by a spinup period from !20160501.
   * Jelena has now implemented STAEKF for LAI in a test version of cy40h1.1
   * Steps toward EKF with evolving B-matrix. [wiki:Surface_physis_assimilation/EKF_surface_work/EKFvsSEKF.pdf See slides by Katya explaining the principles behind SEKF and EKF.]
   * We need to limit/eliminate crazy Jacobian values in non-linear situations, like in the case of rain/snow melt...
 > Magnus, Jelena and Patrick now have EKF-based experiments and results available. They will coordinate investigations and tools. Special focus will be devoted to identify under which circumstances crazy Jacobian values appear and how to tackle these in the best way.
 * Sea-ice development. [https://hirlam.org/trac/wiki/SURFEX-ice#Sea-icedevelopmentmeetingJanuary232017 See status here.]
 > Yurii says: The latest developments in SICE is introduction of ice mass balance in a HIGHTSI-like way. First results were shown during ASM, and I would like to comment that parameterization for ice thickness evolution was tested in climate mode and it gave very promising results. But to obtain smooth ice field I had to run SICE for all ocean points and use ice fraction only for averaging and not to define ice-covered grid cells. I'm still haven't decided how to initialize new ice in NWP mode (in terms of ice thickness).
 * Solve issue with SST interpolation error: A problem when reading regular coordinates via Prep_ini_surfex. [http://hirlam.org/index.php/forum/2-harmonie-system/1268-sst-from-era-interim-in-harmonie-40h1-1 See discussion in HIRLAM Forum on this issue].
 > See comments below related to presentation by Patrick S.
 * Issue with less urban fractions in ECOCLIMAP2 compared to ECOCLIMAP1. What is the truth? Look into Urban Atlas. Has an impact for Urban Heat Island over the Netherlands.
 > See comments below related to urban sub-group meeting.
 * Suspected problem with surface roughness lengths:
   * Nordic operational forecasters report that wind speeds are too high over snow covered areas (at least the problem seems to be connected to snow). Patrick made a test for a stormy case in northern Sweden January 18th, 2017. Roughness for snow is increased from default value z0snow=0.001 m to z0snow=0.01 m. [https://hirlam.org/portal/smhi/HARMONIE_MONITOR/snow_roughness_export/ The result is shown in monitor verification here]. The validation period is only three days so noise is considerable but [https://hirlam.org/portal/smhi/HARMONIE_MONITOR/snow_roughness_export/?choice_ind=Surface;inremlist=0_0_0_0_1_0_0:0_0_0_5_1_0_0:3_0_0_5_1_0_0 a clear impact is seen for 14 mountain stations here].
   * The SBL scheme which has been active over nature so far limits the roughness length to maximum 0.25 m. When it is turned off the [wiki:Surface_physis_assimilation/Snow_assimilation_plans#SURFEXsettingsoffr_vegandz0_vegaddedbyPatrick roughness length is given according to this table]. Thus, for forest with tree height 15 m the roughness length becomes 1.95 m. Thus, if the tree height is unrealistically high it may give a negative bias in wind speed. Mariken has tested to reduce tree height for covers where it seems unrealistic, with good results. But another candidate for modification is the relationship z0veg = 0.13 hveg which maybe should be limited at a maximum z0veg...
 > See notes below under wind, roughness sub-group meeting.
 * A potential post-cy40h1.2 as an intermediate step towards cy43h including:
   * FLake
   * 2 patches
   * MESCAN
   * EKF in combination with Force-restore and D95 snow (or Explicit Snow Scheme maybe...?).
   * CANARI - SURFEX coupling to go beyond grid-averaged first guess.
 > We conclude that using EKF for surface in a cy40h1.2 environment would be a good learning step towards EKF in combination with more advanced physics. Thus, any NWP group who is willing to test such a setup in (pre)operational mode is encouraged to do so in discussion with the HIRLAM Management Group. Beside FLake and 2 patches, MESCAN is probably the lowest hanging fruit. Both EKF and Canari-SURFEX coupling need more development and evaluation.
 * Work on orographic/radiation and parametrization of orographic momentum fluxes. [https://hirlam.org/trac/wiki/Surface_physis_assimilation/ORO_development See status here.]
 > No progress yet.
 * TEB development. [https://hirlam.org/trac/wiki/Surface_physis_assimilation/TEB_development Here we had some quite ambitious plans] but due to personnel changes it is questionable how much of these plans we can implement.
 > See comments under urban sub-group meeting below.
 * Coding strategy: All HIRLAM SURFEX additions in cy43h that affect the AROME-Météo-France NWP setup (e.g. Force-restore and d)5 snow) should be under namelist flags so we can easily reproduce cy43t.
 * Sand and clay fraction: A NordNWP project was started in March 2017 about improving these in the Nordic countries. This work has already been done in Iceland by Bolli Palmason, but should be implemented properly in ECOCLIMAP.
 > Work on this will continue involving Katya Kurzeneva (Finland), Teresa Valkonen & Rafael Grote (Norway), Margarita Choulga (Latvia), Kristian P. Nielsen & Kai Sattler (Denmark) and Lisette Edvinsson (SMHI).

== Location of meeting, hotels and communication ==

The meeting will take place at [https://goo.gl/maps/xpBa84oLPwz SMHI, Norrköping]. For hotels:
 * The nearest hotel to SMHI is [http://www.borgshotell.se/ Borgs Villahotel B&B] which you can book by email to {{{info@borgshotell.se}}}. If you let them know that you are a SMHI visitor you should get special deal.
 * There is a block bocking at [https://www.elite.se/en/hotels/norrkoping/grand-hotel Elite Grand Hotel Norrköping] downtown. Price is 960 SEK including breakfast. Book via email {{{reservation.grandhotel@elite.se}}} and provide booking reference GSMH070517. The block booking expires May 1st but after that the price is still the same.
 * Otherwise, as usual, downtown there are plenty of hotels which you will easily find via hotel booking sites.

To reach Norrköping by plane/train: Norrköping airport has connection to Munich. Linköping airport (30 minutes away by taxi) has connections to Amsterdam and Copenhagen. Stockholm south/Skavsta airport is a Ryanair airport 45 min away by bus. Stockholm Arlanda airport is some 2-2.5 hours away by train. [https://www.sj.se/en/home.html#/ Book train tickets via sj.se].

To reach SMHI: 
 * By tram: From train station or hotels downtown take tram no. 3 towards Klockaretorpet. The tram stop is called SMHI and the buildings are easily visible from there. The journey takes around 15 minutes from downtown. One is supposed to be able to buy tickets by credit card on the tram (30 SEK) but a more convenient way is probably to buy a travel card and load it with your expected number travels (24 SEK each). The travel card can be purchased at Östgötatrafiken information centre next to the train station (the card costs 20 SEK).
 * By walking: It takes some 35-40 minutes to walk from downtown to SMHI. [https://goo.gl/maps/pzqcatYYRC12 See directions here].

== Draft Agenda ==

The idea is to dedicate Monday-Tuesday May 8-9 for HIRLAM surface stuff including a mix of presentations and work in group constellations. During Wednesday-Thursday !MetCoOp colleagues need to spend some time in that constellation but we can continue to work with surface stuff in parallel in working group constellations.

=== Monday May 8 ===

Room: Snavlunda, House 12, room B220


 * 09:00 Opening of working week (Patrick Samuelsson)
 * 09:10-10:00 SURFEXv8 overview (Patrick Le Moigne) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/LeMoigne_SURFEX_SMHI08052017.pdf pdf]

Shorter presentations/discussions/status reports in plenum:

 * Summary of surface experiments (Mariken Homleid) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/SurfaceSpringMeetingSMHI_Mariken_170508.pdf pdf]
 * FLake experiment status (Ekaterina Kourzeneva)[https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/Norrkoping_FLake.pdf pdf]
   > Experiments are still running so too early to draw any strong conclusions but first results look promising and as expected. Thus, nothing indicates at the moment that FLake cannot be offered as an option in cy40h1.2
   > Katya will ask Yurii for help to see if the nn_extrapolate.F90 routine can be used to speed up the PGD step.
 * Canari-SURFEX coupling (Trygve Aspelien) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/canari_sfx.pdf pdf]
 * Parameter optimization of SURFEX/MEB (Kim Friberg, SMHI)
 * Issue with SST interpolation error (Patrick Samuelsson) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/Patrick_SST_interpol_170508.pdf pdf]
   > Patrick S will ask Bert to provide his test setup for further testing of the 12-points and bi-linear interpolation routines. Patrick S will involve Patrick LM, Stéphanie, Katya and Bert in further discussions on how to proceed.
 * EKF experiment status (Patrick Samuelsson)
   > After summer Magnus L, Jelena B., and Patrick S will start to analyse all EKF experiments together. Special focus will be to understand what is the cause of "crazy" Jacobian values and how the should be avoided in a proper way.
 * Offline SURFEX forcing package in python (Trygve Aspelien and John de Vries) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/forcing.pdf pdf Trygve] [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/SURFEX_forcing_John.pdf pdf John]

Working groups / side meetings:

 * 15:00 Urban/TEB discussions:
   * Experiences with SURFEX/TEB in UrbanSIS (Jorge Amorim, David Segersson, SMHI) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/UrbanSIS_HIRLAMweeek_8maj2017.pdf pdf]
   * Simulating Helsinki with TEB: projects and plans at FMI (Carl Fortelius)[https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/CARL_FMI_Plans.pdf pdf]
   * Issue with missing towns in ECOCLIMAP2.2 (Patrick S) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/Patrick_S_Urban_170508.pdf pdf]
   * Further discussions with: Patrick LM, Jorge Amorim, David Segersson, Carl Fortelius, ...
   > A quick fix for urban fractions in ECOCLIMAP2.2 for the domain over the Netherlands is needed to make them able to for cy40. One quick and dirty alternative is to modify the ecoclimap parameter file as suggested by Patrick S. A less dirty alternative is to modify the cover numbers in the ECOCLIMAP2.2 file or provide an external new cover file for a limited area. Our KNMI colleagues will continue to look into this.

 * 15:00 A new python based SURFEX forcing generation:
   * Further discussions with: Trygve, John, Klaus Zimmermann (Epygram in HARMONIE), ...
   > Trygve has setup a [https://github.com/metno/offline-surfex-forcing GitHub project for this] where John and Trygve join in further development. Please contact Trygve if you wish to see/join the development.
   >
   > Klaus will work on the building of Epygram as part of the HARMONE system. However, a few obstacles need to be looked into before we know that this will be successful. Hopefully it will. Then, tools like the new python based SURFEX forcing generation can utilize Epygram functionality, e.g. FA-file reading/writing and plotting.
   >
   > Who will contact/invite non-HIRLAM colleagues to join the !GitHub project if they wish?

 * 19:00 Workshop dinner at Asia restaurant Rosegarden

=== Tuesday May 9 ===

Room: Snavlunda, House 12, room B220

 * 09:00 Parameter sensitivity studies (John de Vries) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/ISBA_calibration.pdf pdf].
 > [https://hirlam.org/trac/wiki/Surface_physis_assimilation/Parameter_calibration_ISBA A wiki page dedicated to Parameter calibration of ISBA] has been set up. Please refer here for further documentation and development ideas.

 * 10:00 - 12:00 Merged !MetCoOp/HIRLAM meeting in room Almagrundet, House 24 (behind the reception)
   * Experiences of HARMONIE by !MetNorway/FMI/SMHI duty forecasters
   > The warm bias related to extreme cold winter temperatures may reduced by the use of 2 patches and utilizing the open-land T2m instead of grid-averaged T2m. This may also help reported problem with too small daily amplitude in T2m. Yet to be examined.
   >
   > The positive bias in spring Rh2m is a well known and frustrating problem. The hypothesis is that it is related to too early onset of transpiration from vegetation in the model. Unfortunately a solution of this problem requires the diffusion soil scheme which will become available for us only in cy43/44.
   >
   > If 2 patches do not help to solve the problem with low amplitude in T2m, maybe a too high heat capacity for vegetation (PCV) as has been reported by Eric Bazile (Météo-France) as an issue for Arpege can be worth looking into.... [http://www.umr-cnrm.fr/aladin/IMG/pdf/expose_ebazile_asm2016_wg_surfex.pdf See slide no 8 in presentation by Eric Bazile here.]

 * 12.00-13:00 Lunch

 * 13:00 Web presentation of STAEKF and LAI development in cy40h (Jelena Bojarova) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/Slide_from_Jelena_19042017.pdf pdf]
   * STAEKF has been introduced in cy40h for LAI modifications. The implementation works technically. Next step is an investigation of "crazy" Jacobian values, coordinated with Magnus L. and Patrick S. Jelena suggested modifications of the SODA routines to allow Jacobian calculations to be calculated not only using the start/end values from an offline simulation window but also utilize intermediate data points.

 * 14:00 SURFEX in regional climate applications (HARMONIE-AROME/ALARO-Climate)
   * Latest experiences with HARMONIE-Climate (Danijel Belusic) [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/SURFEX_HCLIM.pdf pdf]
   * Discussions with climate group representatives: Danijel Belusic, David Lindstedt, Petter Lind... 
 > For HARMONIE-Climate simulations based on ALARO0/SURFEX SMHI experiences problems with T2m over sea, especially the Mediterranean. It is kind of strange since SST is prescribed by ERA-Interim. However, if the heat fluxes are not correct it may lead to biases in T2m. Patrick LM reported that important improvements have been done in SURFEXv8 for the ECUME flux parameterisation used over sea. [https://hirlam.org/trac/raw-attachment/wiki/Meetings/Surface/Surface201705/LeMoigne_SURFEX_SMHI08052017.pdf See his slide no 20]. This will now be tested by the climate group.

 * 15:30 Pre-conclusion time
   Together, we went through the list of "Working items" above and commented on status and progress on items that were not covered by sub group meetings.

=== Wednesday May 10 ===

Room: Naimakka, House 12, room B210

 * 09:00-10:00 Merged HIRLAM/!MetCoOp surface presentation and discussion

 * Morning hours: Sub-group meeting on wind speed, tree height, roughness length
 > Based on [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/SurfaceSpringMeetingSMHI_Mariken_170508.pdf Mariken's presentation] and preliminary [https://hirlam.org/trac/wiki/Harmonie_40h1/validation_for_tagging_40h1.2 Observation Verification for the Validation for tagging HARMONIE-40h1.2] we conclude that wind speed over the !MetCoOp domain suffers a risk to reach negative bias in U10m for target 2 (including 2 patches). One possibility to increase wind speed would be by reduced vegetation roughness length, defined as {{{z0veg = 0.13 hveg}}} where hveg is the height of the vegetation. For forested areas the tree height, as specified per cover in ecoclimapII_eu_covers_param.dat, looks suspiciously high over some areas which then could lead to too high z0veg.
 >
 > It seems like we may have access to GIS data bases for tree height for Sweden, Norway and Finland. For Sweden it is available via these web sites for [https://skogskartan.skogsstyrelsen.se/Skogskartan/Default.aspx?startapp=skogligagrunddata visualization] and for the [http://skogsdataportalen.skogsstyrelsen.se/Skogsdataportalen/ data itself].
 >
 > We discussed two alternative ways forward:
  >
  > 1) Based on the GIS tree height maps, edit (decrease the tree height) in ecoclimapII_eu_covers_param.dat for selected covers. In principle this is easy but it requires some job to identify the dominating covers over the domain and to come up with a representative enough tree height for the area affected by each cover, respectively. 
  >
  > 2) Extract the tree height in ASCII format from the GIS shape files (one per country) and paste them together at some aggregated resolution (say 500 m) and mix the result with ECOCLIMAP output for areas outside these countries. Then this file can be used as input to the SURFEX PGD step (see CFNAM_H_TREE in namelist NAM_DATA_ISBA).
  >
  > Discussions on preferred way forward did not lead to a very clear favour for one of the alternatives. But since it now seems possible to get access to digitized tree height information Mariken and Patrick are currently looking into the second alternative. 

 * Afternoon hours: Sub group meeting on MESCAN
 > We discussed [https://hirlam.org/trac/attachment/wiki/Meetings/Surface/Surface201705/SurfaceSpringMeetingSMHI_Mariken_170508.pdf slides 44-47 in Mariken's presentataion on MESCAN]:
 >
   > Mariken will perform an experiment for a summer period since we believe that the impact of non-homogeneous structure functions have a bigger impact during summer than during winter.
   >
   > The large sigma_b values for MESAN look suspicious. Mariken will seek information for motivations for these values but they should probably be smaller...
   >
   > The recommended length scales for CANARI are REF_A_H2=85000, REF_A_T2=80000 and for MESCAN REF_A_H2=190000, REF_A_T2=190000. However, for her first MESCAN experiment Mariken kept the CANARI length scales. Should be changed in coming experiments. IS THIS CORRECTLY UNDERSTOOD?/Patrick
   >
 > We discussed the comment by Sander Tijm: Should clay/sand pattern affect the anisotropic structure functions in MESCAN as for orography? It may be relevant but for now we decide not to look into this but concentrate on getting more realistic process descriptions running with EKF. If the problem with evaporation remains after that we may consider it again.

 * Afternoon hours: Sub group meeting on CANARI
 > Based on Trygve's presentation on CANARI modifications a discussion on possible steps forward was held. [https://hirlam.org/trac/wiki/Surface_physis_assimilation/MESCAN_tests#ModificationofCANARI Please see "Modification of CANARI" memory notes on the MESCAN/CANARI wiki page here.]


== Participants ==

Please indicate time of arrival, departure and hotel

 * Patrick Samuelsson (SMHI), Mon-Thurs
 * Jeanette Onvlee (KNMI), Mon-Wed
 * Trygve Aspelien (MET-Norway) Mon-Thurs  
 * Tomas Landelius (SMHI), Mon
 * Carl Fortelius (FMI) Mon(p.m.)-Thurs
 * Kristian Pagh Nielsen (DMI), Sun-Tue, Borgs Villahotel.
 * Ekaterina Kourzeneva (FMI), Mon-Wed
 * Mariken Homleid (MET-Norway) Mon-Thurs
 * Patrick Le Moigne (Météo-France) Mon-Tues
 * John de Vries (KNMI), Mon-Wed
 * Ulf Andrae (SMHI), Mon

== Useful links and references ==
