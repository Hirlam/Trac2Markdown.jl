[[PageOutline]]
[[Center(begin)]]
= '''HARMONIE Radiation Working Week''' =
''DMI, 24^th^ of September - 26^th^ of September 2014''

Last modified [[LastModified]]
[[Center(end)]]

= Practical =

 * Participants:
  * Met Éireann:                                          Emily Gleeson
  * Danish Meteorological Institute:                      Kristian Pagh Nielsen
  * Finnish Meteorological Institute:                     Laura Rontu
  * Estonian Meteorological and Hydrological institute:   Velle Toll
  * correspondent from Czech Hydrometeorologcal Institute: Jan Masek (thank you for the support!)
  
= Objectives =

The ultimate goal of this work is to make comparisons and improvements of the radiation schemes available in HARMONIE, i.e. the IFS, ACRANEB and HLRADIA. AROME physics has been chosen for the platform where all radiation routines can be compared in a clean way. Thus, calls of all three radiation routines are being implemented in apl_arome.F90 (or apl_par.F90?), with common interfaces between radiation and clouds, aerosol and surface. In this framework, a clean comparison of any further developments inside the three radition schemes is also possible. It is important to allow the radiation routines to concentrate on radiation and prepare the common input concerning cloud, aerosol and surface state before entering the radiation calculations.  


== Previous radiation working weeks ==

5. Prague March 2014 https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201403

4. Helsinki October 2013 https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201310

3. Copenhagen February 2013 https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201302

2. Dublin October 2012 https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201210

1. Helsinki April 2012

----

= Agenda =

== Wednesday 9.00 - 17.00 ==

== General radiation work ==

=== Reporting and discussion about ongoing work ===

 * GLAMEPS, HIRLAM and IFS solar energy validations and conclusions (Kristian)

=== Testing within MUSC ===

 * Aveiro exercises https://www.hirlam.org/trac/wiki/HarmonieWorkingWeek/YSSS-Aveiro2014/YSSS14_harmoexe

Cases: Derecho 2010, with default and extremal aerosol loads, no clouds. Sodankylä March 2014, thin clouds, very little default aerosol. 

Experiments: IFS radiation, hlradia, acraneb, stand-alone aero_rt6. 

Preliminary results concerning hlradia with aerosol: in the extreme Derecho case, very little SW radiation reaches the surface compared to IFS scheme (order of magnitude in hlradia 30 Wm-2, in IFS 200 Wm-2, acraneb 170 Wm-2 of TOA 967 Wm-2). In hlradia all SWDN is diffuse, in IFS two thirds. The HIRLAM result seems to be consistent with the stand-alone aero_rt6 results, where such large aerosol loads also make the aerosol transmission very small. Also in the case with original aerosol in the Derecho situation, some 13% less SWDN reaches surface by hlradia as compared to IFS and acraneb. In the climatological case around 15 % of SWDN is estimated to be diffuse in hlradia, 22 % % in IFS, 20 % in acranneb. After Kristian's latest update, the sum of IFS direct and diffuse fluxes is reasonably close to the PFRSODS value derived from the net SW flux and albedo in the original aerosol case, while PRFSODS is around 5 % smaller in the extreme aerosol case. Perhaps this has something to do with the direct and diffuse albedo definitions for IFS? All these preliminary results need checking before conclusions can be made.


{{{
Sodankylä with mixed cloud, little aerosol

AROM_60s_L65_lalar-sorilrk0/Out.000.0167.minm:  60.24     PFRSOPS           
AROM_60s_L65_lalar-sorilrk0/Out.000.0167.minm:  247.8     ZFRSOFS           
AROM_60s_L65_lalar-sorilrk0/Out.000.0167.minm:  308.1     PFRSODS           

AROM_60s_L65_lhirr-sorilrk0/Out.000.0167.minm:  86.17     PFRSOPS           
AROM_60s_L65_lhirr-sorilrk0/Out.000.0167.minm:  206.4     ZFRSOFS           
AROM_60s_L65_lhirr-sorilrk0/Out.000.0167.minm:  292.6     PFRSODS           

AROM_60s_L65_lecmr-sorilrk0/Out.000.0167.minm:  276.7     PFRSODS           
AROM_60s_L65_lecmr-sorilrk0/Out.000.0167.minm:  9.072     PFRSOPS           
AROM_60s_L65_lecmr-sorilrk0/Out.000.0167.minm:  267.0     ZFRSOFS           

AROM_60s_L65_lecmr-sorilrk0/Out.000.0167.minm: 0.3346E-01 IWP               
AROM_60s_L65_lalar-sorilrk0/Out.000.0167.minm: 0.3468E-02 LWP               


Derecho case with climatological aerosol, no clouds

AROM_60s_L65_lalar-eorilrk0/Out.000.0167.minm:  550.1  PFRSOPS           
AROM_60s_L65_lalar-eorilrk0/Out.000.0167.minm:  135.4  ZFRSOFS           
AROM_60s_L65_lalar-eorilrk0/Out.000.0167.minm:  685.5  PFRSODS           

AROM_60s_L65_lhirr-eorilrk0/Out.000.0167.minm:  520.1  PFRSOPS           
AROM_60s_L65_lhirr-eorilrk0/Out.000.0167.minm:  88.56  ZFRSOFS           
AROM_60s_L65_lhirr-eorilrk0/Out.000.0167.minm:  608.6  PFRSODS           

AROM_60s_L65_lecmr-eorilrk0/Out.000.0167.minm:  535.2  PFRSOPS           
AROM_60s_L65_lecmr-eorilrk0/Out.000.0167.minm:  150.1  ZFRSOFS           
AROM_60s_L65_lecmr-eorilrk0/Out.000.0167.minm:  684.5  PFRSODS           

AROM_60s_L65_lalar-eorilrk0/Out.000.0167.minm:  0.000  CWP               


Derecho case with enhanced aerosol, no clouds

AROM_60s_L65_lalar-eaerolrk0/Out.000.0167.minm:   44.61    PFRSOPS           
AROM_60s_L65_lalar-eaerolrk0/Out.000.0167.minm:   123.0    ZFRSOFS           
AROM_60s_L65_lalar-eaerolrk0/Out.000.0167.minm:   167.6    PFRSODS           

AROM_60s_L65_lhirr-eaerolrk0/Out.000.0167.minm:   6.497    PFRSOPS           
AROM_60s_L65_lhirr-eaerolrk0/Out.000.0167.minm:   23.80    ZFRSOFS           
AROM_60s_L65_lhirr-eaerolrk0/Out.000.0167.minm:   30.29    PFRSODS           

AROM_60s_L65_lecmr-eaerolrk0/Out.000.0167.minm:   62.56    PFRSOPS           
AROM_60s_L65_lecmr-eaerolrk0/Out.000.0167.minm:   144.3    ZFRSOFS           
AROM_60s_L65_lecmr-eaerolrk0/Out.000.0167.minm:   195.6    PFRSODS           

}}}



[https://www.hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201409/radaero_srctree.png Source tree] of updated radaero experiment (png). Karl-Ivar's updates are available in this framework but were not applied in the experiment radaero (LMICRO=false and possible initial snow and graupel not used),

 * Radiation v.s. Karl-Ivar's OCND2 ice updates ( [https://hirlam.org/trac/changeset/13073 changeset 13073] ) to HARMONIE trunk , see also material at https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Clouds201210

In the new apl_arome, Karl-Ivar has included snow and graupel to be used  
as ice crystals for radiation. They are summed to the zqice with  
multiplication constants zgrau and zsnow (which can easily be set to other  
than the default values hardcoded in apl_arome - should be by the way  
given as namelist variables, not hardcoded like this). Are we happy to get  
these in this quite rough way into three radiation schemes? And not only  
for testing as this has been accepted as a modification to the default  
harmonie-38h1.2 thanks to the good verification results given by the  
modifications. As far as I know there have been earlier attempts by Hannu  
Savijärvi and others to include rain and snow particles into the IFS  
radiation scheme in a somewhat consistent way, possible there remain even  
some options for this in the code which defines the cloud optical  
properties. 


{{{
  ! initialisation des humidite (dans le rayonnement, l'eau liquide  nuageuse
   ! et la glace sont donne par des hu par rapport au gaz.
   ! (qi/qa+qv pour ice par ex. C'est donc different de ri)
   DO JLEV=KTDIA,KLEV
     DO JLON=KIDIA,KFDIA
        ZQICE(JLON,JLEV)=&
         & MAX(0.0_JPRB, &
>>>        & (ZQIM(JLON,JLEV) + ZQSM(JLON,JLEV)*ZSNOW + ZQGM(JLON,JLEV)*ZGRAU)/ &
         & (1.0_JPRB-ZQIM(JLON,JLEV)-ZQCM(JLON,JLEV)-ZQRM(JLON,JLEV)&
         & -ZQGM(JLON,JLEV)-ZQSM(JLON,JLEV)-ZQHM(JLON,JLEV)))
        ZQLI(JLON,JLEV)=MAX(0.0_JPRB, ZQCM(JLON,JLEV)/&
         & (1.0_JPRB-ZQIM(JLON,JLEV)-ZQCM(JLON,JLEV)-ZQRM(JLON,JLEV)&
         & -ZQGM(JLON,JLEV)-ZQSM(JLON,JLEV)-ZQHM(JLON,JLEV)))
        ZQV(JLON,JLEV)=MAX(0.0_JPRB, ZQVM(JLON,JLEV)/ &
         & (1.0_JPRB-ZQIM(JLON,JLEV)-ZQCM(JLON,JLEV)-ZQRM(JLON,JLEV)&
         & -ZQGM(JLON,JLEV)-ZQSM(JLON,JLEV)-ZQHM(JLON,JLEV)))

}}}

It seems that this can indeed have a large impact, thus more studies are needed.

Kristian 17.9.:

The steps needed for implementing snow and graupel in the radiation scheme are:

 
1) The effective (or equivalent) radii of these must be given as input to the radiation scheme. These can be calculated from the size distributions or parametrized locally in the radiation scheme as a function of the ice water concentration/mixing ratio and the temperature analogue to the calculations already done for cloud ice.

 
2) Parametrizations must be added that give the optical properties (mass extinction coefficient, single scattering albedo and asymmetry factor) as a function of the effective radii of snow and graupel.

 
3) Including these optical properties in the calculation of the overall cloud optical properties.
 

The parametrization of the cloud ice effective radius (ZRADIP) in .../phys_ec/radlsw.F90 gives an example of how to implement step 1), while the subsequent calculation of ZTOI, ZOI and ZGI as a function of ZRADIP gives an example of step 2).
 

When the optical properties are calculated, for instance in the variables: ZTOG, ZOG, ZGG, ZTOS, ZOS and ZGS, these are simply included in the expressions for the overall cloud optical properties  (step 3) that currently are:
 

{{{
689     !  - MIX of WATER and ICE CLOUDS
690             ZTAUMX= ZTOL + ZTOI + ZTOR
691             ZOMGMX= ZTOL*ZOL + ZTOI*ZOI + ZTOR*ZOR
692             ZASYMX= ZTOL*ZOL*ZGL + ZTOI*ZOI*ZGI + ZTOR*ZOR*ZGR
693
694             ZASYMX= ZASYMX/ZOMGMX
695             ZOMGMX= ZOMGMX/ZTAUMX
696
697     ! --- SW FINAL CLOUD OPTICAL PARAMETERS
698
699             ZCLDSW(JL,JK)  = PCLFR(JL,IKL)
700             ZTAU(JL,JSW,JK)  = ZTAUMX
701             ZOMEGA(JL,JSW,JK)= ZOMGMX
702             ZCG(JL,JSW,JK)   = ZASYMX
}}}

In this process it is also worth comparing the cloud ice effective size derived from ini_rain_ice.F90 with the parametrized cloud ice sizes calculated locally in the radiation schemes (done separately in IFS and hlradia).

Here are some of Sami's new experiment results for 1-16 Feb, 2014 with basic, Karl-Ivar's upd and Karl-Ivar's upd without snow and graupel radiation effect: 
http://fminwp.fmi.fi/WebgraF/38h1_Feb2014_ocnd/index.html?choice_ind=Surface_map . Comments by Sami to follow later.

Li, J.-L. F.,  R. M. Forbes,  D. E. Waliser,  G. Stephens, and  S. Lee (2014), Characterizing the radiative impacts of precipitating snow in the ECMWF Integrated Forecast System global model, J. Geophys. Res. Atmos., 119, 9626–9637, doi:10.1002/2014JD021450.

Available at http://onlinelibrary.wiley.com/doi/10.1002/2014JD021450/pdf (via your library, no open access in JGR)

 * How to continue with LW comparisons without and with aerosol? 

  
=== Testing within 3D HARMONIE ===

 * Irish reanalysis (Emily) - some rough notes / analysis so far : https://www.hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201409/Ref-vs-KPN-HMcy38h1.1.pdf
   - Some sample plots from Emily (March 2010): https://www.hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201409/MERA-SampleOutput.pdf
   - link to HARMONIE style verification plots (REF37, REF38, 38-expt-radiation):/scratch/ms/ie/dum/SW_monitor_March-July_2010___transport.tar - download, untar and view index.html using a web browser.

 * Planning the Sodankylä spring 2014 comparison

   harmonie-38h1.radiation after the update to 38h1.2 level (not working in 3D yet in cca?), thus including Karl-Ivar's update

   to test: IFS and hlradia against Sodankylä radiation and other relevant measurements

   period 15.1 - 15.5.2014

   to be coordinated with mini-AROME experiments by Eric Bazile et al.

   
=== Direct/diffuse irradiance split issue ===

 * Calcuations done in the IFS subroutines .../arp/phys_rad/swni.F90 and sw1s.F90

 * IFS radiation variables for SURFEX: ZZSFSWDIR ZZSFSWDIF

 * IFS and HIRLAM clear and cloudy sky radiation as output at sfc and TOA

 * Output of (instantantaneous?) DNI for solar energy purposes
 
 * Calculation of direct albedo for all radiation schemes based on SURFEX output and solar zenith angle correction ''- suggested for apl_arome'' as 


{{{
    DO JLON=KIDIA,KFDIA
       DO JSG=1,NSW
!Hannu Savijarvi direct albedo correction from hlradia:
        ZSALBCOR(JLON)=0.2_JPRB/(1._JPRB+PMU0(JLON))-0.12_JPRB  
        ZALBP(JLON,JSG)=ZALBP(JLON,JSG)+ZSALBCOR(JLON)
!end HS
        ZALBP1(JLON)=ZALBP1(JLON)+RSUN(JSG)*ZALBP(JLON,JSG)
        ZALBD1(JLON)=ZALBD1(JLON)+RSUN(JSG)*ZALBD(JLON,JSG)
      ENDDO
    ENDDO
}}}

Below is the question if SURFEX uses the unmodified ZALBP and ZALBD internally, not only preparing them for the atmospheric radiation purposes. If it does, then how to pass the ZSALBCOR there? Also acraneb takes the averaged zalbp1 and zalbd1 as input - to check that there the modified zalbp1 is suitable there.

 * Direct and diffuse formulations in hlradia

In the current hlradia (radiation branch), direct and diffuse radiation are prepared at the lowest model level only and only for output. There seem to be some partly overlapping formulations. A suggested new formulation would contain these elements (suggestion in test experiment radaero/src/arp/phys_dmn/hlradia), where the cloud total, direct and diffuse fluxes have NOT been modified compared to the present hlradia version:


{{{
! Diffuse clear sky radiation according to Paltridge-Platt-Savijarvi 
! multiplied with total aerosol transmission + aerosol diffuse transmission. 
! This is independent of the above formulation of the global clear sky 
! (zclearsfc) where Rayleigh scattering is subtracted from the TOA flux.
!
! Direct clear sky radiation as the difference between clear sky global and
! clear sky diffuse

               if (zscosre(jl) > cosmin) then
                 zflxadf=100._JPRB* &
     &                   (1._JPRB-exp(-2.865_JPRB*asin(zscos(jl))))* &
     &                   ph(jl,klevp1)/101300.*zaswt(jl) +           &
     &                   zfstopa(jl)*zaswtd(jl)
                 zflxadi=zclearsfc-zflxadf
              endif
              zflxadf=max(0._jprb,min( zflxadf, zclearsfc ))
              zflxadi=max(0._jprb,min( zflxadi, zclearsfc ))

! Total through cloud
              zflxcld= zfstopc(jl)*ztrans(jl)*zaswt2(jl)/              &
     &                 (1._JPRB -palbedd(jl)*(1._JPRB-ztrans(jl))*zapr)
              zflxcld=MAX(0._JPRB, zflxcld)
!
! Direct radiation can penetrate optically thin clouds !
              ztausca=zxtinc*zsumcwi(jl)/(ckilgr*(zscos(jl)+zeps)*     &
     &                zresw(jl,klev))
              zflxcdi=(zfstopc(jl)                                     &
     &               - zflxadf*pf(jl,icldtop(jl))/101300.0_JPRB)   &
     &               * exp(-ztausca)                                   &
     &               /(1._JPRB+(ztausca/213.75_JPRB)**.5_JPRB)         &
     &               * exp(-zsumtaua(jl))*zaswt2(jl)
              zflxcdi=MAX( 0.0_JPRB, MIN( zflxcdi, zflxcld ) )
!
! Diffuse through cloud
              zflxcdf=zflxcld-zflxcdi

!     The resulting downward diffuse surface radiation (psswdf)
!     is obtained as linear combination of cloud free (first 
!     terms) and cloudy part (second terms) respectively.

              zflxadf=(1._JPRB-zcovmax(jl))* zflxadf
              zflxadi=(1._JPRB-zcovmax(jl))* zflxadi
              zflxcdf=zcovmax(jl)*zflxcdf
              zflxcdi=zcovmax(jl)*zflxcdi
              zswcle(jl)=zflxadf+zflxadi
              zswclo(jl)=zflxcdf+zflxcdi
              psswdf(jl)=zflxadf+zflxcdf
              zsswdi(jl)=zflxadi+zflxcdi
	      psswdn(jl)=zsswdi(jl)+psswdf(jl) 
              psswnet(jl)=(1._JPRB-zalb)*psswdn(jl)

            ENDIF ! of the lowest level
}}}

Are the clear and cloudy fluxes at the surface zswcle ad zswclo suitable for output in addition to the direct and diffuse radiation? How should the output DNI be formulated in hlradia?


=== Coupling to SURFEX ===

 * Status of orographic radiation - work by Clemens & MF colleagues https://hirlam.org/trac/wiki/ororad

 * SURFEX wavelengths - notes by Kristian:

 1) In https://hirlam.org/trac/browser/trunk/harmonie/src/surfex/SURFEX/modd_isba_par.F90 the SURFEX cut-off wavelengths that separate UV, VIS and NIR are defined as: 



{{{
! Wavelength between near-infra-red and visible parts of the solar spectra
REAL, PARAMETER :: XRED_EDGE = 0.0000007 ! (m) 0.7 micro-m
! Wavelength between visible and UV parts of the solar spectra
REAL, PARAMETER :: XUV_EDGE = 0.00000025 ! (m) 0.1 micro-m

}}}


 Here the 250 nm UV edge is clearly rubbish, and is consistent with the equally rubbish first spectral band in AROME/HARMONIE. The theoretical UV edge is mostly set at 400 nm or 390 nm. In praxis, I am not sure if it even makes sense to have separate UV and VIS albedos. Biological matter (amino acids) absorb strongly at wavelengths below 300 nm, but these wavelengths are insignificant relative to the global radiation; chlorophyll absorbs at green wavelengths and not in particular at UV or VIS wavelengths.

 The "XRED_EDGE" at 700 nm is different from the wavelength band divide in the IFS 2, 4 and 6 SW wavelength bands radiation schemes where the bands are divide at 690 nm. A question here is whether this difference causes some HARMONIE NIR wavelength bands to be misinterpreted as VIS wavelength band in SURFEX - or vice versa.

 2) Overall, it would be nice to have subroutines that can convert SURFEX VIS and NIR albedos in 6 SW spectral band albedos for HARMONIE. If SURFEX is modified to output full spectrum albedos, with 10 nm or 1 nm resolution, such a conversion would be straightforward.

 3) For some SURFEX surface types direct albedos are calculated explicitly. For the other surface types the subroutine  https://hirlam.org/trac/browser/trunk/harmonie/src/surfex/SURFEX/albedo_from_nir_vis.F90 appears to be the standard. This simply puts the direct albedo equal to the diffuse albedo. As suggested before, I think we in this subroutine should implement the HIRLAM direct albedo formula: 


{{{
! Albedo modifications 
 zalbedd = PALBD 
 zsalbcor= 0.2_JPRB/(1._JPRB+PMU0) - 0.12_JPRB
 zalbedp = zalbedd + zsalbcor

}}}

 which compares well with ARM data, and is anyway better than assuming the direct and diffuse albedos to be equal.

This albedo correction was now suggested for apl_arome level (see above). Would it be better to do the solar-angle-dependent correction inside SURFEX instead? How would this suit to the share of job where SURFEX deals with surface-related issues only, while atmospheric or astronomical issues belong to code above it?

Albedo has different aspects for atmospheric and surface parametrizations. It may be an important output (input) parameter for the whole model, in principle including also data assimilation. In the model we see 

 * grid average v.s. subgrid-scale surface properties (tiles, patches, possibly also slopes from orographic radiation): basic(diffuse) albedo derived from the surface properties by SURFEX routines like isba_albedo and its several subsubroutines

 * direct and diffuse albedo: empirical formula involving solar zenith angle, best suitable for calculation by the atmospheric radiation scheme

 * spectral v.s. integrated albedo: different values for UV, visible, near-IR albedos, possible relevant for snow and vegetation parametrizations, presently treated by the subsubroutines like isba_albedo

Now the question is how to optimally calculate the direct albedo from the basic (diffuse) one, taking into account the evolving in time solar zenith angle. A more comprehensive analysis of the usage of various flavours of albedo in the model is needed. The old principle from HIRLAM is that radiation calculations should not be done inside surface routines but suitable coupling between atmospheric radiation and surface is needed. In HIRLAM model, the structure of code in this respect is

surf2rad : albedo and other properties from surface parametrizations of previous time step to current time step radiation

hlradia : atmospheric radiation calculations

hlororad : modification of downwelling LW and SW fluxes due to subgridscale orography

rad2surf : radiation fluxes to surface parametrizations


Relevant routines in SURFEX: albedo_from_nir_vis.F90, isba_albedo.F90, coupling_isba_n, coupling_isba_canopy_n, isba_properties <- garden_properties <- init_tebn, teb_garden etc . A practical question is that SURFEX prepares albedos, they are stored for the next time step and read again before atmospheric radiation in apl_arome. If we will add the solar angle correction within SURFEX, we need to take care that it will not accumulate in this process, i.e. keep separate variables for albedo depending only on basic surface properties and for those updated every time step. Also, in aplpar similar problem will most probably arise. In the framework of cycle40+ new physics interfaces albedo might be consistently taken care of at a level between surface and radiation parametrizations.


=== Preliminary MUSC LW Output ===

2 quick plots by Emily - https://www.hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201409/HM_LW_MUSC.pdf
----

== Thursday, 9.00 - 17.00 ==


== Discussion of HARMONIE output variables ==

- Clear sky fluxes at surface and TOA: O.K. for IFS, ''to obtain from hlradia''

- DNI direct normal irradiance: ''instant or accumulated PFRSOPS/PMU0''

- hourly average accumulation in addition to that from start of cycle? ''postponed''

- output of PFRSODS=PFRSOPS+ZFRSOFS for IFS ''done''

- 3D radiation fluxes - ''DDH or see below''

== Code development ==

=== Harmonie-38h1.radiation branch updates ===

 * merge of trunk to harmonie-38h1.radiation (done by Ulf)
 
=== Radiation cleaning within AROME physics ===

=== Radiation schemes in a common framework in the new physics-dynamics interface of cycle > cy40 ===

----

11:00 AM: Research seminar by Torben Schmith (DMI): "How much have variations in the meridional overturning circulation contributed to sea surface temperature trends since 1850? A study with the EC-Earth global climate model." (Voluntary participation; Included in the Programme since Emily also works with EC-Earth and since EC-Earth is a "cousin" of HARMONIE!)

----

Plan for update of HIRLAM radiation for the unified physics interface > 
cy40

draft 18.8.2014 LR
updated 1.9.2014 LR

--------------
1.0 Background

Hirlam radiation was brought to HARMONIE in 2005 by Sami Niemelä. In
2005 formulation, the scheme consisted routines called by HIRLAM
physics calling routine hlaplpar.F90

src/arp/phys_dmn/hlradia.F90
- basic Savijärvi - Sass - Wyser - Räisänen atmospheric radiation scheme
src/arp/phys_dmn/hlrad.F90
- intermediate routine called from src/arp/phys_dmn/hlaplpar.F90
src/arp/setup/suhlrad.F90
- setup routine
src/arp/module/yhlrad.h
- module containing variables initialized in setup

The full HIRLAM physics framework has since become obsolete in Harmonie Forecasting System (HFS). hlradia was reintroduced in the framework of AROME physics by Laura Rontu and Anastasia Senkova starting from 2007. In this framework, the scheme consisted of

src/arp/phys_dmn/hlradia.F90
src/arp/phys_dmn/apl_hlradia.F90
- a new intermediate calling routine instead of the old hlrad.F90
src/arp/setup/suhlrad.F90
src/arp/module/yhlrad.h

Afterwards new aerosol treatment for hlradia was developed by Kristian Pagh Nielsen in 2011-2014. Technically, a new routine was added to be called from inside hlradia.F90:

src/arp/phys_dmn/aero_rt6.F90

Presently, all this is available via src/arp/phys_dmn/apl_arome.F90 in the radiation branch harmonie-38h1.radiation . Meanwhile, the first
version of the unified physics-dynamics interface for HFS cy40 has been developed by Daan Degrauwe. In this framework, input for the
radiation schemes is prepared in consistent way within /src/arp/phys_dmn/aplpar.F90. Presently IFS and ALARO schemes are applicable, hlradia should follow.

For this, at least three aspects of the version available in apl_arome should be improved:

1. Initial time variables of hlradia should be separated from those really needed to calculate at each time step. This could be done by moving suhlrad call to setup part, later developing suhlrad and perhaps adding namhlrad for user definitions. ''Moved, but not yet developed''


2. aero_rt6 should not be called from inside of hlradia but included in the aerosol preparation at each time step and at the initial state. Initial time definitions of aerosol optical properties are moved to a new setup routine suaert6 filling yoaert6 using tables now inserted in aero_rt6. ''Initialisation done, externalisation of runtime aero_rt6 call from hlradia postponed to cy40 framework''


3. Extra copying of variables in apl_hlradia should be removed, optimally the whole apl_hlradia killed. ''Extra copying removed, apl_hlradia simplified, final killing to be considered.''


Some of the changes were introduced in [https://hirlam.org/trac/changeset/13362 changeset 13362]
-----------------------------------

2.0 hlradia initialisation routines

Presently, hlradia initialisation routine suhlrad is called from apl_hlradia at each time step, which is bad. Now, this is moved to the end of src/arp/phys_dmn/suphmf.F90:

{{{
! HIRLAM radiation setup
IF (LRAYHL) THEN
   CALL SUHLCONST(KULOUT,0)
   CALL SUHLRAD
   CALL SUAERT6(KULOUT)
ENDIF
}}}

The logical variable LRAYHL is available here because src/arp/phys_dmn/su0phy.F90 has been called earlier. No namelist (namhlrad) has not yet been introduced, and the module yhlrad has existed from the very beginning of introduction of HIRLAM physics to HARMONIE. The new routine src/arp/phys_dmn/suaert6.F90 fills a new module, defined by src/arp/module/yoaert6.F90, with the basic aerosol optical properties for 6 hard-coded aerosol types. This module is later used by src/arp/phys_dmn/aero_rt6.F90, which is at the moment still called from inside src/arp/phys_dmn/hlradia.F90. This could be modernised in the environment of > cy40 within the reform of input variables, see the next paragraph. 

-----------------------------------------------

3.0 Cleaning/removal of apl_hlradia

Proper initialisation allows to simplify src/arp/apl_hlradia.F90, which will now consist only of some temporary input related to aerosol testing and some inactive output variables. The latter are kept because they are active in the framework of HIRLAM model. Two possibilities exist: forget the full compatibility between hlradia in HARMONIE and HIRLAM and modify hlradia interface or import the output variables also to HFS. Unnecessary copying of global variables to local are removed from apl_hlradia.

-----------------------------------------------

4.0 Aerosol treatment in apl_arome > new aplpar

(to be written)

----------------------------------------------------------------------

5.0 Roadmap in terms of HARMONIE cycles


1. Do the cleaning and modifications within 381.radiation in the pl_arome side. The branch should first be updated to the level 38h1.2. ''Ongoing''

2. Create harmonie_MUSC_cy40h1 as soon as cy40h1.1beta or similar will be available, create an experiment to prepare harmonie_40h1.radiation within the new interface environment

3. Move all developments in MUSC and 3D to the level of harmonie_40h1.radiation, continue towards the unified physics calling routine based on aplparp

----

== Friday 9.00 - 16 ==


== Aerosols ==

=== Status of the 3D HARMONIE - SILAM/MACC experiments ===

3D HARMONIE experiments with the direct radiative effect of aerosols included using external aerosol input data for the wildfire case in Russia in Summer 2010 have been performed using the default IFS radiation scheme. For these experiments external aerosol optical depth (AOD at 550 nm) data from SILAM (http://silam.fmi.fi/) and MACC (Morcrette et al., 2009; http://data-portal.ecmwf.int/data/d/macc_reanalysis/) has been used and climatological vertical profile has been assumed.

Monthly AOD climatologies following Tegen et al. (1997) have been replaced:
1) To replace AOD fields in climate file /src/ald/c9xx/eincli9.F90
can be modified to redefine SEA, LAND, SOOT and DESERT aerosols.
2) To have aerosol fields changing in time the AOD fields can be set up similarly to
src/arp/setup/sugrida.F90 

Presentation of 3D HARMONIE results with external aerosol data from MACC/SILAM  : https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201409/Aerosol_Russia2010_Velle.pdf

=== Plans for the next 3D HARMONIE - SILAM/MACC experiments ===

The next step would be to have 3D aerosol input from external aerosol data source (SILAM, MACC).
The 3D data can be written to boundary condition files as it is explained here: 
https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201403

At first new 3D variables can be introduced via NAMGFL namelist as it is explained here:
https://hirlam.org/trac/wiki/HarmonieSystemDocumentation/38h1.1/PostPP/Diagnostics  

2 test experiments (for summer 2010 wildfires in Russia)
1) MUSC test experiment 
Total AOD distributed according to climatological profile.
AOT on each layer calculated from mixing ratios available from MACC system.  
2) The same test as 1) but with 3D HARMONIE.

Presentation of next planned experiments with external aerosol data for considering aerosol direct radiative effect  : https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201409/next_aerosol_exp.2.pdf

'''Questions:'''
1) How many aerosol types there should be and which types?
From SILAM it might make sense to have extinction coefficient as input to HARMONIE instead of concentration of different aerosol species in order not to have too many passive tracers.

2) Should we think about the indirect aerosol effects at this stage to have common aerosol input for direct and indirect effects (aerosol types).

=== How to calculate aerosol extinction coefficients on model levels (optical thicknesses for layers)? ===

Example is available in HARMONIE code, from code it can be seen how it is done in IFS framework:
https://hirlam.org/trac/browser/branches/harmonie-38h1.radiation/src/arp/phys_ec/aer_rad.F90
The variables for aerosol mass extinction coefficients are defined by:
https://hirlam.org/trac/browser/branches/harmonie-38h1.radiation/src/arp/module/yoeaerop.F90
and values are set in: 
https://hirlam.org/trac/browser/branches/harmonie-38h1.radiation/src/arp/phys_ec/su_aerop.F90

How to obtain (calculate) mass extinction coefficients in general case?
How to obtain it from Global Aerosol Data Set (GADS: https://wdc.dlr.de/data_products/SPECTRA/gads/)?

=== 4D aerosol data available from MACC system ===

From MACC system mixing ratios (kg/kg) of 11 different aerosol types are available
both from reanalyses and near real time (with time lag of 22 hours?):      


1. Sea Salt Aerosol (0.03 - 0.5 um)
2. Sea Salt Aerosol (0.5 - 5 um) 
3. Sea Salt Aerosol (5 - 20 um) 
4. Dust Aerosol (0.03 - 0.55 um)
5. Dust Aerosol (0.55 - 0.9 um)
6. Dust Aerosol (0.9 - 20 um)
7. Hydrophobic Organic Matter Aerosol
8. Hydrophilic Organic Matter Aerosol
9. Hydrophobic Black Carbon Aerosol
10. Hydrophilic Black Carbon Aerosol
11. Sulphate Aerosol

These fields are available as 3-hourly instantaneous values (5 day forecast for NRT).
 
Treatment of these types to calculate aerosol optical properties is available in HARMONIE code (see previous point).

=== Considering aerosol optical properties dependance on relative humidity ===

For the climatological aerosols in HARMONIE there are some relative humidity (RH) value assumed 
for each aerosol type (http://old.ecmwf.int/research/ifsdocs/CY28r1/Physics/Physics-03-6.html#wp960915).  
Continental, organic matter (RH=80%);
Sea salt (RH=95%);
Desert, dust (RH=50%);
Urban, black carbon (RH=80%).

Considering MACC aerosol mixing ratios, for sulfates, sea salt and organic matter type of aerosol optical properties are given as function of relative humidity (12 values).
RH=[0.,10.,20.,30.,40.,50.,60.,70.,80.,85.,90.,95.] 
Choosing optical property value according to RH value (https://hirlam.org/trac/browser/branches/harmonie-38h1.radiation/src/arp/phys_ec/aer_rad.F90)
{{{
DO JK=1,KLEV
  DO JL=KIDIA,KFDIA
    DO JTAB=1,12
      IF (ZRHCL(JL,JK)*100._JPRB > RRHTAB(JTAB)) THEN	        
        IRH(JL,JK)=JTAB
      ENDIF
    ENDDO
  ENDDO
ENDDO
}}}

=== Aerosol indirect effects in HARMONIE? ===

From apl_arome.F90 sulphate aerosol optical thicknesses are
put to array ZAERINDS in radaer.F90 for sulphate indirect radiative effect computation.
In radlsw.F90 ZAERINDS values are used to calculate cloud droplet number concentration
(effective radius for water and ice particles).

For ECMWF McICA radiation scheme radlswr.F90 prognostic aerosol mixing ratios in array PAERO (relavant aerosols are OM-organic matter, SS-sea salt, SU-sulphate) are used as cloud condensation nuclei further used to determine the effective radius of droplets in liquid water clouds.

How can external aerosol data be used to consider indirect radiative effect?

In HARMONIE mixed phase microphysical parametrization ICE3 (Pinty and Jabouille, 1999)
constant number of cloud droplets is assumed: over land assumed cloud droplet number concentration is 300 (1/cm3) and over sea 100 (1/cm3). 
Cloud droplet number concentration is used for calculating cloud water sedimentation process.
Constant cloud droplet number can be replaced by one diagnosed from external aerosol data.
When external aerosol is introduced to HARMONIE, it can be used for considering indirect effect aswell.
Report by Mirela Pietrisi (Tests about the use of aerosols models to initialize AROME number of cloud droplets in ICE3) can be found here: http://www.cnrm.meteo.fr/aladin/IMG/pdf/rapport_mirela_2014.pdf

=== Status and plans of hlradia with aerosol in HARMONIE/Enviro-HIRLAM ===

Status - see above for the recent MUSC tests. Plans: more validation, improvements based on testing, tuning, streamlining of the code - how to continue? 

=== Our suggestions for the EUMETCHEM workshop 30.9.2014 ===


=== Announcements/info ===

Symposium on Coupled chemistry-meteorology/climate modelling: 
Status and relevance for numerical weather prediction, air quality and climate research.
9-11 February 2015 at the World Meteorological Organization (WMO), Geneva, Switzerland

http://www.eumetcal.info

http://www.copernicus.eu - a possible target for a funding application for the aerosol-in-NWP work
----
From the mail of Anna Wentzel, Copernicus Publications: The new special issue entitled "Coupled chemistry-meteorology modelling: status and relevance for numerical weather prediction, air quality and climate communities (ACP/GMD Inter-Journal SI)" as part of the journals ACP and GMD. The guest editors are B. Vogel and A. Baklanov (for GMD all topical regular editors). As of today, authors can submit their contributions by using the online registration form on the ACP and GMD websites:  http://www.geoscientific-model-development.net/submission/manuscript_submission.html/http://www.atmospheric-chemistry-and-physics.net/submission/manuscript_submission.html. The deadline for submission is 31 August 2015, extendable if necessary.

http://www.copernicus.org

----


== Work space: notes, plans, comments ==

Priority tasks suggested for HIRLAM physics plan 2015: 


Upper air

 * Ice cloud microphysics and statistical properties – testing and developments of Karl-Ivar's updates in AROME microphysics (KII, LB, WdR)

 * Work with representation of cloud statistical properties, feasibility studies, testing, updates within the AROME and ALARO framework (LB, DM)

 *Introduction of new turbulence formulations within the framework of unified physics-dynamics interface > cycle 40 (CF, WdR, I BD, DD …)

 * Introduction and testing of 3 radiation schemes within the unified physics-dynamics interface in clean code including aerosol effects, (LR, KPN, EG, JM, DD)

 * Set up a draft version of the STRACO microphysics into the unified physics-dynamics interface, including indirect aerosol effects (UK, SI, VT)

 * Basic studies, testing, scientific documentation, project application related to aerosol in NWP (radiation team, VT, SI)

 * Extended international usage of KNMI testbed for HARMONIE physics testing (WdR, EB, students)
 
 * International cooperation for design and improvement of fine-resolution physiography data bases like ECOCLIMAP (EK, ...) 

 * Implementation and testing of prognostic MEB within SURFEX8 for cycle40/41 in proper connection with snow and soil schemes and related data assimilation (PS, EK, MH). 

 * Work with improvement of snow OI data assimilation and usage of remote sensing observations and extended conventional observations (work within the COST ES1404) 

 * Implementation and testing of the simple sea ice scheme into SURFEX8-cy40 with technical connection to existing sea ice data assimilation. Draft for implementation of HIGHTSI, with proper connection to GELATO in stand-alone SURFEX8 > cy41 (YB, MH, PS, EK, BC).
 
 * Check and test combination of prognostic Flake and lake depth and climate data bases in SURFEX8-cy40. Prepare Flake for operational usage, with a possiblity of using it as a background for LSWT analysis (EK, MC). 

 * Introduction of sloping surface radiation with related preparation of needed orography parameters within SURFEX (CW, LR, EM, student from MF)


== Notes from Day 1: Sept 24th ==

- Discussion on output variables eg having radiation accumulated over an hour rather than start of cycle. Also instantaneous direct etc. Carried over to Sept 25th.

- Fixed bug in IFS radiation where global SW not equal to sum of direct & diffuse - DONE

- Added the Savijarvi equation for computing the direct SW at the surface from the diffuse (equation was formerly only in apl_hlradia.F90) - not updated with apl_arome so that it enters all schemes.

- Problem in hlradia when enhanced aerosols are used - see here for the vertical profiles of net SW compared to the IFS and ACRANEB2 radiation schemes: https://www.hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201409/MUSC-RADAERO-nocloud-enhancedAero.pdf

Note from Jan on this issue:
1) Results with Derecho 2010 aerosol loads - the reason for too little 
solar radiation reaching the surface in HLRADIA is obviously higher 
aerosol absorption and/or scattering with respect to other two radiation 
schemes. I am not able to differentiate between the two since only 
surface fluxes are given, but excessive absorption would be felt as 
increased atmospheric heating, while excessive scattering would be seen 
as stronger returned solar flux, without affecting much atmospheric 
budget (just the surface one).

If I understand it well, aerosol loads are given via aerosol optical 
depths and thus should be the same in all 3 radiation schemes. In other 
words, aerosol extinction coefficient should be the same. So there must 
be significant difference in aerosol single scattering albedo and maybe 
also in asymmetry factor. Did you think about comparing those parameters 
for the 3 schemes? I can help with getting them for ACRANEB2 if you are 
interested.


----

'''IFS radiation updates for HARMONIE-AROME 23.10.2014'''


In apl_arome, the default radiation scheme is the Fouquart-Morcrette IFS scheme from ca. 2002. Recently, updates have been made to correct bugs, some of which have been around perhaps during most of the AROME history. They concern output or transfer variables in short-wave radiation.

1. Direct and diffuse radiation

Originally, direct and clear sky, diffuse and cloudy sky downwelling radiation have been equal to direct and diffuse, correspondingly, which is not exactly correct. Kristian has made three sets of corrections to src/arp/phys_radi routines swni, sw1s, sw  (concerning near infrared and UV bands):

version in 38h1.1 - modification contains a bug related to levels in vertical

https://www.hirlam.org/trac/log/trunk/harmonie/src/arp/phys_radi/sw1s.F90?rev=13410 - modification contains bug in clear sky radiation

suggestion of 23.10.2014 for harmonie-38h1.2 - should work O.K

2. In apl_arome code, there has been a nonsense formulation where shortwave transmission is given longwave emissivity values:


{{{
61159-! Radiative fluxes calculation at every time-step
61209:! This is a bug, removed:
61235-!  DO JL=KIDIA,KFDIA
61256-!    ZTRSOD(JL) = PEMTU(JL,KLEV)

}}}

suggestion 23.10.2014 for harmonie-38h1.2 to remove this, as done earlier in radiation branch

3. In src/arp/phys_ec/radheat code, PFRSODS has been calculated as 


{{{
PFRSOD(JL)=ZI0(JL)*PTRSOD(JL)

}}}
because of wrong PTRSOD in 2., this has never worked correctly

suggestion 23.10.204 to calculate the global radiation as a sum of direct and diffuse radiation instead

4. In apl_arome, PFRSODS coming from radheat has therefore earlier been overwritten by

{{{
1898	A rajouter car flux calcules dans radheat pas corrects (cf aplpar)
1899	   DO JLON=KIDIA,KFDIA
1900	      PFRSODS(JLON)=PFRSO(JLON,KLEV,1)/(1.0_JPRB-ZALB(JLON))
1901	    ENDDO

}}}

suggestion 23.10.204  for harmonie-38h1.2 to remove this, as now a correct value should come from radheat instead 

Corrections 2 - 4 have existed in radiation branch quite some time already. A consistent correction can now be introduced to trunk, thanks to the latest correction 1 on which the correctness of all the next updates relies on. Correction 1 is necessary also in radiation branch, where the buggy versions of swni and sw1s have been identical to those in trunk. Note, however, that after the tricks 2-4, PFRSODS by IFS has been more or less realistic all the time (shown in the paper by Nielsen et al, GMD 2014), while the direct and diffuse entering SURFEX (instead of the global flux!) have been more approximate earlier and quite wrong in 38h1.1. It is unknown how much this has affected SURFEX results of 38h1.1.


----