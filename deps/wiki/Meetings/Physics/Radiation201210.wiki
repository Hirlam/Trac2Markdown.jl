[[PageOutline]]
[[Center(begin)]]
= '''HARMONIE Radiation Working Week''' =
''Met Éireann, 17^th^ - 19^th^ of October 2012''

Last modified [[LastModified]]
[[Center(end)]]

== Practical ==

 * Participants:
  * MÉ:      Emily Gleeson
  * DMI:     Kristian Pagh Nielsen
  * FMI:     Laura Rontu

== Objectives ==

The ultimate goal of this work is to make comparisons of the radiation schemes available in HARMONIE, i.e. the IFS, ACRANEB and HLRADIA. AROME physics has been chosen for the platform where all radiation routines can be compared in a clean way. Thus, calls of all three radiation routines are being implemented in apl_arome.F90, with common interfaces between radiation and clouds, aerosol and surface. In this framework, a clean comparison of any further developments inside the three radition schemes is also possible. It is important to allow the radiation routines to concentrate on radiation and prepare the common input concerning cloud, aerosol and surface state before entering the radiation calculations.  

== Agenda ==

 * Wednesday: Albedo implementation
 * Thursday: Aerosol implementation
 * Friday: Testing the radiation schemes and future plans

The first version of these notes was written during the working days, but for the time being we will continue to update them for the HARMONIE radiation comparison study. 

== Albedo ==

These notes discuss issues and steps taken when implementing the radiation subroutine hlradia.F90 in HARMONIE with respect to the albedo.

In the following “HIRLAM” refers to HIRLAM 7.4 and “HARMONIE” refers to HARMONIE 37h1.1. “HLRADIA-HARMONIE” refers to HLRADIA implemented in HARMONIE. “HLRADIA” and line numbers in this refers to the HIRLAM version.

 * White sky albedo
   * The white sky albedo is the albedo for radiation below a cloud and for scattered irradiance in general. In the old HIRLAM model, the albedos for different surface types are defined in the subroutine …/phys/ini_veg.F. From these surface type albedos “effective albedos”, i.e. average grid albedos, are calculated in …/phys/surf2rad.F. These have the variable-name: “albedo” in …/phys/phys.F and correspond to the white sky albedo ZALBD in the HARMONIE subroutine …/arp/phys_dmn/apl_arome.F90.
 * Black sky albedo
   * The black sky albedo is the albedo for direct beam sunlight. This should be a function of the solar zenith angle. The variable ZALBP in HARMONIE (…/arp/phys_dmn/apl_arome.F90) is the black sky albedo. In HIRLAM:…/phys/hlradia.F90 the corresponding variable is ZWSALB. This is calculated by adding a solar zenith angle dependent correction (lines 1125-1127) to the white sky albedo. This correction (PSALBCOR) is itself calculated in lines 964-966 in the subroutine:…/phys/phys.F.
 * Spectral bands
   * In the IFS-radiation scheme used in HARMONIE 6 shortwave spectral bands are used. In HLRADIA only 1 spectral band is used. In order to calculate the averaged albedo over spectral bands for HLRADIA, the array RSUN from common …/arp/module/yoesw.F90 used. RSUN is defined in the subroutine …/arp/phys_radi/suswn.F90 as ZSUN6 and contains fractions of the solar flux in the spectral bands at the top of the atmosphere. These are used as an approximation for the solar flux spectral fractions at the surface. Also, after calling HLRADIA-HARMONIE, RSUN is used for estimating the 6 spectral bands of output shortwave radiation used for SURFEX calls in the next time step.
   * In .../arp/phys_dmn/apl_arome.F90 the 6 spectral bands for the albedo in the IFS-radiation scheme were weighted equally, which is not correct. The weighted albedo (ZALB) is used for calculating the downward SW irradiance at the surface (the global radiation) from the net SW surface flux. The incorrect weighting thus gives a bias in the global radiation. This should be corrected in all HARMONIE/AROME versions! The averaged albedo is used to diagnose the model output spectrally averaged incoming and reflected shortwave radiation. Seems that these average fluxes do not enter SURFEX by default, but combinations are possible where they are still needed also for the surface parametrisations.
 * Modifications made in HLRADIA-HARMONIE for implementing the albedo
   - The input albedo is set to be the white sky albedo ZALBD from …/arp/phys_dmn/apl_arome.F90.
   - IN HLRADIA-HARMONIE the white sky albedo variable is called PALBEDD.
   - IN HLRADIA-HARMONIE the black sky albedo variable is called PALBEDP.
   - Definition zalbr = 0.7 in line 195 of HLRADIA is redundant and is removed.
   - The calculation of the correction value PSALBCOR (lines 1125-1127) is moved to …/arp/phys_dmn/apl_hlradia.F90.
   - In line 1236 and line 1250 the albedo variable for the calculation of zdtcle (clear sky heating due to SW absorption) is substituted with PALBEDP.
   - In line 1314 the albedo variable for the calculation of ztrs (SW clear sky transmittance) is substituted with PALBEDP.
   - In line 1317 the albedo variable for the calculation of zdf (SW scattered transmittance below the cloudy fraction) is substituted with PALBEDD.
   - In line 1323 the albedo variable for the calculations of psswnet (net surface SW irradiance) is substituted with ZALB, a weighted average of PALBEDP and PALBEDD. As weighting factor, COVMAX (maximum column cloud cover) is used, i.e. ZALB = PALBEDP*(1-ZCOVMAX) + PALBDEDD*ZCOVMAX.
   - In line 1347 the albedo variable for the calculation of zarfl (clear sky heating due to SW absorption) is substituted with PALBEDP.
 * Documentation on this in pdf-format can be downloaded from [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/Notes_on_the_albedo_calculations_in_HARMONIE_and_in_HLRADIA.pdf here].

== Coupling HLRADIA into APL_AROME ==

Using the RSUN variable the output from HLRADIA was redistributed to the 6 spectral bands. This gave a considerable improvement to comparison of the IFS and HLRADIA radiation schemes for the clear sky 'East Finland' case.

'''Notes on changing the calculation of scattered (diffuse) SW irradiance at the surface in HLRADIA'''

 * Scattered SW irradiance at the surface in HLRADIA (psswdf) is calculated as the sum of scattered irradiance from the clear sky fraction and scattered irradiance below clouds in the cloudy fraction. The HLRADIA version in HIRLAM 7.4 and in older HIRLAM versions contains an error: All irradiance below a cloud, however thin it is, is set to be scattered irradiance. The truth is that direct or almost direct solar irradiance is transmitted through a cloud according to the Beer-Lambert law of exponential transmittance:
     || T = exp(-τ^*^)/VIR, τ^*^ = τ(1-g), τ = (3 CWP)/(2 r,,e,, ρ,,w,,), VIR = 1+(τ/1425)^0.5^ ||
 * Here T is the transmittance, τ^*^ is the scaled cloud optical thickness in the visible spectrum, VIR is a correction factor to account for the absorption in the IR spectrum, τ is the cloud optical thickness in the visible spectrum, g is the asymmetry factor, CWP is the integrated cloud water path, r,,e,, is the average cloud effective radius and ρ,,w,, is the cloud water density. Here g is set to be 0.85 and ρ,,w,, is set to be 1000 kg/m3. The scaling of the optical thickness is done to account for irradiance that is scattered almost in the same direction as the direct beam. A reduced version of the formula above then is:
     || T=exp(-225(kg∙μm)⁄m^2^∙CWP/r,,e,,)/(1+((3/19)(kg∙μm)⁄m^2^∙CWP/r,,e,,)^0.5^) ||
 * Here CWP is given in units of kg/m^2^ and that re is given in units of µm. 
 * The scattered irradiance is then the global irradiance times 1 - T, i.e. one minus the transmittance.
 * This correction has been tested at DMI against measured scattered SW irradiances.

== Aerosols ==

Questions to be answered:

* Which aerosol routines are used in HARMONIE/MUSC?
  * …/arp/phys_dmn/radaer.F90 is a main subroutine for this in apl_arome.F90.
   Input 2D climatological aerosol, computes 3D distribution
  * …/arp/phys_dmn/aro_mnhdust.F90.
   run after radaer.F90 in apl_arome.F90 – produces dust aerosol input for the radiation schemes
   overwriting default type 3 aerosol(desert).
  * … aro_rainaero.F90 is
  called after the radiation schemes in apl_arome.F90.
* What and where are the logical switches?
  * The  Soot, land, sea and desert aerosols are set to True within the 3D harmonie namelist with sulfates and volcanic aerosols set to False. Setting the later to True causes the expt. to fail.
* What documentation exists for these aerosol routines?
  * Climatologies from Tanre et al. (1984)?
* Who works with aerosols in AROME?
  * From the header of radaer.F90:
|| 04/09 : || F. BOUYSSEL - USE OF TEGEN'S AEROSOLS (LNEWAER) ||
|| 09/09 : || A.Alias  - SULFAT AEROSOLS (combined to land) (J.F.Gueremy) || 
|| || - PAEVOL  put in stratospheric aerosols category || 
|| || instead of  RCSTBGA=cste (A.Voldoire) || 
|| 09/07 : || A. VOLDOIRE  - Add a table for sulfate aerosols alone  ||
|| || used for indirect effect calculation only ||
|| || For the direct effect, sulfate aerosols are  ||
|| || mixed with Land aerosols ||
* Does HARMONIE use climatological aerosols?
  * Climatological vertically integrated optical thicknesses of the aerosols are used as input to radaer.F90. This then outputs optical thicknesses of the aerosols at all model levels.
* Which aerosol types are available in HARMONIE?
  * See [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201302#Aerosols the wiki-page from the March 2013 radiation working week].
* How can the HARMONIE aerosol types be mapped into the Global Aerosol Data Set (GADS) types used in HLRADIA?
  * Soot -> SOOT
  * Land -> 1/3 INSO + 2/3 WASO
    * These fractions are estimated from the plots of INSO and WASO in the GADS report (Köpke ''et al.'' 1998).
  * Sea -> SSCM
  * Desert -> MITR
  * Sulphate & Volcano -> SUSO
* How can the HARMONIE aerosol optical depths be used in HLRADIA?
  * KPN: It will be necessary to re-write the interface and the subroutine, as it currently uses aerosol loads rather than optical depths. This requires some work but should not be a problem.
* Is it possible to assimilate satellite observations of aerosol optical depth?
  * < unanswered >
* How to import aerosol test data e.g. from offline/coupled air quality models?
  * LR: SILAM, http://silam.fmi.fi is a system for integrated modelling of atmospheric composition, which is off-line coupled to HIRLAM, ECMWF, possibly HARMONIE. It is possible to receive aerosol data from there in grib format. Mikhail Sofiev writes: "SILAM has sulphates, nitrates, ammonium, mixture of primary black carbon (soot) and organic carbon with some fractionation that can be roughly guessed, and sea salt. Fire smoke is a mixture of the above. Yet-missing components are dust and secondary organics." We might try to set up a Finnish-Russian Harmonie domain to try the 2010 summer data. This is the summer of widespread forest fires in Russia and elsewhere. SILAM has been rerun for this summer. Mikhail writes: "We were considering something like July - September if I remember right. But 15.7 - 25.8 will also do if you have something to initialise from. The worst in Moscow was 5-7.8, the wider areas were burning most of July and August." It is also possible to find space-born and in-situ aerosol measurements for comparison during this period. However, for the radiation HARMONIE study, the question is more about the sensitivity of the ECMWF and HIRLAM radiation schemes to the aerosol load.

== Interface questions in apl_arome ==

* SURFEX input includes ZZSFSWDIR and ZZSFSWDIFF, which are spectral downwelling direct and diffuse shortwave fluxes at the surface level (dimension klon, ksw). ECMWF radiation provides only ZZSFSWDIR, the contents of ZZSFSWDIFF is equal to zero. This means that in the ECMWF scheme, the variable ZZSFSWDIR is equal to the global radiation, not the direct flux. hlradia produces both for one integrated SW band, which is then divided to spectral bands using the band definitions in RSUN (see above). An open question: how to acquire from the ECMWF radiation scheme the separate direct and diffuse radiation fluxes. I is also necessarty pass this information from any radiation scheme to the HARMONIE output files.
* SURFEX input includes also the spectrally averaged thermal and global solar radiation fluxes. An open question is how SURFEX handles these different input, evidently depending on corresponding namelist settings. In other words, this is a question how the possible averages and spectral/tile weightnings are made inside SURFEX. 
* Preparation of cloud and aerosol input before the radiation calls requires careful inspection and possibly reorganisation. Some first steps in this direction were made when implementing and rearranging the radiation calls (acradin, radheat for ECMWF, apl_hlradia for Hirlam and coming apl_acraneb for ALARO radiation).
* Comment on radiation input. Please note that in HARMONIE output grib conversion, since version 37h1.1 a new conversion table is used. In this table https://hirlam.org/trac/wiki/HarmonieSystemDocumentation/Forecast/Outputlist/37h1 , the accumulated variables are defined with the WMO standard time range indicator. Usage of this indicator is necessary also when depicting the fields e.g. with grads. All output radiation variables at the surface and the top of atmosphere level are available as accumulated variables (with the exception of direct/diffuse SW at surface, see above.)

== Testing the radiation schemes ==

  === Benchmark sensitivity study with the DISORT model ===

14 separate experiments were run with an accurate 1D RT-model. In each of these the sensitivity to a different variable was tested.

The experiments were done with the DISORT2 algorithm in the libRadtran library (www.libradtran.org). They took their basis in a reference scenario with the following definitions:

- Day of year = 79 that is the 20th of March or equinox
- Altitude = 0.000 km above sea level
- Solar zenith angle = 56 degrees
- Surface albedo = 0.18
- No clouds
- Atmospheric profile: "mid-latitude summer" from Anderson (1986). This includes:
     - Geopotential heights
     - Temperatures
     - Air densities
     - Mixing ratios of ozone
     - Mixing ratios of oxygen
     - Mixing ratios of water
     - Mixing ratios of carbon dioxide
- Bass and Paur (1985) ozone cross section.
- Shettle (1989) "rural" aerosol profile.
- Kurudz (1992) solar spectrum averaged to 1 nm resolution by Bernhard Mayer.
- The DISORT2 algorithm was run in the spectral range 280 nm to 3001 nm with 1 nm resolution.
- The angular discretisation was 30 streams.

Results:
 
Experiment 1: Water vapour sensitivity
|| H2O mixing ratio [ppm]  ||      Global radiation ||
||            200.000000||             616.309000||
||            500.000000||             604.958000||
||           1000.000000||             594.615000|| 
||           2000.000000||             582.747000||
||           5000.000000||             564.335000||
||          10000.000000||             547.889000||
||          20000.000000||             529.830000||
	
Experiment 2: Solar zenith angle sensitivity
|| Latitude [degrees]    ||        Global radiation ||
||             54.500000||             556.340000||
||             55.000000||             548.039000||
||             55.500000||             539.698000||
||             56.000000||             531.316000||
||             56.500000||             522.895000||
||             57.000000||             514.436000||
||             57.500000||             505.940000|| 

Experiment 3: Day of year sensitivity

|| Day of year [day]    ||         Global radiation ||
||             15.000000||              544.928000||
||             45.000000||              540.530000||
||             75.000000||              532.534000||
||            105.000000||              523.277000||
||            135.000000||              515.224000||
||            165.000000||              510.274000||
||            195.000000||              509.460000||
||            225.000000||              512.936000||
||            255.000000||              519.988000||
||            285.000000||              529.036000||
||            315.000000||              537.792000||
||            345.000000||              543.787000||

Changing the "day of year" here only changes the Earth-Sun distance. The atmospheric profile is held constant.

Experiment 4: Albedo sensitivity for cloud free conditions
|| Albedo [-]            ||        Global radiation ||
||              0.000000||             522.074000||
||              0.100000||             527.136000||
||              0.200000||             532.380000||
||              0.300000||             537.821000||
||              0.400000||             543.475000||
||              0.500000||             549.439000||
||              0.600000||             555.495000||
||              0.700000||             561.906000|| 
||              0.800000||             568.621000||

Experiment 5: Cloud water sensitivity for 10 µm r,,e,, cloud drops
|| Cloud water load [kg/m^2^] ||     Global radiation ||
||              0.000000||             531.454000||
||              0.001000||             521.495000||
||              0.002000||             511.511000||
||              0.005000||             482.987000||
||              0.010000||             442.383000||
||              0.020000||             383.686000||
||              0.050000||             285.651000||
||              0.100000||             202.396000||
||              0.200000||             125.933000||
||              0.500000||              56.520000||
||              1.000000||              27.924000||
||              2.000000||              12.813000||
||              5.000000||               3.995500||

Experiment 6: Cloud drop effective radius sensitivity for 0.1 kg/m^2^ cloud water
|| Cloud r,,e, water,, [µm]  ||        Global radiation ||
||              4.000000||              91.101600||
||              7.000000||             155.214000||
||             10.000000||             202.396000||
||             15.000000||             256.825000||
||             20.000000||             293.399000||
||             30.000000||             340.897000||
||             40.000000||             370.423000||

Experiment 7: Albedo sensitivity for 0.1 kg/m^2^ cloud water and 10 µm r,,e,,
|| Albedo [-]            ||        Global radiation ||
||              0.000000||             180.300000||
||              0.100000||             191.931000||
||              0.200000||             205.196000||
||              0.300000||             220.468000||
||              0.400000||             238.245000||
||              0.500000||             259.208000||
||              0.600000||             284.308000||
||              0.700000||             314.922000||
||              0.800000||             353.122000||

Experiment 8: Albedo sensitivity for 1 kg/m^2^ cloud water and 10 µm r,,e,,
|| Albedo [-]            ||        Global radiation ||
||              0.000000||              23.343700||
||              0.100000||              25.683700||
||              0.200000||              28.547200||
||              0.300000||              32.132500||
||              0.400000||              36.753200||
||              0.500000||              42.935700||
||              0.600000||              51.637800|| 
||              0.700000||              64.806900||
||              0.800000||              87.112500||

Experiment 9: Cloud ice sensitivity for 50 µm r,,e,, cloud ice
|| Cloud ice load [kg/m^2^] ||       Global radiation || 
||              0.000000||             531.454000||
||              0.001000||             528.620000||
||              0.002000||             525.776000||
||              0.005000||             517.291000||
||              0.010000||             503.382000||
||              0.020000||             477.107000||
||              0.050000||             413.376000||
||              0.100000||             344.009000||
||              0.200000||             264.281000||
||              0.500000||             157.761000||

Experiment 10: Cloud ice sensitivity for 50 µm r,,e,, cloud ice and albedo 0.7
|| Cloud ice load [kg/m^2^] ||       Global radiation ||
||              0.000000||             562.085000||
||              0.001000||             560.517000||
||              0.002000||             558.895000||
||              0.005000||             553.824000||
||              0.010000||             544.968000||
||              0.020000||             527.108000||
||              0.050000||             480.932000||
||              0.100000||             429.030000||
||              0.200000||             366.152000||
||              0.500000||             262.922000||

Experiment 11: Cloud ice effective radius sensitivity for 0.1 kg/m^2^ cloud ice
|| Cloud r,,e, ice,, [µm]    ||        Global radiation ||
||             20.000000||             224.140000||
||             30.000000||             277.614000||
||             40.000000||             315.406000||
||             50.000000||             344.009000||
||             60.000000||             366.531000||
||             70.000000||             384.591000||
||             80.000000||             399.132000||

Experiment 12: Cloud ice effective radius sensitivity for 0.1 kg/m^2^ cloud ice and albedo 0.7
|| Cloud r,,e, ice,, [µm]    ||        Global radiation ||
||             20.000000||             334.242000||
||             30.000000||             379.586000||
||             40.000000||             408.319000||
||             50.000000||             429.030000||
||             60.000000||             445.036000||
||             70.000000||             457.795000||
||             80.000000||             468.057000||

Experiment 13: Air pressure sensitivity
|| Surface air pressure [hPa] ||   Global radiation ||
||            950.000000||             535.513000||
||            975.000000||             533.832000||
||           1000.000000||             532.171000||
||           1025.000000||             530.531000||
||           1050.000000||             528.910000||

Experiment 14: Ozone column sensitivity
|| Ozone column [DU]     ||        Global radiation || 
||            100.000000||             539.159000||
||            200.000000||             535.547000||
||            300.000000||             532.383000||
||            400.000000||             529.437000||
||            500.000000||             526.629000||
 
Experiment 15: Altitude sensitivity
|| Altitude [km]         ||        Global radiation ||
||              0.000000||             531.316000||
||              0.100000||             533.217000||
||              0.200000||             535.167000||
||              0.500000||             541.312000||
||              1.000000||             552.078000||
||              2.000000||             572.429000||
||              5.000000||             622.771000||

Experiment 16: Water vapour sensitivity - tropical atmosphere
|| H2O mixing ratio [ppm]   ||     Global radiation ||
||            200.000000||              617.498000||
||            500.000000||              606.070000||
||           1000.000000||              595.676000||
||           2000.000000||              583.753000||
||           5000.000000||              565.239000||
||          10000.000000||              548.674000||
||          20000.000000||              529.683000||
||          40000.000000||              514.161000||
Experiment 16 is almost the same as experiment 1, only the atmospheric profile has been replaced with the "tropical" atmospheric profile from Anderson (1986).

  === Sensitivity study using edited versions of the MUSC GABLS3 forcing files ===

Note that these tests were done by editing the MUSC GABLS3 surfex and atmospheric input forcing files. The test were only run for a few timesteps and in some cases the experiment became unstable quickly as the input forcing files probably led to an unbalanced initial state for the experiment run.

'''Experiment 1:''' Water vapour sensitivity (Global SW)

The water vapour mixing ratio (ppm) refers to the surface values.The atmospheric forcing file contains specific humidity values QV (g/g) for each of the 41 atmospheric levels in the test case. These were scaled to give the relevant ppm at the surface where ppm = SH*1.608*10^6.

Downward SW radiation at the surface is consistently 5-6% higher when the hlradia scheme is used instead of the IFS scheme.

||H2O mixing ratio [ppm]	||	DISORT2	||	IFS	||	hlradia	||	IFS %diff	||	hlradia %diff	||
||200	||	616.31	||	611.46	||	653.5	||	-0.79	||	6.03	||
||500	||	604.96	||	601.38	||	641.61	||	-0.59	||	6.06	||
||1000	||	594.62	||	592.03	||	630.58	||	-0.44	||	6.05	||
||2000	||	582.75	||	580.53	||	617.44	||	-0.38	||	5.95	||
||5000	||	564.34	||	561.4	||	596.18	||	-0.52	||	5.64	||
||10000	||	548.67	||	544.25	||	576.52	||	-0.81	||	5.08	||
||20000	||	529.68	||	524.52	||	553.14	||	-0.97	||	4.43	||


'''Experiment 2:''' Solar zenith angle sensitivity (Global SW)

||	Latitude [degrees]	||	DISORT2	||	IFS	||	hlradia	||	IFS (%diff)	||	hlradia (%diff)	||
||	0	||	1055.41	||	1047.96	||	1072.76	||	-0.71	||	1.64	||
||	10	||	1037.08	||	1030.21	||	1055.04	||	-0.66	||	1.73	||
||	20	||	982.71	||	975.95	||	1001.61	||	-0.69	||	1.92	||
||	30	||	894.23	||	886.17	||	914.38	||	-0.9	||	2.25	||
||	40	||	774.83	||	765.36	||	796.46	||	-1.22	||	2.79	||
||	50	||	629.01	||	621.08	||	652.25	||	-1.26	||	3.7	||
||	54.5	||	556.34	||	550.56	||	580.26	||	-1.04	||	4.3	||
||	55	||	548.04	||	542.55	||	572.03	||	-1	||	4.38	||
||	55.5	||	539.7	||	534.51	||	563.75	||	-0.96	||	4.46	||
||	56	||	531.32	||	526.44	||	555.44	||	-0.92	||	4.54	||
||	56.5	||	522.9	||	518.34	||	547.08	||	-0.87	||	4.62	||
||	57	||	514.44	||	510.21	||	538.68	||	-0.82	||	4.71	||
||	57.5	||	505.94	||	502.06	||	530.25	||	-0.77	||	4.8	||
||	60	||	463.01	||	460.89	||	487.52	||	-0.46	||	5.29	||
||	70	||	285.67	||	292.63	||	309.95	||	2.44	||	8.5	||
||	80	||	114.09	||	132.3	||	131.93	||	15.97	||	15.64	||


'''Experiment 3:''' Day of year sensitivity

*Used GABLS3 defaults but changed date and kept albedo at 0.18. Changed latitude to keep solar angle at 56 degrees. With and without aerosol cases were tests - the 'no aerosols case to check the effect of ozone. Aerosols were removed from the IFS scheme by setting them to zero in the defatm* namelist while for hlradia, the cask and caak parameters in suhlrad.F90 were set to 1.

||	Day of year [day]	||	DISORT2 	||	DISORT2 (no aerosols)	||	IFS	||	IFS (no aerosols)	||	hlradia	||	Hlradia (no aerosols)	||	IFS (%diff)	||	IFS (%diff) no aerosols	||	Hlradia (%diff)	||	Hlradia (%diff) no aerosols	||
||	15	||	544.93	||	571.38	||	534.64	||	573.54	||	564.2	||	598.29	||	-1.89	||	0.38	||	3.54	||	4.71	||
||	45	||	540.53	||	566.77	||	532.26	||	570.93	||	561.65	||	595.54	||	-1.53	||	0.73	||	3.91	||	5.08	||
||	75	||	532.53	||	558.38	||	512.17	||	549.81	||	540.74	||	573.76	||	-3.82	||	-1.54	||	1.54	||	2.75	||
||	105	||	523.28	||	548.68	||	510.96	||	548.25	||	539.3	||	571.99	||	-2.35	||	-0.08	||	3.06	||	4.25	||
||	135	||	515.22	||	540.24	||	505.51	||	542.32	||	533.49	||	565.76	||	-1.88	||	0.39	||	3.55	||	4.72	||
||	165	||	510.27	||	535.04	||	508.31	||	545.05	||	536.26	||	568.44	||	-0.38	||	1.87	||	5.09	||	6.24	||
||	195	||	509.46	||	534.19	||	507.31	||	543.98	||	535.21	||	567.33	||	-0.42	||	1.83	||	5.05	||	6.2	||
||	225	||	512.94	||	537.84	||	510.92	||	547.85	||	539.02	||	571.36	||	-0.39	||	1.86	||	5.08	||	6.23	||
||	255	||	519.99	||	545.23	||	516.27	||	553.64	||	544.7	||	577.44	||	-0.72	||	1.54	||	4.75	||	5.91	||
||	285	||	529.04	||	554.72	||	526.96	||	565.03	||	555.93	||	589.28	||	-0.39	||	1.86	||	5.08	||	6.23	||
||	315	||	537.79	||	563.9	||	531.94	||	570.49	||	561.27	||	595.05	||	-1.09	||	1.17	||	4.37	||	5.52	||
||	345	||	543.79	||	570.18	||	531.67	||	570.42	||	561.13	||	595.1	||	-2.23	||	0.04	||	3.19	||	4.37	||

Another Expt 3 - binary aerosols!

||		||	Latitude [degrees]	||	DISORT2	||	IFS	||	hlradia	||	IFS (%diff)	||	hlradia (%diff)	||
||	aerosols	||	56	||	531.80	||	526.44	||	555.44	||	-1.01	||	4.46	||
||	no aerosols	||	56	||	557.48	||	564.57	||	588.85	||	 1.27	||	5.63	||



'''Experiment 4:''' Albedo sensitivity for cloud free conditions (Global SW)

||	Albedo [-]	||	DISORT2	||	IFS	||	hlradia	||	IFS (%diff)	||	hlradia (%diff)	||
||	0	||	522.07	||	517.11	||	543.16	||	-0.95	||	4.04	||
||	0.1	||	527.14	||	522.2	||	549.98	||	-0.94	||	4.33	||
||	0.2	||	532.38	||	527.53	||	556.8	||	-0.91	||	4.59	||
||	0.3	||	537.82	||	533.12	||	563.63	||	-0.87	||	4.8	||
||	0.4	||	543.48	||	538.99	||	570.45	||	-0.83	||	4.96	||
||	0.5	||	549.44	||	545.17	||	577.27	||	-0.78	||	5.07	||
||	0.6	||	555.46	||	551.69	||	584.1	||	-0.68	||	5.16	||
||	0.7	||	561.91	||	558.57	||	590.92	||	-0.59	||	5.16	||
||	0.8	||	568.62	||	565.86	||	597.74	||	-0.49	||	5.12	||


'''Experiment 5:''' Cloud water sensitivity for 10 µm r,,e,, cloud drops
 * Hardcoded cloud water, cloud ice, cloud liquid water path and cloud ice path in radlsw.F90 (ZRADLP, ZRADIP, ZFLWP and ZFIWP) and included the line: ZDESR(JL)=ZRADIP(JL) / ZRefDe. This is to also correct the cloud ice particle diameter parameter that is used in some of the parametrizations (Fu 1996, Eq. 3.12)
 *  with cloud over 5 levels (9-13) 
 * Note C: ZRESW corrected and inhomogeneity factor set to 1.0 rather than 0.8
 * Note B: like C except inhomogeneity factor set to 0.8

||	Cloud water load [kg/m2] 	||	DISORT2 	||	IFS (nliqopt-1) 0.7	||	IFS (nliqopt-1) 1.0	||	IFS (nliqopt-2) 	||	IFS (nliqopt-3) 	||	hlradia 	||	Hlradia (note C)	||	Hlradia (note B)	||	IFS-1 (%diff) 0.7	||	IFS-1 (diff) 0.7	||	IFS-1 (%diff) 1.0	||	IFS-1 (diff) 1.0	||	IFS-2 (%diff) 	||	IFS-2 (diff) 	||	IFS-3 (%diff) 	||	IFS-3 (diff) 	||	hlradia (%diff) 	||	hlradia (diff) 	||	hlradia (%diff) Note C	||	hlradia (diff) Note C	||	hlradia (%diff) Note B	||	hlradia (diff) Note B	||
||	0	||	531.45	||	526.44	||	526.44	||	526.44	||	526.44	||	555.44	||	555.44	||	555.44	||	-0.94	||	-5.01	||	-0.94	||	-5.01	||	-0.94	||	-5.01	||	-0.94	||	-5.01	||	4.51	||	23.99	||	4.51	||	23.99	||	4.51	||	23.99	||
||	0.001	||	521.50	||	530.22	||	527.52	||	522.02	||	523.92	||	561.94	||	561.88	||	561.88	||	1.67	||	8.72	||	1.15	||	6.02	||	0.10	||	0.52	||	0.46	||	2.42	||	7.75	||	40.44	||	7.74	||	40.38	||	7.74	||	40.38	||
||	0.002	||	511.51	||	524.07	||	519.12	||	509.57	||	512.89	||	562.83	||	562.73	||	562.73	||	2.45	||	12.56	||	1.49	||	7.61	||	-0.38	||	-1.94	||	0.27	||	1.38	||	10.03	||	51.32	||	10.01	||	51.22	||	10.01	||	51.22	||
||	0.005	||	482.99	||	507.65	||	497.10	||	478.27	||	484.95	||	544.69	||	536.18	||	546.33	||	5.11	||	24.66	||	2.92	||	14.11	||	-0.98	||	-4.72	||	0.40	||	1.96	||	12.78	||	61.70	||	11.01	||	53.19	||	13.11	||	63.34	||
||	0.01	||	442.38	||	484.05	||	466.08	||	436.10	||	446.76	||	508.25	||	493.75	||	511.14	||	9.42	||	41.67	||	5.36	||	23.70	||	-1.42	||	-6.28	||	0.99	||	4.38	||	14.89	||	65.87	||	11.61	||	51.37	||	15.54	||	68.76	||
||	0.02	||	383.69	||	444.44	||	415.71	||	372.15	||	387.45	||	447.98	||	426.24	||	452.55	||	15.83	||	60.75	||	8.35	||	32.02	||	-3.01	||	-11.54	||	0.98	||	3.76	||	16.76	||	64.29	||	11.09	||	42.55	||	17.95	||	68.86	||
||	0.05	||	285.65	||	357.85	||	313.58	||	258.17	||	277.14	||	329.60	||	301.92	||	335.91	||	25.27	||	72.20	||	9.78	||	27.93	||	-9.62	||	-27.48	||	-2.98	||	-8.51	||	15.38	||	43.95	||	5.69	||	16.27	||	17.60	||	50.26	||
||	0.1	||	202.40	||	268.28	||	219.05	||	168.70	||	185.83	||	228.28	||	202.92	||	234.43	||	32.55	||	65.88	||	8.22	||	16.65	||	-16.65	||	-33.70	||	-8.19	||	-16.57	||	12.79	||	25.88	||	0.26	||	0.52	||	15.83	||	32.03	||
||	0.2	||	125.93	||	174.13	||	130.76	||	98.11	||	109.98	||	141.16	||	122.45	||	145.91	||	38.28	||	48.20	||	3.83	||	4.83	||	-22.09	||	-27.82	||	-12.66	||	-15.95	||	12.09	||	15.23	||	-2.76	||	-3.48	||	15.86	||	19.98	||
||	0.5	||	56.52	||	75.61	||	49.76	||	42.24	||	48.18	||	65.72	||	55.87	||	68.32	||	33.78	||	19.09	||	-11.97	||	-6.76	||	-25.26	||	-14.28	||	-14.76	||	-8.34	||	16.29	||	9.20	||	-1.15	||	-0.65	||	20.88	||	11.80	||
||	1	||	27.92	||	31.78	||	18.58	||	19.44	||	23.00	||	34.74	||	29.29	||	36.20	||	13.84	||	3.86	||	-33.46	||	-9.34	||	-30.39	||	-8.48	||	-17.61	||	-4.92	||	24.43	||	6.82	||	4.92	||	1.37	||	29.64	||	8.28	||
||	2	||	12.81	||	10.40	||	5.01	||	7.64	||	9.33	||	17.87	||	15.00	||	18.64	||	-18.84	||	-2.41	||	-60.92	||	-7.80	||	-40.35	||	-5.17	||	-27.20	||	-3.48	||	39.52	||	5.06	||	17.13	||	2.19	||	45.55	||	5.83	||
||	5	||	4.00	||	1.05	||	0.24	||	1.99	||	2.40	||	7.27	||	6.09	||	7.59	||	-73.71	||	-2.95	||	-93.92	||	-3.76	||	-50.13	||	-2.01	||	-40.06	||	-1.60	||	81.75	||	3.27	||	52.17	||	2.09	||	89.75	||	3.59	||


'''Experiment 6:''' Cloud drop effective radius sensitivity for 0.1 kg/m^2^ cloud water
  *  cloud over 5 levels (9-13)

* In the below, NLIQOPT 3 is a new parameterisation for cloud water developed by Kristian Pagh-Nielsen.
* In the default IFS code, RSWINHF is set to 0.7.
* In Kristian's scheme it should be 1 but this may have implications for the ice scheme - need to test this!
* KPN's scheme performs significantly better than the schemes already available in the IFS subroutine radlsw.F90.

||	Cloud re, water [µm] 	||	DISORT2 	||	IFS (nswliqopt-1) 0.7	||	IFS (nswliqopt-1) 1.0	||	IFS (nswliqopt-2) 	||	IFS (nswliqopt-3) 	||	hlradia (See note A)	||	hlradia (See Note B)	||	hlradia (See Note C)	||	hlradia (See Note D)	||	IFS-1 (%diff) 0.7	||	IFS-1 (diff) 0.7	||	IFS-1 (%diff) 1.0	||	IFS-1 (diff) 1.0	||	IFS-2 (%diff) 	||	IFS-2 (diff) 	||	IFS-3 (%diff) 	||	IFS-3 (diff) 	||	Hlradia A (%diff) 	||	hlradia A (diff) 	||	Hlradia B (%diff) 	||	hlradia B (diff) 	||	Hlradia C (%diff) 	||	hlradia C (diff) 	||	Hlradia D (%diff) 	||	hlradia D (diff) 	||
||	4	||	91.10	||	146.35	||	106.70	||	83.41	||	81.07	||	193.11	||	112.03	||	92.94	||	120.52	||	60.65	||	55.25	||	17.13	||	15.60	||	-8.44	||	-7.69	||	-11.01	||	-10.03	||	111.98	||	102.01	||	22.97	||	20.93	||	2.02	||	1.84	||	32.29	||	29.42	||
||	7	||	155.21	||	219.05	||	171.54	||	130.31	||	138.70	||	211.51	||	182.20	||	154.83	||	199.91	||	41.13	||	63.84	||	10.52	||	16.33	||	-16.05	||	-24.90	||	-10.64	||	-16.51	||	36.27	||	56.30	||	17.39	||	26.99	||	-0.25	||	-0.38	||	28.80	||	44.70	||
||	10	||	202.40	||	268.28	||	219.05	||	168.70	||	185.83	||	228.28	||	234.43	||	202.92	||	261.15	||	32.55	||	65.88	||	8.22	||	16.65	||	-16.65	||	-33.70	||	-8.19	||	-16.57	||	12.79	||	25.88	||	15.83	||	32.03	||	0.26	||	0.52	||	29.03	||	58.75	||
||	15	||	256.83	||	322.51	||	274.98	||	220.90	||	244.02	||	253.14	||	296.85	||	262.92	||	336.94	||	25.57	||	65.68	||	7.07	||	18.15	||	-13.99	||	-35.93	||	-4.99	||	-12.81	||	-1.44	||	-3.69	||	15.58	||	40.02	||	2.37	||	6.09	||	31.19	||	80.11	||
||	20	||	293.40	||	357.85	||	313.58	||	264.04	||	284.84	||	274.77	||	340.40	||	306.56	||	391.65	||	21.97	||	64.45	||	6.88	||	20.18	||	-10.01	||	-29.36	||	-2.92	||	-8.56	||	-6.35	||	-18.63	||	16.02	||	47.00	||	4.48	||	13.16	||	33.49	||	98.25	||
||	30	||	340.90	||	401.33	||	363.49	||	337.29	||	338.35	||	310.57	||	396.95	||	365.63	||	465.13	||	17.73	||	60.43	||	6.63	||	22.59	||	-1.06	||	-3.61	||	-0.75	||	-2.55	||	-8.90	||	-30.33	||	16.44	||	56.05	||	7.25	||	24.73	||	36.44	||	124.23	||
||	40	||	370.42	||	427.20	||	394.50	||	438.17	||	372.37	||	338.95	||	431.88	||	403.64	||	512.06	||	15.33	||	56.78	||	6.50	||	24.08	||	18.29	||	67.75	||	0.53	||	1.95	||	-8.50	||	-31.47	||	16.59	||	61.46	||	8.97	||	33.22	||	38.24	||	141.64	||



Note A: In this hlradia expt the ZRESW is a linear combination of the ice and water effective radii rather than just being equal to ZREWAT (liq radius). This is wrong!

Note B: This time ZRESW=ZREWAT in and below the cloud. In both A and B the inhomogeneity factor of 0.8 is included.

Note C: Similar to B but inhomogeneity factor is now 1.0.

Note D: Changed (1._JPRB-palbedd(jl)*(1._JPRB-ztrans(jl))*zapr) to ((1._JPRB -palbedd(jl)*(1._JPRB-ztrans(jl)))*zapr) ie moved brackets


'''Experiment 7:''' Albedo sensitivity for 0.1 kg/m^2^ cloud water and 10 µm r,,e,,
  * with cloud over 5 levels (9-13) rather than concentrated in one level.
  * nswliqopt=1 (Fouquart), 2 (Slingo), 3 (Nielsen)
  * Note C: zresw amended and inhomogeneity factor set to 1.0
  * Note B: like C except inhomogeneity factor set to 0.8

||	Albedo [-]	||	DISORT2	||	IFS (nliqopt-1) 0.7	||	IFS (nliqopt-1) 1.0	||	IFS (nswliqopt=2)	||	IFS (nswliqopt=3)	||	hlradia	||	hlradia (Note C)	||	hlradia (Note B)	||	IFS-1 (%diff) 0.7	||	IFS-1 (%diff) 1.0	||	IFS-2 (%diff)	||	IFS-3 (%diff)	||	hlradia (%diff)	||	hlradia (%diff) Note C	||	hlradia (%diff) Note B	||
||	0	||	180.30	||	247.78	||	199.83	||	150.92	||	167.09	||	206.71	||	182.65	||	212.59	||	37.43	||	10.83	||	-16.29	||	-7.33	||	14.65	||	1.30	||	17.91	||
||	0.1	||	191.93	||	258.74	||	210.05	||	160.30	||	176.99	||	218.13	||	193.36	||	224.17	||	34.81	||	9.44	||	-16.48	||	-7.78	||	13.65	||	0.74	||	16.80	||
||	0.2	||	205.20	||	270.79	||	221.42	||	170.94	||	188.18	||	230.97	||	205.47	||	237.15	||	31.96	||	7.91	||	-16.70	||	-8.30	||	12.56	||	0.13	||	15.57	||
||	0.3	||	220.47	||	284.09	||	234.18	||	183.12	||	200.90	||	245.51	||	219.28	||	251.82	||	28.86	||	6.22	||	-16.94	||	-8.88	||	11.36	||	-0.54	||	14.22	||
||	0.4	||	238.25	||	298.86	||	248.58	||	197.21	||	215.51	||	262.10	||	235.17	||	268.53	||	25.44	||	4.34	||	-17.23	||	-9.54	||	10.01	||	-1.29	||	12.71	||
||	0.5	||	259.21	||	315.37	||	264.99	||	213.70	||	232.47	||	281.21	||	253.65	||	287.74	||	21.67	||	2.23	||	-17.56	||	-10.31	||	8.49	||	-2.15	||	11.01	||
||	0.6	||	284.31	||	333.98	||	283.89	||	233.27	||	252.41	||	303.46	||	275.40	||	310.03	||	17.47	||	-0.15	||	-17.95	||	-11.22	||	6.74	||	-3.13	||	9.05	||
||	0.7	||	314.92	||	355.12	||	305.91	||	256.89	||	276.19	||	329.69	||	301.40	||	336.24	||	12.77	||	-2.86	||	-18.43	||	-12.30	||	4.69	||	-4.29	||	6.77	||
||	0.8	||	353.12	||	379.39	||	331.95	||	285.98	||	305.07	||	361.08	||	332.99	||	367.48	||	7.44	||	-5.99	||	-19.01	||	-13.61	||	2.26	||	-5.70	||	4.07	||


'''Experiment 8:''' Albedo sensitivity for 1 kg/m^2^ cloud water and 10 µm r,,e,,
 cloud in 5 levels
  * nswliqopt=1 (Fouquart), 2 (Slingo), 3 (Nielsen)
  * Note C: zresw amended and inhomogeneity=1.0
  * Note B: like C except inhomogeneity factor set to 0.8

||	Albedo [-]	||	DISORT2	||	IFS (nliqopt-1) 0.7	||	IFS (nliqopt-1) 1.0	||	IFS (nswliqopt-2)	||	IFS (nswliqopt-3)	||	hlradia	||	hlradia Note C	||	hlradia (Note B)	||	IFS-1 (%diff) 0.7	||	IFS-1 (%diff) 1.0	||	IFS-2 (%diff)	||	IFS-3 (%diff)	||	hlradia (%diff)	||	hlradia (%diff) Note C	||	hlradia (%diff) Note B	||
||	0	||	23.34	||	27.38	||	15.89	||	16.42	||	19.45	||	30.07	||	25.32	||	31.34	||	17.32	||		||	-29.67	||	-16.68	||	28.83	||	8.50	||	34.27	||
||	0.1	||	25.68	||	29.66	||	17.28	||	17.97	||	21.27	||	32.49	||	27.38	||	33.86	||	15.50	||		||	-30.03	||	-17.15	||	26.53	||	6.63	||	31.85	||
||	0.2	||	28.55	||	32.36	||	18.94	||	19.84	||	23.48	||	35.35	||	29.82	||	36.83	||	13.36	||		||	-30.50	||	-17.75	||	23.83	||	4.43	||	29.01	||
||	0.3	||	32.13	||	35.62	||	20.95	||	22.16	||	26.20	||	38.78	||	32.73	||	40.39	||	10.86	||		||	-31.04	||	-18.45	||	20.70	||	1.88	||	25.72	||
||	0.4	||	36.75	||	39.62	||	23.47	||	25.08	||	29.63	||	42.96	||	36.30	||	44.74	||	7.82	||		||	-31.75	||	-19.36	||	16.90	||	-1.22	||	21.73	||
||	0.5	||	42.94	||	44.68	||	26.67	||	28.90	||	34.11	||	48.18	||	40.77	||	50.15	||	4.04	||		||	-32.70	||	-20.57	||	12.20	||	-5.06	||	16.79	||
||	0.6	||	51.64	||	51.26	||	30.92	||	34.09	||	40.18	||	54.86	||	46.50	||	57.08	||	-0.74	||		||	-33.98	||	-22.19	||	6.24	||	-9.95	||	10.54	||
||	0.7	||	64.81	||	60.22	||	36.84	||	41.57	||	48.90	||	63.75	||	54.16	||	66.28	||	-7.08	||		||	-35.85	||	-24.54	||	-1.64	||	-16.44	||	2.27	||
||	0.8	||	87.11	||	73.19	||	45.66	||	53.29	||	62.50	||	76.12	||	64.87	||	79.08	||	-15.98	||		||	-38.82	||	-28.25	||	-12.62	||	-25.53	||	-9.22	||


''Experiment 9:''' Cloud ice sensitivity for 50 µm r,,e,, cloud ice																
 *  cloud over 5 layers [albedo 0.18]																
															
repeat of expt 9 - zresw altered - now using the following equation: zreq(jl,jk)=a1*zreice(jl,jk)+a2*zscos(jl)+a3

||	Cloud ice load [kg/m2]	||	DISORT2	||	IFS (nswiceopt=2)	||	IFS (NSWICEOPT=3)	||	hlradia	||	hlradia inhom 1.0	||	hlradia inhom 0.8	||	IFS-2 (%diff)	||	IFS-3 (%diff)	||	hlradia(%diff)	||	hlradia(%diff) inhom 1.0	||	hlradia(%diff) inhom 0.8	||
||	0.000	||	531.45	||	526.44	||	526.44	||	555.44	||	555.44	||	555.44	||	-0.94	||	-0.94	||	4.51	||	4.51	||	4.51	||
||	0.001	||	528.62	||	533.24	||	533.28	||	562.64	||	561.11	||	561.11	||	0.87	||	0.88	||	6.44	||	6.15	||	6.15	||
||	0.002	||	525.78	||	529.59	||	529.67	||	562.78	||	561.11	||	561.11	||	0.72	||	0.74	||	7.04	||	6.72	||	6.72	||
||	0.005	||	517.29	||	519.59	||	519.75	||	563.5	||	561.57	||	561.57	||	0.44	||	0.48	||	8.93	||	8.56	||	8.56	||
||	0.010	||	503.38	||	504.79	||	505.05	||	551.5	||	549.71	||	557.08	||	0.28	||	0.33	||	9.56	||	9.2	||	10.67	||
||	0.020	||	477.11	||	479	||	479.38	||	521.9	||	517.88	||	531.05	||	0.4	||	0.48	||	9.39	||	8.54	||	11.3	||
||	0.050	||	413.38	||	417.28	||	417.77	||	449.41	||	441.49	||	465.84	||	0.94	||	1.06	||	8.72	||	6.8	||	12.69	||
||	0.100	||	344.01	||	343.46	||	343.87	||	364.41	||	354.25	||	386.27	||	-0.16	||	-0.04	||	5.93	||	2.98	||	12.28	||
||	0.200	||	264.28	||	251.42	||	251.64	||	263.87	||	253.68	||	287.36	||	-4.87	||	-4.78	||	-0.16	||	-4.01	||	8.73	||
||	0.500	||	157.76	||	136.19	||	136.37	||	144	||	136.8	||	162.07	||	-13.67	||	-13.56	||	-8.72	||	-13.29	||	2.73	||
																
																
''Experiment 10:''' Cloud ice sensitivity for 50 µm r,,e,, cloud ice and albedo 0.7 (5 cloud layers)																

repeat of expt 10 - zresw altered - now using the following equation: zreq(jl,jk)=a1*zreice(jl,jk)+a2*zscos(jl)+a3

||	Cloud ice load [kg/m2]	||	DISORT2	||	IFS (nswiceopt=2)	||	IFS (NSWICEOPT=3)	||	hlradia	||	hlradia inhom 1.0	||	hlradia inhom 0.8	||	IFS-2 (%diff)	||	IFS (%diff)	||	hlradia(%diff)	||	hlradia(%diff) inhom 1.0	||	hlradia(%diff) inhom 0.8	||
||	0.000	||	562.09	||	558.57	||	558.57	||	590.92	||	590.92	||	590.92	||	-0.63	||	-0.63	||	5.13	||	5.13	||	5.13	||
||	0.001	||	560.52	||	571.3	||	571.34	||	579.13	||	578.19	||	578.19	||	1.92	||	1.93	||	3.32	||	3.15	||	3.15	||
||	0.002	||	558.9	||	568.31	||	568.38	||	579.27	||	578.19	||	578.19	||	1.68	||	1.7	||	3.64	||	3.45	||	3.45	||
||	0.005	||	553.82	||	560.31	||	560.43	||	579.99	||	578.65	||	578.65	||	1.17	||	1.19	||	4.72	||	4.48	||	4.48	||
||	0.010	||	544.97	||	548.81	||	548.98	||	575.27	||	574.07	||	578.22	||	0.7	||	0.74	||	5.56	||	5.34	||	6.1	||
||	0.020	||	527.11	||	529.12	||	529.32	||	559.36	||	556.59	||	564.41	||	0.38	||	0.42	||	6.12	||	5.59	||	7.08	||
||	0.050	||	480.93	||	481.44	||	481.59	||	515.75	||	509.78	||	526.27	||	0.11	||	0.14	||	7.24	||	6	||	9.43	||
||	0.100	||	429.03	||	421.12	||	421.07	||	454.76	||	446.02	||	471.58	||	-1.84	||	-1.85	||	6	||	3.96	||	9.92	||
||	0.200	||	366.15	||	338.28	||	338.09	||	365.96	||	355.45	||	388.58	||	-7.61	||	-7.66	||	-0.05	||	-2.92	||	6.13	||
||	0.500	||	262.92	||	216.78	||	216.83	||	229.28	||	219.7	||	252.52	||	-17.55	||	-17.53	||	-12.8	||	-16.44	||	-3.95	||


''Experiment 11:''' Cloud ice effective radius sensitivity for 0.1 kg/m2 cloud ice [albedo 0.18]																
																																	
repeat of expt 11 - zresw altered - now using the following equation: zreq(jl,jk)=a1*zreice(jl,jk)+a2*zscos(jl)+a3

||	Cloud re, ice [µm]	||	DISORT2	||	IFS (nswiceopt=2)	||	IFS (nswiceopt=3)	||	hlradia	||	hlradia inhom 1.0	||	hlradia inhom 0.8	||	IFS-2 (%diff)	||	IFS-3 (%diff)	||	hlradia(%diff)	||	hlradia(%diff) inhom 1.0	||	hlradia(%diff) inhom 0.8	||
||	20.000	||	224.14	||	201.17	||	207.74	||	243.9	||	229.5	||	262.45	||	-10.25	||	-7.32	||	8.82	||	2.39	||	17.09	||
||	30.000	||	277.61	||	260.84	||	267.48	||	296.54	||	283.95	||	318.02	||	-6.04	||	-3.65	||	6.82	||	2.28	||	14.56	||
||	40.000	||	315.41	||	306.82	||	311.1	||	335.06	||	323.82	||	357.21	||	-2.72	||	-1.37	||	6.23	||	2.67	||	13.25	||
||	50.000	||	344.01	||	343.46	||	343.87	||	364.41	||	354.25	||	386.27	||	-0.16	||	-0.04	||	5.93	||	2.98	||	12.28	||
||	60.000	||	366.53	||	373.22	||	368.99	||	387.48	||	378.2	||	408.63	||	1.83	||	0.67	||	5.72	||	3.18	||	11.48	||
||	70.000	||	384.59	||	397.63	||	388.5	||	406.08	||	397.52	||	426.34	||	3.39	||	1.02	||	5.59	||	3.36	||	10.85	||
||	80.000	||	399.13	||	417.68	||	403.75	||	421.36	||	413.43	||	440.69	||	4.65	||	1.16	||	5.57	||	3.58	||	10.41	||


''Experiment 12:''' Cloud ice effective radius sensitivity for 0.1 kg/m2 cloud ice [albedo 0.7]																
	
repeat of expt 12 - zresw altered - now using the following equation: zreq(jl,jk)=a1*zreice(jl,jk)+a2*zscos(jl)+a3

||	Cloud re, ice [µm]	||	DISORT2	||	IFS (nswiceopt=2)	||	IFS (nswiceopt=3)	||	hlradia	||	hlradia inhom 1.0	||	hlradia inhom 0.8	||	IFS-2 (%diff)	||	IFS-3 (%diff)	||	hlradia(%diff)	||	hlradia(%diff) inhom 1.0	||	hlradia(%diff) inhom 0.8	||
||	20.000	||	334.24	||	292.24	||	298.46	||	346.04	||	330.65	||	364.92	||	-12.56	||	-10.7	||	3.53	||	-1.07	||	9.18	||
||	30.000	||	379.59	||	350.06	||	355.63	||	397.26	||	385.13	||	416.56	||	-7.78	||	-6.31	||	4.66	||	1.46	||	9.74	||
||	40.000	||	408.32	||	390.66	||	393.87	||	430.99	||	420.88	||	449.21	||	-4.33	||	-3.54	||	5.55	||	3.08	||	10.01	||
||	50.000	||	429.03	||	421.12	||	421.07	||	454.76	||	446.02	||	471.58	||	-1.84	||	-1.85	||	6	||	3.96	||	9.92	||
||	60.000	||	445.04	||	444.9	||	441.22	||	472.34	||	464.61	||	487.77	||	-0.03	||	-0.86	||	6.14	||	4.4	||	9.6	||
||	70.000	||	457.8	||	463.9	||	456.51	||	485.83	||	478.86	||	500	||	1.33	||	-0.28	||	6.12	||	4.6	||	9.22	||
||	80.000	||	468.06	||	479.29	||	468.27	||	496.47	||	490.11	||	509.51	||	2.4	||	0.05	||	6.07	||	4.71	||	8.86	||


Link to some plots of the above:[https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/PlotsRadiation.pdf].
* Also included atmospheric profile plots (SW net, up and down at each level). In the cloudy case, 2 examples were considered: 1. Cloud in the lowest level 2. Cloud equally distributed over 5 levels (~1-2km height and not weighted by layer thickness).

== Some points relating to the Model ==
* 'LSRTM' => '.FALSE.,' in the namelist so NLIQOPT=0 (but otherwise it would be 2).

* In the plots the NLIQOPT=0 profiles are a better fit to the Distort2 model (NLIQOPT=2 is the default setting though). There appears to be a greater discrepancy in the upward SW than the downward. Could this be something to do with the coupling to surfex or direct/diffuse possible issue?

*  Ran a 12h MUSC-Arome expt to look at the diffuse and direct SW output for the IFS and hlradia cases. I printed the SW components to the output files after various routines were called. They are first calculated in Radlsw.F90 in the IFS case. This is called by Recmwf via Acadin which sets the values to zero depending on the solar angle. Radheat also calculates the SW components and I would have assumed that they should be the same as the output from Acradin as the model is run every timestep - they are identical in the direct case but in the case of diffuse radiation, when SW radiation becomes non-zero, there's a lag between the values from Acradin and Radheat - I've attached a spreadsheet with the data for bands 3 and 4 which contain most of the power: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/Direct-Diffuse.ods]. The hlradia output is different probably because of the cloud liq etc but the main reason for me doing this test was to show that IFS has both components and that ZZSFSWDIF is not set to zero as we had assumed - see later for update on this regarding clear sky case!

* I have attached some output from a clear-sky Gabls expt and it shows that in the IFS case the diffuse is zero and all the SW is in the direct - in Hlradia diffuse exists and so the direct is lower. I've also included Kristian's Distort values for comparison. While the total (diffuse+direct) for the IFS case matches the Disort data very well, hlradia captures the split between direct and diffuse better. [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/Direct-Diffuse-Gabls3.ods] and [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/DirectDiffuse_13122012.pdf].

* 1.  I took a closer look at the IFS code. When we run a clear sky example the variable PCLEAR=1 (set in swu.F90). In the SW routines (SW1S - 0.25-0.68 MICRON and SWNI - 0.68-4.00 MICRON) the following lines calculate the diffuse and direct and the diffuse becomes zero in the clear sky case as PCLEAR=1.

   DO JL = KIDIA,KFDIA
     ZDIFF(JL) = ZR(JL,1)*ZR(JL,2)*ZT(JL,1)*ZRJ(JL,JAJ,IKL)
     ZDIRF(JL) = ZR(JL,3)*ZR(JL,4)*ZT(JL,2)*ZRJ0(JL,JAJ,IKL)
     PDIFF(JL,IKL) = ZDIFF(JL) * RSUN(KNU)*(1.0_JPRB-PCLEAR(JL))
     PDIRF(JL,IKL) = ZDIRF(JL) * RSUN(KNU)*PCLEAR(JL)
     PFD(JL,IKL) = ((1.0_JPRB-PCLEAR(JL)) * ZDIFF(JL)&
      & +PCLEAR(JL)  * ZDIRF(JL)) * RSUN(KNU)
     PCD(JL,IKL) = ZDIRF(JL) * RSUN(KNU)
   ENDDO

I also checked the musc-arome case (East Finland example where we had no cloud) and again PCLEAR=1 - I just checked that to ensure that the Gabls3 expt hadn't introduced something peculiar.


* 2. I looked at some of the SURFEX routines and followed the Nature-ISBA ones through to see what's happening the diffuse/direct components. In some places global SW is computed (e.g. in src/surfex/new/init_isba_sbl.F90:

   !We compute total shortwave incoming radiation needed by veg
   ZP_GLOBAL_SW(:) = 0.
   DO JSWB=1,SIZE(PSW_BANDS)
     ZP_GLOBAL_SW(:)   = ZP_GLOBAL_SW(:) + (PDIR_SW(:,JSWB) + PSCA_SW(:,JSWB))
   END DO

but in src/surfex/new/isba_albedo.F90 (attached) we have the following which uses the diffuse and direct components to calculate the overall albedos. If the diffuse and direct albedos are identical for a particular band, then it may not matter that all the power is in the direct.

!* snow-free global albedo (needed by ISBA)
!
 ZSW_UP(:) = 0.
 DO JSWB=1,KSW
   ZSW_UP(:) =  ZSW_UP(:)                                       &
               + ZDIR_ALB_WITHOUT_SNOW(:,JSWB) * PDIR_SW(:,JSWB) &
               + ZSCA_ALB_WITHOUT_SNOW(:,JSWB) * PSCA_SW(:,JSWB)
 END DO
 PSNOWFREE_ALB(:) = XUNDEF
 WHERE(PGLOBAL_SW(:)>0.)
      PSNOWFREE_ALB(:) = ZSW_UP(:) / PGLOBAL_SW(:)
 ELSEWHERE
      PSNOWFREE_ALB(:) = ZDIR_ALB_WITHOUT_SNOW(:,1)
 END WHERE
! 

* In the clear case, PCLEAR which comes from swu.F90 is set to 1 so there's no diffuse but in fact the value in the direct component seems to be the global radiation and not just the direct. I did a test by modifying

PDIFF(JL,IKL) = ZDIFF(JL) * RSUN(KNU)*(1.0_JPRB-PCLEAR(JL))
PDIRF(JL,IKL) = ZDIRF(JL) * RSUN(KNU)*PCLEAR(JL)

to

PDIFF(JL,IKL) = ZDIFF(JL) * RSUN(KNU)
PDIRF(JL,IKL) = ZDIRF(JL) * RSUN(KNU)

and there are values in all the bands in the diffuse case - the numbers are comparable to the direct (this is wrong) so it seems as if ZDIFF and ZDIRF are actually global SW radiation.

In the cloudy musc-arome 12hr run where there was diffuse o/p PCLEAR must have been a fraction.


=== Three-dimensional HARMONIE comparisons ===

Some preliminary 3D HARMONIE-AROME tests were run for January 2011 with comparison of Sodankylä radiation observations. Radiation fluxes of three model runs are compared: HIRLAM RCR with data picked from archive, HARMONIE-AROME experiment 37h1.2 over the Finnish domain with the reference ECMWF radiation (ecradia) and with the slightly modified HIRLAM radiation scheme called from AROME (hlradia). Vertically integrated cloud water and ice are available for HIRLAM and HARMONIE with ecradia. Preliminary comparison results are shown here: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/Rontu_sodaradcomp.pdf (pdf)].  

=== Notes for the plan: Comparison of the HARMONIE/MUSC IFS-radiation schemes ===

Basic MUSC tests with input from 3D radiation
 - Helsinki, East Finland, Norrköping, Sodankyla available - prepare more cases
 - obtain and store MUSC initial profiles for Sodankyla 
   from FMI HARMONIE operational runs - to be used when interesting cases turn up 
 - check the LFA output, Emily's tools for plotting

Documentation on this in pdf-format can be downloaded from [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/Harmonie_26102012.pdf here].


Single-step data for radiation scheme validation 
 - use GABLS3 experiment input namelists as template for preparation of hand-made initial data in MUSC 
 - (1d HIRLAM framework for hlradia)

Sandbox for radiation code development in MUSC branch?
- Asked Ulf Andrae

Cloud/aerosol cleaning from inside radiation routines 
- minimum common input for any radiation scheme. 

Observations
- Sodankylä regular measurements of LW, SW down/up, averaged over 3h and corresponding fluxes from wintertime operational HIRLAM RCR, are available [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/Sodarad.tgz here] for Jan 2008 -August 2011. There is also a small script to pick/depict monthly time-series. Not much documentation, sorry ...  The original minute observations (but gaps filled with missing values) are [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/sodaobsrad_2009-2011_clean.tgz here]. 
- mast comparison (Sodankylä, Lindenbert, Cabauw, Valladolid)... 
- measurement campaigns in Arctic/Antarctic ... Svalbard
- global radiation networks - Danish, German? 

3D HARMONIE tests
 - code tested in MUSC to be tried in HARMONIE experiments
 - possibility of parallel runs in Met Eireann?

Import ACRANEB to APL_AROME (logical switch: LALAR)
- see aplpar, ac_cloud_model for the interface
- MUSC reference code + technical support to Jan Masek
- implementation by Jan Masek, work together

== HARMONIE code used for radiation comparison ==

LR: We have tried radiation code modifications both in MUSC and 3D HARMONIE. MUSC code is available via subversion from https://svn.hirlam.org/branches/harmonie_MUSC . There is a new test package test_harad.tgz, which contains the modified code and a couple of initial files for testing. The same code can be used in a 3D experiment, but modifications to the namelist need to be written to harmonie_namelists.pm or elsewhere. Please find a tarball for 3D experiment [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/harad37h11.tar.gz here]. 

== Future plans ==

- The HLRADIA version from Enviro-HIRLAM needs to be adapted to use aerosol optical thicknesses at model levels in order to be used in HARMONIE (KPN).
- The sensitivity test of the HARMONIE IFS radiation scheme with MUSC should be updated including a single time step test with modified GABLS3 data (EG).
- A sensitivity test of the HARMONIE HLRADIA radiation scheme should be made (KPN).
- 3D comparisons in real time HARMONIE should be set up (LR/EG).
- Observation verification should be made (KPN/LR/EG).
- ACRANEB - the ALARO radiation scheme - should be imported to APL_AROME (JM/ALARO group).

== Summary ==
 
- The albedo issue has been fixed.
- A plan has been made for implementing HLRADIA including aerosols in HARMONIE.
- A plan has been made for doing a sensitivity test of the HARMONIE IFS radiation scheme with MUSC.
- A plan has been made for doing a sensitivity test of the HARMONIE HLRADIA radiation scheme.
- The comparison of the IFS and the HLRADIA radiation schemes in MUSC/HARMONIE is ongoing.

== Reference: previous HARMONIE working weeks on radiation ==

 * The work here is a continuation of a working week at FMI from the 11^th^ to the 20^th^ of April.

== Some Useful Files ==
* File which creates MUSC input files using the GABLS3 forcing files: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/acadfa1D_main.F90]
* GABLS3 atmospheric forcing file - comments from Emily included: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/defatm_GABLS3_L41.nam-Emily]
* GABLS3 atmospheric forcing file - similar to default with but date/lat/albedos set the same as in KPN experiments: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/defatm_GABLS3_L41.nam]
* Modified file which creates MUSC input files using the GABLS3 forcing files - Cloud cover is set to 0 or 1 depending on whether cloud liquid and/or cloud ice is 0 or non-zero: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/acadfa1D_main.2.F90]
* GABLS3 atmospheric forcing file - cloud liquid/ice arrays are now included: [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/defatm_GABLS3_L41.2.nam]

== To be continued ==
* Radlsw is reading in the correct coefficients (from suclopn.F90) used in the various parameterisations of the (short wave) cloud optical properties but perhaps it is necessary to recalculate the parameterisation with Mie-Debye theory.

* The diffuse/direct radiation split in the IFS scheme is not correct. Global SW is computed and when cloud=0 , all the SW is put into direct; when cloud=1 all SW is put into diffuse - this is not correct. See [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201210/SomeTransOutput.pdf] where the various transmittances for the diffuse and direct cases are actually the same.

* Compare the SW schemes to those used in ECHAM5 to check if they are implemented correctly.

ECHAM5 uses sw.F90, swr.F90, swni.F90, etc., i.e. the same main radiation routines as in the IFS code, however, sw.F90 is called from the routine .../model/rad_int.F90, which is made at MPI and not at ECMWF.  Only 2 spectral bands or 4 spectral bands may be chosen. The same spectral divisions as in the IFS model are used, however, the cloud inherent optical property parametrisations are based on Rockel et al. (1991), with coefficients given in .../module/mo_sw_clop.F90. The implementation of the IFS-radiation scheme is clearly very different from model to model, even though it is often referred to as something that is congruent between models that use this. In AROME/Harmonie there are also local changes in some of the core radiation routines for cloud overlap options.