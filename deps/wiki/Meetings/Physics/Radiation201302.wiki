[[PageOutline]]
[[Center(begin)]]
= '''HARMONIE Radiation Working Week''' =
''DMI, 25^th^ - 28^th^ of February 2013''

Last modified [[LastModified]]
[[Center(end)]]

== Practical ==

 * Participants:
  * Met Éireann:      Emily Gleeson
  * Danish Meteorological Institute:     Kristian Pagh Nielsen
  * Danish Meteorological Institute:     Ulrik Smith Korsholm
  * Danish Meteorological Institute:     Alexander Baklanov
  * Danish Meteorological Institute:     Bent Hansen Sass
  * Danish Meteorological Institute / Copenhagen University:  Roman Nuterman
  * Finnish Meteorological Institute:     Laura Rontu

== Objectives ==

The ultimate goal of this work is to make comparisons and improvements of the radiation schemes available in HARMONIE, i.e. the IFS, ACRANEB and HLRADIA. AROME physics has been chosen for the platform where all radiation routines can be compared in a clean way. Thus, calls of all three radiation routines are being implemented in apl_arome.F90, with common interfaces between radiation and clouds, aerosol and surface. In this framework, a clean comparison of any further developments inside the three radition schemes is also possible. It is important to allow the radiation routines to concentrate on radiation and prepare the common input concerning cloud, aerosol and surface state before entering the radiation calculations.  

This work is a continuation from [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201210 the previous radiation working weeks].

== Agenda ==

 * Monday: Cloud physics and harmonization of radiation subroutine versions.
 * Tuesday: Aerosol and cloud-aerosol physiscs and implementations with emphasis on modules from Enviro-HIRLAM
 * Wednesday: Cleaning the radiation subroutine and the radiation namelist in HARMONIE.
 * Thursday: Hirlam-B strategy: (i) next steps in HIRLAM-B including integrated modelling (step by step as we agreed in Odessa), (ii) join plans for this with MeteoFrance, (iii) for this we included into COST EuMetChem plans and budget a joint HIRLAM-ALADIN meeting in May (in Toulouse or Copenhagen).

== Branch ==

A [https://hirlam.org/trac/browser/branches/harmonie-37h1.radiation new branch] based on .../branches/harmonie-37h1.2.bugfix has been made at hirlam.org. As a starting point for the further developmens, we added a version of apl_arome.F90 which is able to call both IFS and HIRLAM radiation schemes, with necessary updates in default namelists and elsewhere. Code from this branch should be used for development purposes only, possibly exporting code from there also to the corresponding MUSC experiments.  

== Clouds ==

 === Results of sensitivity experiments ===

 The sensitivity experiment results remain at the [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201210 wiki-page from the previous working week] in order to avoid confusion. An improved liquid cloud optical parametrisation is the primary accomplishment since the last meeting. 

== Harmonizing radiation subroutine versions ==

There are many versions of the IFS radiation scheme around in different models (HARMONIE, ECMWF, ECHAM ...). However, even hlradia presently comes in many flavours: the one in HIRLAM v.7.4, another in HARMONIE (edited in our experiments), the third for ENVIRO-HIRLAM (including aerosol, different development codes). It is desirable to unify them before continuation of comparisons in HARMONIE. It was found that the old single-column HIRLAM provides a suitable environment for the unification work and testing. Attached is a tarball of [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201302/ae1_20130306.tgz h1d with aerosol] which can be used and modified. 

MUSC, the single column HARMONIE is considered the optimal environment for radiation code development. harmonie_MUSC branch in the svn.hirlam.org repository contains a version based on cycle 37h1, compatible with our [https://hirlam.org/trac/browser/branches/harmonie-37h1.radiation new branch] . In the future, MUSC versions will follow the IFS-HARMONIE cycles: a version based on [https://hirlam.org/trac/browser/branches/harmonie_MUSC_cy38h1 cycle 38] is available for testing but does not yet contain any of our radiation updates. A useful course on HARMONIE MUSC is arranged in the [http://www.helsinki.fi/~jaraisan/numlab2013/NumLab13.html University of Helsinki].

LR: About the situation in the beginning of April, 2013. A consistent version of hlradia is available for testing in HIRLAM and HARMONIE. It contains the aerosol code by Kristian, which can be switched off by feeding hlradia with zero aerosol. In HARMONIE, this can be arranged at the level of apl_hlradia.F90, in 1D HIRLAM via initial files. The basic code is available via the harmonie-37h1.radiation branch after the update [https://hirlam.org/trac/changeset/11733 11733] and in harmonie-MUSC experiment haerad, see changeset [https://hirlam.org/trac/changeset/11732 11732]. The updated tarball for 1D HIRLAM is [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201302/ae1_20130403.tgz here].

== Aerosols ==

* Which aerosols are used in HARMONIE?
  * Answer from Aurore Voldoire on the 7th of March 2013: "''I have coded in the ARPEGE code and my code has been used in AROME/HIRLAM but I do not really know the AROME code so I can just give you an indication of the reason, based on my knowledge of ARPEGE. In fact the six aerosols which are read are not the same as those which are used in the radiation code. There is a re-organisation of the aerosols types in the routine radaer.F90: In the PAER table you have finally:''
    * 1 = Land + Sulphate+ tropospheric background
    * 2 = Sea
    * 3 = Desert
    * 4 = Soot
    * 5 = Volcanic background
    * 6 = Stratospheric background

    ''This is this 6 types which are really used in the radiation code. In the original code, the last two categories are specified as a constant later in the radiation code, that is probably why you have seen that they are set to zero.  It is not the sulphate that is set to zero.''"
* 
  * Answer from Antoinette Alias on the 13th of March 2013: "''I can add that volcano aerosols were added for climate runs that is why they were set to zero as AROME is only for forecast runs at that stage. This should not change the usual behavour for AROME. You could check apl-arome.F90 in cy35t1 (without volcanos) and cy36t1 (with introduction of volcano).''"
  * LR: Aerosol found in one gridpoint (close to Helsinki) in the MUSC experiment haerad can be found in this [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201302/zaerfig.pdf figure]. This aerosol is seen by radiation routines, unless the input is not modified deeper inside the (IFS) radiation code.
  * KPN comments to this: 
    * If constant values are used in the IFS radiation scheme for the aerosol types 5 and 6, what are these values?
    * Are they significant?
    * Is it correct to assume that the stratospheric background aerosols are mostly sulphate droplets (H2SO4) - Are there any other aerosols that normally exist in the stratosphere?
      * HN03 - nitric acid - also exists in the stratrosphere, however, this aerosol type is not considered in the currently used IFS-scheme or in the Global Aerosol Data Set (GADS).
* How can the HARMONIE aerosol types be mapped into the Global Aerosol Data Set (GADS) types used in HLRADIA?
  * Soot -> SOOT
  * Land -> 1/3 INSO + 2/3 WASO
    * These fractions are estimated from the plots of INSO and WASO in the GADS report (Köpke ''et al.'' 1998).
  * Sea -> SSCM
  * Desert -> MITR
  * Volcanic & stratospheric background -> SUSO
* How can the HARMONIE aerosol optical depths be used in HLRADIA?
  * KPN: It will be necessary to re-write the interface and the subroutine, as it currently uses aerosol loads rather than optical depths. This requires some work but should not be a problem.
* How can we get more realistic aerosols into the model?
  * Is it possible to assimilate satellite observations of aerosol optical depth?
    * < unanswered >
  * Can we add emissions in the model?
    * Ulrik could introduce a simple way to define emissions as sources of aerosol in AROME/SURFEX (a task for later development)
    * ... they also need to be advected in the model.
    * Kristian: This is a lot of work, since the aerosols need to be added as new GFL variables. This should be done in collaboration with Meteo France.
    * Alexander: Elements of Enviro-HIRLAM can be implemented into HARMONIE step by step. Meso-NH has a fully online-coupled model, which could be used as a starting point.
* How to import aerosol test data e.g. from offline/coupled air quality models?
  * Alexander: It can be done by different ways: from simplest literature data and measurement distributions, to climatic or averaged modeled fields, to reading off-line ACT model output (e.g. operational DMI-CAMx forecast) or archives (e.g. TRANSPHORM DMI-CAMx fields), to fully online integrated aerosol emission and dynamics (simplified or comprehensive). Involvement into the EuMetChem (eumetchem.info) and AQMEII (aqmeii.jrc.ec.europa.eu) exercise for year 2010 would be very useful, because all available datasets are prepared for that. 
  * LR: SILAM, http://silam.fmi.fi is a system for integrated modelling of atmospheric composition, which is off-line coupled to HIRLAM, ECMWF, possibly HARMONIE. It is possible to receive aerosol data from there in grib format. Mikhail Sofiev writes: "SILAM has sulphates, nitrates, ammonium, mixture of primary black carbon (soot) and organic carbon with some fractionation that can be roughly guessed, and sea salt. Fire smoke is a mixture of the above. Yet-missing components are dust and secondary organics." We might try to set up a Finnish-Russian Harmonie domain to try the 2010 summer data. This is the summer of widespread forest fires in Russia and elsewhere. SILAM has been rerun for this summer. Mikhail writes: "We were considering something like July - September if I remember right. But 15.7 - 25.8 will also do if you have something to initialise from. The worst in Moscow was 5-7.8, the wider areas were burning most of July and August." It is also possible to find space-born and in-situ aerosol measurements for comparison during this period. However, for the radiation HARMONIE study, the question is more about the sensitivity of the ECMWF and HIRLAM radiation schemes to the aerosol load.

=== Enviro-HIRLAM ===

Alexander: Enviro-HIRLAM is developing as a fully online integrated ACT-NWP modeling system. At the first phase it was built on base of the HIRLAM NWP model, now we need to realise it on base of the HARMONIE NWP platform. Enviro-HIRLAM is not a model based only on HIRLAM, this an integrated model of the HIRLAM community, so following the HIRLAM strategy the new version should be realised based on HARMONIE NWP base. Further work with Enviro-HIRLAM based on HIRLAM is moving more to the University of Copenhagen and other partners. The current version, developing by Roman Nuterman (UoC), is focusing on the needs of NWP (and possibly for climate applications) with a very cheap chemistry (which is needed for aerosol formation) and aerosols which are important for interaction with radiation and clouds. 

Roman Nuterman updated the working group on the latest results with Enviro-HIRLAM. This model now uses the M7 aerosol module 
(Vignati et al. 2005) that has the following aerosol types:

- Sulf. Modes: nucleation/aitken/accumulation/coarse (soluble)
- BC. Modes: aitken (soluble/insoluble), accumulation/coarse (insoluble)
- OC. Modes: aitken (soluble/insoluble), accumulation/coarse (insoluble)
- SS. Modes: accumulation/coarse (soluble)
- Dust. Modes: accumulation/coarse (insoluble)

Each size mode follows a log-normal distribution.

Emission module: TNO (Kuene et al. 2010). Resolution 0.12 degrees x 0.06 degrees.

Wet deposition: Stier et al. (2005).
Dry deposition: Roeckner et el. (1992).

Roman: "I would like to change these into something where the deposition depends on the dynamics and on surface type."

The chemistry calculations focus mainly on sulphur.

Relative computational costs of adding aerosol microphysics:

- Physics: 0.59 s vs 0.06 s per time step without aerosols (x 10).
- Semi-Lagragian: 1.22 s vs 0.18 s per time step without aerosols (x 6.8).
- All: 1.3 s vs 0.19 s per average time step without aerosols (x 6.8). These average time steps also include time used for e.g. initialization and post processing. 

Ongoing work:

- Implementing STRACO with aerosol activation scheme by Abdul-Razzak and Ghan (2000).
- Coupling with aero_RT radiation scheme in hlradia
- New wet deposition scheme (Croft et al. 2009).

Romans presentation at the meeting can be seen [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201302/Nuterman_radiation_WS_v1.ppt here].

=== New STRACO version for use in high resolution HARMONIE ===

Ulrik updated on his work with Bent on the STRACO scheme and on the prospects for using this in HARMONIE.

- The purpose of this work is to make a 2-moment stratiform scheme that is fast enough to run operationally.
- The cloud droplet number concentration is implemented in STRACO, which is tested in 1-D HIRLAM.
- The cloud ice particle number concentration is being implemented in STRACO by Ph.D.-student Maher Sahyoun.
- Processes included in the scheme: Nucleation, self collection, autoconversion, evaporation.
  - 4 different nucleation schemes can be used: the Abdul-Razzak scheme, the Twomey scheme and two types of modified Twomey scheme (Cohard et al.).
  - Cloud droplet distribution function and self collection parametrization by Seifert and Beheng (2006) are used.
  - Droplet with masses above a critical mass are autoconverted (to rain).
- This scheme covers different aspects than the eddy mass flux scheme (EDMFm), hence they should be able to work together.

Ongoing work:

- Adding graupel.
- Assume rain drop size distribution based on Abel & Boutle (2012).
- Prognostic rain/sedimentation. 
- Implementation of the calculation of the effective radius in apl_arome.F90. From here is can be input to the radiation scheme, where a local calculation of the effective radius is then no longer necessary.
- Correspondence between Ulrik on the one hand and Lisa and Wim on the other hand should be enhanced.

Ulriks presentation at the meeting can be seen [https://hirlam.org/trac/attachment/wiki/HarmonieWorkingWeek/Radiation201302/HIRLAM-B-Feb-2013.pdf here].

== Cleaning the IFS-radiation scheme in HARMONIE ==

In the main IFS-radiation routine several options that make little sense physically. Also the optical property namelist variables affect both the SW and LW parts of the code.
* We cleaned up the NRADLP, NRADIP, NLIQOPT and NICEOPT options in radlsw.F90, removing non-sensible options e.g. ones with NRAD* set to a constant etc.
* Setting NLIQOPT, NICEOPT affects both the SW and LW calls. We created 4 new variables: NSWLIQOPT, NLWLIQOPT, NSWICEOPT, NLWICEOPT (also introduced to naerad.h, suecrad.F90, yoerad.F90).
* RSWINHF was set to 0.7 by default. Now this is only the case in the Fouquart scheme and otherwise to 1.
* Removed NAER=1 from the main HARMONIE namelist (harmonie_namelist.pm) as it's hardcoded to 6 everywhere where aerosols are used.
* Removed NSW=6 from the main HARMONIE namelist as this is only only working option.

== Summary ==

 - A new branch - a "sandbox" - has been made for the radiation updates to HARMONIE. Change sets from here can then be ported to the trunk version, when they have been tested, also they can be directly imported to MUSC for experimenting.
 - The hlradia versions both with and without aerosols have been harmonized, further checking before implementation to the branch.
 - The shortwave radiation scheme sensitivity test is almost complete.
 - Roman Nuterman gave an update on the work with Enviro-HIRLAM.
 - Ulrik Korsholm gave an update on the work with the STRACO routine and how this can be implemented in HARMONIE.
 - Work has begun with cleaning the IFS-radiation scheme and pulling out the key namelist variables to the main HARMONIE namelist. 

== Further work ==

 - Correcting the [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201210#SomepointsrelatingtotheModel diffuse/direct split in HARMONIE version running IFS radiation].
 - Correcting the coupling of the radiation variables to SURFEX regarding spectral components and diffuse/direct irradiances.
 - HARMONIE has 6 aerosol types hardcoded in .../phys_dmn/apl_arome.F90 although the variable NAER exists. NAER is set to 1 in .../phys_radi/suecrad.F90 and in the default MUSC GABLS namelist. Why not setting NAER to 6 and utilizing this - problem of hardcoded aerosol types? 
 - Implementing a 6 aerosol scheme into HLRADIA that is in agreement with the [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201210#Aerosols aerosols currently available in HARMONIE], testing via 1d HIRLAM first.
 - Move cloud microphysics calculations from .../arp/phys_ec/radlsw.F90 to .../arp/phys_dmn/apl_arome.F90 so that this can be used consistently in all physics sub-routines.
 - When NOVLP is set to 5 or 6, the Delta-Eddington calculations in the core of the radiation scheme have been modified by people from Meso-NH. Since the HARMONIE default currently is 6, this must be investigated further.
 - Comprehensive tests of the HARMONIE longwave radiation schemes should be done in a similar fashion to the test of the shortwave radiation schemes.
 - Run more experiments with MUSC and 3D HARMONIE for all changes done.
 
== Reference: previous HARMONIE working weeks on radiation ==

 * [https://hirlam.org/trac/wiki/HarmonieWorkingWeek/Radiation201210 A working week on radiation was held at Met Éireann] from the 17^th^ to the 19^th^ of October 2012.
 * A working week on radiation was held at FMI from the 11^th^ to the 20^th^ of April 2012.

== Some Useful Files ==

