= Configuration Issues =
To configure the HARMONIE system in your experiment directory ($EXP indicating the experiment name), do the following from your home directory. In this example for some Linux box with MPI (LinuxPC-MPI, the rest of the choices are found [https://hirlam.org/trac/browser/tags/harmonie-37h1.1/config-sh].
{{{
mkdir -p hm_home/$EXP
cd hm_home/$EXP
PATH_TO_HARMONIE/config-sh/Harmonie setup -r PATH_TO_HARMONIE -h LinuxPC-MPI
}}}
This results in:
{{{
config-sh/
Env_submit -> config-sh/submit.LinuxPC-MPI
Env_system -> config-sh/config.LinuxPC-MPI
sms/
}}}

The Env_system file typically contains most of the installation/build specific definitions to be changed to suite your environment:

Do you want to use Makeup or GMKpack? (both of them are able to do the job, defaults to Makeup):
{{{
export MAKEUP=${MAKEUP-yes}
}}}

In case of Makeup:
{{{
# Makeup settings
# Set MAKE_OWN_PRECOMPILED=yes if you want to make your own pre-compiled binaries.
# These will be placed in $PRECOMPILED. If $PRECOMPILED already exists, HARMONIE will be
# built on top of PRECOMPILED's compiled binaries.
export MAKEUP=${MAKEUP-yes}
export MAKEUP_BUILD_DIR=$HM_LIB                                          # Directory for Makeup compilation
export MAKEUP_BUILD_GRIB_API_FLAG="-A"
export PRECOMPILED=""
export MAKE_OWN_PRECOMPILED=no
}}}

or GMKpack:
{{{
# GMKPACK, normally only the location of the ROOTPACK should be changed
export ROOTPACK=/nobackup/smhid9/sm_uandr/rootpack
export GMKROOT=$HM_LIB/util/gmkpack
export GMKFILE=INTEL.$HARMONIE_CONFIG
export GMKTMP=$HM_DATA/gmktmp
}}}

In a scattered fashion some GMKpack settings, less frequently modified, are in sms/config_exp.h:
{{{
case $MAKEUP in
no)
                                             # Definitions about gmkpack, should fit with hm_rev
     BUILD_ROOTPACK=${BUILD_ROOTPACK-yes}    # Build your own ROOTPACK if it doesn't exists (yes|no)
	                                     # This may take several hours!
                                             # Make sure you have write permissions in ROOTPACK directory defined in Env_system
     REVISION=37h1                           # Revision ( or cycle ) number, has to be set even for the trunk!
     BRANCH=main
     VERSION=01                              # Version of revision/branch to use
     OPTION=x                                # Which gmkpack/arch/SYSTEM.HOST.OPTION file to use
   ;;
   yes)
   ;;
}}}
External libraries in Env_system as applicable:
{{{
# Path to auxiliry libraries,. GRIB/BUFR/dummies
if [ "$MAKEUP" == "yes" ] ; then
  # BUFR
  export BUFR_TABLES=$HM_LIB/util/auxlibs/bufr_000381/bufrtables/      # directory with BUFR tables
  # GRIBEX
  export LOCAL_DEFINITION_TEMPLATES=$HM_LIB/util/auxlibs/gribex_000370/gribtemplates
  export ECMWF_LOCAL_TABLE_PATH=HM_LIB/util/auxlibs/gribex_000370/gribtables/
  # GRIB_API
  export GRIB_TEMPLATES_PATH=$HM_LIB/util/grib_api/grib_api-1.9.9/samples
  export GRIB_SAMPLES_PATH=$HM_LIB/util/grib_api/grib_api-1.9.9/samples
  export GRIB_DEFINITION_PATH=$HM_LIB/util/grib_api/grib_api-1.9.9/definitions
else
  # BUFR
  export AUXLIBS=/home/harmonie/auxlibs/auxlibs_installer.1.5/INTEL/lib
  export BUFR_TABLES=$AUXLIBS/bufrtables/
  # GRIBEX
  export LOCAL_DEFINITION_TEMPLATES=$AUXLIBS/gribtemplates
  export ECMWF_LOCAL_TABLE_PATH=$AUXLIBS/gribtables/
fi
}}}

Plus more or less something depending on the structure of the Env_system file and a build configuration file in question. 

For makeup the build configuration files are in most cases named according to the $HARMONIE_CONFIG (like config.linux.gfortran.mpi):
{{{
# Configuration identifier for gmkpack and util config files
export HARMONIE_CONFIG=linux.gfortran.mpi
}}} 

and resides under util/makeup. Whereas GMKpack adds the name of the compiler as prefix to the $HARMONIE_CONFIG (like GFORTRAN.LINUX-MPI.x), these can be found from util/gmkpack/arch. Check if something has to be changed also in the build configuration file.

When installing on a novel or peculiar system you may also have to modify the CPP flags in play [https://hirlam.org/trac/attachment/wiki/HarmonieSystemDocumentation/cpp_macros.pdf (pdf)].

 