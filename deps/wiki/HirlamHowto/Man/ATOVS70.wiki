[[PageOutline]]

[[Center(begin)]]
== '''Hirlam System Documentation''' ==
= '''Assimilation of ATOVS data (old guide, <V7.0)''' =
[[Center(end)]]

A new and updgraded version of the ATOVS processing system is being implemented,
and the corresponding documentation is available [wiki:HirlamSystemDocumentation/Analysis/ATOVS here].

= Introduction =

The ATOVS term is used to describe the set of sounder instruments flown on
for instance the noaa satellite series. The sounder instruments are designed to
provide information about the temperature and humidity profiles of the atmosphere.

The ATOVS instruments on for instance noaa16 are the passive microwave sounders
amsu-a and amsu-b, and the infrared sounder hirs/3. The amsu-a instrument operates
in the lower microwave range, while amsu-b operates in the higher range, and is
therefore more sensitive to cloud contamination.

HIRLAM 3D-var is currently capable of assimilating amsu-a observations successfully
over open sea. Experiments are also ongoing for assimilating amsu-b over open sea
and amsu-a over sea ice. There have also been experiments to assimilate HIRS over
open sea, but some tuning still remains before this option can be used operationally.

The amsu-a observations made by the noaa satellites can be received free of charge
by using a local antenna, or members of EUMETSAT may receive the observations
free of charge through the EUMETSAT retransmission service EARS. This service
collects locally received data at different locations in Europe, processes the data
using AAPP (EUMETSAT free software) to level 1B, and distributes the data freely.

The starting point for the processing chain in HIRLAM is level amsu-a level 1c pass
files (one per pass over each receiving station). The level 1c pass files should first
the be processed individually to 2a files one by one using the program [wiki:HirlamHowto/Man/hitmerge7 hitmerge7].
The 2a files should then be processed together by [wiki:HirlamHowto/Man/landx landx] so that data is gathered
in one file relevant to each assimilation cycle. These 2a files should finally be converted
to BUFR files by [wiki:HirlamHowto/Man/hitmerge7 hitmerge7]. These ATOVS BUFR files are input to HIRLAM 3D-VAR.

HIRLAM 3D-Var also needs information about the ATOVS bias correction. This is
controlled by the bccf index file (usually called bccf.index). The bccf files are
generated by the program [wiki:HirlamHowto/Man/mkbccf mkbccf]. Observations that do not have bias corrections
(bccf file), are ignored. HIRLAM 3D-Var also need information about the observation
error covariance matrix. The current implementation allows correlations between
channels, this option is usually not applied (since we do not know the correlations).
There is no program available for generating the observation error matrix (dbt-files),
and these files are usually generated by trial and error. Use existing files as templates.
HIRLAM will ignore ATOVS observations that do not have a corresponding dbt-file.
HIRLAM 3D-Var uses a forward model to simulate the ATOVS observations from model
fields, that is called RTTOV. The RTTOV model uses a series of coefficient files, typically
"rtcoef_noaa_15_amsua.dat". The current version of RTTOV is 7, but RTTOV8 will be
implemented in the reference shortly.

The relevant ATOVS BUFR must be concatenated into a file named "ATOVIO01".
Further in the namelist "&NAMBUFR" we must have "LATOVF(1)=.TRUE." in order
for OBSPROC to put the ATOVS data into the CMA array.
HIRLAM 3D-Var must have "LLRTM=.TRUE.," in the namelist "&obstypes" in the files
prepobstypes.dat, scrobstypes.dat and minobstypes.dat. Note that if LLRTM is false
in prepobstypes.dat, but not the other files, the system will abort.

The following files must be available for HIRLAM 3D-Var:
 *   {{{fort.1000}}}     ({{{dbt.index}}}, made by user)
 *   {{{fort.1002}}}     ({{{bccf.index}}}, from [wiki:HirlamHowto/Man/mkbccf mkbccf])
 *   {{{emis.dat}}}      (emissivity file, from [wiki:HirlamHowto/Man/hitmerge7 hitmerge])
 *   {{{rtcoef_noaa_15_amsua.dat}}}  (RTTOV7 coefficient file)
 *   {{{rtcoef_noaa_16_amsua.dat}}}  (RTTOV7 coefficient file)
 *   {{{rtcoef_noaa_17_amsua.dat}}}  (RTTOV7 coefficient file)
 *   {{{lrtcoef_noaa_15_amsub.dat}}}  (RTTOV7 coefficient file)
 *   {{{rtcoef_noaa_16_amsub.dat}}}  (RTTOV7 coefficient file)
 *   {{{rtcoef_noaa_17_amsub.dat}}}  (RTTOV7 coefficient file)
 *   {{{fort.1001}}}     ({{{rtatov_noaa.ascii}}}, RTTOV5 coefficient file)

The ATOVS innovation data is available in the ACMA file generated by HIRLAM 3D-Var.
The ACMA file is processed by cmatortm to generate rtm.raw files which are used
by [wiki:HirlamHowto/Man/putbias putbias] to update the ATOVS bias database. The program [wiki:HirlamHowto/Man/mkbccf mkbccf] can in
turn be run to generate the BCCF files used by HIRLAM 3D-Var. in order to generate
innovation data in the ACMA file, _you already need a bccf file_. Use an existing
file as template, but do not specify a corresponding dbt-file since the bias corrected
observation will be very odd. Run HIRLAM on an appropriate period without assimilating
the data (but with a dummy bccf file) while you store the ACMA files. Next create your
ATOVS bias database by using [wiki:HirlamHowto/Man/putbias putbias]. Finally generate your BCCF files by using
the program [wiki:HirlamHowto/Man/mkbccf mkbccf].


== Example ==

Assimilating ATOVS successfully gives entries in the HIRVDA log similar to:
{{{
...
 IORTME          Opening file:emis.dat
 IORTME          Emissivities read: 1796
...
 PREPARE_RTM_MOD Total number of obs:          553
 PREPARE_RTM_MOD Land mask:                    -57 ( 10.3%)
 PREPARE_RTM_MOD Cloud mask:                     0 (  0.0%)
 PREPARE_RTM_MOD No bccf file:                   0 (  0.0%)
 PREPARE_RTM_MOD No bias cor. available:         0 (  0.0%)
 PREPARE_RTM_MOD No btcm file:                   0 (  0.0%)
 PREPARE_RTM_MOD -----------------------
 PREPARE_RTM_MOD Accepted:                     496
...
 RTM_THINN  Satellite: noaa16    Instrument: amsu-a
 RTM_THINN  Total number of obs:          496
 RTM_THINN  Thinned:                     -372 ( 75.0%)
 RTM_THINN -------------------------------------------
 RTM_THINN  Accepted:                     124
...
--------------- RTM Cost function contributions ----------------------------
...
 noaa16   amsu-a       ice  ch: 1   Jrtm=      11.78 HX-Y= 11.27 active:   41
 noaa16   amsu-a       ice  ch: 2   Jrtm=       9.93 HX-Y=  8.76 active:   58
 noaa16   amsu-a       ice  ch: 3   Jrtm=       3.82 HX-Y=  3.65 active:   58
 noaa16   amsu-a       ice  ch: 4   Jrtm=      38.74 HX-Y=  3.06 active:   89
 noaa16   amsu-a       ice  ch: 5   Jrtm=      81.81 HX-Y=  1.19 active:  117
 noaa16   amsu-a       ice  ch: 6   Jrtm=       8.03 HX-Y=  0.12 active:  124
 noaa16   amsu-a       ice  ch: 7   Jrtm=      12.91 HX-Y= -0.05 active:  124
 noaa16   amsu-a       ice  ch: 8   Jrtm=      15.91 HX-Y= -0.02 active:  124
 noaa16   amsu-a       ice  ch: 9   Jrtm=       3.08 HX-Y=  0.11 active:  124
 noaa16   amsu-a       ice  ch:10   Jrtm=      61.23 HX-Y= -0.48 active:  124
 ----------------------------------------------------------------------------
 Total (no rep:  330)               Jrtm=     800.23 active: 2609
...
}}}

The {{{bccf.index}}} file (processed by [wiki:HirlamHowto/Man/nukem nukem])
typically looks like this:
{{{
 GETIND INDEX FILE V1.0 [0]
 #
 LIST OF SATELLITES, CATEGORIES AND INDEXED FILES [*] %
 noaa15 amsu-a ../noaa15amsu-a_bccf.dat
 noaa16 amsu-a ../noaa16amsu-a_bccf.dat
 #
}}}

The bccf-file is a fixed format file, so be careful if you edit it!
The first line tells us which version of the file this is, which
satellite and instrument it is valid for, and for which time period
it is based on.
The second line tells us how many categories there are (sea, ice, mixed),
how many channels, predictors and latitude bands there are.
The last number is the number of observations necessary in order
to report the bias correction coefficients.
Then follows the number of observations used to calculate the
 coefficients for each latitude, category and predictor.
If there are too few observations, the coefficients are omitted.
A bccf file typically looks like this:
{{{
BC COEF FILE V1.6 noaa16   amsu-a       FROM:2004/11/30 23:52: 0.00 TO:2005/01/08 19:46: 0.01
  3  15   7   3     1000
     0.000     45.000
        0
        0
        0
    45.000     65.000
    259790
0.7271998636E+02 0.1443670233E+03 0.8760153071E+02 0.1673030750E+02 0.4242317291E+01 -.1861353875E+01 -.4275281724E+01 -.2379258266E+01 -.4430606399E+01 -.5292460624E+01 -.2103844926E+02 -.4472382930E+02 -.4543677830E+02 -.3998462012E+02 0.1789684713E+03
0.4770340365E-02 -.8154260612E-01 -.8436554214E-02 0.5802057175E-02 0.1326017611E-02 -.5111844715E-03 -.3438593402E-02 -.4318854859E-02 -.1642977030E-02 -.8661311808E-02 -.4396701353E-01 -.1650587193E+00 -.3164541458E+00 -.3353355023E+00 0.5944618937E-01
0.2107616189E-01 0.4222309437E-01 0.3383047193E-01 0.8665384272E-02 -.1931476351E-03 0.6376990009E-03 0.6422862812E-02 0.2695041273E-02 -.5565612944E-03 -.6265324662E-02 -.3624797076E-01 -.1430132473E+00 -.3020900064E+00 -.3647578532E+00 -.8705782840E-02
-.3118425805E+00 -.4437689101E+00 -.3428677494E+00 -.8263702829E-01 -.1540507820E-01 0.5002105587E-02 0.8789900298E-02 0.1128353104E-01 0.1896050905E-01 0.4446435269E-01 0.2189872786E+00 0.7224653240E+00 0.1295925550E+01 0.1423434873E+01 -.7045064096E+00
0.1859725911E+00 0.5214948482E+00 0.2616408525E+00 0.3286567131E-01 -.4935045470E-02 -.1124626039E-02 0.4296903011E-02 0.6391299950E-02 0.5955001027E-02 0.1211133805E-01 0.3552572006E-01 0.9303415648E-01 0.1536162188E+00 0.1494954913E+00 0.1632487073E+00
-.3250524413E-03 -.2653249915E-03 -.1496699900E-02 -.6688185475E-03 -.1629589054E-03 0.9905725920E-04 0.2873663432E-03 0.9323635578E-04 -.2783159038E-04 -.1308561366E-03 -.2400147259E-03 -.5036820528E-03 -.5878416317E-03 -.2854221667E-03 -.7910524287E-03
0.1331813201E-02 -.2324128533E-01 0.1220441099E-01 0.3225773977E-02 -.1619472968E-02 0.4971112004E-02 0.2873362156E-02 0.4964362521E-03 0.7514095949E-02 0.7719016586E-02 0.8319368547E-02 0.8401826624E-02 0.6660980007E-02 0.4670424904E-02 -.2938609573E-02
        0
        0
    65.000     90.000
        0
        0
        0
}}}


The {{{dbt.index file}}} (processed by [wiki:HirlamHowto/Man/nukem nukem]) 
typically looks like this
{{{
 GETIND INDEX FILE V1.0 [0]
 #
 LIST OF SATELLITES, CATEGORIES AND INDEXED FILES [*] %
 noaa15 amsu-a ../noaa15amsu-a_dbt.dat
 noaa16 amsu-a ../noaa15amsu-a_dbt.dat
}}}




The first line in the dtb-files shows which version of the file we are looking at,
and the time interval which we used to estimate the observation error correlatiions.
The follows a line showing the number of channels and categories.
For each category then follows:
the RTTOV equivalent to the channels is listed.
The number of data used to estimate the observation error is reported next,
along with the observation error covariance matrix.
After this matrix follows the number of channels proposed used during
assimilation, and an indexed list to their location relative to the original order.
A dbt-files typically looks like this:
{{{
BTF V2.1 Mon Mar 11 10:10:10 2002 B  E      0.25000   0.2500 2002/01/01 2002/01/31
  15    3
 28  29  30  31  32  33  34  35  36  37  38  39  40  41  42
   99999
3.000000000E+02 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 3.000000000E+02 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 3.000000000E+02 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.350000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.350000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.350000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.350000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.700000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 1.400000000E+01 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+02 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+01 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+01 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+01 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+01 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+01
  10
 28  29  30  31  32  33  34  35  36  37
  1   2   3   4   5   6   7   8   9  10
   99999
2.240000000E+02 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 3.670000000E+02 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 1.080000000E+02 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 9.860000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 1.190000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.300000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.560000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.740000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 1.070000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 2.200000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+05 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+05 0.000000000E+00 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+05 0.000000000E+00 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+05 0.000000000E+00
0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 0.000000000E+00 3.000000000E+05
  10
 28  29  30  31  32  33  34  35  36  37
  1   2   3   4   5   6   7   8   9  10
       0
}}}

= Relevant links =

 * [wiki:HirlamHowto/Man/mkbccf mkbccf.x], creates ATOVS BCCF (Bias Coefficient Correction Files) from BIAS database.
 * [wiki:HirlamHowto/Man/putbias putbias.x], puts "rtm.raw" (from rtmcmaextr.x) ATOVS innovation data into BIAS database.
 * [wiki:HirlamHowto/Man/hitmerge7 hitmerge7.x], can create "rtm.raw" files, BUFR or 2a-files from BUFR files and GRIB files or 2a-files or ascii files.
 * [wiki:HirlamHowto/Man/landx landx.x], can "land-mask" ATOVS 2a-files, merges passes to single files, removes bad data etc.
 * [wiki:HirlamHowto/Man/ascii2bufr ascii2bufr.x], converts ATOVS ascii files to BUFR.
 * [wiki:HirlamHowto/Man/nukem nukem], library used to read input file for the above ATOVS programs.

[[Center(begin)]]
[https://hirlam.org/trac/wiki/HirlamHowto See also the corresponding pages on HIRLAM Howto]
[[Center(end)]]

[[SubWiki]]

[[Center(begin)]]
[https://hirlam.org/trac/wiki/HirlamSystemDocumentation Back to the main page of the HIRLAM System Documentation]
[[Center(end)]]
----
[[Center(begin)]]
[[Disclaimer]]

[[Color(red, Last modified on)]] [[LastModified]]
[[Center(end)]]