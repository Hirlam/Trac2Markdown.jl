```@meta
EditURL="https://:@hirlam.org/trac//wiki/HarmonieSystemDocumentation/ClimateGeneration?action=edit"
```


## Generation of climate and physiography files

## Introduction

The generation of climate files includes two parts. The first part is the generation of climate files for the atmospheric model, the so called 
[e923](http://www.cnrm.meteo.fr/gmapdoc/spip.php?page# recherche&recherchee923) configuration. The second part is the generation of the physiography information for 
[SURFEX](http://www.cnrm-game-meteo.fr/surfex/). In the following we describe how it is implemented in HARMONIE.

*Climate generation in mSMS*

## Input data for climate generation
The location of your input data for the climate generation is defined by the `**HM_CLDATA**` environment variable defined in the [`config.yourhost](Harmonie/config-sh/config.ecgb-cca?rev=release-43h2.beta.3`) file. At ECMWF the climate data is stored on cca here:
` `cca:/ms_perm/hirlam/harmonie_climate` `

Information on what data to download is available here: [wiki:HarmonieSystemDocumentation#Downloadinputdata]. The input data contains physiography data, topography information and climatological values determined from a one year ARPEGE assimilation experiment with a resolution of T79. 

## Preparation of SURFEX physiography file

At present the most applied configuration is to run with SURFEX as the surface scheme. SURFEX needs information about the distribution of different available tiles like nature, sea, water and town. The nature tile also needs information about type of vegetation and soiltypes. The main input sources for this are found at [SURFEX physiographic `maps](http://www.cnrm-game-meteo.fr/surfex/spip.php?rubrique14`).

The data base for SURFEX-file preparation is located under `HM_CLDATA/PGD`
 * `ecoclimats_v2.*` : Landtypes
 * gtopo30.* : Topography
 * `sand_fao.*` : Soil type distribution
 * `clay_fao.*` : Soil type distribution

The generation of SURFEX physiography file (**PGD.lfi**) is done in [`Prepare_pgd`](Harmonie/scr/Prepare_pgd?rev# release-43h2.beta.3). The script creates the namelist OPTIONS.nam based on the *DOMAIN* settings in [`Harmonie_domains.pm`](Harmonie/scr/Harmonie_domains.pm?revrelease-43h2.beta.3). Note that the SURFEX domain is only created over the C+I area. In the namelist we set which scheme that should be activated for each tile.

 | ||||| Tile | 
| --- | --- | --- | --- | --- | --- |
 |# PHYSICS|# Nature|# Sea|# Water|# Town|
 |AROME  |ISBA  |SEAFLX|WATFLX |TEB         |
 |ALARO  |ISBA  |SEAFLX|WATFLX |Town as rock|

The program PGD produces one SURFEX physiography file (**PGD.lfi**), which is stored in *CLIMDIR* directory.

To make sure we have the same topography input for the atmospheric part we call `Prepare_pgd` two times. One time to produce a PGD.lfi for SURFEX and a second time to produce a PGD.fa file that can be used as input for the climate generation described below. Note that for the atmosphere the topography will be spectrally filtered and the resulting topography will be imposed on SURFEX again.
 
## Generation of a non SURFEX climate file

[Climate](Harmonie/scr/Climate?rev=release-43h2.beta.3) is a script, which prepares climate file(s) for 
prefered forecast range. Climate files are produced for past, present and following month. The outline of **Climate** is as follows:

 * Check if climate files already exists.
 * Creation of namelists. The definition of domain and truncation values is taken from [`Harmonie_domains.pm`](Harmonie/scr/Harmonie_domains.pm?rev=release-43h2.beta.3).
 * Part 0: Read the PGD.fa file generated by SURFEX and write it to Neworog
 * Part 1: Filter  `__Neworog__` to target grid with spectral smoothing to remove 2dx waves.
 * Part 2: generation of surface, soil and vegetation variables, without annual variation.
 * Part 3: creation of monthly climatological values and  modification of albedo and emissivity according to the climatology of sea-ice limit.
 * Part 4: definition and modification of the vegetation and surface characteristics
 * Part 5: modification of fields created by step 2 and 4 over land from high resolution datasets (for each month)
 * Part 6: modification of climatological values
 
 The result is climate files for the previous, current and next month. The files are named after their month like **m01**, **m02** - **m12** and stored in *CLIMDIR*.

Further reference [`e923](http://www.cnrm.meteo.fr/gmapdoc/IMG/ps/e923_users.ps`)


----


